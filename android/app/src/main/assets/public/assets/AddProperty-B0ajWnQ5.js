import{r as i,j as e,ab as V,a9 as $,X as H,bc as B,c8 as J,a5 as Y,bA as X}from"./react-vendor-CPmH2tz8.js";import{u as O,a as W,P as Z,b as K,L as Q,c as ee,d as se,e as te,M as re}from"./LocationPicker-C-a9Wq3S.js";import{m as ae,F as ie}from"./route-property-b6Ka_7KN.js";import{aj as le,w as oe,x as ne,C as P,e as C,B as y,s as L,l as U,X as z,b as D,d as R,j as S,Z as A,Y as ce,t as _,aC as de}from"./route-admin-B1Ip8YDE.js";import{D as me}from"./route-owner-C83ejxxl.js";import{F as ue}from"./FormProgressIndicator-BFIH4d_g.js";import{F as pe}from"./FormStepper-CogL4h-a.js";import{N as xe}from"./index-LMib0YFl.js";import{L as fe}from"./route-tenant-DNBKfVUX.js";import"./query-vendor-ByjIuei6.js";import"./monitoring-vendor-C7yD_Gmu.js";import"./ui-vendor-Dua12RDV.js";import"./common-vendor-CK5d0rWc.js";import"./forms-vendor-DqOZ4YtP.js";import"./maps-vendor-B7X9GnXQ.js";import"./route-agency-BEE2sWoQ.js";import"./animation-vendor-BJe5VoH_.js";import"./charts-vendor-16YcNskv.js";import"./supabase-vendor-CzsKfTY-.js";(function(){try{var a=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};a.SENTRY_RELEASE={id:"b65e2d84341e79b518aed72b6e71dcc77eba934a"}}catch{}})();try{(function(){var a=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},l=new a.Error().stack;l&&(a._sentryDebugIds=a._sentryDebugIds||{},a._sentryDebugIds[l]="dff91432-0d27-41ec-8c93-b6a65dabd09c",a._sentryDebugIdIdentifier="sentry-dbid-dff91432-0d27-41ec-8c93-b6a65dabd09c")})()}catch{}const he=({propertyId:a,onUploadSuccess:l,existingUrl:F})=>{const[x,f]=i.useState(!1),[p,h]=i.useState(F||null),{toast:o}=le(),N=async u=>{var c;const s=(c=u.target.files)==null?void 0:c[0];if(!s)return;const b=10*1024*1024,w=["application/pdf","image/jpeg","image/png"];if(s.size>b){o({title:"❌ Fichier trop volumineux",description:"La taille maximale est de 10 MB",variant:"destructive"});return}if(!w.includes(s.type)){o({title:"❌ Format non accepté",description:"Formats acceptés : PDF, JPEG, PNG",variant:"destructive"});return}f(!0);try{const d=s.name.split(".").pop(),T=`${a}/title_deed.${d}`,{data:E,error:g}=await L.storage.from("property-documents").upload(T,s,{upsert:!0,cacheControl:"3600"});if(g)throw g;const m=`property-documents/${E.path}`;h(m),l==null||l(m),o({title:"✅ Titre de propriété ajouté",description:"Le document a été uploadé avec succès"})}catch(d){U.logError(d,{context:"TitleDeedUploader",action:"upload",propertyId:a}),o({title:"❌ Erreur d'upload",description:d.message||"Impossible d'uploader le fichier",variant:"destructive"})}finally{f(!1)}},j=async()=>{if(p)try{const u=p.split("property-documents/")[1],{error:s}=await L.storage.from("property-documents").remove([u]);if(s)throw s;h(null),l==null||l(""),o({title:"✅ Document supprimé",description:"Le titre de propriété a été retiré"})}catch(u){U.logError(u,{context:"TitleDeedUploader",action:"remove",propertyId:a}),o({title:"❌ Erreur",description:"Impossible de supprimer le fichier",variant:"destructive"})}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(oe,{children:[e.jsx(V,{className:"h-4 w-4"}),e.jsxs(ne,{children:[e.jsx("strong",{children:"Document officiel :"})," Le titre de propriété sera accessible uniquement au propriétaire, aux locataires avec un bail actif, et aux administrateurs."]})]}),p?e.jsx(P,{className:"border-success",children:e.jsx(C,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($,{className:"h-5 w-5 text-success"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Titre de propriété ajouté"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Document sécurisé"})]})]}),e.jsx(y,{variant:"ghost",size:"sm",onClick:j,disabled:x,children:e.jsx(H,{className:"h-4 w-4"})})]})})}):e.jsxs("div",{className:"border-2 border-dashed rounded-lg p-8 text-center",children:[e.jsx("input",{type:"file",id:"title-deed-input",className:"hidden",accept:".pdf,.jpg,.jpeg,.png",onChange:N,disabled:x}),e.jsx("label",{htmlFor:"title-deed-input",className:"cursor-pointer",children:x?e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx(B,{className:"h-12 w-12 animate-spin text-primary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Upload en cours..."})]}):e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx(J,{className:"h-12 w-12 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Cliquez pour ajouter le titre de propriété"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"PDF, JPEG ou PNG (max 10 MB)"})]})]})})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"🔒 Ce document sera stocké de manière sécurisée et soumis à des contrôles d'accès stricts."})]})},k=[{id:"basic",label:"Type de bien"},{id:"location",label:"Informations générales"},{id:"characteristics",label:"Photos et description"},{id:"pricing",label:"Prix et disponibilité"},{id:"media",label:"Vérification"}],_e=()=>{const[a,l]=i.useState(0),[F,x]=i.useState(!1),f=i.useRef(null),p=i.useRef(null),h=i.useRef(null),o=i.useRef(null),N=i.useRef(null),j=Y(),{requireOwnerAccess:u}=ae(),{form:s,submitting:b,submitProperty:w}=O(),{uploading:c,progress:d,uploadMedia:T,validateMediaFiles:E}=W(),[g,m]=i.useState({images:[],video:null,panoramas:[],floorPlans:[],virtualTourUrl:""}),[je,M]=i.useState(null),[G]=i.useState(()=>crypto.randomUUID());i.useEffect(()=>{const t=()=>{x(window.scrollY>100);const r=[{ref:f,step:0},{ref:p,step:1},{ref:h,step:2},{ref:o,step:3},{ref:N,step:4}];for(let n=r.length-1;n>=0;n--){const v=r[n];if(v.ref.current&&v.ref.current.getBoundingClientRect().top<=200){l(v.step);break}}};return window.addEventListener("scroll",t),()=>window.removeEventListener("scroll",t)},[]);const q=async t=>{const r=E(g);if(!r.valid){r.errors.forEach(n=>{_({title:"Erreur",description:n,variant:"destructive"})});return}try{const n=await w(t,{images:[],mainImage:null,videoUrl:null,panoramas:[],floorPlans:[]}),v=await T(n,g);await w(t,v,n),j("/mes-biens")}catch{}},I=u();return I.hasAccess?e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx(z,{}),F&&e.jsx(ce,{offsetTop:"top-16",className:"shadow-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold text-lg",children:"Nouvelle Propriété"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Étape ",a+1," sur ",k.length]})]}),e.jsxs(y,{variant:"outline",size:"sm",onClick:()=>{_({title:"Brouillon sauvegardé",description:"Vos modifications ont été enregistrées"})},className:"gap-2",children:[e.jsx(X,{className:"h-4 w-4"}),"Enregistrer brouillon"]})]})}),e.jsx("main",{className:"flex-1 container mx-auto px-4 py-8 pt-24",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx(me,{}),e.jsx("div",{className:"mb-6 mt-4",children:e.jsx(xe,{backTo:"/dashboard",backLabel:"Retour au dashboard"})}),e.jsxs("div",{className:"mb-8 grid md:grid-cols-[1fr,300px] gap-6 items-center p-6 rounded-2xl bg-gradient-to-br from-primary/5 to-secondary/5 border border-border/50",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Publiez votre bien"}),e.jsx("p",{className:"text-lg text-muted-foreground",children:"Remplissez le formulaire en quelques clics et touchez des milliers de locataires"})]}),e.jsx(fe,{src:de("ivorian-family-house"),alt:"Publier un bien",className:"hidden md:block w-full h-[180px] rounded-xl",animate:!0})]}),e.jsx(pe,{steps:k,currentStep:a}),e.jsx(ue,{steps:k,currentStep:a,className:"mt-6"}),e.jsx(ie,{...s,children:e.jsxs("form",{onSubmit:s.handleSubmit(q),className:"space-y-8",children:[e.jsx("div",{ref:f,className:"scroll-mt-32",children:e.jsx(Z,{form:s})}),e.jsx("div",{ref:p,className:"scroll-mt-32",children:e.jsx(K,{form:s})}),e.jsx(Q,{city:s.watch("city"),onLocationSelect:(t,r)=>M({lat:t,lng:r})}),e.jsx("div",{ref:h,className:"scroll-mt-32",children:e.jsx(ee,{form:s})}),e.jsx("div",{ref:o,className:"scroll-mt-32",children:e.jsx(se,{form:s})}),e.jsx(te,{form:s}),e.jsxs(P,{children:[e.jsxs(D,{children:[e.jsx(R,{children:"📄 Titre de propriété (optionnel)"}),e.jsx(S,{children:"Document officiel attestant de votre propriété du bien (PDF, JPEG, PNG)"})]}),e.jsx(C,{children:e.jsx(he,{propertyId:G,onUploadSuccess:t=>s.setValue("title_deed_url",t),existingUrl:s.watch("title_deed_url")})})]}),e.jsxs(P,{ref:N,className:"scroll-mt-32",children:[e.jsxs(D,{children:[e.jsx(R,{children:"Médias"}),e.jsx(S,{children:"Ajoutez des photos, vidéos, vues 360° et plans"})]}),e.jsxs(C,{className:"space-y-4",children:[e.jsx(re,{onImagesChange:t=>m(r=>({...r,images:t})),onVideoChange:t=>m(r=>({...r,video:t})),onPanoramaChange:t=>m(r=>({...r,panoramas:t})),onFloorPlanChange:t=>m(r=>({...r,floorPlans:t})),onVirtualTourUrlChange:t=>m(r=>({...r,virtualTourUrl:t})),uploading:c}),c&&d>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Téléchargement des médias..."}),e.jsxs("span",{children:[d,"%"]})]}),e.jsx("div",{className:"w-full bg-secondary rounded-full h-2",children:e.jsx("div",{className:"bg-primary h-2 rounded-full transition-all duration-300",style:{width:`${d}%`}})})]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(y,{type:"button",variant:"outline",onClick:()=>j("/mes-biens"),disabled:b||c,className:"flex-1",children:"Annuler"}),e.jsx(y,{type:"submit",disabled:b||c,className:"flex-1",children:b||c?e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"mr-2 h-4 w-4 animate-spin"}),"Publication en cours..."]}):"Publier le bien"})]})]})})]})}),e.jsx(A,{})]}):e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx(z,{}),e.jsx("main",{className:"flex-1 container mx-auto px-4 py-12",children:e.jsxs(P,{children:[e.jsxs(D,{children:[e.jsx(R,{children:"Accès refusé"}),e.jsx(S,{children:I.error})]}),e.jsx(C,{children:e.jsx(y,{onClick:()=>j("/"),children:"Retour à l'accueil"})})]})}),e.jsx(A,{})]})};export{_e as default};
//# sourceMappingURL=AddProperty-B0ajWnQ5.js.map
