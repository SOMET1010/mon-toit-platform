{"version":3,"file":"FeaturedProperties-fpsYfsW4.js","sources":["../../src/components/FeaturedProperties.tsx"],"sourcesContent":["import { useState, useEffect, useCallback, useMemo } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { Link } from 'react-router-dom';\nimport { PropertyCard } from '@/components/properties/PropertyCard';\nimport { propertyService } from '@/services/propertyService';\nimport { Property } from '@/types';\nimport { useFavorites } from '@/hooks/useFavorites';\nimport { useAuth } from '@/hooks/useAuth';\nimport { AlertCircle, RefreshCw, ArrowRight } from 'lucide-react';\nimport { handleError } from '@/lib/errorHandler';\nimport { logger } from '@/services/logger';\nimport { toast } from 'sonner';\n\ninterface FeaturedPropertiesProps {\n  limit?: number;\n}\n\nconst FeaturedProperties = ({ limit = 6 }: FeaturedPropertiesProps) => {\n  const [properties, setProperties] = useState<Property[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [isRetrying, setIsRetrying] = useState(false);\n  const [activeFilter, setActiveFilter] = useState<string>('Tous');\n  const { toggleFavorite, isFavorite } = useFavorites();\n  const { user } = useAuth();\n\n  const fetchFeaturedProperties = useCallback(async () => {\n    try {\n      setLoading(true);\n      setError(null);\n\n      logger.debug('Fetching featured properties');\n      const data = await propertyService.fetchAll();\n      logger.debug('Featured properties data received', { count: data?.length || 0 });\n\n      if (!data || data.length === 0) {\n        logger.warn('No properties returned from API');\n        setProperties([]);\n        setLoading(false);\n        setIsRetrying(false);\n        return;\n      }\n\n      // Filter out rented properties - propertyService.fetchAll() already does this\n      const featured = data\n        .sort((a, b) => (b.view_count || 0) - (a.view_count || 0))\n        .slice(0, limit);\n\n      logger.info('Featured properties prepared', { count: featured.length });\n      setProperties(featured);\n    } catch (err) {\n      logger.logError(err, { context: 'fetchFeaturedProperties' });\n\n      let errorMessage = 'Impossible de charger les biens en vedette. Veuillez réessayer.';\n\n      // Provide more specific error messages\n      if (err instanceof Error) {\n        if (err.message.includes('Failed to fetch') || err.message.includes('network')) {\n          errorMessage = 'Problème de connexion. Vérifiez votre connexion internet.';\n        } else if (err.message.includes('JWT') || err.message.includes('auth')) {\n          errorMessage = 'Session expirée. Veuillez vous reconnecter.';\n        } else if (err.message.includes('not found') || err.message.includes('404')) {\n          errorMessage = 'Service temporairement indisponible. Réessayez dans quelques instants.';\n        }\n      }\n\n      setError(errorMessage);\n      handleError(err, errorMessage);\n    } finally {\n      setLoading(false);\n      setIsRetrying(false);\n    }\n  }, [limit]);\n\n  useEffect(() => {\n    fetchFeaturedProperties();\n  }, [fetchFeaturedProperties]);\n\n  const handleRetry = useCallback(async () => {\n    setIsRetrying(true);\n    await fetchFeaturedProperties();\n  }, [fetchFeaturedProperties]);\n\n  const filteredProperties = useMemo(() => {\n    if (activeFilter === 'Tous') return properties;\n    return properties.filter(p => {\n      if (activeFilter === 'Appartements') return p.property_type.toLowerCase().includes('appartement');\n      if (activeFilter === 'Villas') return p.property_type.toLowerCase().includes('villa');\n      if (activeFilter === 'Studios') return p.property_type.toLowerCase().includes('studio');\n      return true;\n    });\n  }, [properties, activeFilter]);\n\n  // Skeleton loader optimisé pour PropertyCard\n  const SkeletonCard = useMemo(() => (\n    <div className=\"bg-white border border-gray-200 rounded-lg overflow-hidden shadow-md\">\n      <Skeleton className=\"h-56 w-full rounded-none\" />\n      <div className=\"p-4 space-y-3\">\n        <Skeleton className=\"h-6 w-3/4\" />\n        <Skeleton className=\"h-4 w-1/2\" />\n        <div className=\"flex items-center gap-4 pt-2\">\n          <Skeleton className=\"h-4 w-16\" />\n          <Skeleton className=\"h-4 w-16\" />\n          <Skeleton className=\"h-4 w-16\" />\n        </div>\n        <Skeleton className=\"h-8 w-full mt-4\" />\n      </div>\n    </div>\n  ), []);\n\n  if (loading) {\n    return (\n      <div className=\"px-4 bg-white\">\n        <div className=\"container mx-auto max-w-7xl\">\n          <div className=\"flex flex-col md:flex-row md:items-end md:justify-between mb-12\">\n            <div>\n              <h2 className=\"text-4xl md:text-5xl font-bold mb-4 text-foreground\">\n                Biens en vedette\n              </h2>\n              <p className=\"text-lg text-muted-foreground max-w-2xl\">\n                Découvrez notre sélection de biens les plus consultés\n              </p>\n            </div>\n          </div>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n            {Array.from({ length: limit }).map((_, i) => (\n              <div key={i}>{SkeletonCard}</div>\n            ))}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"px-4 bg-white\">\n        <div className=\"container mx-auto max-w-7xl\">\n          <div className=\"flex flex-col items-center justify-center py-8 px-4\">\n            <AlertCircle className=\"w-12 h-12 text-destructive mb-4\" />\n            <h3 className=\"text-xl font-semibold mb-2 text-foreground\">\n              Une erreur est survenue\n            </h3>\n            <p className=\"text-muted-foreground mb-6 text-center max-w-md\">\n              {error}\n            </p>\n            <Button onClick={handleRetry} variant=\"outline\" disabled={isRetrying}>\n              <RefreshCw className={`w-4 h-4 mr-2 ${isRetrying ? 'animate-spin' : ''}`} />\n              {isRetrying ? 'Chargement...' : 'Réessayer'}\n            </Button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (properties.length === 0) {\n    return null;\n  }\n\n  return (\n    <div className=\"px-3 md:px-4 bg-gradient-to-b from-white via-primary/3 to-white border-t border-primary/10\">\n      <div className=\"container mx-auto max-w-7xl\">\n        <div className=\"flex flex-col md:flex-row md:items-end md:justify-between mb-6 animate-fade-in\">\n          <div>\n            <h2 \n              id=\"featured-properties-heading\"\n              className=\"text-4xl md:text-5xl font-bold mb-3 text-foreground\"\n            >\n              Biens en vedette\n            </h2>\n            <p className=\"text-lg text-muted-foreground max-w-2xl\">\n              Découvrez les biens les plus populaires cette semaine\n            </p>\n          </div>\n          <Button \n            size=\"lg\" \n            variant=\"outline\" \n            asChild\n            className=\"hidden md:flex items-center gap-2 mt-6 md:mt-0 font-semibold border-2 hover:bg-primary hover:text-white transition-all\"\n          >\n            <Link to=\"/recherche\">\n              Voir toutes les annonces\n              <ArrowRight className=\"h-5 w-5\" />\n            </Link>\n          </Button>\n        </div>\n        \n        {/* Filtres rapides */}\n        <div className=\"flex gap-2 mb-6 overflow-x-auto pb-2\">\n          {['Tous', 'Appartements', 'Villas', 'Studios'].map(filter => (\n            <Button \n              key={filter} \n              variant={activeFilter === filter ? \"default\" : \"ghost\"}\n              size=\"sm\"\n              onClick={() => setActiveFilter(filter)}\n              className=\"whitespace-nowrap font-medium\"\n            >\n              {filter}\n            </Button>\n          ))}\n        </div>\n        \n        <div \n          className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-5\"\n          role=\"list\"\n          aria-label=\"Biens immobiliers en vedette\"\n        >\n          {filteredProperties.map((property, index) => (\n            <div \n              key={property.id} \n              role=\"listitem\"\n              className=\"animate-fade-in hover-scale\"\n              style={{ animationDelay: `${index * 100}ms` }}\n            >\n              <PropertyCard\n                property={property}\n                onFavoriteClick={(id) => {\n                  if (!user) {\n                    toast.error(\"Connectez-vous pour ajouter des favoris\");\n                    return;\n                  }\n                  toggleFavorite(id);\n                }}\n                isFavorite={user ? isFavorite(property.id) : false}\n                variant=\"compact\"\n              />\n            </div>\n          ))}\n        </div>\n        \n        <div className=\"text-center mt-8\">\n          <Button asChild size=\"lg\" className=\"md:hidden font-semibold shadow-lg hover:shadow-xl\">\n            <Link to=\"/recherche\" className=\"flex items-center gap-2\">\n              Voir toutes les annonces\n              <ArrowRight className=\"h-5 w-5\" />\n            </Link>\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default FeaturedProperties;\n"],"names":["FeaturedProperties","limit","properties","setProperties","useState","loading","setLoading","error","setError","isRetrying","setIsRetrying","activeFilter","setActiveFilter","toggleFavorite","isFavorite","useFavorites","user","useAuth","fetchFeaturedProperties","useCallback","logger","data","propertyService","featured","a","b","err","errorMessage","handleError","useEffect","handleRetry","filteredProperties","useMemo","p","SkeletonCard","jsxs","jsx","Skeleton","_","i","AlertCircle","Button","RefreshCw","Link","ArrowRight","filter","property","index","PropertyCard","id","toast"],"mappings":"kuCAkBA,MAAMA,EAAqB,CAAC,CAAE,MAAAC,EAAQ,KAAiC,CACrE,KAAM,CAACC,EAAYC,CAAa,EAAIC,EAAAA,SAAqB,CAAA,CAAE,EACrD,CAACC,EAASC,CAAU,EAAIF,EAAAA,SAAS,EAAI,EACrC,CAACG,EAAOC,CAAQ,EAAIJ,EAAAA,SAAwB,IAAI,EAChD,CAACK,EAAYC,CAAa,EAAIN,EAAAA,SAAS,EAAK,EAC5C,CAACO,EAAcC,CAAe,EAAIR,EAAAA,SAAiB,MAAM,EACzD,CAAE,eAAAS,EAAgB,WAAAC,CAAA,EAAeC,EAAA,EACjC,CAAE,KAAAC,CAAA,EAASC,EAAA,EAEXC,EAA0BC,EAAAA,YAAY,SAAY,CACtD,GAAI,CACFb,EAAW,EAAI,EACfE,EAAS,IAAI,EAEbY,EAAO,MAAM,8BAA8B,EAC3C,MAAMC,EAAO,MAAMC,EAAgB,SAAA,EAGnC,GAFAF,EAAO,MAAM,oCAAqC,CAAE,OAAOC,GAAA,YAAAA,EAAM,SAAU,EAAG,EAE1E,CAACA,GAAQA,EAAK,SAAW,EAAG,CAC9BD,EAAO,KAAK,iCAAiC,EAC7CjB,EAAc,CAAA,CAAE,EAChBG,EAAW,EAAK,EAChBI,EAAc,EAAK,EACnB,MACF,CAGA,MAAMa,EAAWF,EACd,KAAK,CAACG,EAAGC,KAAOA,EAAE,YAAc,IAAMD,EAAE,YAAc,EAAE,EACxD,MAAM,EAAGvB,CAAK,EAEjBmB,EAAO,KAAK,+BAAgC,CAAE,MAAOG,EAAS,OAAQ,EACtEpB,EAAcoB,CAAQ,CACxB,OAASG,EAAK,CACZN,EAAO,SAASM,EAAK,CAAE,QAAS,0BAA2B,EAE3D,IAAIC,EAAe,kEAGfD,aAAe,QACbA,EAAI,QAAQ,SAAS,iBAAiB,GAAKA,EAAI,QAAQ,SAAS,SAAS,EAC3EC,EAAe,4DACND,EAAI,QAAQ,SAAS,KAAK,GAAKA,EAAI,QAAQ,SAAS,MAAM,EACnEC,EAAe,+CACND,EAAI,QAAQ,SAAS,WAAW,GAAKA,EAAI,QAAQ,SAAS,KAAK,KACxEC,EAAe,2EAInBnB,EAASmB,CAAY,EACrBC,EAAYF,EAAKC,CAAY,CAC/B,QAAA,CACErB,EAAW,EAAK,EAChBI,EAAc,EAAK,CACrB,CACF,EAAG,CAACT,CAAK,CAAC,EAEV4B,EAAAA,UAAU,IAAM,CACdX,EAAA,CACF,EAAG,CAACA,CAAuB,CAAC,EAE5B,MAAMY,EAAcX,EAAAA,YAAY,SAAY,CAC1CT,EAAc,EAAI,EAClB,MAAMQ,EAAA,CACR,EAAG,CAACA,CAAuB,CAAC,EAEtBa,EAAqBC,EAAAA,QAAQ,IAC7BrB,IAAiB,OAAeT,EAC7BA,EAAW,OAAO+B,GACnBtB,IAAiB,eAAuBsB,EAAE,cAAc,YAAA,EAAc,SAAS,aAAa,EAC5FtB,IAAiB,SAAiBsB,EAAE,cAAc,YAAA,EAAc,SAAS,OAAO,EAChFtB,IAAiB,UAAkBsB,EAAE,cAAc,YAAA,EAAc,SAAS,QAAQ,EAC/E,EACR,EACA,CAAC/B,EAAYS,CAAY,CAAC,EAGvBuB,EAAeF,EAAAA,QAAQ,IAC3BG,EAAAA,KAAC,MAAA,CAAI,UAAU,uEACb,SAAA,CAAAC,EAAAA,IAACC,EAAA,CAAS,UAAU,0BAAA,CAA2B,EAC/CF,EAAAA,KAAC,MAAA,CAAI,UAAU,gBACb,SAAA,CAAAC,EAAAA,IAACC,EAAA,CAAS,UAAU,WAAA,CAAY,EAChCD,EAAAA,IAACC,EAAA,CAAS,UAAU,WAAA,CAAY,EAChCF,EAAAA,KAAC,MAAA,CAAI,UAAU,+BACb,SAAA,CAAAC,EAAAA,IAACC,EAAA,CAAS,UAAU,UAAA,CAAW,EAC/BD,EAAAA,IAACC,EAAA,CAAS,UAAU,UAAA,CAAW,EAC/BD,EAAAA,IAACC,EAAA,CAAS,UAAU,UAAA,CAAW,CAAA,EACjC,EACAD,EAAAA,IAACC,EAAA,CAAS,UAAU,iBAAA,CAAkB,CAAA,CAAA,CACxC,CAAA,CAAA,CACF,EACC,CAAA,CAAE,EAEL,OAAIhC,QAEC,MAAA,CAAI,UAAU,gBACb,SAAA8B,EAAAA,KAAC,MAAA,CAAI,UAAU,8BACb,SAAA,CAAAC,MAAC,MAAA,CAAI,UAAU,kEACb,SAAAD,EAAAA,KAAC,MAAA,CACC,SAAA,CAAAC,EAAAA,IAAC,KAAA,CAAG,UAAU,sDAAsD,SAAA,mBAEpE,EACAA,EAAAA,IAAC,IAAA,CAAE,UAAU,0CAA0C,SAAA,uDAAA,CAEvD,CAAA,CAAA,CACF,CAAA,CACF,EACAA,MAAC,OAAI,UAAU,uDACZ,eAAM,KAAK,CAAE,OAAQnC,CAAA,CAAO,EAAE,IAAI,CAACqC,EAAGC,IACrCH,MAAC,OAAa,SAAAF,CAAA,EAAJK,CAAiB,CAC5B,CAAA,CACH,CAAA,CAAA,CACF,CAAA,CACF,EAIAhC,EAEA6B,EAAAA,IAAC,MAAA,CAAI,UAAU,gBACb,SAAAA,EAAAA,IAAC,MAAA,CAAI,UAAU,8BACb,SAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,sDACb,SAAA,CAAAC,EAAAA,IAACI,EAAA,CAAY,UAAU,iCAAA,CAAkC,EACzDJ,EAAAA,IAAC,KAAA,CAAG,UAAU,6CAA6C,SAAA,0BAE3D,EACAA,EAAAA,IAAC,IAAA,CAAE,UAAU,kDACV,SAAA7B,EACH,SACCkC,EAAA,CAAO,QAASX,EAAa,QAAQ,UAAU,SAAUrB,EACxD,SAAA,CAAA2B,MAACM,GAAU,UAAW,gBAAgBjC,EAAa,eAAiB,EAAE,GAAI,EACzEA,EAAa,gBAAkB,WAAA,CAAA,CAClC,CAAA,CAAA,CACF,EACF,EACF,EAIAP,EAAW,SAAW,EACjB,WAIN,MAAA,CAAI,UAAU,6FACb,SAAAiC,EAAAA,KAAC,MAAA,CAAI,UAAU,8BACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,iFACb,SAAA,CAAAA,OAAC,MAAA,CACC,SAAA,CAAAC,EAAAA,IAAC,KAAA,CACC,GAAG,8BACH,UAAU,sDACX,SAAA,kBAAA,CAAA,EAGDA,EAAAA,IAAC,IAAA,CAAE,UAAU,0CAA0C,SAAA,uDAAA,CAEvD,CAAA,EACF,EACAA,EAAAA,IAACK,EAAA,CACC,KAAK,KACL,QAAQ,UACR,QAAO,GACP,UAAU,yHAEV,SAAAN,EAAAA,KAACQ,EAAA,CAAK,GAAG,aAAa,SAAA,CAAA,2BAEpBP,EAAAA,IAACQ,EAAA,CAAW,UAAU,SAAA,CAAU,CAAA,CAAA,CAClC,CAAA,CAAA,CACF,EACF,EAGAR,EAAAA,IAAC,MAAA,CAAI,UAAU,uCACZ,SAAA,CAAC,OAAQ,eAAgB,SAAU,SAAS,EAAE,IAAIS,GACjDT,EAAAA,IAACK,EAAA,CAEC,QAAS9B,IAAiBkC,EAAS,UAAY,QAC/C,KAAK,KACL,QAAS,IAAMjC,EAAgBiC,CAAM,EACrC,UAAU,gCAET,SAAAA,CAAA,EANIA,CAAA,CAQR,EACH,EAEAT,EAAAA,IAAC,MAAA,CACC,UAAU,uDACV,KAAK,OACL,aAAW,+BAEV,SAAAL,EAAmB,IAAI,CAACe,EAAUC,IACjCX,EAAAA,IAAC,MAAA,CAEC,KAAK,WACL,UAAU,8BACV,MAAO,CAAE,eAAgB,GAAGW,EAAQ,GAAG,IAAA,EAEvC,SAAAX,EAAAA,IAACY,EAAA,CACC,SAAAF,EACA,gBAAkBG,GAAO,CACvB,GAAI,CAACjC,EAAM,CACTkC,EAAM,MAAM,yCAAyC,EACrD,MACF,CACArC,EAAeoC,CAAE,CACnB,EACA,WAAYjC,EAAOF,EAAWgC,EAAS,EAAE,EAAI,GAC7C,QAAQ,SAAA,CAAA,CACV,EAhBKA,EAAS,EAAA,CAkBjB,CAAA,CAAA,QAGF,MAAA,CAAI,UAAU,mBACb,SAAAV,EAAAA,IAACK,GAAO,QAAO,GAAC,KAAK,KAAK,UAAU,oDAClC,SAAAN,EAAAA,KAACQ,GAAK,GAAG,aAAa,UAAU,0BAA0B,SAAA,CAAA,2BAExDP,EAAAA,IAACQ,EAAA,CAAW,UAAU,SAAA,CAAU,CAAA,CAAA,CAClC,EACF,CAAA,CACF,CAAA,CAAA,CACF,CAAA,CACF,CAEJ"}