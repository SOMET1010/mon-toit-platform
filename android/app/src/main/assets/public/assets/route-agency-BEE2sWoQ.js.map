{"version":3,"file":"route-agency-BEE2sWoQ.js","sources":["../../src/utils/haptics.ts","../../src/hooks/useLongPress.ts","../../src/hooks/useTimeAgo.ts","../../src/components/property/OptimizedImage.tsx","../../src/hooks/useNetworkStatus.ts","../../src/components/properties/PropertyCard.tsx","../../src/hooks/useAgencyProperties.ts","../../src/components/agency/AgencyMandatesList.tsx","../../src/components/agency/AgencyPropertiesView.tsx","../../src/components/agency/AgencyFinancialStats.tsx","../../src/pages/AgencyDashboard.tsx"],"sourcesContent":["/**\n * Cross-platform haptic feedback utility\n * Works on iOS (via AudioContext) and Android (via Vibration API)\n */\n\nexport type HapticIntensity = 'light' | 'medium' | 'heavy';\n\nexport const triggerHapticFeedback = (type: HapticIntensity = 'light') => {\n  // iOS: Use AudioContext to trigger taptic engine\n  // This is a workaround since iOS doesn't support navigator.vibrate()\n  if (/iPhone|iPad|iPod/.test(navigator.userAgent)) {\n    try {\n      const audioContext = new (window.AudioContext || (window as any).webkitAudioContext)();\n      const oscillator = audioContext.createOscillator();\n      const gainNode = audioContext.createGain();\n      \n      oscillator.connect(gainNode);\n      gainNode.connect(audioContext.destination);\n      \n      // Very low frequency (inaudible) to trigger haptic without sound\n      oscillator.frequency.value = 0;\n      gainNode.gain.value = 0.01;\n      \n      const duration = type === 'light' ? 0.01 : type === 'medium' ? 0.02 : 0.03;\n      \n      oscillator.start();\n      oscillator.stop(audioContext.currentTime + duration);\n      \n      // Clean up\n      setTimeout(() => {\n        audioContext.close();\n      }, 100);\n    } catch (error) {\n      // Silently fail if AudioContext is not supported\n      console.debug('Haptic feedback not supported');\n    }\n    return;\n  }\n  \n  // Android: Use Vibration API\n  if ('vibrate' in navigator) {\n    const duration = type === 'light' ? 10 : type === 'medium' ? 20 : 30;\n    navigator.vibrate(duration);\n  }\n};\n","import { useCallback, useRef, useState } from 'react';\nimport { triggerHapticFeedback } from '@/utils/haptics';\n\ninterface LongPressOptions {\n  onLongPress: () => void;\n  onClick: () => void;\n  delay?: number;\n}\n\nexport const useLongPress = (\n  { onLongPress, onClick, delay = 500 }: LongPressOptions\n) => {\n  const [longPressTriggered, setLongPressTriggered] = useState(false);\n  const timeout = useRef<NodeJS.Timeout>();\n\n  const start = useCallback((event: React.TouchEvent | React.MouseEvent) => {\n    event.preventDefault();\n    timeout.current = setTimeout(() => {\n      onLongPress();\n      setLongPressTriggered(true);\n      triggerHapticFeedback('medium');\n    }, delay);\n  }, [onLongPress, delay]);\n\n  const clear = useCallback(() => {\n    if (timeout.current) {\n      clearTimeout(timeout.current);\n    }\n    setLongPressTriggered(false);\n  }, []);\n\n  const clickHandler = useCallback((event: React.MouseEvent) => {\n    if (!longPressTriggered) {\n      onClick();\n    }\n    clear();\n  }, [onClick, longPressTriggered, clear]);\n\n  return {\n    onMouseDown: start,\n    onTouchStart: start,\n    onMouseUp: clear,\n    onMouseLeave: clear,\n    onTouchEnd: clear,\n    onClick: clickHandler,\n  };\n};\n","export const useTimeAgo = (date: string | Date) => {\n  const now = new Date();\n  const past = new Date(date);\n  const diffMs = now.getTime() - past.getTime();\n  const diffMinutes = Math.floor(diffMs / 60000);\n  const diffHours = Math.floor(diffMs / 3600000);\n  const diffDays = Math.floor(diffMs / 86400000);\n\n  if (diffMinutes < 1) {\n    return 'À l\\'instant';\n  } else if (diffMinutes < 60) {\n    return `Il y a ${diffMinutes} min`;\n  } else if (diffHours < 24) {\n    return `Il y a ${diffHours}h`;\n  } else if (diffDays === 1) {\n    const timeStr = past.toLocaleTimeString('fr-FR', { \n      hour: '2-digit', \n      minute: '2-digit',\n      timeZone: 'Africa/Abidjan'\n    });\n    return `Hier à ${timeStr}`;\n  } else if (diffDays < 7) {\n    return `Il y a ${diffDays} jours`;\n  } else {\n    return past.toLocaleDateString('fr-FR', {\n      day: '2-digit',\n      month: 'short',\n      year: 'numeric',\n      timeZone: 'Africa/Abidjan'\n    });\n  }\n};\n","import { useState, useEffect, useRef } from 'react';\nimport { cn } from '@/lib/utils';\nimport { logger } from '@/services/logger';\n\ninterface OptimizedImageProps {\n  src: string;\n  alt: string;\n  priority?: boolean;\n  sizes?: string;\n  className?: string;\n}\n\nexport const OptimizedImage = ({ \n  src, \n  alt, \n  priority = false, \n  sizes,\n  className \n}: OptimizedImageProps) => {\n  const [currentSrc, setCurrentSrc] = useState<string>(\"\");\n  const [isLoading, setIsLoading] = useState(true);\n  const [isVisible, setIsVisible] = useState(priority);\n  const imgRef = useRef<HTMLImageElement>(null);\n\n  // ✅ SÉCURITÉ : Validation de l'URL avant affichage\n  const sanitizeUrl = (url: string): string => {\n    try {\n      const urlObj = new URL(url);\n      // Ne permettre que les URLs Supabase Storage\n      if (!urlObj.hostname.includes('supabase.co')) {\n        logger.warn('Unauthorized URL attempted', { hostname: urlObj.hostname });\n        return '/placeholder.svg';\n      }\n      return url;\n    } catch {\n      return '/placeholder.svg';\n    }\n  };\n\n  const getLowResSrc = (url: string): string => {\n    if (url.includes(\"supabase\")) {\n      const separator = url.includes(\"?\") ? \"&\" : \"?\";\n      return `${url}${separator}quality=10&width=50`;\n    }\n    return url;\n  };\n\n  // Intersection Observer for lazy loading\n  useEffect(() => {\n    if (priority) {\n      setIsVisible(true);\n      return;\n    }\n\n    const observer = new IntersectionObserver(\n      ([entry]) => {\n        if (entry.isIntersecting) {\n          setIsVisible(true);\n          observer.disconnect();\n        }\n      },\n      { rootMargin: '50px' }\n    );\n\n    if (imgRef.current) {\n      observer.observe(imgRef.current);\n    }\n\n    return () => observer.disconnect();\n  }, [priority]);\n\n  useEffect(() => {\n    if (!isVisible) return;\n\n    const safeSrc = sanitizeUrl(src);\n    setIsLoading(true);\n    \n    const lowResImg = new Image();\n    const lowResSrc = getLowResSrc(safeSrc);\n    \n    lowResImg.onload = () => {\n      setCurrentSrc(lowResSrc);\n      \n      const highResImg = new Image();\n      highResImg.onload = () => {\n        setCurrentSrc(safeSrc);\n        setIsLoading(false);\n      };\n      highResImg.onerror = () => {\n        setIsLoading(false);\n      };\n      highResImg.src = safeSrc;\n    };\n\n    lowResImg.onerror = () => {\n      setCurrentSrc(safeSrc);\n      setIsLoading(false);\n    };\n\n    lowResImg.src = lowResSrc;\n  }, [src, isVisible]);\n\n  const generateSrcSet = (url: string): string => {\n    if (!url.includes(\"supabase\")) return url;\n    const separator = url.includes(\"?\") ? \"&\" : \"?\";\n    return `\n      ${url}${separator}width=480 480w,\n      ${url}${separator}width=768 768w,\n      ${url}${separator}width=1024 1024w,\n      ${url}${separator}width=1280 1280w\n    `.trim();\n  };\n\n  return (\n    <div ref={imgRef as any}>\n      {isVisible && currentSrc ? (\n        <picture>\n          <source\n            srcSet={generateSrcSet(currentSrc)}\n            sizes={sizes || \"(max-width: 768px) 100vw, (max-width: 1024px) 50vw, 33vw\"}\n            type=\"image/webp\"\n          />\n          <img\n            src={currentSrc}\n            srcSet={generateSrcSet(currentSrc)}\n            sizes={sizes || \"(max-width: 768px) 100vw, (max-width: 1024px) 50vw, 33vw\"}\n            alt={alt}\n            loading={priority ? \"eager\" : \"lazy\"}\n            decoding=\"async\"\n            className={cn(\n              \"transition-opacity duration-500 w-full h-auto\",\n              isLoading ? \"blur-sm opacity-50\" : \"blur-0 opacity-100\",\n              className\n            )}\n          />\n        </picture>\n      ) : (\n        <div className={cn(\"bg-muted animate-pulse\", className)} />\n      )}\n    </div>\n  );\n};\n","import { useState, useEffect } from 'react';\n\ninterface NetworkInfo {\n  effectiveType: '4g' | '3g' | '2g' | 'slow-2g';\n  downlink: number;\n  saveData: boolean;\n  online: boolean;\n}\n\nexport const useNetworkStatus = (): NetworkInfo => {\n  const [networkInfo, setNetworkInfo] = useState<NetworkInfo>({\n    effectiveType: '4g',\n    downlink: 10,\n    saveData: false,\n    online: navigator.onLine,\n  });\n\n  useEffect(() => {\n    const connection = (navigator as any).connection || (navigator as any).mozConnection || (navigator as any).webkitConnection;\n    \n    const updateNetworkInfo = () => {\n      setNetworkInfo({\n        effectiveType: connection?.effectiveType || '4g',\n        downlink: connection?.downlink || 10,\n        saveData: connection?.saveData || false,\n        online: navigator.onLine,\n      });\n    };\n\n    const handleOnlineChange = () => {\n      setNetworkInfo(prev => ({ ...prev, online: navigator.onLine }));\n    };\n\n    if (connection) {\n      connection.addEventListener('change', updateNetworkInfo);\n      updateNetworkInfo();\n    }\n\n    window.addEventListener('online', handleOnlineChange);\n    window.addEventListener('offline', handleOnlineChange);\n\n    return () => {\n      if (connection) {\n        connection.removeEventListener('change', updateNetworkInfo);\n      }\n      window.removeEventListener('online', handleOnlineChange);\n      window.removeEventListener('offline', handleOnlineChange);\n    };\n  }, []);\n\n  return networkInfo;\n};\n","import { useState, useEffect } from 'react';\nimport { Link } from 'react-router-dom';\nimport { useSwipeable } from 'react-swipeable';\nimport { motion } from 'framer-motion';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { Dialog, DialogContent } from '@/components/ui/dialog';\nimport { Heart, MapPin, Bed, Bath, Maximize, Clock, Lock, Wrench, ExternalLink, ShieldCheck, Building2 } from 'lucide-react';\nimport { Property } from '@/types';\nimport { getPropertyStatusLabel, formatPrice } from '@/constants';\nimport { supabase } from '@/lib/supabase';\nimport ANSUTCertifiedBadge from '@/components/ui/ansut-certified-badge';\nimport { useTimeAgo } from '@/hooks/useTimeAgo';\nimport { toast } from '@/hooks/use-toast';\nimport { OptimizedImage } from '@/components/property/OptimizedImage';\nimport { useLongPress } from '@/hooks/useLongPress';\nimport { triggerHapticFeedback } from '@/utils/haptics';\nimport { useNetworkStatus } from '@/hooks/useNetworkStatus';\n\ninterface PropertyCardProps {\n  property: Property;\n  onFavoriteClick?: (id: string) => void;\n  isFavorite?: boolean;\n  variant?: 'default' | 'compact';\n  showStatus?: boolean;\n  showRemoveButton?: boolean;\n}\n\nexport const PropertyCard = ({ \n  property, \n  onFavoriteClick,\n  isFavorite = false,\n  variant = 'default',\n  showStatus = true,\n  showRemoveButton = false\n}: PropertyCardProps) => {\n  const [hasCertifiedLease, setHasCertifiedLease] = useState(false);\n  const [showPreview, setShowPreview] = useState(false);\n  const [agencyName, setAgencyName] = useState<string | null>(null);\n  const timeAgo = useTimeAgo(property.created_at);\n  const { effectiveType, saveData } = useNetworkStatus();\n\n  // Adapt image quality based on network\n  const imageQuality = effectiveType === '4g' && !saveData;\n\n  useEffect(() => {\n    const checkCertification = async () => {\n      const { data } = await supabase\n        .from('leases')\n        .select('id')\n        .eq('property_id', property.id)\n        .eq('certification_status', 'certified')\n        .limit(1)\n        .maybeSingle();\n      \n      setHasCertifiedLease(!!data);\n    };\n\n    const checkAgencyMandate = async () => {\n      const { data } = await supabase\n        .from('agency_mandates')\n        .select('agency_id, profiles!agency_mandates_agency_id_fkey(full_name)')\n        .eq('property_id', property.id)\n        .eq('status', 'active')\n        .limit(1)\n        .maybeSingle();\n      \n      if (data && data.profiles) {\n        setAgencyName((data.profiles as any).full_name);\n      }\n    };\n\n    checkCertification();\n    checkAgencyMandate();\n  }, [property.id]);\n\n  // Long press for preview\n  const longPressProps = useLongPress({\n    onLongPress: () => {\n      setShowPreview(true);\n      triggerHapticFeedback('heavy');\n    },\n    onClick: () => {}, // Empty, we use Link for navigation\n    delay: 500,\n  });\n\n  // Swipe to favorite/unfavorite\n  const swipeHandlers = useSwipeable({\n    onSwipedRight: () => {\n      if (!isFavorite && onFavoriteClick) {\n        triggerHapticFeedback('heavy');\n        onFavoriteClick(property.id);\n        toast({\n          title: \"💙 Ajouté aux favoris !\",\n          description: \"Glissez vers la gauche pour retirer\",\n          duration: 2000,\n        });\n      }\n    },\n    onSwipedLeft: () => {\n      if (isFavorite && onFavoriteClick) {\n        triggerHapticFeedback('medium');\n        onFavoriteClick(property.id);\n        toast({\n          description: \"❤️ Retiré des favoris\",\n          duration: 2000,\n        });\n      }\n    },\n    trackMouse: false,\n    delta: 100,\n  });\n\n  return (\n    <>\n      <Card \n        {...swipeHandlers}\n        {...longPressProps}\n        className=\"group relative overflow-hidden bg-white shadow-card hover:shadow-card-hover transition-all duration-300 border border-border rounded-2xl animate-scale-in active:scale-95\"\n        role=\"article\"\n        aria-labelledby={`property-title-${property.id}`}\n        aria-describedby={`property-description-${property.id}`}\n      >\n      <div className=\"relative h-56 sm:h-64 bg-muted overflow-hidden\">\n        {property.main_image ? (\n          <>\n            <OptimizedImage\n              src={property.main_image}\n              alt={`Photo du bien: ${property.title} - ${property.property_type} à ${property.city}`}\n              className=\"w-full h-full object-cover transition-transform duration-300 group-hover:scale-105\"\n              priority={false}\n            />\n            <div className=\"absolute inset-0 bg-gradient-to-t from-black/30 to-transparent pointer-events-none\" />\n          </>\n        ) : (\n          <div className=\"w-full h-full flex items-center justify-center text-muted-foreground bg-gradient-to-br from-muted to-muted/50\">\n            <div className=\"text-center\">\n              <MapPin className=\"h-12 w-12 mx-auto mb-2 opacity-50\" />\n              <p>Pas d'image</p>\n            </div>\n          </div>\n        )}\n        \n        {onFavoriteClick && (\n          <motion.button\n            className=\"absolute top-3 right-3 rounded-lg shadow-md\"\n            whileTap={{ scale: 1.2 }}\n            animate={isFavorite ? { scale: [1, 1.3, 1] } : {}}\n            transition={{ duration: 0.3 }}\n            onClick={(e) => {\n              e.preventDefault();\n              e.stopPropagation();\n              triggerHapticFeedback('heavy');\n              onFavoriteClick(property.id);\n              toast({\n                description: isFavorite ? \"❤️ Bien retiré des favoris\" : \"💙 Bien ajouté aux favoris !\",\n                duration: 2000,\n              });\n            }}\n          >\n            <Button\n              size=\"icon\"\n              variant={showRemoveButton ? \"destructive\" : isFavorite ? \"default\" : \"secondary\"}\n              className=\"pointer-events-none\"\n              asChild\n            >\n              <motion.div\n                animate={{\n                  rotate: isFavorite ? [0, -15, 15, -15, 0] : 0,\n                }}\n                transition={{ duration: 0.5 }}\n              >\n                <Heart className={`h-4 w-4 transition-all duration-300 ${isFavorite ? 'fill-current' : ''}`} />\n              </motion.div>\n            </Button>\n          </motion.button>\n        )}\n        \n        {/* Time badge - top left */}\n        <Badge className=\"absolute top-3 left-3 text-xs rounded-lg font-semibold shadow-md bg-background/90 backdrop-blur-sm text-foreground border border-border/50 flex items-center gap-1\">\n          <Clock className=\"h-3 w-3\" />\n          {timeAgo}\n        </Badge>\n        \n        <div className=\"absolute top-14 left-3 flex flex-col gap-2\">\n          {showStatus && (\n            <Badge \n              className={`text-xs rounded-lg font-semibold shadow-md flex items-center gap-1 ${\n                property.status === 'disponible' \n                  ? 'bg-green-500 hover:bg-green-600 text-white animate-pulse' \n                  : property.status === 'en_negociation'\n                  ? 'bg-orange-500 hover:bg-orange-600 text-white'\n                  : 'bg-gray-400 hover:bg-gray-500 text-white'\n              }`}\n              role=\"status\"\n              aria-live=\"polite\"\n            >\n              {property.status === 'loué' && <Lock className=\"h-3 w-3\" aria-hidden=\"true\" />}\n              {getPropertyStatusLabel(property.status)}\n            </Badge>\n          )}\n          \n          {agencyName && (\n            <Badge className=\"text-xs rounded-lg font-semibold shadow-md bg-blue-600 hover:bg-blue-700 text-white flex items-center gap-1\">\n              <Building2 className=\"h-3 w-3\" />\n              Géré par {agencyName}\n            </Badge>\n          )}\n          \n          {hasCertifiedLease && (\n            <Badge className=\"text-xs rounded-lg font-semibold shadow-md bg-primary/90 text-white flex items-center gap-1\">\n              <ShieldCheck className=\"h-3 w-3\" />\n              Certifié ANSUT\n            </Badge>\n          )}\n          \n          {property.work_status && property.work_status !== 'aucun_travail' && (\n            <Badge className=\"text-xs rounded-lg font-semibold shadow-md bg-orange-600 hover:bg-orange-700 text-white flex items-center gap-1\">\n              <Wrench className=\"h-3 w-3\" />\n              Travaux\n            </Badge>\n          )}\n        </div>\n      </div>\n\n      {/* Screen reader description */}\n      <div id={`property-description-${property.id}`} className=\"sr-only\">\n        Bien de {property.bedrooms} chambres, {property.bathrooms} salles de bain, \n        situé à {property.city}, pour {formatPrice(property.monthly_rent)} par mois.\n        Statut : {getPropertyStatusLabel(property.status)}.\n      </div>\n\n      <CardHeader className=\"p-3 sm:p-4 pb-2\">\n        <div className=\"flex items-baseline gap-2 mb-2\">\n          <p className=\"text-2xl sm:text-3xl font-black text-primary\">\n            {formatPrice(property.monthly_rent)}\n          </p>\n          <span className=\"text-sm font-medium text-muted-foreground\">/mois</span>\n        </div>\n        <CardTitle id={`property-title-${property.id}`} className=\"line-clamp-1 text-base sm:text-lg font-bold\">\n          {property.property_type} {property.bedrooms}ch. - {property.city}\n        </CardTitle>\n      </CardHeader>\n\n      <CardContent className=\"space-y-3 p-3 sm:p-4 pt-0\">\n        <div className=\"flex items-center text-muted-foreground\">\n          <MapPin className=\"h-4 w-4 mr-2 flex-shrink-0 text-primary\" />\n          <span className=\"line-clamp-1 font-medium\">{property.city}</span>\n        </div>\n\n        <div className=\"flex items-center gap-4 text-sm bg-muted/50 p-2 rounded-xl\">\n          <div className=\"flex items-center gap-1\">\n            <Bed className=\"h-4 w-4\" />\n            <span className=\"font-medium\">{property.bedrooms}</span>\n          </div>\n          <div className=\"flex items-center gap-1\">\n            <Bath className=\"h-4 w-4\" />\n            <span className=\"font-medium\">{property.bathrooms}</span>\n          </div>\n          {property.surface_area && (\n            <div className=\"flex items-center gap-1\">\n              <Maximize className=\"h-4 w-4\" />\n              <span className=\"font-medium\">{property.surface_area}m²</span>\n            </div>\n          )}\n        </div>\n\n        {variant === 'default' && (\n          <div className=\"flex flex-wrap gap-1.5\">\n            {property.is_furnished && <Badge variant=\"secondary\" className=\"text-xs rounded-full\">Meublé</Badge>}\n            {property.has_ac && <Badge variant=\"secondary\" className=\"text-xs rounded-full\">Climatisation</Badge>}\n            {property.has_parking && <Badge variant=\"secondary\" className=\"text-xs rounded-full\">Parking</Badge>}\n            {property.has_garden && <Badge variant=\"secondary\" className=\"text-xs rounded-full\">Jardin</Badge>}\n          </div>\n        )}\n\n        <Button asChild variant=\"default\" className=\"w-full rounded-xl min-h-[40px] font-semibold shadow-md active:scale-95\">\n          <Link to={`/property/${property.id}`}>Découvrir ce bien</Link>\n        </Button>\n      </CardContent>\n    </Card>\n\n    {/* Preview Modal */}\n    <Dialog open={showPreview} onOpenChange={setShowPreview}>\n      <DialogContent className=\"max-w-md\">\n        {property.main_image && (\n          <OptimizedImage\n            src={property.main_image}\n            alt={property.title}\n            className=\"w-full rounded-lg\"\n            priority={false}\n          />\n        )}\n        <h3 className=\"text-xl font-bold\">{property.title}</h3>\n        <p className=\"text-2xl text-primary font-bold\">\n          {formatPrice(property.monthly_rent)} <span className=\"text-base font-normal\">/mois</span>\n        </p>\n        <div className=\"flex items-center text-muted-foreground mb-2\">\n          <MapPin className=\"h-4 w-4 mr-2\" />\n          {property.city}\n        </div>\n        <div className=\"flex gap-2\">\n          {onFavoriteClick && (\n            <Button\n              variant={isFavorite ? \"default\" : \"outline\"}\n              onClick={() => {\n                triggerHapticFeedback('light');\n                onFavoriteClick(property.id);\n                toast({\n                  description: isFavorite ? \"❤️ Retiré des favoris\" : \"💙 Ajouté aux favoris\",\n                  duration: 2000,\n                });\n              }}\n              className=\"flex-1\"\n            >\n              <Heart className={`h-4 w-4 mr-2 ${isFavorite ? 'fill-current' : ''}`} />\n              Favoris\n            </Button>\n          )}\n          <Button asChild className=\"flex-1\">\n            <Link to={`/property/${property.id}`}>\n              <ExternalLink className=\"h-4 w-4 mr-2\" />\n              Voir\n            </Link>\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  </>\n  );\n};\n","import { useQuery } from '@tanstack/react-query';\nimport { supabase } from '@/lib/supabase';\nimport { useAuth } from './useAuth';\nimport { useAgencyMandates } from './useAgencyMandates';\n\n/**\n * Hook pour récupérer les biens gérés par une agence\n * Combine les biens sous mandats spécifiques ET globaux\n */\nexport const useAgencyProperties = () => {\n  const { user, profile } = useAuth();\n  const { activeMandates, asAgency } = useAgencyMandates();\n\n  const isAgency = profile?.user_type === 'agence';\n\n  const { data: managedProperties = [], isLoading } = useQuery({\n    queryKey: ['agency-properties', user?.id, activeMandates],\n    queryFn: async () => {\n      if (!user || !isAgency || asAgency.length === 0) return [];\n\n      // Récupérer les IDs de propriétaires avec mandats actifs\n      const ownerIds = [...new Set(asAgency.map(m => m.owner_id))];\n      \n      // Récupérer toutes les propriétés des propriétaires avec mandats\n      const { data, error } = await supabase\n        .from('properties')\n        .select('*')\n        .in('owner_id', ownerIds)\n        .order('created_at', { ascending: false });\n\n      if (error) throw error;\n\n      // Filtrer côté client pour ne garder que les biens autorisés\n      return (data || []).filter(property => {\n        // Vérifier si mandat global OU mandat spécifique pour ce bien\n        return asAgency.some(mandate =>\n          mandate.status === 'active' &&\n          mandate.owner_id === property.owner_id &&\n          (mandate.property_id === null || mandate.property_id === property.id)\n        );\n      });\n    },\n    enabled: isAgency && asAgency.length > 0,\n  });\n\n  // Grouper par propriétaire\n  const propertiesByOwner = managedProperties.reduce((acc, property) => {\n    const ownerId = property.owner_id;\n    if (!acc[ownerId]) {\n      acc[ownerId] = [];\n    }\n    acc[ownerId].push(property);\n    return acc;\n  }, {} as Record<string, typeof managedProperties>);\n\n  // Statistiques\n  const stats = {\n    totalProperties: managedProperties.length,\n    totalOwners: Object.keys(propertiesByOwner).length,\n    availableProperties: managedProperties.filter(p => p.status === 'disponible').length,\n    rentedProperties: managedProperties.filter(p => p.status === 'loue').length,\n  };\n\n  return {\n    managedProperties,\n    propertiesByOwner,\n    stats,\n    isLoading,\n    isAgency,\n  };\n};\n","import { AgencyMandate } from '@/hooks/useAgencyMandates';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { Building2, Check, X, Pause, Eye, Edit, Trash, Users, Wrench, DollarSign, FileText, Home } from 'lucide-react';\nimport { format } from 'date-fns';\nimport { fr } from 'date-fns/locale';\nimport { useAgencyMandates } from '@/hooks/useAgencyMandates';\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n  AlertDialogTrigger,\n} from \"@/components/ui/alert-dialog\";\n\ninterface AgencyMandatesListProps {\n  mandates: AgencyMandate[];\n  isLoading: boolean;\n}\n\nexport function AgencyMandatesList({ mandates, isLoading }: AgencyMandatesListProps) {\n  const { acceptMandate, refuseMandate } = useAgencyMandates();\n\n  const getStatusBadge = (status: AgencyMandate['status']) => {\n    const variants = {\n      pending: { variant: 'secondary' as const, label: 'En attente' },\n      active: { variant: 'default' as const, label: 'Actif' },\n      suspended: { variant: 'outline' as const, label: 'Suspendu' },\n      terminated: { variant: 'destructive' as const, label: 'Résilié' },\n      expired: { variant: 'outline' as const, label: 'Expiré' },\n    };\n    const config = variants[status];\n    return <Badge variant={config.variant}>{config.label}</Badge>;\n  };\n\n  const getMandateTypeLabel = (type: AgencyMandate['mandate_type']) => {\n    const labels = {\n      location: 'Location',\n      gestion_complete: 'Gestion complète',\n      vente: 'Vente',\n    };\n    return labels[type];\n  };\n\n  if (isLoading) {\n    return <div>Chargement...</div>;\n  }\n\n  if (mandates.length === 0) {\n    return (\n      <Card>\n        <CardContent className=\"pt-6\">\n          <div className=\"text-center py-12\">\n            <Building2 className=\"mx-auto h-12 w-12 text-muted-foreground mb-4\" />\n            <h3 className=\"text-lg font-semibold mb-2\">Aucun mandat</h3>\n            <p className=\"text-muted-foreground\">\n              Vous n'avez pas encore de mandat de gestion\n            </p>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      {mandates.map(mandate => (\n        <Card key={mandate.id}>\n          <CardHeader>\n            <div className=\"flex items-start justify-between\">\n              <div className=\"flex-1\">\n                <div className=\"flex items-center gap-2 mb-2\">\n                  <CardTitle className=\"text-lg\">\n                    {getMandateTypeLabel(mandate.mandate_type)}\n                  </CardTitle>\n                  {getStatusBadge(mandate.status)}\n                </div>\n                <CardDescription>\n                  {mandate.property_id ? 'Mandat spécifique' : 'Mandat global'} \n                  {' • '}\n                  Depuis le {format(new Date(mandate.start_date), 'dd MMMM yyyy', { locale: fr })}\n                  {mandate.end_date ? ` jusqu'au ${format(new Date(mandate.end_date), 'dd MMMM yyyy', { locale: fr })}` : ' • Durée indéterminée'}\n                </CardDescription>\n              </div>\n              \n              {mandate.status === 'pending' && (\n                <div className=\"flex gap-2\">\n                  <Button \n                    size=\"sm\" \n                    variant=\"default\"\n                    onClick={() => acceptMandate(mandate.id)}\n                  >\n                    <Check className=\"h-4 w-4 mr-1\" />\n                    Accepter\n                  </Button>\n                  <AlertDialog>\n                    <AlertDialogTrigger asChild>\n                      <Button size=\"sm\" variant=\"outline\">\n                        <X className=\"h-4 w-4 mr-1\" />\n                        Refuser\n                      </Button>\n                    </AlertDialogTrigger>\n                    <AlertDialogContent>\n                      <AlertDialogHeader>\n                        <AlertDialogTitle>Refuser ce mandat ?</AlertDialogTitle>\n                        <AlertDialogDescription>\n                          Êtes-vous sûr de vouloir refuser ce mandat de gestion ?\n                        </AlertDialogDescription>\n                      </AlertDialogHeader>\n                      <AlertDialogFooter>\n                        <AlertDialogCancel>Annuler</AlertDialogCancel>\n                        <AlertDialogAction\n                          onClick={() => refuseMandate({ mandateId: mandate.id })}\n                        >\n                          Confirmer le refus\n                        </AlertDialogAction>\n                      </AlertDialogFooter>\n                    </AlertDialogContent>\n                  </AlertDialog>\n                </div>\n              )}\n            </div>\n          </CardHeader>\n          \n          <CardContent>\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n              {mandate.commission_rate && (\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Commission</p>\n                  <p className=\"font-medium\">{mandate.commission_rate}%</p>\n                </div>\n              )}\n              {mandate.fixed_fee && (\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Frais fixes</p>\n                  <p className=\"font-medium\">{mandate.fixed_fee} FCFA</p>\n                </div>\n              )}\n              {mandate.billing_frequency && (\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Facturation</p>\n                  <p className=\"font-medium capitalize\">{mandate.billing_frequency}</p>\n                </div>\n              )}\n              {mandate.end_date && (\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Fin prévue</p>\n                  <p className=\"font-medium\">\n                    {format(new Date(mandate.end_date), 'dd/MM/yyyy')}\n                  </p>\n                </div>\n              )}\n            </div>\n\n            {/* Permissions with icons */}\n            <div className=\"mt-4 pt-4 border-t\">\n              <p className=\"text-sm font-medium mb-3\">Permissions accordées :</p>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n                {/* Propriétés */}\n                <div>\n                  <p className=\"text-xs text-muted-foreground mb-2 flex items-center gap-1\">\n                    <Home className=\"h-3 w-3\" /> Propriétés\n                  </p>\n                  <div className=\"flex flex-wrap gap-1\">\n                    {mandate.permissions.can_view_properties && (\n                      <Badge variant=\"outline\" className=\"text-xs gap-1\">\n                        <Eye className=\"h-3 w-3\" /> Voir\n                      </Badge>\n                    )}\n                    {mandate.permissions.can_edit_properties && (\n                      <Badge variant=\"outline\" className=\"text-xs gap-1\">\n                        <Edit className=\"h-3 w-3\" /> Modifier\n                      </Badge>\n                    )}\n                    {mandate.permissions.can_create_properties && (\n                      <Badge variant=\"outline\" className=\"text-xs gap-1\">\n                        <FileText className=\"h-3 w-3\" /> Créer\n                      </Badge>\n                    )}\n                    {mandate.permissions.can_delete_properties && (\n                      <Badge variant=\"outline\" className=\"text-xs gap-1\">\n                        <Trash className=\"h-3 w-3\" /> Supprimer\n                      </Badge>\n                    )}\n                  </div>\n                </div>\n\n                {/* Candidatures */}\n                <div>\n                  <p className=\"text-xs text-muted-foreground mb-2 flex items-center gap-1\">\n                    <Users className=\"h-3 w-3\" /> Candidatures\n                  </p>\n                  <div className=\"flex flex-wrap gap-1\">\n                    {mandate.permissions.can_view_applications && (\n                      <Badge variant=\"outline\" className=\"text-xs gap-1\">\n                        <Eye className=\"h-3 w-3\" /> Voir\n                      </Badge>\n                    )}\n                    {mandate.permissions.can_manage_applications && (\n                      <Badge variant=\"outline\" className=\"text-xs gap-1\">\n                        <Edit className=\"h-3 w-3\" /> Gérer\n                      </Badge>\n                    )}\n                  </div>\n                </div>\n\n                {/* Gestion */}\n                <div>\n                  <p className=\"text-xs text-muted-foreground mb-2 flex items-center gap-1\">\n                    <Wrench className=\"h-3 w-3\" /> Gestion\n                  </p>\n                  <div className=\"flex flex-wrap gap-1\">\n                    {mandate.permissions.can_create_leases && (\n                      <Badge variant=\"outline\" className=\"text-xs gap-1\">\n                        <FileText className=\"h-3 w-3\" /> Baux\n                      </Badge>\n                    )}\n                    {mandate.permissions.can_manage_maintenance && (\n                      <Badge variant=\"outline\" className=\"text-xs gap-1\">\n                        <Wrench className=\"h-3 w-3\" /> Maintenance\n                      </Badge>\n                    )}\n                    {mandate.permissions.can_manage_documents && (\n                      <Badge variant=\"outline\" className=\"text-xs gap-1\">\n                        <FileText className=\"h-3 w-3\" /> Documents\n                      </Badge>\n                    )}\n                  </div>\n                </div>\n\n                {/* Financier */}\n                <div>\n                  <p className=\"text-xs text-muted-foreground mb-2 flex items-center gap-1\">\n                    <DollarSign className=\"h-3 w-3\" /> Financier\n                  </p>\n                  <div className=\"flex flex-wrap gap-1\">\n                    {mandate.permissions.can_view_financials && (\n                      <Badge variant=\"outline\" className=\"text-xs gap-1\">\n                        <Eye className=\"h-3 w-3\" /> Voir finances\n                      </Badge>\n                    )}\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            {mandate.notes && (\n              <div className=\"mt-4 pt-4 border-t\">\n                <p className=\"text-sm text-muted-foreground\">{mandate.notes}</p>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      ))}\n    </div>\n  );\n}\n","import { PropertyCard } from '@/components/properties/PropertyCard';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Building2 } from 'lucide-react';\nimport { AgencyMandate } from '@/hooks/useAgencyMandates';\nimport { useState, useMemo } from 'react';\nimport { Button } from '@/components/ui/button';\n\ninterface AgencyPropertiesViewProps {\n  properties: any[];\n  mandates: AgencyMandate[];\n}\n\nconst ITEMS_PER_PAGE = 50;\n\nexport function AgencyPropertiesView({ properties, mandates }: AgencyPropertiesViewProps) {\n  const [page, setPage] = useState(1);\n  if (properties.length === 0) {\n    return (\n      <Card>\n        <CardContent className=\"pt-6\">\n          <div className=\"text-center py-12\">\n            <Building2 className=\"mx-auto h-12 w-12 text-muted-foreground mb-4\" />\n            <h3 className=\"text-lg font-semibold mb-2\">Aucun bien à gérer</h3>\n            <p className=\"text-muted-foreground\">\n              Les biens dont vous avez la gestion apparaîtront ici\n            </p>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  // Grouper par propriétaire avec useMemo\n  const propertiesByOwner = useMemo(() => {\n    return properties.reduce<Record<string, { mandate: AgencyMandate; properties: any[] }>>(\n      (acc, property) => {\n        const mandate = mandates.find(m => \n          m.owner_id === property.owner_id &&\n          (m.property_id === property.id || m.property_id === null)\n        );\n        \n        if (!mandate) return acc;\n\n        const ownerName = mandate.owner_id; // TODO: Récupérer le nom du propriétaire\n        if (!acc[ownerName]) {\n          acc[ownerName] = { mandate, properties: [] };\n        }\n        acc[ownerName].properties.push(property);\n        return acc;\n      }, \n      {}\n    );\n  }, [properties, mandates]);\n\n  // Pagination des propriétaires\n  const ownersEntries = Object.entries(propertiesByOwner);\n  const totalPages = Math.ceil(ownersEntries.length / ITEMS_PER_PAGE);\n  const paginatedOwners = useMemo(\n    () => ownersEntries.slice((page - 1) * ITEMS_PER_PAGE, page * ITEMS_PER_PAGE),\n    [ownersEntries, page]\n  );\n\n  return (\n    <div className=\"space-y-8\">\n      {paginatedOwners.map(([ownerName, data]) => {\n        const { mandate, properties: ownerProperties } = data;\n        return (\n          <div key={ownerName} className=\"space-y-4\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <h3 className=\"text-lg font-semibold\">Propriétaire: {ownerName}</h3>\n                <p className=\"text-sm text-muted-foreground\">\n                  {ownerProperties.length} bien{ownerProperties.length > 1 ? 's' : ''} géré\n                  {ownerProperties.length > 1 ? 's' : ''}\n                </p>\n              </div>\n            </div>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n              {ownerProperties.map(property => (\n                <PropertyCard key={property.id} property={property} />\n              ))}\n            </div>\n          </div>\n        );\n      })}\n\n      {/* Pagination */}\n      {totalPages > 1 && (\n        <div className=\"flex justify-center gap-2 mt-6\">\n          <Button\n            variant=\"outline\"\n            onClick={() => setPage(p => Math.max(1, p - 1))}\n            disabled={page === 1}\n          >\n            Précédent\n          </Button>\n          <span className=\"flex items-center px-4\">\n            Page {page} sur {totalPages}\n          </span>\n          <Button\n            variant=\"outline\"\n            onClick={() => setPage(p => Math.min(totalPages, p + 1))}\n            disabled={page === totalPages}\n          >\n            Suivant\n          </Button>\n        </div>\n      )}\n    </div>\n  );\n}\n","import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { AgencyMandate } from '@/hooks/useAgencyMandates';\nimport { TrendingUp, DollarSign, Calendar } from 'lucide-react';\nimport { useMemo } from 'react';\n\ninterface AgencyFinancialStatsProps {\n  mandates: AgencyMandate[];\n  properties: any[];\n}\n\nexport function AgencyFinancialStats({ mandates, properties }: AgencyFinancialStatsProps) {\n  // Calculer les revenus estimés avec useMemo pour optimiser\n  const estimatedRevenue = useMemo(() => {\n    return mandates.reduce((total, mandate) => {\n      if (mandate.fixed_fee) {\n        return total + mandate.fixed_fee;\n      }\n      if (mandate.commission_rate) {\n        // Estimer basé sur les loyers des biens\n        const mandateProperties = properties.filter(p => \n          mandate.property_id === p.id || mandate.property_id === null\n        );\n        const totalRent = mandateProperties.reduce((sum, p) => sum + (p.monthly_rent || 0), 0);\n        return total + (totalRent * mandate.commission_rate / 100);\n      }\n      return total;\n    }, 0);\n  }, [mandates, properties]);\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Revenus estimés</CardTitle>\n            <DollarSign className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">\n              {estimatedRevenue.toLocaleString()} FCFA\n            </div>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              Par mois\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Mandats avec commission</CardTitle>\n            <TrendingUp className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">\n              {mandates.filter(m => m.commission_rate).length}\n            </div>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              Commission moyenne: {\n                mandates.filter(m => m.commission_rate).length > 0\n                  ? (mandates.filter(m => m.commission_rate).reduce((sum, m) => sum + (m.commission_rate || 0), 0) / mandates.filter(m => m.commission_rate).length).toFixed(1)\n                  : 0\n              }%\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Frais fixes mensuels</CardTitle>\n            <Calendar className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">\n              {mandates.filter(m => m.fixed_fee && m.billing_frequency === 'mensuel')\n                .reduce((sum, m) => sum + (m.fixed_fee || 0), 0)\n                .toLocaleString()} FCFA\n            </div>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              {mandates.filter(m => m.fixed_fee).length} mandat{mandates.filter(m => m.fixed_fee).length > 1 ? 's' : ''}\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Détail des revenus par mandat</CardTitle>\n          <CardDescription>Estimation basée sur les loyers actuels</CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-4\">\n            {mandates.map(mandate => {\n              const mandateProperties = properties.filter(p => \n                mandate.property_id === p.id || mandate.property_id === null\n              );\n              const totalRent = mandateProperties.reduce((sum, p) => sum + (p.monthly_rent || 0), 0);\n              const revenue = mandate.fixed_fee || (totalRent * (mandate.commission_rate || 0) / 100);\n\n              return (\n                <div key={mandate.id} className=\"flex items-center justify-between py-3 border-b last:border-0\">\n                  <div>\n                    <p className=\"font-medium\">\n                      {mandate.property_id ? 'Mandat spécifique' : 'Mandat global'}\n                    </p>\n                    <p className=\"text-sm text-muted-foreground\">\n                      {mandateProperties.length} bien{mandateProperties.length > 1 ? 's' : ''}\n                      {mandate.commission_rate && ` • ${mandate.commission_rate}% commission`}\n                      {mandate.fixed_fee && ` • ${mandate.fixed_fee} FCFA`}\n                    </p>\n                  </div>\n                  <div className=\"text-right\">\n                    <p className=\"font-bold\">{revenue.toLocaleString()} FCFA</p>\n                    <p className=\"text-xs text-muted-foreground\">\n                      {mandate.billing_frequency || 'mensuel'}\n                    </p>\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","import { useAuth } from '@/hooks/useAuth';\nimport { useAgencyMandates } from '@/hooks/useAgencyMandates';\nimport { useAgencyProperties } from '@/hooks/useAgencyProperties';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Badge } from '@/components/ui/badge';\nimport { Building2, Users, TrendingUp, FileCheck, AlertCircle, AlertTriangle, HelpCircle } from 'lucide-react';\nimport { Navigate, Link } from 'react-router-dom';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { Button } from '@/components/ui/button';\nimport { AgencyMandatesList } from '@/components/agency/AgencyMandatesList';\nimport { AgencyPropertiesView } from '@/components/agency/AgencyPropertiesView';\nimport { AgencyFinancialStats } from '@/components/agency/AgencyFinancialStats';\n\nexport default function AgencyDashboard() {\n  const { profile } = useAuth();\n  const { pendingMandates, activeMandates, asAgency, isLoading } = useAgencyMandates();\n  const { stats, managedProperties } = useAgencyProperties();\n\n  // Mandats expirant dans moins de 30 jours\n  const expiringSoon = activeMandates.filter(m => {\n    if (!m.end_date) return false;\n    const daysUntilExpiry = (new Date(m.end_date).getTime() - Date.now()) / (1000 * 60 * 60 * 24);\n    return daysUntilExpiry > 0 && daysUntilExpiry <= 30;\n  });\n\n  // Redirection si pas une agence\n  if (profile && profile.user_type !== 'agence') {\n    return <Navigate to=\"/dashboard\" replace />;\n  }\n\n  return (\n    <div className=\"container mx-auto py-6 space-y-8\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold\">Tableau de bord Agence</h1>\n          <p className=\"text-muted-foreground mt-2\">\n            Gérez vos mandats et propriétés confiées\n          </p>\n        </div>\n        <div className=\"flex items-center gap-3\">\n          <Button variant=\"outline\" size=\"sm\" asChild>\n            <Link to=\"/mandates/help\" className=\"gap-2\">\n              <HelpCircle className=\"h-4 w-4\" />\n              Aide\n            </Link>\n          </Button>\n          {pendingMandates.length > 0 && (\n            <Badge variant=\"default\" className=\"text-lg px-4 py-2\">\n              {pendingMandates.length} invitation{pendingMandates.length > 1 ? 's' : ''} en attente\n            </Badge>\n          )}\n        </div>\n      </div>\n\n      {/* Alertes */}\n      <div className=\"space-y-4\">\n        {pendingMandates.length > 0 && (\n          <Alert>\n            <AlertCircle className=\"h-4 w-4\" />\n            <AlertDescription>\n              Vous avez {pendingMandates.length} nouvelle{pendingMandates.length > 1 ? 's' : ''} invitation\n              {pendingMandates.length > 1 ? 's' : ''} de mandat à traiter.\n            </AlertDescription>\n          </Alert>\n        )}\n\n        {expiringSoon.length > 0 && (\n          <Alert variant=\"destructive\">\n            <AlertTriangle className=\"h-4 w-4\" />\n            <AlertDescription>\n              ⚠️ {expiringSoon.length} mandat{expiringSoon.length > 1 ? 's' : ''} expire\n              {expiringSoon.length > 1 ? 'nt' : ''} dans les 30 prochains jours. \n              Contactez vos clients pour renouveler.\n            </AlertDescription>\n          </Alert>\n        )}\n      </div>\n\n      {/* Stats globales */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Mandats actifs</CardTitle>\n            <FileCheck className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{activeMandates.length}</div>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              {asAgency.length} total\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Biens gérés</CardTitle>\n            <Building2 className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{stats.totalProperties}</div>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              {stats.availableProperties} disponibles\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Propriétaires</CardTitle>\n            <Users className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{stats.totalOwners}</div>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              Clients actifs\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Taux occupation</CardTitle>\n            <TrendingUp className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">\n              {stats.totalProperties > 0 \n                ? Math.round((stats.rentedProperties / stats.totalProperties) * 100)\n                : 0}%\n            </div>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              {stats.rentedProperties} biens loués\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Tabs principales */}\n      <Tabs defaultValue=\"mandates\" className=\"space-y-6\">\n        <TabsList className=\"grid w-full grid-cols-3\">\n          <TabsTrigger value=\"mandates\">\n            Mes mandats ({asAgency.length})\n          </TabsTrigger>\n          <TabsTrigger value=\"properties\">\n            Biens gérés ({stats.totalProperties})\n          </TabsTrigger>\n          <TabsTrigger value=\"financials\">\n            Financier\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"mandates\" className=\"space-y-4\">\n          <AgencyMandatesList \n            mandates={asAgency} \n            isLoading={isLoading}\n          />\n        </TabsContent>\n\n        <TabsContent value=\"properties\" className=\"space-y-4\">\n          <AgencyPropertiesView \n            properties={managedProperties}\n            mandates={activeMandates}\n          />\n        </TabsContent>\n\n        <TabsContent value=\"financials\" className=\"space-y-4\">\n          <AgencyFinancialStats \n            mandates={activeMandates}\n            properties={managedProperties}\n          />\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n"],"names":["triggerHapticFeedback","type","audioContext","oscillator","gainNode","duration","useLongPress","onLongPress","onClick","delay","longPressTriggered","setLongPressTriggered","useState","timeout","useRef","start","useCallback","event","clear","clickHandler","useTimeAgo","date","now","past","diffMs","diffMinutes","diffHours","diffDays","OptimizedImage","src","alt","priority","sizes","className","currentSrc","setCurrentSrc","isLoading","setIsLoading","isVisible","setIsVisible","imgRef","sanitizeUrl","url","urlObj","logger","getLowResSrc","separator","useEffect","observer","entry","safeSrc","lowResImg","lowResSrc","highResImg","generateSrcSet","jsx","cn","useNetworkStatus","networkInfo","setNetworkInfo","connection","updateNetworkInfo","handleOnlineChange","prev","PropertyCard","property","onFavoriteClick","isFavorite","variant","showStatus","showRemoveButton","hasCertifiedLease","setHasCertifiedLease","showPreview","setShowPreview","agencyName","setAgencyName","timeAgo","effectiveType","saveData","checkCertification","data","supabase","checkAgencyMandate","longPressProps","swipeHandlers","useSwipeable","toast","jsxs","Fragment","Card","MapPin","motion","e","Button","Heart","Badge","Clock","Lock","getPropertyStatusLabel","Building2","ShieldCheck","Wrench","formatPrice","CardHeader","CardTitle","CardContent","Bed","Bath","Maximize","Link","Dialog","DialogContent","ExternalLink","useAgencyProperties","user","profile","useAuth","activeMandates","asAgency","useAgencyMandates","isAgency","managedProperties","useQuery","ownerIds","m","error","mandate","propertiesByOwner","acc","ownerId","stats","p","AgencyMandatesList","mandates","acceptMandate","refuseMandate","getStatusBadge","status","config","getMandateTypeLabel","CardDescription","format","fr","Check","AlertDialog","AlertDialogTrigger","X","AlertDialogContent","AlertDialogHeader","AlertDialogTitle","AlertDialogDescription","AlertDialogFooter","AlertDialogCancel","AlertDialogAction","Home","Eye","Edit","FileText","Trash","Users","DollarSign","ITEMS_PER_PAGE","AgencyPropertiesView","properties","page","setPage","useMemo","ownerName","ownersEntries","totalPages","paginatedOwners","ownerProperties","AgencyFinancialStats","estimatedRevenue","total","totalRent","sum","TrendingUp","Calendar","mandateProperties","revenue","AgencyDashboard","pendingMandates","expiringSoon","daysUntilExpiry","Navigate","HelpCircle","Alert","AlertCircle","AlertDescription","AlertTriangle","FileCheck","Tabs","TabsList","TabsTrigger","TabsContent"],"mappings":"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"}