import{r as c,j as e,S as Ns,z as Ce,bT as bs,ah as P,af as Ae,bb as $,bL as Q,ab as Z,ae as Ye,be as H,bU as Xe,bV as Je,a$ as ws,a5 as Qe,b9 as Ze,bC as J,aJ as ys,bJ as es,bz as _s,b0 as Ss,bd as Cs,bW as As,bX as ks,bY as Ts,ai as $e,bZ as Ds,b_ as Rs,bx as ss,X as Ms,bu as le,b$ as Ve,bO as Ee,c0 as ze,bw as Oe}from"./react-vendor-CPmH2tz8.js";import{c as G,F as Ls,G as Ps,H as Fs,S as Bs,P as we,I as $s,J as Vs,C as A,e as D,b as L,d as F,j as W,B as y,D as Es,h as zs,K as Os,L as Is,M as Us,a as _,N as de,O as me,Q as U,R as v,U as xe,V as N,W as Ie,s as M,l as O,u as ke,X as ts,Y as as,T as rs,y as is,z as E,E as Ue,Z as ns,t as Ke,_ as Ks,A as qs,k as Hs,m as Gs,n as Ws,o as Ys,p as Xs,q as Js,r as Qs,v as Zs,$ as ye,a0 as qe,w as ce,x as oe,a1 as et,a2 as st,a3 as tt,a4 as ve,a5 as at}from"./route-admin-B1Ip8YDE.js";import{R as Te,b as rt,C as De,X as Re,Y as Me,T as Le,L as Pe,c as He,B as it,a as Ne,A as nt,i as be}from"./charts-vendor-16YcNskv.js";import{cd as lt,cj as z}from"./common-vendor-CK5d0rWc.js";import{t as Ge}from"./route-agency-BEE2sWoQ.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};s.SENTRY_RELEASE={id:"b65e2d84341e79b518aed72b6e71dcc77eba934a"}}catch{}})();try{(function(){var s=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},t=new s.Error().stack;t&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[t]="ad879bf1-588f-411f-b720-3387e553842e",s._sentryDebugIdIdentifier="sentry-dbid-ad879bf1-588f-411f-b720-3387e553842e")})()}catch{}const ls=c.forwardRef(({...s},t)=>e.jsx("nav",{ref:t,"aria-label":"breadcrumb",...s}));ls.displayName="Breadcrumb";const cs=c.forwardRef(({className:s,...t},r)=>e.jsx("ol",{ref:r,className:G("flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5",s),...t}));cs.displayName="BreadcrumbList";const _e=c.forwardRef(({className:s,...t},r)=>e.jsx("li",{ref:r,className:G("inline-flex items-center gap-1.5",s),...t}));_e.displayName="BreadcrumbItem";const Se=c.forwardRef(({asChild:s,className:t,...r},i)=>{const a=s?Ns:"a";return e.jsx(a,{ref:i,className:G("transition-colors hover:text-foreground",t),...r})});Se.displayName="BreadcrumbLink";const os=c.forwardRef(({className:s,...t},r)=>e.jsx("span",{ref:r,role:"link","aria-disabled":"true","aria-current":"page",className:G("font-normal text-foreground",s),...t}));os.displayName="BreadcrumbPage";const ds=({children:s,className:t,...r})=>e.jsx("li",{role:"presentation","aria-hidden":"true",className:G("[&>svg]:size-3.5",t),...r,children:s??e.jsx(Ce,{})});ds.displayName="BreadcrumbSeparator";const ct={"/":"Accueil","/dashboard":"Tableau de bord","/analytics":"Analytics","/profil":"Mon Profil","/mes-biens":"Mes Biens","/ajouter-bien":"Publier un bien","/editer-bien":"Modifier le bien","/modifier-bien":"Modifier le bien","/verification":"Vérification d'identité","/favoris":"Mes Favoris","/candidatures":"Mes Candidatures","/candidature":"Postuler","/recherche":"Recherche avancée","/explorer":"Explorer la carte","/publier":"Publier un bien","/baux":"Mes Baux","/messages":"Messagerie","/paiements":"Paiements","/maintenance":"Maintenance","/a-propos":"À propos","/admin":"Administration","/admin/certifications":"Certifications","/admin/dashboard":"Dashboard Admin","/property":"Détails du bien","/certification":"Certification","/guide":"Guide","/tarifs":"Tarifs","/conditions":"Conditions","/confidentialite":"Confidentialité","/mentions-legales":"Mentions légales","/legal":"Mentions légales"},ms=()=>{const t=bs().pathname.split("/").filter(i=>i);if(t.length===0)return null;const r=i=>`/${t.slice(0,i+1).join("/")}`;return e.jsx(ls,{className:"mb-6",children:e.jsxs(cs,{children:[e.jsx(_e,{children:e.jsx(Se,{asChild:!0,children:e.jsxs(P,{to:"/",className:"flex items-center gap-1 hover:text-primary transition-smooth",children:[e.jsx(Ae,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Accueil"})]})})}),t.map((i,a)=>{const n=r(a),x=a===t.length-1,j=ct[n]||t[a];return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ds,{children:e.jsx(Ce,{className:"h-4 w-4"})}),e.jsx(_e,{children:x?e.jsx(os,{className:"font-medium text-foreground",children:j}):e.jsx(Se,{asChild:!0,children:e.jsx(P,{to:n,className:"hover:text-primary transition-smooth",children:j})})})]},n)})]})})},ot=lt("inline-flex items-center gap-1.5 rounded-full border font-semibold transition-all duration-300 animate-badge-appear",{variants:{variant:{success:"bg-status-success text-status-success-foreground border-status-success/30 hover:shadow-[0_0_12px_rgba(34,197,94,0.4)]",warning:"bg-status-warning text-status-warning-foreground border-status-warning/30 hover:shadow-[0_0_12px_rgba(251,146,60,0.4)] animate-pulse-soft",danger:"bg-status-danger text-status-danger-foreground border-status-danger/30 hover:shadow-[0_0_12px_rgba(239,68,68,0.4)]",info:"bg-status-info text-status-info-foreground border-status-info/30 hover:shadow-[0_0_12px_rgba(59,130,246,0.4)]",neutral:"bg-status-neutral text-status-neutral-foreground border-status-neutral/30 hover:shadow-[0_0_12px_rgba(107,114,128,0.4)]"},size:{sm:"px-2 py-0.5 text-xs",md:"px-2.5 py-1 text-sm",lg:"px-3 py-1.5 text-base"}},defaultVariants:{variant:"neutral",size:"md"}}),dt={disponible:"Disponible à la location",loué:"Déjà loué",loue:"Déjà loué",en_attente:"En cours de validation",retiré:"Retiré de la plateforme",retire:"Retiré de la plateforme",refuse:"Refusé par la modération"};function mt({status:s,variant:t,size:r="md",showIcon:i=!0,showLabel:a=!0,animate:n=!1,className:x}){const j=t||$s[s]||"neutral",u=Bs[s],h=we[s]||s,d=dt[s]||h,g=r==="sm"?"h-3 w-3":r==="lg"?"h-5 w-5":"h-4 w-4";return e.jsx(Ls,{children:e.jsxs(Ps,{children:[e.jsx(Fs,{asChild:!0,children:e.jsxs("div",{className:G(ot({variant:j,size:r}),n&&s==="en_attente"&&"animate-pulse-soft","hover:scale-105",x),"aria-label":`Statut : ${d}`,children:[i&&u&&e.jsx(u,{className:g}),a&&e.jsx("span",{children:h})]})}),e.jsx(Vs,{children:e.jsx("p",{children:d})})]})})}const xt=({status:s,variant:t="default"})=>e.jsx(mt,{status:s,size:t==="compact"?"sm":"md",animate:s==="en_attente"}),ut=({stats:s})=>{const t=[{title:"Biens",value:s.totalProperties,icon:Ae,color:"text-blue-600"},{title:"Vues",value:s.totalViews.toLocaleString(),icon:$,color:"text-primary"},{title:"Favoris",value:s.totalFavorites,icon:Q,color:"text-pink-600"},{title:"Candidatures",value:s.totalApplications,icon:Z,color:"text-orange-600"},{title:"Loyer moyen",value:`${(s.averageRent/1e3).toFixed(0)}K`,icon:Ye,color:"text-green-600"},{title:"Occupation",value:`${s.occupancyRate}%`,icon:H,color:"text-success"}];return e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-6 gap-3",children:t.map((r,i)=>e.jsx(A,{className:"hover:shadow-md transition-shadow",children:e.jsx(D,{className:"p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(r.icon,{className:`h-4 w-4 ${r.color}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-lg font-bold truncate",children:r.value}),e.jsx("div",{className:"text-xs text-muted-foreground truncate",children:r.title})]})]})})},i))})},ht=({title:s,value:t,icon:r,trend:i,description:a})=>e.jsxs(A,{className:"transition-all duration-200 hover:scale-105 hover:shadow-card-hover cursor-pointer group",children:[e.jsxs(L,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(F,{className:"text-sm font-medium",children:s}),e.jsx(r,{className:"h-4 w-4 text-muted-foreground transition-transform duration-200 group-hover:rotate-12"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t}),a&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:a}),i&&e.jsxs("p",{className:`text-xs mt-1 ${i.isPositive?"text-green-600":"text-red-600"}`,children:[i.isPositive?"+":"",i.value,"% depuis le mois dernier"]})]})]}),jt=({stats:s,trends:t})=>{const r=[{title:"Biens totaux",value:s.totalProperties,icon:Ae,trend:t==null?void 0:t.totalProperties},{title:"Vues totales",value:s.totalViews.toLocaleString(),icon:$,trend:t==null?void 0:t.totalViews},{title:"Favoris",value:s.totalFavorites,icon:Q,trend:t==null?void 0:t.totalFavorites},{title:"Candidatures",value:s.totalApplications,icon:Z,trend:t==null?void 0:t.totalApplications},{title:"Loyer moyen",value:`${s.averageRent.toLocaleString()} FCFA`,icon:Ye,trend:t==null?void 0:t.averageRent,description:"Par mois"},{title:"Taux d'occupation",value:`${s.occupancyRate}%`,icon:H,trend:t==null?void 0:t.occupancyRate}];return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:r.map((i,a)=>e.jsx(ht,{...i},a))})},We=({data:s,className:t,loading:r=!1})=>{const[i,a]=c.useState("30d"),[n,x]=c.useState(!0),[j,u]=c.useState(!0),h=[{value:"7d",label:"7j"},{value:"30d",label:"30j"},{value:"3m",label:"3 mois"},{value:"1y",label:"1 an"}],d=s.length>0?s:Array.from({length:7},(g,T)=>{const R=new Date;return R.setDate(R.getDate()-(6-T)),{date:R.toLocaleDateString("fr-FR",{day:"numeric",month:"short"}),views:Math.floor(Math.random()*50)+10,favorites:Math.floor(Math.random()*10)+2}});return r?e.jsxs(A,{className:t,children:[e.jsx(L,{children:e.jsx("div",{className:"h-6 w-48 bg-muted rounded animate-pulse"})}),e.jsx(D,{children:e.jsx("div",{className:"h-64 bg-muted/50 rounded animate-pulse"})})]}):e.jsxs(A,{className:t,children:[e.jsx(L,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(F,{children:"Évolution des Vues et Favoris"}),e.jsxs(W,{children:["Statistiques des ",i==="7d"?"7 derniers jours":i==="30d"?"30 derniers jours":i==="3m"?"3 derniers mois":"dernière année"]})]}),e.jsx("div",{className:"flex gap-2",children:h.map(g=>e.jsx(y,{variant:i===g.value?"default":"outline",size:"sm",onClick:()=>a(g.value),children:g.label},g.value))})]})}),e.jsx(D,{children:e.jsx(Te,{width:"100%",height:300,children:e.jsxs(rt,{data:d,children:[e.jsx(De,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(Re,{dataKey:"date",className:"text-xs",tick:{fill:"hsl(var(--muted-foreground))"}}),e.jsx(Me,{className:"text-xs",tick:{fill:"hsl(var(--muted-foreground))"}}),e.jsx(Le,{contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))",borderRadius:"8px"}}),e.jsx(Pe,{onClick:g=>{g.dataKey==="views"&&x(!n),g.dataKey==="favorites"&&u(!j)},wrapperStyle:{cursor:"pointer"}}),n&&e.jsx(He,{type:"monotone",dataKey:"views",stroke:"hsl(var(--primary))",strokeWidth:2,name:"Vues",dot:{fill:"hsl(var(--primary))"},activeDot:{r:6}}),j&&e.jsx(He,{type:"monotone",dataKey:"favorites",stroke:"hsl(var(--destructive))",strokeWidth:2,name:"Favoris",dot:{fill:"hsl(var(--destructive))"},activeDot:{r:6}})]})})})]})},gt=({data:s,className:t})=>{const[r,i]=c.useState(null),a=s.find(x=>x.property===r),n=a?a.pending+a.approved+a.rejected:0;return e.jsxs(e.Fragment,{children:[e.jsxs(A,{className:t,children:[e.jsxs(L,{children:[e.jsx(F,{children:"Candidatures par Bien"}),e.jsx(W,{children:"Cliquez sur une barre pour voir les détails"})]}),e.jsx(D,{children:e.jsx(Te,{width:"100%",height:300,children:e.jsxs(it,{data:s,children:[e.jsx(De,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(Re,{dataKey:"property",className:"text-xs",tick:{fill:"hsl(var(--muted-foreground))"},angle:-45,textAnchor:"end",height:100}),e.jsx(Me,{className:"text-xs",tick:{fill:"hsl(var(--muted-foreground))"}}),e.jsx(Le,{contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))",borderRadius:"8px"}}),e.jsx(Pe,{}),e.jsx(Ne,{dataKey:"pending",fill:"#facc15",name:"En attente",cursor:"pointer",onClick:x=>i(x.property)}),e.jsx(Ne,{dataKey:"approved",fill:"#22c55e",name:"Approuvées",cursor:"pointer",onClick:x=>i(x.property)}),e.jsx(Ne,{dataKey:"rejected",fill:"#ef4444",name:"Rejetées",cursor:"pointer",onClick:x=>i(x.property)})]})})})]}),e.jsx(Es,{open:!!r,onOpenChange:()=>i(null),children:e.jsxs(zs,{children:[e.jsxs(Os,{children:[e.jsx(Is,{children:r}),e.jsx(Us,{children:"Détail des candidatures pour ce bien"})]}),a&&e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total"}),e.jsx("p",{className:"text-2xl font-bold",children:n})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Taux d'approbation"}),e.jsxs("p",{className:"text-2xl font-bold",children:[n>0?Math.round(a.approved/n*100):0,"%"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 rounded-lg bg-yellow-50 dark:bg-yellow-950",children:[e.jsx("span",{className:"text-sm font-medium",children:"En attente"}),e.jsx("span",{className:"font-bold",children:a.pending})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 rounded-lg bg-green-50 dark:bg-green-950",children:[e.jsx("span",{className:"text-sm font-medium",children:"Approuvées"}),e.jsx("span",{className:"font-bold",children:a.approved})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 rounded-lg bg-red-50 dark:bg-red-950",children:[e.jsx("span",{className:"text-sm font-medium",children:"Rejetées"}),e.jsx("span",{className:"font-bold",children:a.rejected})]})]})]})]})})]})},pt=({data:s,className:t})=>{const r=a=>{switch(a){case"up":return e.jsx(H,{className:"h-4 w-4 text-green-600"});case"down":return e.jsx(Je,{className:"h-4 w-4 text-red-600"});default:return e.jsx(Xe,{className:"h-4 w-4 text-muted-foreground"})}},i=a=>a>0?e.jsxs(_,{variant:"default",className:"bg-green-600",children:["+",a,"%"]}):a<0?e.jsxs(_,{variant:"destructive",children:[a,"%"]}):e.jsx(_,{variant:"secondary",children:"0%"});return e.jsxs(A,{className:t,children:[e.jsxs(L,{children:[e.jsx(F,{children:"Comparaison de Marché"}),e.jsx(W,{children:"Vos prix vs prix du marché par type de bien"})]}),e.jsx(D,{children:e.jsx("div",{className:"space-y-4",children:s.map((a,n)=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[r(a.trend),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.propertyType}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Votre moyenne: ",a.myAverage.toLocaleString()," FCFA"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm text-muted-foreground mb-1",children:["Marché: ",a.marketAverage.toLocaleString()," FCFA"]}),i(a.difference)]})]},n))})})]})},ft=({properties:s})=>e.jsxs(A,{children:[e.jsxs(L,{children:[e.jsx(F,{children:"Biens les Plus Performants"}),e.jsx(W,{children:"Top 5 par taux de conversion"})]}),e.jsx(D,{children:e.jsxs(de,{children:[e.jsx(me,{children:e.jsxs(U,{children:[e.jsx(v,{className:"w-12",children:"#"}),e.jsx(v,{children:"Bien"}),e.jsx(v,{className:"text-center",children:"Vues"}),e.jsx(v,{className:"text-center",children:"Favoris"}),e.jsx(v,{className:"text-center",children:"Candidatures"}),e.jsx(v,{className:"text-right",children:"Conversion"})]})}),e.jsx(xe,{children:s.map((t,r)=>e.jsxs(U,{className:"hover:bg-muted/50",children:[e.jsx(N,{children:e.jsx(_,{variant:"outline",className:"font-bold",children:r+1})}),e.jsx(N,{children:e.jsx(P,{to:`/property/${t.id}`,className:"font-medium hover:text-primary transition-colors line-clamp-1",children:t.title})}),e.jsx(N,{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx($,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:t.views})]})}),e.jsx(N,{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(Q,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:t.favorites})]})}),e.jsx(N,{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(ws,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:t.applications})]})}),e.jsx(N,{className:"text-right",children:e.jsxs(_,{variant:t.conversionRate>10?"default":"secondary",className:t.conversionRate>10?"bg-green-600":"",children:[t.conversionRate,"%"]})})]},t.id))})]})})]}),vt=({properties:s,loading:t})=>{const r=Qe();return t?e.jsxs(A,{className:"col-span-full",children:[e.jsx(L,{children:e.jsx(Ie,{className:"h-6 w-48"})}),e.jsx(D,{children:e.jsx("div",{className:"space-y-4",children:[1,2,3].map(i=>e.jsx(Ie,{className:"h-16 w-full"},i))})})]}):s.length===0?e.jsxs(A,{className:"col-span-full",children:[e.jsx(L,{children:e.jsx(F,{children:"Performance par Bien"})}),e.jsx(D,{children:e.jsx("p",{className:"text-muted-foreground text-center py-8",children:"Aucune propriété à afficher pour le moment"})})]}):e.jsxs(A,{className:"col-span-full",children:[e.jsx(L,{children:e.jsx(F,{children:"Performance par Bien"})}),e.jsx(D,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(de,{children:[e.jsx(me,{children:e.jsxs(U,{children:[e.jsx(v,{children:"Bien"}),e.jsx(v,{children:"Loyer"}),e.jsx(v,{className:"text-center",children:"Vues (7j)"}),e.jsx(v,{className:"text-center",children:"Candidatures"}),e.jsx(v,{className:"text-center",children:"Conversion"}),e.jsx(v,{children:"Statut"}),e.jsx(v,{className:"text-right",children:"Actions"})]})}),e.jsx(xe,{children:s.map(i=>e.jsxs(U,{children:[e.jsx(N,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-3",children:[i.property_image&&e.jsx("img",{src:i.property_image,alt:i.property_title,className:"h-10 w-10 rounded object-cover"}),e.jsx("span",{className:"truncate max-w-xs",children:i.property_title})]})}),e.jsxs(N,{children:[i.monthly_rent.toLocaleString()," FCFA"]}),e.jsx(N,{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx($,{className:"h-4 w-4 text-muted-foreground"}),i.views_7d]})}),e.jsx(N,{className:"text-center",children:i.applications_count}),e.jsx(N,{className:"text-center",children:e.jsxs(_,{variant:i.conversion_rate>5?"default":"secondary",children:[e.jsx(H,{className:"h-3 w-3 mr-1"}),i.conversion_rate,"%"]})}),e.jsx(N,{children:e.jsx(_,{variant:i.status==="disponible"?"default":"secondary",children:i.status})}),e.jsx(N,{className:"text-right",children:e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(y,{size:"sm",variant:"outline",onClick:()=>r(`/property/${i.property_id}`),children:"Voir"}),e.jsx(y,{size:"sm",variant:"outline",onClick:()=>r(`/edit-property/${i.property_id}`),children:e.jsx(Ze,{className:"h-4 w-4"})})]})})]},i.property_id))})]})})})]})},Nt=({className:s})=>{const[t,r]=c.useState([]),[i,a]=c.useState(!0),[n,x]=c.useState(!1);c.useEffect(()=>{j()},[]);const j=async()=>{try{const{data:d,error:g}=await M.from("rental_applications").select(`
          id,
          property_id,
          processing_deadline,
          properties (title)
        `).eq("status","pending").eq("is_overdue",!0).order("processing_deadline",{ascending:!0}).limit(10);if(g)throw g;const T=(d||[]).map(R=>{var I;const S=new Date(R.processing_deadline),C=new Date().getTime()-S.getTime(),V=Math.floor(C/(1e3*60*60*24));return{id:R.id,type:"overdue_application",title:`${((I=R.properties)==null?void 0:I.title)||"Bien"}`,priority:V>5?"critical":V>2?"important":"info",link:"/tiers-de-confiance",daysOverdue:V}});r(T)}catch(d){O.logError(d,{context:"UrgentActionsCardCompact",action:"fetch"})}finally{a(!1)}};if(i)return e.jsx(A,{className:s,children:e.jsx(D,{className:"p-4 text-center text-sm text-muted-foreground",children:"Chargement..."})});const u=d=>{switch(d){case"critical":return"destructive";case"important":return"default";case"info":return"secondary"}};if(t.length===0)return e.jsx(A,{className:`border-green-200 bg-green-50 dark:bg-green-950 dark:border-green-800 ${s}`,children:e.jsx(L,{className:"p-4",children:e.jsx(F,{className:"text-sm text-green-700 dark:text-green-400",children:"✓ Tout est à jour"})})});const h=n?t:t.slice(0,5);return e.jsxs(A,{className:`border-orange-200 dark:border-orange-800 ${s}`,children:[e.jsx(L,{className:"p-4 pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(F,{className:"flex items-center gap-2 text-base",children:[e.jsx(J,{className:"h-4 w-4 text-orange-600"}),"Actions Urgentes"]}),e.jsx(_,{variant:"destructive",className:"text-xs",children:t.length})]})}),e.jsxs(D,{className:"p-4 pt-0",children:[e.jsx("div",{className:"space-y-2",children:h.map(d=>e.jsxs(P,{to:d.link,className:"flex items-center gap-2 p-2 rounded-lg border hover:bg-accent/50 transition-colors group",children:[e.jsx(ys,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:d.title}),e.jsxs("p",{className:"text-xs text-destructive",children:[d.daysOverdue,"j de retard"]})]}),e.jsx(_,{variant:u(d.priority),className:"text-xs",children:d.priority==="critical"?"Urgent":"Important"}),e.jsx(Ce,{className:"h-4 w-4 text-muted-foreground group-hover:translate-x-1 transition-transform"})]},d.id))}),t.length>5&&e.jsx(y,{variant:"ghost",size:"sm",className:"w-full mt-2",onClick:()=>x(!n),children:n?"Voir moins":`Voir ${t.length-5} de plus`})]})]})},bt=({currentRevenue:s,occupancyRate:t,className:r})=>{const a=["Mois 1","Mois 2","Mois 3"].map((h,d)=>{const g=1+d*.05;return{month:h,optimistic:Math.round(s*g*1.15),realistic:Math.round(s*g),pessimistic:Math.round(s*g*.85)}}),n=a.reduce((u,h)=>u+h.realistic,0),x=s*3,j=(n-x)/x*100;return e.jsxs(A,{className:r,children:[e.jsxs(L,{children:[e.jsxs(F,{className:"flex items-center justify-between",children:["Prévisions de Revenus",e.jsx("div",{className:"flex items-center gap-1 text-sm font-normal",children:j>0?e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"h-4 w-4 text-green-600"}),e.jsxs("span",{className:"text-green-600",children:["+",j.toFixed(1),"%"]})]}):j<0?e.jsxs(e.Fragment,{children:[e.jsx(Je,{className:"h-4 w-4 text-red-600"}),e.jsxs("span",{className:"text-red-600",children:[j.toFixed(1),"%"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(Xe,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-muted-foreground",children:"Stable"})]})})]}),e.jsxs(W,{children:["Projection sur 3 mois (taux d'occupation actuel: ",t,"%)"]})]}),e.jsxs(D,{children:[e.jsx(Te,{width:"100%",height:300,children:e.jsxs(nt,{data:a,children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"colorOptimistic",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#22c55e",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#22c55e",stopOpacity:0})]}),e.jsxs("linearGradient",{id:"colorRealistic",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"hsl(var(--primary))",stopOpacity:.4}),e.jsx("stop",{offset:"95%",stopColor:"hsl(var(--primary))",stopOpacity:0})]}),e.jsxs("linearGradient",{id:"colorPessimistic",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#ef4444",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#ef4444",stopOpacity:0})]})]}),e.jsx(De,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(Re,{dataKey:"month",className:"text-xs",tick:{fill:"hsl(var(--muted-foreground))"}}),e.jsx(Me,{className:"text-xs",tick:{fill:"hsl(var(--muted-foreground))"},tickFormatter:u=>`${(u/1e3).toFixed(0)}K`}),e.jsx(Le,{contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))",borderRadius:"8px"},formatter:u=>`${u.toLocaleString()} FCFA`}),e.jsx(Pe,{}),e.jsx(be,{type:"monotone",dataKey:"optimistic",stroke:"#22c55e",strokeWidth:1,fill:"url(#colorOptimistic)",name:"Optimiste (+15%)"}),e.jsx(be,{type:"monotone",dataKey:"realistic",stroke:"hsl(var(--primary))",strokeWidth:2,fill:"url(#colorRealistic)",name:"Réaliste"}),e.jsx(be,{type:"monotone",dataKey:"pessimistic",stroke:"#ef4444",strokeWidth:1,fill:"url(#colorPessimistic)",name:"Pessimiste (-15%)"})]})}),e.jsxs("div",{className:"mt-4 pt-4 border-t space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Revenus actuels (mois)"}),e.jsxs("span",{className:"font-medium",children:[s.toLocaleString()," FCFA"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Projection réaliste (3 mois)"}),e.jsxs("span",{className:"font-medium",children:[n.toLocaleString()," FCFA"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-3",children:"* Basé sur le taux d'occupation actuel et les tendances du marché"})]})]})]})},wt=()=>{const{user:s}=ke(),[t,r]=c.useState([]),[i,a]=c.useState(null),[n,x]=c.useState(!0),[j,u]=c.useState(null);return c.useEffect(()=>{if(!s){x(!1);return}(async()=>{try{x(!0);const{data:d,error:g}=await M.rpc("get_owner_analytics",{owner_user_id:s.id});if(g)throw g;if(r(d||[]),d&&d.length>0){const T=d.reduce((B,C)=>B+Number(C.views_7d),0),R=d.reduce((B,C)=>B+Number(C.applications_count),0),S=d.reduce((B,C)=>B+Number(C.conversion_rate),0)/d.length;a({total_properties:d.length,total_views_7d:T,total_applications:R,avg_conversion_rate:Math.round(S*100)/100})}else a({total_properties:0,total_views_7d:0,total_applications:0,avg_conversion_rate:0})}catch(d){O.error("Failed to fetch owner analytics",{error:d.message,userId:s.id}),u(d.message)}finally{x(!1)}})()},[s]),{analytics:t,stats:i,loading:n,error:j}},yt=()=>{const{user:s,profile:t,loading:r}=ke(),{analytics:i,stats:a,loading:n}=wt(),[x,j]=c.useState(!0),[u,h]=c.useState({totalProperties:0,totalViews:0,totalFavorites:0,totalApplications:0,averageRent:0,occupancyRate:0}),[d,g]=c.useState([]),[T,R]=c.useState([]),[S,B]=c.useState([]),[C,V]=c.useState([]),[I,Y]=c.useState([]),[ee,se]=c.useState([]);c.useEffect(()=>{s&&t&&te()},[s,t]);const te=async()=>{if(s){j(!0);try{const{data:l,error:o}=await M.from("properties").select("*").eq("owner_id",s.id);if(o)throw o;const{data:b}=await M.from("properties").select("property_type, monthly_rent"),{data:p}=await M.from("user_favorites").select("property_id").in("property_id",(l==null?void 0:l.map(m=>m.id))||[]),{data:f}=await M.from("rental_applications").select("property_id, status, created_at").in("property_id",(l==null?void 0:l.map(m=>m.id))||[]),X=(l==null?void 0:l.length)||0,ae=(l==null?void 0:l.reduce((m,w)=>m+(w.view_count||0),0))||0,je=(p==null?void 0:p.length)||0,xs=(f==null?void 0:f.length)||0,us=(l==null?void 0:l.reduce((m,w)=>m+w.monthly_rent,0))/Math.max(X,1)||0,hs=(l==null?void 0:l.filter(m=>m.status==="loué").length)||0,js=Math.round(hs/Math.max(X,1)*100);h({totalProperties:X,totalViews:ae,totalFavorites:je,totalApplications:xs,averageRent:Math.round(us),occupancyRate:js});const gs=Array.from({length:30},(m,w)=>{const k=new Date;return k.setDate(k.getDate()-(29-w)),{date:k.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"}),views:Math.floor(Math.random()*50)+10,favorites:Math.floor(Math.random()*10)+2}});g(gs);const ps=(l==null?void 0:l.slice(0,5).map(m=>{const w=(f==null?void 0:f.filter(k=>k.property_id===m.id))||[];return{property:m.title.slice(0,20)+(m.title.length>20?"...":""),pending:w.filter(k=>k.status==="pending").length,approved:w.filter(k=>k.status==="approved").length,rejected:w.filter(k=>k.status==="rejected").length}}))||[];R(ps);const fs=[...new Set((l==null?void 0:l.map(m=>m.property_type))||[])].map(m=>{const w=(l==null?void 0:l.filter(q=>q.property_type===m))||[],k=w.reduce((q,fe)=>q+fe.monthly_rent,0)/Math.max(w.length,1),ne=(b==null?void 0:b.filter(q=>q.property_type===m))||[],K=ne.reduce((q,fe)=>q+fe.monthly_rent,0)/Math.max(ne.length,1),pe=Math.round((k-K)/K*100);return{propertyType:m.charAt(0).toUpperCase()+m.slice(1),myAverage:Math.round(k),marketAverage:Math.round(K),difference:pe,trend:pe>5?"up":pe<-5?"down":"neutral"}});B(fs);const vs=(l==null?void 0:l.map(m=>{const w=(p==null?void 0:p.filter(K=>K.property_id===m.id).length)||0,k=(f==null?void 0:f.filter(K=>K.property_id===m.id).length)||0,ne=m.view_count>0?Math.round(k/m.view_count*100):0;return{id:m.id,title:m.title,views:m.view_count||0,favorites:w,applications:k,conversionRate:ne}}).sort((m,w)=>w.conversionRate-m.conversionRate).slice(0,5))||[];V(vs);const ge=[],Fe=new Date,re=(f==null?void 0:f.filter(m=>{if(m.status!=="pending")return!1;const w=new Date(m.created_at);return(Fe.getTime()-w.getTime())/(1e3*60*60)>48}))||[];re.length>0&&ge.push({id:"overdue-apps",type:"overdue_application",title:`${re.length} candidature${re.length>1?"s":""} en attente`,description:"Des candidatures attendent une réponse depuis plus de 48h",priority:"critical",link:"/applications",daysOverdue:Math.floor(Math.max(...re.map(m=>{const w=new Date(m.created_at);return(Fe.getTime()-w.getTime())/(1e3*60*60*24)})))});const ie=(l==null?void 0:l.filter(m=>!m.main_image||!m.description||m.description.length<50))||[];ie.length>0&&ge.push({id:"incomplete-props",type:"incomplete_property",title:`${ie.length} bien${ie.length>1?"s":""} incomplet${ie.length>1?"s":""}`,description:"Ajoutez photos et descriptions pour améliorer vos annonces",priority:"important",link:"/my-properties"}),Y(ge);const{data:Be}=await M.from("report_history").select("*").eq("owner_id",s.id).order("generated_at",{ascending:!1}).limit(12);if(Be){const m=Be.map(w=>({...w,period_label:`${new Date(w.period_start).toLocaleDateString("fr-FR",{month:"long",year:"numeric"})} - ${new Date(w.period_end).toLocaleDateString("fr-FR",{month:"long",year:"numeric"})}`}));se(m)}}catch(l){O.logError(l,{context:"OwnerDashboard",action:"fetchDashboardData"})}finally{j(!1)}}},ue=l=>{z.info("Prévisualisation du rapport",{description:`Rapport ${l.report_type} - ${l.period_label}`})},he=l=>{const o=new Blob([JSON.stringify(l.report_data,null,2)],{type:"application/json"}),b=URL.createObjectURL(o),p=document.createElement("a");p.href=b,p.download=`rapport-${l.report_type}-${l.period_start}.json`,p.click(),URL.revokeObjectURL(b),z.success("Rapport téléchargé")};return r||x?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):!t||t.user_type!=="proprietaire"&&t.user_type!=="agence"?e.jsx(es,{to:"/",replace:!0}):e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx(ts,{}),e.jsx("main",{className:"flex-1 container mx-auto px-4 py-8 pt-24",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-4",children:[e.jsx(ms,{}),e.jsxs(as,{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Tableau de Bord"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Analysez les performances de vos biens"})]}),e.jsxs(y,{onClick:te,variant:"outline",size:"sm",children:[e.jsx(_s,{className:"h-4 w-4 mr-2"}),"Actualiser"]})]}),e.jsxs(rs,{defaultValue:"overview",className:"space-y-4",children:[e.jsxs(is,{children:[e.jsx(E,{value:"overview",children:"Vue d'ensemble"}),e.jsxs(E,{value:"analytics",children:[e.jsx(Ss,{className:"h-4 w-4 mr-2"}),"Analytics"]})]}),e.jsxs(Ue,{value:"overview",className:"space-y-4",children:[e.jsx(ut,{stats:u}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsx(Nt,{className:"lg:col-span-1"}),e.jsxs("div",{className:"lg:col-span-2 grid grid-cols-2 gap-4 h-[320px]",children:[e.jsx(We,{data:d,className:"h-full"}),e.jsx(gt,{data:T,className:"h-full"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 h-[280px]",children:[e.jsx(bt,{currentRevenue:u.averageRent*u.totalProperties,occupancyRate:u.occupancyRate,className:"h-full"}),e.jsx(pt,{data:S,className:"h-full"})]}),e.jsx(ft,{properties:C}),ee.length>0&&e.jsxs(A,{children:[e.jsxs(L,{children:[e.jsxs(F,{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-5 w-5"}),"Historique des Rapports"]}),e.jsx(W,{children:"Consultez vos rapports de performance des 12 derniers mois"})]}),e.jsx(D,{children:e.jsxs(de,{children:[e.jsx(me,{children:e.jsxs(U,{children:[e.jsx(v,{children:"Période"}),e.jsx(v,{children:"Type"}),e.jsx(v,{children:"Généré le"}),e.jsx(v,{className:"text-right",children:"Actions"})]})}),e.jsx(xe,{children:ee.map(l=>e.jsxs(U,{children:[e.jsx(N,{className:"font-medium",children:l.period_label}),e.jsx(N,{children:e.jsx(_,{variant:"outline",children:l.report_type==="monthly"?"Mensuel":l.report_type==="quarterly"?"Trimestriel":"Annuel"})}),e.jsx(N,{children:new Date(l.generated_at).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"})}),e.jsxs(N,{className:"text-right space-x-2",children:[e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>ue(l),title:"Voir le rapport",children:e.jsx($,{className:"h-4 w-4"})}),e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>he(l),title:"Télécharger",children:e.jsx(Cs,{className:"h-4 w-4"})})]})]},l.id))})]})})]})]}),e.jsxs(Ue,{value:"analytics",className:"space-y-6",children:[e.jsx(jt,{stats:{totalProperties:(a==null?void 0:a.total_properties)||0,totalViews:(a==null?void 0:a.total_views_7d)||0,totalFavorites:0,totalApplications:(a==null?void 0:a.total_applications)||0,averageRent:0,occupancyRate:(a==null?void 0:a.avg_conversion_rate)||0}}),e.jsx("div",{className:"grid gap-6 lg:grid-cols-3",children:e.jsx(We,{data:[],loading:n,className:"lg:col-span-2"})}),e.jsx(vt,{properties:i,loading:n})]})]})]})}),e.jsx(ns,{})]})},Et=Object.freeze(Object.defineProperty({__proto__:null,default:yt},Symbol.toStringTag,{value:"Module"})),_t=({activeStatus:s,onStatusChange:t,counts:r})=>e.jsx(rs,{value:s,onValueChange:t,className:"w-full",children:e.jsxs(is,{className:"grid w-full grid-cols-3 lg:grid-cols-7",children:[e.jsxs(E,{value:"all",className:"gap-2",children:["Tous",e.jsx(_,{variant:"secondary",className:"ml-1",children:r.all})]}),e.jsxs(E,{value:"disponible",className:"gap-2",children:["Disponible",e.jsx(_,{variant:"secondary",className:"ml-1",children:r.disponible})]}),e.jsxs(E,{value:"loué",className:"gap-2",children:["Loué",e.jsx(_,{variant:"secondary",className:"ml-1",children:r.loué})]}),e.jsxs(E,{value:"en_maintenance",className:"gap-2",children:["Maintenance",e.jsx(_,{variant:"secondary",className:"ml-1",children:r.en_maintenance})]}),e.jsxs(E,{value:"en_negociation",className:"gap-2",children:["En négociation",e.jsx(_,{variant:"secondary",className:"ml-1 bg-negotiation/20 text-negotiation",children:r.en_negociation})]}),e.jsxs(E,{value:"pending",className:"gap-2",children:["En attente",e.jsx(_,{variant:"secondary",className:"ml-1",children:r.pending})]}),e.jsxs(E,{value:"rejected",className:"gap-2",children:["Rejeté",e.jsx(_,{variant:"secondary",className:"ml-1",children:r.rejected})]})]})}),St=({view:s,onViewChange:t,options:r=["grid","list"]})=>e.jsxs("div",{className:"flex gap-1 border rounded-lg p-1",children:[r.includes("grid")&&e.jsxs(y,{variant:s==="grid"?"default":"ghost",size:"sm",onClick:()=>t("grid"),className:"gap-2",children:[e.jsx(As,{className:"h-4 w-4"}),"Grille"]}),r.includes("list")&&e.jsxs(y,{variant:s==="list"?"default":"ghost",size:"sm",onClick:()=>t("list"),className:"gap-2",children:[e.jsx(ks,{className:"h-4 w-4"}),"Liste"]}),r.includes("table")&&e.jsxs(y,{variant:s==="table"?"default":"ghost",size:"sm",onClick:()=>t("table"),className:"gap-2",children:[e.jsx(Ts,{className:"h-4 w-4"}),"Tableau"]})]}),Ct=()=>{const[s,t]=c.useState(!1),[r,i]=c.useState(""),[a,n]=c.useState(!1);return c.useEffect(()=>{const u=window.SpeechRecognition||window.webkitSpeechRecognition;n(!!u)},[]),c.useEffect(()=>{const u=window.SpeechRecognition||window.webkitSpeechRecognition;if(!u||!s)return;const h=new u;return h.lang="fr-FR",h.continuous=!1,h.interimResults=!0,h.onresult=d=>{const g=d.resultIndex,T=d.results[g][0].transcript;i(T)},h.onend=()=>{t(!1)},h.onerror=d=>{O.warn("Speech recognition error",{error:d.error}),t(!1),d.error==="no-speech"&&Ke({title:"Aucun son détecté",description:"Veuillez réessayer et parler clairement",variant:"destructive"})},h.start(),()=>{h.stop()}},[s]),{isListening:s,transcript:r,isSupported:a,startListening:()=>{if(!a){Ke({title:"Non supporté",description:"La recherche vocale n'est pas supportée sur ce navigateur",variant:"destructive"});return}t(!0)},stopListening:()=>{t(!1)}}},At=s=>{const[t,r]=c.useState([]),[i,a]=c.useState(!1);return c.useEffect(()=>{if(s.length<2){r([]);return}const n=setTimeout(async()=>{a(!0);try{const{data:x,error:j}=await M.from("properties").select("city, title, neighborhood").or(`city.ilike.%${s}%,title.ilike.%${s}%,neighborhood.ilike.%${s}%`).eq("moderation_status","approved").limit(10);if(j)throw j;if(x){const u=[...new Set([...x.map(h=>h.city).filter(Boolean),...x.map(h=>h.neighborhood).filter(Boolean),...x.map(h=>h.title.split(" ")[0]).filter(Boolean)])];r(u.slice(0,5))}}catch{O.debug("Failed to fetch search suggestions",{query:s}),r([])}finally{a(!1)}},300);return()=>clearTimeout(n)},[s]),{suggestions:t,isLoading:i}},kt=({searchQuery:s,onSearchChange:t})=>{const[r,i]=c.useState(s),[a,n]=c.useState(!1),{isListening:x,transcript:j,isSupported:u,startListening:h,stopListening:d}=Ct(),{suggestions:g}=At(r);c.useEffect(()=>{j&&(i(j),t(j))},[j,t]),c.useEffect(()=>{i(s)},[s]);const T=S=>{i(S),t(S),n(!0)},R=S=>{i(S),t(S),n(!1),Ge("light")};return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx($e,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Ks,{value:r,onChange:S=>T(S.target.value),onFocus:()=>n(!0),onBlur:()=>setTimeout(()=>n(!1),200),placeholder:"Rechercher par ville, quartier...",className:"pl-10","aria-label":"Rechercher des propriétés","aria-autocomplete":"list","aria-expanded":a&&g.length>0})]}),u&&e.jsx(y,{size:"icon",variant:x?"default":"outline",onClick:()=>{Ge("medium"),x?d():h()},"aria-label":x?"Arrêter l'écoute":"Recherche vocale",className:"min-h-[44px] min-w-[44px]",children:e.jsx(Ds,{className:G("h-4 w-4",x&&"animate-pulse")})})]}),a&&g.length>0&&e.jsx(A,{className:"absolute top-full left-0 right-0 mt-2 z-50 shadow-lg",children:e.jsx(D,{className:"p-0",children:g.map((S,B)=>e.jsxs("button",{className:"w-full text-left px-4 py-3 hover:bg-muted transition-colors border-b last:border-0 min-h-[44px] flex items-center gap-2",onClick:()=>R(S),onMouseDown:C=>C.preventDefault(),children:[e.jsx($e,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:S})]},B))})})]})},Tt=({selectedCount:s,onClearSelection:t,onBulkDelete:r,onBulkStatusChange:i})=>s===0?null:e.jsx("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 z-50 animate-fade-in",children:e.jsxs("div",{className:"bg-primary text-primary-foreground rounded-lg shadow-lg p-4 flex items-center gap-4",children:[e.jsxs(_,{variant:"secondary",className:"px-3 py-1",children:[s," sélectionné",s>1?"s":""]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(y,{variant:"secondary",size:"sm",onClick:()=>i("disponible"),className:"gap-2",children:[e.jsx($,{className:"h-4 w-4"}),"Rendre disponible"]}),e.jsxs(y,{variant:"secondary",size:"sm",onClick:()=>i("en_maintenance"),className:"gap-2",children:[e.jsx(Rs,{className:"h-4 w-4"}),"Maintenance"]}),e.jsxs(qs,{children:[e.jsx(Hs,{asChild:!0,children:e.jsxs(y,{variant:"destructive",size:"sm",className:"gap-2",children:[e.jsx(ss,{className:"h-4 w-4"}),"Supprimer"]})}),e.jsxs(Gs,{children:[e.jsxs(Ws,{children:[e.jsx(Ys,{children:"Confirmer la suppression"}),e.jsxs(Xs,{children:["Êtes-vous sûr de vouloir supprimer ",s," bien",s>1?"s":""," ? Cette action est irréversible."]})]}),e.jsxs(Js,{children:[e.jsx(Qs,{children:"Annuler"}),e.jsx(Zs,{onClick:r,children:"Supprimer"})]})]})]})]}),e.jsx(y,{variant:"ghost",size:"sm",onClick:t,className:"ml-2",children:e.jsx(Ms,{className:"h-4 w-4"})})]})}),Dt=({property:s,view:t,isSelected:r,onToggleSelect:i})=>t==="list"?e.jsx(A,{className:"overflow-hidden hover:shadow-lg transition-shadow",children:e.jsxs("div",{className:"flex flex-col md:flex-row",children:[e.jsx("div",{className:"absolute top-4 left-4 z-10",children:e.jsx(ye,{checked:r,onCheckedChange:()=>i(s.id),className:"bg-background"})}),e.jsxs("div",{className:"md:w-64 aspect-video md:aspect-auto bg-muted relative",children:[s.main_image?e.jsx("img",{src:s.main_image,alt:s.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(le,{className:"h-12 w-12 text-muted-foreground"})}),e.jsx(_,{className:`absolute top-2 right-2 ${qe[s.status]}`,children:we[s.status]})]}),e.jsxs("div",{className:"flex-1 p-6",children:[s.moderation_status==="pending"&&e.jsxs(ce,{className:"mb-4",children:[e.jsx(J,{className:"h-4 w-4"}),e.jsx(oe,{children:"En attente de modération"})]}),s.moderation_status==="rejected"&&e.jsxs(ce,{variant:"destructive",className:"mb-4",children:[e.jsx(J,{className:"h-4 w-4"}),e.jsxs(oe,{children:["Rejeté: ",s.moderation_notes||"Non spécifié"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold",children:s.title}),e.jsxs("p",{className:"text-muted-foreground flex items-center gap-1 mt-1",children:[e.jsx(le,{className:"h-4 w-4"}),s.city]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 py-4 border-y",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm",children:[s.bedrooms," chambres"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm",children:[s.bathrooms," bains"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ze,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm",children:[s.surface_area,"m²"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm",children:[s.view_count," vues"]})]}),s.conversion_rate!==void 0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-4 w-4 text-green-600"}),e.jsxs("span",{className:"text-sm font-medium",children:[s.conversion_rate,"% conv."]})]})]}),(s.favorites_count!==void 0||s.applications_count!==void 0)&&e.jsxs("div",{className:"flex gap-4 text-sm",children:[s.favorites_count!==void 0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Q,{className:"h-4 w-4 text-red-500"}),e.jsxs("span",{children:[s.favorites_count," favoris"]})]}),s.applications_count!==void 0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Z,{className:"h-4 w-4 text-blue-500"}),e.jsxs("span",{children:[s.applications_count," candidatures"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-3xl font-bold text-primary",children:[s.monthly_rent.toLocaleString()," FCFA",e.jsx("span",{className:"text-sm text-muted-foreground font-normal",children:"/mois"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{variant:"outline",size:"sm",asChild:!0,children:e.jsx(P,{to:`/biens/${s.id}`,children:"Voir"})}),e.jsx(y,{variant:"outline",size:"sm",asChild:!0,children:e.jsx(P,{to:`/biens/${s.id}/modifier`,children:"Modifier"})})]})]})]})]})]})}):e.jsxs(A,{className:"overflow-hidden hover:shadow-lg transition-shadow",children:[e.jsx("div",{className:"absolute top-2 left-2 z-10",children:e.jsx(ye,{checked:r,onCheckedChange:()=>i(s.id),className:"bg-background"})}),s.moderation_status==="pending"&&e.jsxs(ce,{className:"m-4 mb-0",children:[e.jsx(J,{className:"h-4 w-4"}),e.jsx(oe,{children:"En attente de modération"})]}),s.moderation_status==="rejected"&&e.jsxs(ce,{variant:"destructive",className:"m-4 mb-0",children:[e.jsx(J,{className:"h-4 w-4"}),e.jsxs(oe,{children:["Rejeté: ",s.moderation_notes||"Non spécifié"]})]}),e.jsxs("div",{className:"aspect-video bg-muted relative",children:[s.main_image?e.jsx("img",{src:s.main_image,alt:s.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(le,{className:"h-12 w-12 text-muted-foreground"})}),e.jsx(_,{className:`absolute top-2 right-2 ${qe[s.status]}`,children:we[s.status]})]}),e.jsxs(L,{children:[e.jsx(F,{className:"line-clamp-1",children:s.title}),e.jsxs(W,{className:"flex items-center gap-1",children:[e.jsx(le,{className:"h-3 w-3"}),s.city]})]}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ve,{className:"h-4 w-4"}),s.bedrooms]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ee,{className:"h-4 w-4"}),s.bathrooms]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ze,{className:"h-4 w-4"}),s.surface_area,"m²"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx($,{className:"h-4 w-4"}),s.view_count," vues"]}),s.conversion_rate!==void 0&&e.jsxs("div",{className:"flex items-center gap-1 text-green-600",children:[e.jsx(H,{className:"h-4 w-4"}),s.conversion_rate,"%"]})]}),(s.favorites_count!==void 0||s.applications_count!==void 0)&&e.jsxs("div",{className:"flex gap-3 text-xs border-t pt-3",children:[s.favorites_count!==void 0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Q,{className:"h-3 w-3 text-red-500"}),s.favorites_count]}),s.applications_count!==void 0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Z,{className:"h-3 w-3 text-blue-500"}),s.applications_count]})]}),e.jsxs("div",{className:"text-2xl font-bold text-primary",children:[s.monthly_rent.toLocaleString()," FCFA/mois"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{variant:"outline",className:"flex-1",asChild:!0,children:e.jsx(P,{to:`/biens/${s.id}`,children:"Voir"})}),e.jsx(y,{variant:"outline",className:"flex-1",asChild:!0,children:e.jsx(P,{to:`/biens/${s.id}/modifier`,children:"Modifier"})})]})]})]}),Rt=({properties:s,selectedProperties:t,onToggleSelect:r,onEdit:i,onDelete:a})=>e.jsx("div",{className:"rounded-md border",children:e.jsxs(de,{children:[e.jsx(me,{children:e.jsxs(U,{children:[e.jsx(v,{className:"w-12"}),e.jsx(v,{className:"w-20",children:"Image"}),e.jsx(v,{children:"Titre"}),e.jsx(v,{className:"w-24",children:"Type"}),e.jsx(v,{className:"w-32",children:"Prix/mois"}),e.jsx(v,{className:"text-center w-32",children:"Stats"}),e.jsx(v,{className:"w-24",children:"Statut"}),e.jsx(v,{className:"w-20 text-right",children:"Actions"})]})}),e.jsx(xe,{children:s.map(n=>e.jsxs(U,{className:"hover:bg-muted/50",children:[e.jsx(N,{children:e.jsx(ye,{checked:t.includes(n.id),onCheckedChange:()=>r(n.id)})}),e.jsx(N,{children:e.jsx("div",{className:"h-10 w-14 rounded overflow-hidden bg-muted",children:n.main_image?e.jsx("img",{src:n.main_image,alt:n.title,className:"h-full w-full object-cover"}):e.jsx("div",{className:"h-full w-full flex items-center justify-center",children:e.jsx($,{className:"h-4 w-4 text-muted-foreground"})})})}),e.jsxs(N,{children:[e.jsx(P,{to:`/bien/${n.id}`,className:"font-medium hover:text-primary transition-colors line-clamp-1",children:n.title}),e.jsx("div",{className:"text-xs text-muted-foreground",children:n.city})]}),e.jsx(N,{className:"text-sm",children:n.property_type}),e.jsxs(N,{className:"font-medium",children:[n.monthly_rent.toLocaleString()," FCFA"]}),e.jsx(N,{children:e.jsxs("div",{className:"flex items-center justify-center gap-3 text-xs",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx($,{className:"h-3.5 w-3.5 text-muted-foreground"}),n.view_count||0]}),e.jsxs("span",{className:"flex items-center gap-1",children:["⭐ ",n.favorites_count||0]}),e.jsxs("span",{className:"flex items-center gap-1",children:["✉ ",n.applications_count||0]})]})}),e.jsx(N,{children:e.jsx(xt,{status:n.status,variant:"compact"})}),e.jsx(N,{className:"text-right",children:e.jsxs(et,{children:[e.jsx(st,{asChild:!0,children:e.jsx(y,{variant:"ghost",size:"sm",children:"•••"})}),e.jsxs(tt,{align:"end",children:[e.jsx(ve,{asChild:!0,children:e.jsxs(P,{to:`/bien/${n.id}`,children:[e.jsx($,{className:"h-4 w-4 mr-2"}),"Voir"]})}),e.jsxs(ve,{onClick:()=>i(n.id),children:[e.jsx(Ze,{className:"h-4 w-4 mr-2"}),"Modifier"]}),e.jsx(at,{}),e.jsxs(ve,{onClick:()=>a(n.id),className:"text-destructive",children:[e.jsx(ss,{className:"h-4 w-4 mr-2"}),"Supprimer"]})]})]})})]},n.id))})]})}),Mt=()=>{const{user:s,profile:t,loading:r}=ke(),i=Qe(),[a,n]=c.useState([]),[x,j]=c.useState(!0),[u,h]=c.useState("all"),[d,g]=c.useState("table"),[T,R]=c.useState(""),[S,B]=c.useState("created_desc"),[C,V]=c.useState([]);c.useEffect(()=>{s&&I()},[s]);const I=async()=>{j(!0);try{const{data:o,error:b}=await M.from("properties").select("*").eq("owner_id",s.id).order("created_at",{ascending:!1});if(b)throw b;const p=await Promise.all((o||[]).map(async f=>{const{count:X}=await M.from("user_favorites").select("*",{count:"exact",head:!0}).eq("property_id",f.id),{count:ae}=await M.from("rental_applications").select("*",{count:"exact",head:!0}).eq("property_id",f.id),je=f.view_count>0?Math.round((ae||0)/f.view_count*100):0;return{...f,favorites_count:X||0,applications_count:ae||0,conversion_rate:je}}));n(p)}catch(o){O.error("Failed to fetch user properties",{error:o,userId:s==null?void 0:s.id}),z.error("Erreur lors du chargement des propriétés")}finally{j(!1)}},Y=c.useMemo(()=>{let o=a;if(u!=="all"&&(u==="pending"||u==="rejected"?o=o.filter(p=>p.moderation_status===u):o=o.filter(p=>p.status===u)),T){const p=T.toLowerCase();o=o.filter(f=>f.title.toLowerCase().includes(p)||f.city.toLowerCase().includes(p)||f.address.toLowerCase().includes(p))}return[...o].sort((p,f)=>{switch(S){case"created_desc":return new Date(f.created_at).getTime()-new Date(p.created_at).getTime();case"created_asc":return new Date(p.created_at).getTime()-new Date(f.created_at).getTime();case"price_desc":return f.monthly_rent-p.monthly_rent;case"price_asc":return p.monthly_rent-f.monthly_rent;case"views_desc":return(f.view_count||0)-(p.view_count||0);case"views_asc":return(p.view_count||0)-(f.view_count||0);default:return 0}})},[a,u,T,S]),ee=c.useMemo(()=>({all:a.length,disponible:a.filter(o=>o.status==="disponible").length,loué:a.filter(o=>o.status==="loué").length,en_maintenance:a.filter(o=>o.status==="en_maintenance").length,en_negociation:a.filter(o=>o.status==="en_negociation").length,pending:a.filter(o=>o.moderation_status==="pending").length,rejected:a.filter(o=>o.moderation_status==="rejected").length}),[a]),se=o=>{V(b=>b.includes(o)?b.filter(p=>p!==o):[...b,o])},te=()=>{V([])},ue=async()=>{try{const{error:o}=await M.from("properties").delete().in("id",C);if(o)throw o;z.success(`${C.length} bien(s) supprimé(s)`),V([]),I()}catch(o){O.error("Failed to delete properties",{error:o}),z.error("Erreur lors de la suppression")}},he=async o=>{try{const{error:b}=await M.from("properties").update({status:o}).in("id",C);if(b)throw b;z.success(`Statut mis à jour pour ${C.length} bien(s)`),V([]),I()}catch(b){O.error("Failed to update status",{error:b}),z.error("Erreur lors de la mise à jour")}},l=async o=>{try{const{error:b}=await M.from("properties").delete().eq("id",o);if(b)throw b;z.success("Bien supprimé"),I()}catch(b){O.error("Failed to delete property",{error:b}),z.error("Erreur lors de la suppression")}};return r||x?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):!s||t&&t.user_type==="locataire"?e.jsx(es,{to:"/",replace:!0}):e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx(ts,{}),e.jsx("main",{className:"flex-1 container mx-auto px-4 py-8 pt-24",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-8",children:[e.jsx(ms,{}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold",children:"Mes Biens Immobiliers"}),e.jsxs("p",{className:"text-muted-foreground mt-2",children:[a.length," ",a.length>1?"biens":"bien"," au total"]})]}),e.jsx(y,{asChild:!0,children:e.jsxs(P,{to:"/ajouter-bien",children:[e.jsx(Oe,{className:"mr-2 h-4 w-4"}),"Ajouter un bien"]})})]}),e.jsx(_t,{activeStatus:u,onStatusChange:h,counts:ee}),e.jsx(as,{children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 justify-between items-start md:items-center w-full",children:[e.jsx(kt,{searchQuery:T,onSearchChange:R}),e.jsx(St,{view:d,onViewChange:g,options:["grid","list","table"]})]})}),Y.length===0?e.jsx(A,{className:"p-12 text-center",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-muted-foreground",children:a.length===0?"Vous n'avez pas encore ajouté de biens":"Aucun bien ne correspond à vos critères"}),a.length===0&&e.jsx(y,{asChild:!0,children:e.jsxs(P,{to:"/ajouter-bien",children:[e.jsx(Oe,{className:"mr-2 h-4 w-4"}),"Ajouter mon premier bien"]})})]})}):d==="table"?e.jsx(Rt,{properties:Y,selectedProperties:C,onToggleSelect:se,onEdit:o=>i(`/modifier-bien/${o}`),onDelete:l}):e.jsx("div",{className:d==="grid"?"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6":"space-y-4",children:Y.map(o=>e.jsx(Dt,{property:o,view:d,isSelected:C.includes(o.id),onToggleSelect:se},o.id))}),e.jsx(Tt,{selectedCount:C.length,onClearSelection:te,onBulkDelete:ue,onBulkStatusChange:he})]})}),e.jsx(ns,{})]})},zt=Object.freeze(Object.defineProperty({__proto__:null,default:Mt},Symbol.toStringTag,{value:"Module"}));export{ms as D,zt as M,Et as O,xt as S,St as V};
//# sourceMappingURL=route-owner-C83ejxxl.js.map
