import{c4 as M,a5 as Q,_ as X,r as k,$ as D,a0 as Z,j as e,bc as h,aK as $,bC as F,ai as H,bw as J,bM as q,dw as W,d4 as Y,dx as G,aa as O,a9 as ee,aJ as se}from"./react-vendor-CPmH2tz8.js";import{u as ae,X as g,Z as j,C as p,b as f,d as b,j as y,e as v,B as d,ag as o,a7 as A,a8 as S,a9 as E,aa as T,ab as i,_ as re,ae as ne,w as te,ai as ie,x as le,t as I,l as ce,s as N,a as z}from"./route-admin-B1Ip8YDE.js";import{D as de}from"./route-owner-C83ejxxl.js";import"./query-vendor-ByjIuei6.js";import"./monitoring-vendor-C7yD_Gmu.js";import"./ui-vendor-Dua12RDV.js";import"./common-vendor-CK5d0rWc.js";import"./charts-vendor-16YcNskv.js";import"./supabase-vendor-CzsKfTY-.js";import"./route-agency-BEE2sWoQ.js";import"./animation-vendor-BJe5VoH_.js";(function(){try{var a=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};a.SENTRY_RELEASE={id:"b65e2d84341e79b518aed72b6e71dcc77eba934a"}}catch{}})();try{(function(){var a=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},l=new a.Error().stack;l&&(a._sentryDebugIds=a._sentryDebugIds||{},a._sentryDebugIds[l]="377b4be6-bb37-428e-993b-92fa5c99c0e8",a._sentryDebugIdIdentifier="sentry-dbid-377b4be6-bb37-428e-993b-92fa5c99c0e8")})()}catch{}const ve=()=>{const{propertyId:a}=M(),{user:l}=ae(),w=Q(),L=X(),[C,x]=k.useState(!1),[r,c]=k.useState({request_type:"other",title:"",description:"",urgency:"normal"}),{data:_,isLoading:B}=D({queryKey:["can-access-maintenance",a],queryFn:async()=>{if(!l||!a)return!1;const{data:s,error:n}=await N.rpc("can_access_maintenance",{p_property_id:a});if(n)throw n;return s},enabled:!!l&&!!a}),{data:m,isLoading:R}=D({queryKey:["maintenance-requests",a],queryFn:async()=>{const{data:s,error:n}=await N.from("maintenance_requests").select("*").eq("property_id",a).order("created_at",{ascending:!1});if(n)throw n;return s},enabled:_===!0}),u=Z({mutationFn:async s=>{const{data:n,error:t}=await N.from("maintenance_requests").insert({property_id:a,requester_id:l.id,...s}).select().single();if(t)throw t;return n},onSuccess:()=>{I({title:"Demande créée",description:"Votre demande de maintenance a été envoyée au propriétaire."}),L.invalidateQueries({queryKey:["maintenance-requests",a]}),x(!1),c({request_type:"other",title:"",description:"",urgency:"normal"})},onError:s=>{I({title:"Erreur",description:"Impossible de créer la demande.",variant:"destructive"}),ce.error("Failed to create maintenance request",{error:s})}}),U=s=>{switch(s){case"plumbing":return e.jsx(G,{className:"h-4 w-4"});case"electrical":return e.jsx(Y,{className:"h-4 w-4"});case"heating":return e.jsx(W,{className:"h-4 w-4"});default:return e.jsx(q,{className:"h-4 w-4"})}},P=s=>{const t={pending:{icon:se,variant:"secondary",label:"En attente"},in_progress:{icon:q,variant:"default",label:"En cours"},completed:{icon:ee,variant:"default",label:"Terminé"},cancelled:{icon:O,variant:"destructive",label:"Annulé"}}[s],K=t.icon;return e.jsxs(z,{variant:t.variant,className:"gap-1",children:[e.jsx(K,{className:"h-3 w-3"}),t.label]})},V=s=>{const t={low:{className:"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-400",label:"Faible"},normal:{className:"bg-gray-100 text-gray-800 dark:bg-gray-900/20 dark:text-gray-400",label:"Normal"},high:{className:"bg-orange-100 text-orange-800 dark:bg-orange-900/20 dark:text-orange-400",label:"Urgent"},emergency:{className:"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400",label:"Urgence"}}[s];return e.jsx(z,{className:t.className,children:t.label})};return B?e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx(g,{}),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx(h,{className:"h-8 w-8 animate-spin text-primary"})}),e.jsx(j,{})]}):_?e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx(g,{}),e.jsx("div",{className:"flex-1 container mx-auto px-4 py-8 pt-24",children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsx(de,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Demandes de maintenance"}),e.jsxs(d,{onClick:()=>x(!C),className:"gap-2",children:[e.jsx(J,{className:"h-4 w-4"}),"Nouvelle demande"]})]}),C&&e.jsxs(p,{children:[e.jsxs(f,{children:[e.jsx(b,{children:"Créer une demande"}),e.jsx(y,{children:"Décrivez le problème rencontré"})]}),e.jsxs(v,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"request_type",children:"Type de problème"}),e.jsxs(A,{value:r.request_type,onValueChange:s=>c({...r,request_type:s}),children:[e.jsx(S,{children:e.jsx(E,{})}),e.jsxs(T,{children:[e.jsx(i,{value:"plumbing",children:"Plomberie"}),e.jsx(i,{value:"electrical",children:"Électricité"}),e.jsx(i,{value:"heating",children:"Chauffage"}),e.jsx(i,{value:"other",children:"Autre"})]})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"urgency",children:"Urgence"}),e.jsxs(A,{value:r.urgency,onValueChange:s=>c({...r,urgency:s}),children:[e.jsx(S,{children:e.jsx(E,{})}),e.jsxs(T,{children:[e.jsx(i,{value:"low",children:"Faible"}),e.jsx(i,{value:"normal",children:"Normal"}),e.jsx(i,{value:"high",children:"Urgent"}),e.jsx(i,{value:"emergency",children:"Urgence"})]})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"title",children:"Titre"}),e.jsx(re,{id:"title",value:r.title,onChange:s=>c({...r,title:s.target.value}),placeholder:"Ex: Fuite d'eau dans la salle de bain"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"description",children:"Description détaillée"}),e.jsx(ne,{id:"description",value:r.description,onChange:s=>c({...r,description:s.target.value}),placeholder:"Décrivez le problème en détail...",rows:4})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(d,{onClick:()=>u.mutate(r),disabled:!r.title||!r.description||u.isPending,children:[u.isPending&&e.jsx(h,{className:"mr-2 h-4 w-4 animate-spin"}),"Envoyer la demande"]}),e.jsx(d,{variant:"outline",onClick:()=>x(!1),children:"Annuler"})]})]})]}),R?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(h,{className:"h-8 w-8 animate-spin text-primary"})}):m&&m.length>0?e.jsx("div",{className:"space-y-4",children:m.map(s=>e.jsxs(p,{children:[e.jsxs(f,{children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[U(s.request_type),e.jsx(b,{className:"text-lg",children:s.title})]}),e.jsxs("div",{className:"flex gap-2",children:[V(s.urgency),P(s.status)]})]}),e.jsx(y,{children:new Date(s.created_at).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"})})]}),e.jsx(v,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description})})]},s.id))}):e.jsxs(te,{children:[e.jsx(F,{className:"h-4 w-4"}),e.jsx(ie,{children:"Aucune demande"}),e.jsx(le,{children:"Vous n'avez pas encore créé de demande de maintenance."})]})]})}),e.jsx(j,{})]}):e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx(g,{}),e.jsx("div",{className:"flex-1 container mx-auto px-4 py-8 pt-24",children:e.jsx("div",{className:"max-w-3xl mx-auto",children:e.jsxs(p,{className:"border-2 border-orange-200 bg-gradient-to-br from-orange-50 to-white",children:[e.jsxs(f,{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-center w-16 h-16 mx-auto rounded-full bg-orange-100",children:e.jsx($,{className:"h-8 w-8 text-orange-600"})}),e.jsx(b,{className:"text-2xl text-center",children:"Fonctionnalité réservée aux locataires"}),e.jsx(y,{className:"text-center text-base",children:"La gestion des demandes de maintenance nécessite un dossier validé"})]}),e.jsxs(v,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4 items-start p-4 rounded-lg bg-white border",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-primary text-white flex items-center justify-center font-bold",children:"1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-1",children:"Postulez à ce bien"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Créez votre dossier de candidature depuis la page du bien"})]})]}),e.jsxs("div",{className:"flex gap-4 items-start p-4 rounded-lg bg-white border",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-primary text-white flex items-center justify-center font-bold",children:"2"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-1",children:"Attendez la validation"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Le propriétaire étudiera votre dossier sous 48h"})]})]}),e.jsxs("div",{className:"flex gap-4 items-start p-4 rounded-lg bg-white border",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-primary text-white flex items-center justify-center font-bold",children:"3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-1",children:"Accédez aux fonctionnalités"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Une fois validé, gérez vos demandes de maintenance facilement"})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-4",children:[e.jsxs(d,{onClick:()=>w(`/property/${a}`),className:"flex-1",size:"lg",children:[e.jsx(F,{className:"mr-2 h-4 w-4"}),"Voir le bien"]}),e.jsxs(d,{onClick:()=>w("/recherche"),variant:"outline",className:"flex-1",size:"lg",children:[e.jsx(H,{className:"mr-2 h-4 w-4"}),"Chercher un autre bien"]})]})]})]})})}),e.jsx(j,{})]})};export{ve as default};
//# sourceMappingURL=Maintenance-Ck1SRhR6.js.map
