import{r as i,j as e,ai as be,al as de,co as qe,ah as we,ad as Z,ac as Ce,br as xe,a9 as Pe,aa as Le,bx as Ve,bJ as Oe,bw as ue,af as He,ae as Be,a$ as Ge}from"./react-vendor-CPmH2tz8.js";import{c as A,s as ee,l as Ue,F as $e,G as Je,H as Qe,J as We,i as me,D as Ye,h as Ke,K as Xe,L as Ze,B as v,M as es,aR as H,aS as B,aT as G,w as Se,x as Me,a7 as U,a8 as $,a9 as J,aa as Q,ab as C,_ as pe,aU as he,C as M,b as I,d as z,j as De,e as D,aB as q,ae as se,A as ae,m as ne,n as te,o as ie,p as re,q as le,r as ce,v as oe,u as Ae,k as je,a as fe,T as ss,y as as,z as W,E as Y}from"./route-admin-B1Ip8YDE.js";import{a as ns}from"./route-agency-BEE2sWoQ.js";import{t as ts,o as ge,s as K,d as _e,e as ve,c as Ne,b}from"./forms-vendor-DqOZ4YtP.js";import{F as is,g as h,h as j,i as f,j as g,k as ye,l as S}from"./route-property-b6Ka_7KN.js";import{u as rs}from"./index-LMib0YFl.js";import{cu as _,bY as k,cf as R}from"./common-vendor-CK5d0rWc.js";import"./query-vendor-ByjIuei6.js";import"./monitoring-vendor-C7yD_Gmu.js";import"./ui-vendor-Dua12RDV.js";import"./charts-vendor-16YcNskv.js";import"./supabase-vendor-CzsKfTY-.js";import"./animation-vendor-BJe5VoH_.js";import"./route-owner-C83ejxxl.js";import"./route-tenant-DNBKfVUX.js";import"./maps-vendor-B7X9GnXQ.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};s.SENTRY_RELEASE={id:"b65e2d84341e79b518aed72b6e71dcc77eba934a"}}catch{}})();try{(function(){var s=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},n=new s.Error().stack;n&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[n]="525a869f-c3c2-4f0f-9b6b-645444042827",s._sentryDebugIdIdentifier="sentry-dbid-525a869f-c3c2-4f0f-9b6b-645444042827")})()}catch{}const Te=i.forwardRef(({className:s,...n},r)=>e.jsx(_,{ref:r,className:A("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",s),...n}));Te.displayName=_.displayName;const ke=i.forwardRef(({className:s,...n},r)=>e.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[e.jsx(be,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),e.jsx(_.Input,{ref:r,className:A("flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",s),...n})]}));ke.displayName=_.Input.displayName;const ls=i.forwardRef(({className:s,...n},r)=>e.jsx(_.List,{ref:r,className:A("max-h-[300px] overflow-y-auto overflow-x-hidden",s),...n}));ls.displayName=_.List.displayName;const Fe=i.forwardRef((s,n)=>e.jsx(_.Empty,{ref:n,className:"py-6 text-center text-sm",...s}));Fe.displayName=_.Empty.displayName;const Ie=i.forwardRef(({className:s,...n},r)=>e.jsx(_.Group,{ref:r,className:A("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",s),...n}));Ie.displayName=_.Group.displayName;const cs=i.forwardRef(({className:s,...n},r)=>e.jsx(_.Separator,{ref:r,className:A("-mx-1 h-px bg-border",s),...n}));cs.displayName=_.Separator.displayName;const ze=i.forwardRef(({className:s,...n},r)=>e.jsx(_.Item,{ref:r,className:A("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50",s),...n}));ze.displayName=_.Item.displayName;const os=()=>{const[s,n]=i.useState(!1),[r,N]=i.useState(""),o=i.useCallback(async(d,T)=>{try{const{data:{user:t}}=await ee.auth.getUser();if(!t)return;await ee.from("help_interactions").insert({user_id:t.id,help_type:d,content_id:T})}catch{Ue.debug("Failed to track help interaction",{helpType:d,contentId:T})}},[]),u=i.useCallback(()=>{n(!0),o("help_center","opened")},[o]),w=i.useCallback(()=>{n(!1)},[]),y=i.useCallback(d=>{N(d),d.length>2&&o("search",d)},[o]);return{isHelpOpen:s,searchQuery:r,openHelp:u,closeHelp:w,searchHelp:y,trackInteraction:o}},P=({id:s,title:n,content:r,videoUrl:N})=>{const{trackInteraction:o}=os();return e.jsx($e,{children:e.jsxs(Je,{children:[e.jsx(Qe,{asChild:!0,children:e.jsx("button",{type:"button",className:"inline-flex items-center text-muted-foreground hover:text-primary transition-colors",onClick:()=>o("tooltip",s),children:e.jsx(de,{className:"h-4 w-4"})})}),e.jsxs(We,{className:"max-w-sm space-y-2",side:"right",children:[e.jsx("div",{className:"font-semibold",children:n}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r}),N&&e.jsx("a",{href:N,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-primary hover:underline inline-block mt-1",children:"Voir la vidéo explicative →"})]})]})})},ds=ge({agency_id:K().min(1,"Sélectionnez une agence"),property_id:K().optional(),mandate_type:ve(["location","gestion_complete","vente"]),commission_rate:Ne.number().min(0).max(100).optional(),fixed_fee:Ne.number().min(0).optional(),billing_frequency:ve(["mensuel","trimestriel","annuel","par_transaction"]).optional(),start_date:_e(),end_date:_e().optional(),notes:K().optional(),permissions:ge({can_view_properties:b().default(!0),can_edit_properties:b().default(!1),can_create_properties:b().default(!1),can_delete_properties:b().default(!1),can_view_applications:b().default(!0),can_manage_applications:b().default(!1),can_create_leases:b().default(!1),can_view_financials:b().default(!1),can_manage_maintenance:b().default(!1),can_communicate_tenants:b().default(!0),can_manage_documents:b().default(!1)})}).refine(s=>s.end_date&&s.start_date?s.end_date>s.start_date:!0,{message:"La date de fin doit être postérieure à la date de début",path:["end_date"]});function ms({open:s,onOpenChange:n}){const{createMandate:r,asOwner:N}=me(),{data:o=[]}=rs(),[u,w]=i.useState([]),[y,d]=i.useState(!1),[T,t]=i.useState(!1),[l,E]=i.useState(!1),[L,V]=i.useState(!1),[m,O]=i.useState(null),c=qe({resolver:ts(ds),defaultValues:{mandate_type:"location",start_date:new Date,permissions:{can_view_properties:!0,can_edit_properties:!1,can_create_properties:!1,can_delete_properties:!1,can_view_applications:!0,can_manage_applications:!1,can_create_leases:!1,can_view_financials:!1,can_manage_maintenance:!1,can_communicate_tenants:!0,can_manage_documents:!1}}});i.useEffect(()=>{s&&(async()=>{d(!0);const{data:p,error:x}=await ee.from("profiles").select("id, full_name, city, created_at").eq("user_type","agence").order("full_name");!x&&p&&w(p.map(F=>({...F,user_type:"agence"}))),d(!1)})()},[s]),i.useEffect(()=>{const a=c.watch("agency_id"),p=c.watch("property_id");if(a){const x=N.some(F=>F.agency_id===a&&F.status==="active"&&(F.property_id===p||!p&&!F.property_id));E(x)}},[c.watch("agency_id"),c.watch("property_id"),N]);const Re=a=>{var x;if(l)return;const p={agency_id:a.agency_id,property_id:a.property_id||null,mandate_type:a.mandate_type,commission_rate:a.commission_rate,fixed_fee:a.fixed_fee,billing_frequency:a.billing_frequency,start_date:a.start_date.toISOString().split("T")[0],end_date:(x=a.end_date)==null?void 0:x.toISOString().split("T")[0],notes:a.notes,permissions:{can_view_properties:a.permissions.can_view_properties,can_edit_properties:a.permissions.can_edit_properties,can_create_properties:a.permissions.can_create_properties,can_delete_properties:a.permissions.can_delete_properties,can_view_applications:a.permissions.can_view_applications,can_manage_applications:a.permissions.can_manage_applications,can_create_leases:a.permissions.can_create_leases,can_view_financials:a.permissions.can_view_financials,can_manage_maintenance:a.permissions.can_manage_maintenance,can_communicate_tenants:a.permissions.can_communicate_tenants,can_manage_documents:a.permissions.can_manage_documents}};O(p),V(!0)},Ee=()=>{m&&(r(m),V(!1),O(null),n(!1),c.reset())};return e.jsxs(Ye,{open:s,onOpenChange:n,children:[e.jsxs(Ke,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Xe,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Ze,{children:"Inviter une agence"}),e.jsx(v,{variant:"ghost",size:"sm",asChild:!0,children:e.jsxs(we,{to:"/mandates/help",className:"gap-2",children:[e.jsx(de,{className:"h-4 w-4"}),"Aide"]})})]}),e.jsx(es,{children:"Donnez à une agence immobilière l'accès à vos biens pour qu'elle les gère en votre nom"})]}),e.jsx(is,{...c,children:e.jsxs("form",{onSubmit:c.handleSubmit(Re),className:"space-y-6",children:[e.jsx(h,{control:c.control,name:"agency_id",render:({field:a})=>{var p;return e.jsxs(j,{className:"flex flex-col",children:[e.jsxs(f,{className:"flex items-center gap-2",children:["Agence",e.jsx(P,{id:"select_agency",title:"Choisir une agence",content:"Sélectionnez l'agence immobilière à qui vous souhaitez confier la gestion de votre bien. Assurez-vous que l'agence est bien enregistrée sur la plateforme."})]}),e.jsxs(H,{open:T,onOpenChange:t,children:[e.jsx(B,{asChild:!0,children:e.jsx(g,{children:e.jsxs(v,{variant:"outline",role:"combobox",className:A("justify-between",!a.value&&"text-muted-foreground"),children:[a.value?(p=u.find(x=>x.id===a.value))==null?void 0:p.full_name:"Rechercher une agence...",e.jsx(be,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})})}),e.jsx(G,{className:"w-[400px] p-0",children:e.jsxs(Te,{children:[e.jsx(ke,{placeholder:"Rechercher une agence..."}),e.jsx(Fe,{children:"Aucune agence trouvée."}),e.jsx(Ie,{children:u.map(x=>e.jsxs(ze,{value:x.full_name,onSelect:()=>{c.setValue("agency_id",x.id),t(!1)},children:[e.jsx(Z,{className:"mr-2 h-4 w-4"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:x.full_name}),x.city&&e.jsx("span",{className:"text-xs text-muted-foreground",children:x.city})]})]},x.id))})]})})]}),e.jsx(ye,{children:"Recherchez et sélectionnez l'agence qui gérera vos biens"}),e.jsx(S,{})]})}}),l&&e.jsxs(Se,{variant:"destructive",children:[e.jsx(Ce,{className:"h-4 w-4"}),e.jsx(Me,{children:"Un mandat actif existe déjà avec cette agence pour cette portée. Veuillez terminer le mandat existant avant d'en créer un nouveau."})]}),e.jsx(h,{control:c.control,name:"mandate_type",render:({field:a})=>e.jsxs(j,{children:[e.jsx(f,{children:"Type de mandat"}),e.jsxs(U,{onValueChange:a.onChange,defaultValue:a.value,children:[e.jsx(g,{children:e.jsx($,{children:e.jsx(J,{})})}),e.jsxs(Q,{children:[e.jsx(C,{value:"location",children:"Location"}),e.jsx(C,{value:"gestion_complete",children:"Gestion complète"}),e.jsx(C,{value:"vente",children:"Vente"})]})]}),e.jsx(S,{})]})}),e.jsx(h,{control:c.control,name:"property_id",render:({field:a})=>e.jsxs(j,{children:[e.jsxs(f,{className:"flex items-center gap-2",children:["Bien concerné (optionnel)",e.jsx(P,{id:"mandate_scope",title:"Mandat spécifique vs Global",content:"Mandat spécifique : l'agence gère UN seul bien. Mandat global : l'agence gère TOUS vos biens actuels et futurs. Idéal pour une gestion centralisée."})]}),e.jsxs(U,{onValueChange:a.onChange,defaultValue:a.value,children:[e.jsx(g,{children:e.jsx($,{children:e.jsx(J,{placeholder:"Tous mes biens (mandat global)"})})}),e.jsxs(Q,{children:[e.jsx(C,{value:"",children:"Tous mes biens"}),o.map(p=>e.jsx(C,{value:p.id,children:p.title},p.id))]})]}),e.jsx(ye,{children:"Laissez vide pour un mandat global sur tous vos biens"}),e.jsx(S,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(h,{control:c.control,name:"commission_rate",render:({field:a})=>e.jsxs(j,{children:[e.jsxs(f,{className:"flex items-center gap-2",children:["Commission (%)",e.jsx(P,{id:"commission_rate",title:"Commission",content:"Pourcentage prélevé sur les loyers perçus. Exemple : 10% signifie que l'agence touchera 10% du loyer mensuel. Négociez ce taux avec votre agence."})]}),e.jsx(g,{children:e.jsx(pe,{type:"number",min:"0",max:"100",step:"0.1",...a})}),e.jsx(S,{})]})}),e.jsx(h,{control:c.control,name:"fixed_fee",render:({field:a})=>e.jsxs(j,{children:[e.jsxs(f,{className:"flex items-center gap-2",children:["Frais fixes (FCFA)",e.jsx(P,{id:"fixed_fee",title:"Frais fixes",content:"Montant fixe payé à l'agence indépendamment des loyers. Exemple : 50 000 FCFA/mois. Vous pouvez combiner commission + frais fixes selon votre accord."})]}),e.jsx(g,{children:e.jsx(pe,{type:"number",min:"0",...a})}),e.jsx(S,{})]})})]}),e.jsx(h,{control:c.control,name:"billing_frequency",render:({field:a})=>e.jsxs(j,{children:[e.jsx(f,{children:"Fréquence de facturation"}),e.jsxs(U,{onValueChange:a.onChange,defaultValue:a.value,children:[e.jsx(g,{children:e.jsx($,{children:e.jsx(J,{placeholder:"Sélectionnez"})})}),e.jsxs(Q,{children:[e.jsx(C,{value:"mensuel",children:"Mensuel"}),e.jsx(C,{value:"trimestriel",children:"Trimestriel"}),e.jsx(C,{value:"annuel",children:"Annuel"}),e.jsx(C,{value:"par_transaction",children:"Par transaction"})]})]}),e.jsx(S,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(h,{control:c.control,name:"start_date",render:({field:a})=>e.jsxs(j,{className:"flex flex-col",children:[e.jsx(f,{children:"Date de début"}),e.jsxs(H,{children:[e.jsx(B,{asChild:!0,children:e.jsx(g,{children:e.jsxs(v,{variant:"outline",className:A(!a.value&&"text-muted-foreground"),children:[a.value?k(a.value,"PPP",{locale:R}):"Sélectionner",e.jsx(xe,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),e.jsx(G,{className:"w-auto p-0",align:"start",children:e.jsx(he,{mode:"single",selected:a.value,onSelect:a.onChange,initialFocus:!0})})]}),e.jsx(S,{})]})}),e.jsx(h,{control:c.control,name:"end_date",render:({field:a})=>e.jsxs(j,{className:"flex flex-col",children:[e.jsx(f,{children:"Date de fin (optionnel)"}),e.jsxs(H,{children:[e.jsx(B,{asChild:!0,children:e.jsx(g,{children:e.jsxs(v,{variant:"outline",className:A(!a.value&&"text-muted-foreground"),children:[a.value?k(a.value,"PPP",{locale:R}):"Indéterminé",e.jsx(xe,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),e.jsx(G,{className:"w-auto p-0",align:"start",children:e.jsx(he,{mode:"single",selected:a.value,onSelect:a.onChange,initialFocus:!0})})]}),e.jsx(S,{})]})})]}),e.jsxs(M,{children:[e.jsxs(I,{children:[e.jsx(z,{className:"text-base",children:"Permissions"}),e.jsx(De,{children:"Définissez ce que l'agence peut faire"})]}),e.jsxs(D,{className:"space-y-3",children:[e.jsx(h,{control:c.control,name:"permissions.can_view_properties",render:({field:a})=>e.jsxs(j,{className:"flex items-center justify-between",children:[e.jsx(f,{className:"text-sm font-normal",children:"Voir les propriétés"}),e.jsx(g,{children:e.jsx(q,{checked:a.value,onCheckedChange:a.onChange})})]})}),e.jsx(h,{control:c.control,name:"permissions.can_edit_properties",render:({field:a})=>e.jsxs(j,{className:"flex items-center justify-between",children:[e.jsx(f,{className:"text-sm font-normal",children:"Modifier les propriétés"}),e.jsx(g,{children:e.jsx(q,{checked:a.value,onCheckedChange:a.onChange})})]})}),e.jsx(h,{control:c.control,name:"permissions.can_view_applications",render:({field:a})=>e.jsxs(j,{className:"flex items-center justify-between",children:[e.jsx(f,{className:"text-sm font-normal",children:"Voir les candidatures"}),e.jsx(g,{children:e.jsx(q,{checked:a.value,onCheckedChange:a.onChange})})]})}),e.jsx(h,{control:c.control,name:"permissions.can_manage_applications",render:({field:a})=>e.jsxs(j,{className:"flex items-center justify-between",children:[e.jsx(f,{className:"text-sm font-normal",children:"Gérer les candidatures"}),e.jsx(g,{children:e.jsx(q,{checked:a.value,onCheckedChange:a.onChange})})]})}),e.jsx(h,{control:c.control,name:"permissions.can_create_leases",render:({field:a})=>e.jsxs(j,{className:"flex items-center justify-between",children:[e.jsx(f,{className:"text-sm font-normal",children:"Créer des baux"}),e.jsx(g,{children:e.jsx(q,{checked:a.value,onCheckedChange:a.onChange})})]})})]})]}),e.jsx(h,{control:c.control,name:"notes",render:({field:a})=>e.jsxs(j,{children:[e.jsx(f,{children:"Notes (optionnel)"}),e.jsx(g,{children:e.jsx(se,{...a,rows:3})}),e.jsx(S,{})]})}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(v,{type:"button",variant:"outline",onClick:()=>n(!1),children:"Annuler"}),e.jsx(v,{type:"submit",disabled:!!l,children:"Envoyer l'invitation"})]})]})})]}),e.jsx(ae,{open:L,onOpenChange:V,children:e.jsxs(ne,{children:[e.jsxs(te,{children:[e.jsx(ie,{children:"Confirmer l'invitation"}),e.jsxs(re,{children:["Vous êtes sur le point d'inviter une agence à gérer ",m!=null&&m.property_id?"ce bien":"tous vos biens","."]})]}),m&&e.jsx("div",{className:"space-y-2 py-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Type de mandat:"}),e.jsx("span",{className:"font-medium",children:m.mandate_type==="location"?"Location":m.mandate_type==="gestion_complete"?"Gestion complète":"Vente"}),e.jsx("span",{className:"text-muted-foreground",children:"Portée:"}),e.jsx("span",{className:"font-medium",children:m.property_id?"Bien spécifique":"Tous les biens"}),e.jsx("span",{className:"text-muted-foreground",children:"Début:"}),e.jsx("span",{className:"font-medium",children:k(new Date(m.start_date),"dd MMMM yyyy",{locale:R})}),m.end_date&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-muted-foreground",children:"Fin:"}),e.jsx("span",{className:"font-medium",children:k(new Date(m.end_date),"dd MMMM yyyy",{locale:R})})]}),m.commission_rate&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-muted-foreground",children:"Commission:"}),e.jsxs("span",{className:"font-medium",children:[m.commission_rate,"%"]})]}),m.fixed_fee&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-muted-foreground",children:"Frais fixes:"}),e.jsxs("span",{className:"font-medium",children:[m.fixed_fee," FCFA"]})]})]})}),e.jsxs(le,{children:[e.jsx(ce,{onClick:()=>O(null),children:"Annuler"}),e.jsx(oe,{onClick:Ee,children:"Confirmer l'invitation"})]})]})})]})}function X({mandate:s}){const{terminateMandate:n,acceptMandate:r,refuseMandate:N}=me(),{user:o}=Ae(),[u,w]=i.useState(""),[y,d]=i.useState(""),T=l=>{const L={pending:{variant:"secondary",label:"En attente"},active:{variant:"default",label:"Actif"},suspended:{variant:"outline",label:"Suspendu"},terminated:{variant:"destructive",label:"Résilié"},expired:{variant:"outline",label:"Expiré"}}[l];return e.jsx(fe,{variant:L.variant,children:L.label})},t=l=>({location:"Location",gestion_complete:"Gestion complète",vente:"Vente"})[l];return e.jsxs(M,{children:[e.jsx(I,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(z,{className:"text-lg",children:t(s.mandate_type)}),T(s.status),e.jsx(P,{id:"mandate_status",title:"Statut du mandat",content:s.status==="pending"?"En attente d'acceptation par l'agence":s.status==="active"?"Mandat actif - L'agence gère vos biens":s.status==="suspended"?"Mandat suspendu temporairement":s.status==="terminated"?"Mandat résilié - Plus aucune permission":"Mandat expiré à la date prévue"})]}),e.jsxs(De,{children:[s.property_id?"Mandat spécifique":"Mandat global"," • ","Depuis le ",k(new Date(s.start_date),"dd MMMM yyyy",{locale:R}),s.end_date?` jusqu'au ${k(new Date(s.end_date),"dd MMMM yyyy",{locale:R})}`:" • Durée indéterminée"]})]}),s.status==="pending"&&(o==null?void 0:o.id)===s.agency_id&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(v,{size:"sm",variant:"default",onClick:()=>r(s.id),children:[e.jsx(Pe,{className:"h-4 w-4 mr-1"}),"Accepter"]}),e.jsxs(ae,{children:[e.jsx(je,{asChild:!0,children:e.jsxs(v,{size:"sm",variant:"outline",children:[e.jsx(Le,{className:"h-4 w-4 mr-1"}),"Refuser"]})}),e.jsxs(ne,{children:[e.jsxs(te,{children:[e.jsx(ie,{children:"Refuser ce mandat ?"}),e.jsx(re,{children:"Le propriétaire sera notifié de votre refus. Cette action est définitive."})]}),e.jsxs("div",{className:"py-4",children:[e.jsx("label",{className:"text-sm font-medium",children:"Motif de refus (obligatoire)"}),e.jsx(se,{value:y,onChange:l=>d(l.target.value),placeholder:"Expliquez pourquoi vous refusez ce mandat...",className:"mt-2",rows:3})]}),e.jsxs(le,{children:[e.jsx(ce,{onClick:()=>d(""),children:"Annuler"}),e.jsx(oe,{onClick:()=>{y.trim()&&(N({mandateId:s.id,reason:y}),d(""))},disabled:!y.trim(),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Confirmer le refus"})]})]})]})]}),s.status==="active"&&(o==null?void 0:o.id)===s.owner_id&&e.jsx("div",{className:"flex gap-2",children:e.jsxs(ae,{children:[e.jsx(je,{asChild:!0,children:e.jsxs(v,{size:"sm",variant:"destructive",children:[e.jsx(Ve,{className:"h-4 w-4 mr-1"}),"Résilier"]})}),e.jsxs(ne,{children:[e.jsxs(te,{children:[e.jsx(ie,{children:"Résilier ce mandat ?"}),e.jsx(re,{children:"L'agence perdra immédiatement l'accès à vos biens. Cette action est irréversible."})]}),e.jsxs("div",{className:"py-4",children:[e.jsx("label",{className:"text-sm font-medium",children:"Motif de résiliation"}),e.jsx(se,{value:u,onChange:l=>w(l.target.value),placeholder:"Expliquez pourquoi vous résiliez ce mandat...",className:"mt-2",rows:3})]}),e.jsxs(le,{children:[e.jsx(ce,{children:"Annuler"}),e.jsx(oe,{onClick:()=>{n({mandateId:s.id,reason:u||"Résilié par le propriétaire"})},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Confirmer la résiliation"})]})]})]})})]})}),e.jsxs(D,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s.commission_rate&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Commission"}),e.jsxs("p",{className:"font-medium",children:[s.commission_rate,"%"]})]}),s.fixed_fee&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Frais fixes"}),e.jsxs("p",{className:"font-medium",children:[s.fixed_fee," FCFA"]})]}),s.billing_frequency&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Facturation"}),e.jsx("p",{className:"font-medium capitalize",children:s.billing_frequency})]}),s.end_date&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Fin prévue"}),e.jsx("p",{className:"font-medium",children:k(new Date(s.end_date),"dd/MM/yyyy")})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Permissions accordées :"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(s.permissions).filter(([l,E])=>E).map(([l])=>e.jsx(fe,{variant:"secondary",className:"text-xs",children:l.replace("can_","").replace(/_/g," ")},l))})]}),(s.notes||s.termination_reason)&&e.jsx("div",{className:"mt-4 pt-4 border-t",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:s.termination_reason||s.notes})})]})]})}function Ds(){const{profile:s}=Ae(),{asOwner:n}=me(),{stats:r}=ns(),[N,o]=i.useState(!1);if(s&&s.user_type!=="proprietaire"&&s.user_type!=="agence")return e.jsx(Oe,{to:"/dashboard",replace:!0});const u=n.filter(t=>t.status==="active"),w=n.filter(t=>t.status==="pending"),y=n.filter(t=>t.status==="terminated"||t.status==="expired"),d=u.filter(t=>{if(!t.end_date)return!1;const l=(new Date(t.end_date).getTime()-Date.now())/(1e3*60*60*24);return l>0&&l<=30}),T=u.reduce((t,l)=>l.commission_rate&&r.totalProperties?t+15e4*(l.commission_rate/100):t+(l.fixed_fee||0),0);return e.jsxs("div",{className:"container mx-auto py-8 space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Mes mandats de gestion"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Gérez les agences qui ont accès à vos biens"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(v,{variant:"ghost",size:"sm",asChild:!0,children:e.jsxs(we,{to:"/mandates/help",className:"gap-2",children:[e.jsx(de,{className:"h-4 w-4"}),"Aide"]})}),e.jsxs(v,{onClick:()=>o(!0),size:"lg",children:[e.jsx(ue,{className:"h-5 w-5 mr-2"}),"Inviter une agence"]})]})]}),d.length>0&&e.jsxs(Se,{variant:"destructive",children:[e.jsx(Ce,{className:"h-4 w-4"}),e.jsxs(Me,{children:["⚠️ ",d.length," mandat",d.length>1?"s":""," expire",d.length>1?"nt":""," dans les 30 prochains jours."]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs(M,{children:[e.jsxs(I,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(z,{className:"text-sm font-medium",children:"Mandats actifs"}),e.jsx(Z,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold",children:u.length}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[n.length," total"]})]})]}),e.jsxs(M,{children:[e.jsxs(I,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(z,{className:"text-sm font-medium",children:"Biens sous mandat"}),e.jsx(He,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold",children:r.totalProperties||0}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[r.totalOwners||0," propriétaires"]})]})]}),e.jsxs(M,{children:[e.jsxs(I,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(z,{className:"text-sm font-medium",children:"Revenus estimés"}),e.jsx(Be,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold",children:Math.round(T).toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"FCFA / mois"})]})]}),e.jsxs(M,{children:[e.jsxs(I,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(z,{className:"text-sm font-medium",children:"En attente"}),e.jsx(Ge,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold",children:w.length}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Invitations envoyées"})]})]})]}),e.jsxs(ss,{defaultValue:"active",className:"space-y-6",children:[e.jsxs(as,{className:"grid w-full grid-cols-3",children:[e.jsxs(W,{value:"active",children:["Actifs (",u.length,")"]}),e.jsxs(W,{value:"pending",children:["En attente (",w.length,")"]}),e.jsxs(W,{value:"terminated",children:["Terminés (",y.length,")"]})]}),e.jsx(Y,{value:"active",className:"space-y-4",children:u.length===0?e.jsx(M,{children:e.jsx(D,{className:"pt-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Z,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Aucun mandat actif"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Invitez une agence pour commencer à déléguer la gestion de vos biens"}),e.jsxs(v,{onClick:()=>o(!0),children:[e.jsx(ue,{className:"mr-2 h-4 w-4"}),"Inviter une agence"]})]})})}):e.jsx("div",{className:"grid gap-4",children:u.map(t=>e.jsx(X,{mandate:t},t.id))})}),e.jsx(Y,{value:"pending",className:"space-y-4",children:w.length===0?e.jsx(M,{children:e.jsx(D,{className:"pt-6",children:e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"Aucune invitation en attente"})})}):e.jsx("div",{className:"grid gap-4",children:w.map(t=>e.jsx(X,{mandate:t},t.id))})}),e.jsx(Y,{value:"terminated",className:"space-y-4",children:y.length===0?e.jsx(M,{children:e.jsx(D,{className:"pt-6",children:e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"Aucun mandat terminé"})})}):e.jsx("div",{className:"grid gap-4",children:y.map(t=>e.jsx(X,{mandate:t},t.id))})})]}),e.jsx(ms,{open:N,onOpenChange:o})]})}export{Ds as default};
//# sourceMappingURL=MyMandates-4dUaJinv.js.map
