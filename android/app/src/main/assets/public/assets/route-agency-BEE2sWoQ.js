import{r as h,j as e,bK as ae,bu as T,bL as H,aJ as ie,aK as ne,ad as P,ak as re,bM as q,bN as le,bO as ce,bP as de,ah as O,bQ as oe,$ as me,L as xe,X as ue,af as he,bb as k,b9 as V,ab as L,bR as fe,a$ as W,ae as X,be as ee,br as ge,bJ as je,al as pe,bC as be,ac as ve,bS as Ne}from"./react-vendor-CPmH2tz8.js";import{c as U,l as we,C as p,B as w,t as M,a as u,g as G,f as $,b as v,d as N,e as b,D as _e,h as ye,s as B,u as se,i as F,j as te,A as Ae,k as Ce,m as Se,n as Me,o as Pe,p as De,q as Te,r as ke,v as Le,w as J,x as K,T as $e,y as Ee,z as E,E as R}from"./route-admin-B1Ip8YDE.js";import{bY as I,cf as Q}from"./common-vendor-CK5d0rWc.js";import{m as Y}from"./animation-vendor-BJe5VoH_.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};s.SENTRY_RELEASE={id:"b65e2d84341e79b518aed72b6e71dcc77eba934a"}}catch{}})();try{(function(){var s=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},n=new s.Error().stack;n&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[n]="753bc106-97d5-4025-adda-461374aefe0e",s._sentryDebugIdIdentifier="sentry-dbid-753bc106-97d5-4025-adda-461374aefe0e")})()}catch{}const A=(s="light")=>{if(/iPhone|iPad|iPod/.test(navigator.userAgent)){try{const n=new(window.AudioContext||window.webkitAudioContext),i=n.createOscillator(),t=n.createGain();i.connect(t),t.connect(n.destination),i.frequency.value=0,t.gain.value=.01;const r=s==="light"?.01:s==="medium"?.02:.03;i.start(),i.stop(n.currentTime+r),setTimeout(()=>{n.close()},100)}catch{console.debug("Haptic feedback not supported")}return}if("vibrate"in navigator){const n=s==="light"?10:s==="medium"?20:30;navigator.vibrate(n)}},Re=({onLongPress:s,onClick:n,delay:i=500})=>{const[t,r]=h.useState(!1),l=h.useRef(),a=h.useCallback(o=>{o.preventDefault(),l.current=setTimeout(()=>{s(),r(!0),A("medium")},i)},[s,i]),d=h.useCallback(()=>{l.current&&clearTimeout(l.current),r(!1)},[]),c=h.useCallback(o=>{t||n(),d()},[n,t,d]);return{onMouseDown:a,onTouchStart:a,onMouseUp:d,onMouseLeave:d,onTouchEnd:d,onClick:c}},Ie=s=>{const n=new Date,i=new Date(s),t=n.getTime()-i.getTime(),r=Math.floor(t/6e4),l=Math.floor(t/36e5),a=Math.floor(t/864e5);return r<1?"√Ä l'instant":r<60?`Il y a ${r} min`:l<24?`Il y a ${l}h`:a===1?`Hier √† ${i.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit",timeZone:"Africa/Abidjan"})}`:a<7?`Il y a ${a} jours`:i.toLocaleDateString("fr-FR",{day:"2-digit",month:"short",year:"numeric",timeZone:"Africa/Abidjan"})},Z=({src:s,alt:n,priority:i=!1,sizes:t,className:r})=>{const[l,a]=h.useState(""),[d,c]=h.useState(!0),[o,g]=h.useState(i),x=h.useRef(null),j=m=>{try{const f=new URL(m);return f.hostname.includes("supabase.co")?m:(we.warn("Unauthorized URL attempted",{hostname:f.hostname}),"/placeholder.svg")}catch{return"/placeholder.svg"}},_=m=>{if(m.includes("supabase")){const f=m.includes("?")?"&":"?";return`${m}${f}quality=10&width=50`}return m};h.useEffect(()=>{if(i){g(!0);return}const m=new IntersectionObserver(([f])=>{f.isIntersecting&&(g(!0),m.disconnect())},{rootMargin:"50px"});return x.current&&m.observe(x.current),()=>m.disconnect()},[i]),h.useEffect(()=>{if(!o)return;const m=j(s);c(!0);const f=new Image,y=_(m);f.onload=()=>{a(y);const C=new Image;C.onload=()=>{a(m),c(!1)},C.onerror=()=>{c(!1)},C.src=m},f.onerror=()=>{a(m),c(!1)},f.src=y},[s,o]);const D=m=>{if(!m.includes("supabase"))return m;const f=m.includes("?")?"&":"?";return`
      ${m}${f}width=480 480w,
      ${m}${f}width=768 768w,
      ${m}${f}width=1024 1024w,
      ${m}${f}width=1280 1280w
    `.trim()};return e.jsx("div",{ref:x,children:o&&l?e.jsxs("picture",{children:[e.jsx("source",{srcSet:D(l),sizes:t||"(max-width: 768px) 100vw, (max-width: 1024px) 50vw, 33vw",type:"image/webp"}),e.jsx("img",{src:l,srcSet:D(l),sizes:t||"(max-width: 768px) 100vw, (max-width: 1024px) 50vw, 33vw",alt:n,loading:i?"eager":"lazy",decoding:"async",className:U("transition-opacity duration-500 w-full h-auto",d?"blur-sm opacity-50":"blur-0 opacity-100",r)})]}):e.jsx("div",{className:U("bg-muted animate-pulse",r)})})},ze=()=>{const[s,n]=h.useState({effectiveType:"4g",downlink:10,saveData:!1,online:navigator.onLine});return h.useEffect(()=>{const i=navigator.connection||navigator.mozConnection||navigator.webkitConnection,t=()=>{n({effectiveType:(i==null?void 0:i.effectiveType)||"4g",downlink:(i==null?void 0:i.downlink)||10,saveData:(i==null?void 0:i.saveData)||!1,online:navigator.onLine})},r=()=>{n(l=>({...l,online:navigator.onLine}))};return i&&(i.addEventListener("change",t),t()),window.addEventListener("online",r),window.addEventListener("offline",r),()=>{i&&i.removeEventListener("change",t),window.removeEventListener("online",r),window.removeEventListener("offline",r)}},[]),s},qe=({property:s,onFavoriteClick:n,isFavorite:i=!1,variant:t="default",showStatus:r=!0,showRemoveButton:l=!1})=>{const[a,d]=h.useState(!1),[c,o]=h.useState(!1),[g,x]=h.useState(null),j=Ie(s.created_at),{effectiveType:_,saveData:D}=ze();h.useEffect(()=>{const y=async()=>{const{data:S}=await B.from("leases").select("id").eq("property_id",s.id).eq("certification_status","certified").limit(1).maybeSingle();d(!!S)},C=async()=>{const{data:S}=await B.from("agency_mandates").select("agency_id, profiles!agency_mandates_agency_id_fkey(full_name)").eq("property_id",s.id).eq("status","active").limit(1).maybeSingle();S&&S.profiles&&x(S.profiles.full_name)};y(),C()},[s.id]);const m=Re({onLongPress:()=>{o(!0),A("heavy")},onClick:()=>{},delay:500}),f=ae({onSwipedRight:()=>{!i&&n&&(A("heavy"),n(s.id),M({title:"üíô Ajout√© aux favoris !",description:"Glissez vers la gauche pour retirer",duration:2e3}))},onSwipedLeft:()=>{i&&n&&(A("medium"),n(s.id),M({description:"‚ù§Ô∏è Retir√© des favoris",duration:2e3}))},trackMouse:!1,delta:100});return e.jsxs(e.Fragment,{children:[e.jsxs(p,{...f,...m,className:"group relative overflow-hidden bg-white shadow-card hover:shadow-card-hover transition-all duration-300 border border-border rounded-2xl animate-scale-in active:scale-95",role:"article","aria-labelledby":`property-title-${s.id}`,"aria-describedby":`property-description-${s.id}`,children:[e.jsxs("div",{className:"relative h-56 sm:h-64 bg-muted overflow-hidden",children:[s.main_image?e.jsxs(e.Fragment,{children:[e.jsx(Z,{src:s.main_image,alt:`Photo du bien: ${s.title} - ${s.property_type} √† ${s.city}`,className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-105",priority:!1}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/30 to-transparent pointer-events-none"})]}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-muted-foreground bg-gradient-to-br from-muted to-muted/50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(T,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Pas d'image"})]})}),n&&e.jsx(Y.button,{className:"absolute top-3 right-3 rounded-lg shadow-md",whileTap:{scale:1.2},animate:i?{scale:[1,1.3,1]}:{},transition:{duration:.3},onClick:y=>{y.preventDefault(),y.stopPropagation(),A("heavy"),n(s.id),M({description:i?"‚ù§Ô∏è Bien retir√© des favoris":"üíô Bien ajout√© aux favoris !",duration:2e3})},children:e.jsx(w,{size:"icon",variant:l?"destructive":i?"default":"secondary",className:"pointer-events-none",asChild:!0,children:e.jsx(Y.div,{animate:{rotate:i?[0,-15,15,-15,0]:0},transition:{duration:.5},children:e.jsx(H,{className:`h-4 w-4 transition-all duration-300 ${i?"fill-current":""}`})})})}),e.jsxs(u,{className:"absolute top-3 left-3 text-xs rounded-lg font-semibold shadow-md bg-background/90 backdrop-blur-sm text-foreground border border-border/50 flex items-center gap-1",children:[e.jsx(ie,{className:"h-3 w-3"}),j]}),e.jsxs("div",{className:"absolute top-14 left-3 flex flex-col gap-2",children:[r&&e.jsxs(u,{className:`text-xs rounded-lg font-semibold shadow-md flex items-center gap-1 ${s.status==="disponible"?"bg-green-500 hover:bg-green-600 text-white animate-pulse":s.status==="en_negociation"?"bg-orange-500 hover:bg-orange-600 text-white":"bg-gray-400 hover:bg-gray-500 text-white"}`,role:"status","aria-live":"polite",children:[s.status==="lou√©"&&e.jsx(ne,{className:"h-3 w-3","aria-hidden":"true"}),G(s.status)]}),g&&e.jsxs(u,{className:"text-xs rounded-lg font-semibold shadow-md bg-blue-600 hover:bg-blue-700 text-white flex items-center gap-1",children:[e.jsx(P,{className:"h-3 w-3"}),"G√©r√© par ",g]}),a&&e.jsxs(u,{className:"text-xs rounded-lg font-semibold shadow-md bg-primary/90 text-white flex items-center gap-1",children:[e.jsx(re,{className:"h-3 w-3"}),"Certifi√© ANSUT"]}),s.work_status&&s.work_status!=="aucun_travail"&&e.jsxs(u,{className:"text-xs rounded-lg font-semibold shadow-md bg-orange-600 hover:bg-orange-700 text-white flex items-center gap-1",children:[e.jsx(q,{className:"h-3 w-3"}),"Travaux"]})]})]}),e.jsxs("div",{id:`property-description-${s.id}`,className:"sr-only",children:["Bien de ",s.bedrooms," chambres, ",s.bathrooms," salles de bain, situ√© √† ",s.city,", pour ",$(s.monthly_rent)," par mois. Statut : ",G(s.status),"."]}),e.jsxs(v,{className:"p-3 sm:p-4 pb-2",children:[e.jsxs("div",{className:"flex items-baseline gap-2 mb-2",children:[e.jsx("p",{className:"text-2xl sm:text-3xl font-black text-primary",children:$(s.monthly_rent)}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"/mois"})]}),e.jsxs(N,{id:`property-title-${s.id}`,className:"line-clamp-1 text-base sm:text-lg font-bold",children:[s.property_type," ",s.bedrooms,"ch. - ",s.city]})]}),e.jsxs(b,{className:"space-y-3 p-3 sm:p-4 pt-0",children:[e.jsxs("div",{className:"flex items-center text-muted-foreground",children:[e.jsx(T,{className:"h-4 w-4 mr-2 flex-shrink-0 text-primary"}),e.jsx("span",{className:"line-clamp-1 font-medium",children:s.city})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm bg-muted/50 p-2 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:s.bedrooms})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ce,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:s.bathrooms})]}),s.surface_area&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(de,{className:"h-4 w-4"}),e.jsxs("span",{className:"font-medium",children:[s.surface_area,"m¬≤"]})]})]}),t==="default"&&e.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[s.is_furnished&&e.jsx(u,{variant:"secondary",className:"text-xs rounded-full",children:"Meubl√©"}),s.has_ac&&e.jsx(u,{variant:"secondary",className:"text-xs rounded-full",children:"Climatisation"}),s.has_parking&&e.jsx(u,{variant:"secondary",className:"text-xs rounded-full",children:"Parking"}),s.has_garden&&e.jsx(u,{variant:"secondary",className:"text-xs rounded-full",children:"Jardin"})]}),e.jsx(w,{asChild:!0,variant:"default",className:"w-full rounded-xl min-h-[40px] font-semibold shadow-md active:scale-95",children:e.jsx(O,{to:`/property/${s.id}`,children:"D√©couvrir ce bien"})})]})]}),e.jsx(_e,{open:c,onOpenChange:o,children:e.jsxs(ye,{className:"max-w-md",children:[s.main_image&&e.jsx(Z,{src:s.main_image,alt:s.title,className:"w-full rounded-lg",priority:!1}),e.jsx("h3",{className:"text-xl font-bold",children:s.title}),e.jsxs("p",{className:"text-2xl text-primary font-bold",children:[$(s.monthly_rent)," ",e.jsx("span",{className:"text-base font-normal",children:"/mois"})]}),e.jsxs("div",{className:"flex items-center text-muted-foreground mb-2",children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),s.city]}),e.jsxs("div",{className:"flex gap-2",children:[n&&e.jsxs(w,{variant:i?"default":"outline",onClick:()=>{A("light"),n(s.id),M({description:i?"‚ù§Ô∏è Retir√© des favoris":"üíô Ajout√© aux favoris",duration:2e3})},className:"flex-1",children:[e.jsx(H,{className:`h-4 w-4 mr-2 ${i?"fill-current":""}`}),"Favoris"]}),e.jsx(w,{asChild:!0,className:"flex-1",children:e.jsxs(O,{to:`/property/${s.id}`,children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Voir"]})})]})]})})]})},Oe=()=>{const{user:s,profile:n}=se(),{activeMandates:i,asAgency:t}=F(),r=(n==null?void 0:n.user_type)==="agence",{data:l=[],isLoading:a}=me({queryKey:["agency-properties",s==null?void 0:s.id,i],queryFn:async()=>{if(!s||!r||t.length===0)return[];const o=[...new Set(t.map(j=>j.owner_id))],{data:g,error:x}=await B.from("properties").select("*").in("owner_id",o).order("created_at",{ascending:!1});if(x)throw x;return(g||[]).filter(j=>t.some(_=>_.status==="active"&&_.owner_id===j.owner_id&&(_.property_id===null||_.property_id===j.id)))},enabled:r&&t.length>0}),d=l.reduce((o,g)=>{const x=g.owner_id;return o[x]||(o[x]=[]),o[x].push(g),o},{}),c={totalProperties:l.length,totalOwners:Object.keys(d).length,availableProperties:l.filter(o=>o.status==="disponible").length,rentedProperties:l.filter(o=>o.status==="loue").length};return{managedProperties:l,propertiesByOwner:d,stats:c,isLoading:a,isAgency:r}};function Be({mandates:s,isLoading:n}){const{acceptMandate:i,refuseMandate:t}=F(),r=a=>{const c={pending:{variant:"secondary",label:"En attente"},active:{variant:"default",label:"Actif"},suspended:{variant:"outline",label:"Suspendu"},terminated:{variant:"destructive",label:"R√©sili√©"},expired:{variant:"outline",label:"Expir√©"}}[a];return e.jsx(u,{variant:c.variant,children:c.label})},l=a=>({location:"Location",gestion_complete:"Gestion compl√®te",vente:"Vente"})[a];return n?e.jsx("div",{children:"Chargement..."}):s.length===0?e.jsx(p,{children:e.jsx(b,{className:"pt-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(P,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Aucun mandat"}),e.jsx("p",{className:"text-muted-foreground",children:"Vous n'avez pas encore de mandat de gestion"})]})})}):e.jsx("div",{className:"space-y-4",children:s.map(a=>e.jsxs(p,{children:[e.jsx(v,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(N,{className:"text-lg",children:l(a.mandate_type)}),r(a.status)]}),e.jsxs(te,{children:[a.property_id?"Mandat sp√©cifique":"Mandat global"," ‚Ä¢ ","Depuis le ",I(new Date(a.start_date),"dd MMMM yyyy",{locale:Q}),a.end_date?` jusqu'au ${I(new Date(a.end_date),"dd MMMM yyyy",{locale:Q})}`:" ‚Ä¢ Dur√©e ind√©termin√©e"]})]}),a.status==="pending"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(w,{size:"sm",variant:"default",onClick:()=>i(a.id),children:[e.jsx(xe,{className:"h-4 w-4 mr-1"}),"Accepter"]}),e.jsxs(Ae,{children:[e.jsx(Ce,{asChild:!0,children:e.jsxs(w,{size:"sm",variant:"outline",children:[e.jsx(ue,{className:"h-4 w-4 mr-1"}),"Refuser"]})}),e.jsxs(Se,{children:[e.jsxs(Me,{children:[e.jsx(Pe,{children:"Refuser ce mandat ?"}),e.jsx(De,{children:"√ätes-vous s√ªr de vouloir refuser ce mandat de gestion ?"})]}),e.jsxs(Te,{children:[e.jsx(ke,{children:"Annuler"}),e.jsx(Le,{onClick:()=>t({mandateId:a.id}),children:"Confirmer le refus"})]})]})]})]})]})}),e.jsxs(b,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[a.commission_rate&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Commission"}),e.jsxs("p",{className:"font-medium",children:[a.commission_rate,"%"]})]}),a.fixed_fee&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Frais fixes"}),e.jsxs("p",{className:"font-medium",children:[a.fixed_fee," FCFA"]})]}),a.billing_frequency&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Facturation"}),e.jsx("p",{className:"font-medium capitalize",children:a.billing_frequency})]}),a.end_date&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Fin pr√©vue"}),e.jsx("p",{className:"font-medium",children:I(new Date(a.end_date),"dd/MM/yyyy")})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsx("p",{className:"text-sm font-medium mb-3",children:"Permissions accord√©es :"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs text-muted-foreground mb-2 flex items-center gap-1",children:[e.jsx(he,{className:"h-3 w-3"})," Propri√©t√©s"]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[a.permissions.can_view_properties&&e.jsxs(u,{variant:"outline",className:"text-xs gap-1",children:[e.jsx(k,{className:"h-3 w-3"})," Voir"]}),a.permissions.can_edit_properties&&e.jsxs(u,{variant:"outline",className:"text-xs gap-1",children:[e.jsx(V,{className:"h-3 w-3"})," Modifier"]}),a.permissions.can_create_properties&&e.jsxs(u,{variant:"outline",className:"text-xs gap-1",children:[e.jsx(L,{className:"h-3 w-3"})," Cr√©er"]}),a.permissions.can_delete_properties&&e.jsxs(u,{variant:"outline",className:"text-xs gap-1",children:[e.jsx(fe,{className:"h-3 w-3"})," Supprimer"]})]})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs text-muted-foreground mb-2 flex items-center gap-1",children:[e.jsx(W,{className:"h-3 w-3"})," Candidatures"]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[a.permissions.can_view_applications&&e.jsxs(u,{variant:"outline",className:"text-xs gap-1",children:[e.jsx(k,{className:"h-3 w-3"})," Voir"]}),a.permissions.can_manage_applications&&e.jsxs(u,{variant:"outline",className:"text-xs gap-1",children:[e.jsx(V,{className:"h-3 w-3"})," G√©rer"]})]})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs text-muted-foreground mb-2 flex items-center gap-1",children:[e.jsx(q,{className:"h-3 w-3"})," Gestion"]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[a.permissions.can_create_leases&&e.jsxs(u,{variant:"outline",className:"text-xs gap-1",children:[e.jsx(L,{className:"h-3 w-3"})," Baux"]}),a.permissions.can_manage_maintenance&&e.jsxs(u,{variant:"outline",className:"text-xs gap-1",children:[e.jsx(q,{className:"h-3 w-3"})," Maintenance"]}),a.permissions.can_manage_documents&&e.jsxs(u,{variant:"outline",className:"text-xs gap-1",children:[e.jsx(L,{className:"h-3 w-3"})," Documents"]})]})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs text-muted-foreground mb-2 flex items-center gap-1",children:[e.jsx(X,{className:"h-3 w-3"})," Financier"]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:a.permissions.can_view_financials&&e.jsxs(u,{variant:"outline",className:"text-xs gap-1",children:[e.jsx(k,{className:"h-3 w-3"})," Voir finances"]})})]})]})]}),a.notes&&e.jsx("div",{className:"mt-4 pt-4 border-t",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:a.notes})})]})]},a.id))})}const z=50;function Fe({properties:s,mandates:n}){const[i,t]=h.useState(1);if(s.length===0)return e.jsx(p,{children:e.jsx(b,{className:"pt-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(P,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Aucun bien √† g√©rer"}),e.jsx("p",{className:"text-muted-foreground",children:"Les biens dont vous avez la gestion appara√Ætront ici"})]})})});const r=h.useMemo(()=>s.reduce((c,o)=>{const g=n.find(j=>j.owner_id===o.owner_id&&(j.property_id===o.id||j.property_id===null));if(!g)return c;const x=g.owner_id;return c[x]||(c[x]={mandate:g,properties:[]}),c[x].properties.push(o),c},{}),[s,n]),l=Object.entries(r),a=Math.ceil(l.length/z),d=h.useMemo(()=>l.slice((i-1)*z,i*z),[l,i]);return e.jsxs("div",{className:"space-y-8",children:[d.map(([c,o])=>{const{mandate:g,properties:x}=o;return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Propri√©taire: ",c]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[x.length," bien",x.length>1?"s":""," g√©r√©",x.length>1?"s":""]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:x.map(j=>e.jsx(qe,{property:j},j.id))})]},c)}),a>1&&e.jsxs("div",{className:"flex justify-center gap-2 mt-6",children:[e.jsx(w,{variant:"outline",onClick:()=>t(c=>Math.max(1,c-1)),disabled:i===1,children:"Pr√©c√©dent"}),e.jsxs("span",{className:"flex items-center px-4",children:["Page ",i," sur ",a]}),e.jsx(w,{variant:"outline",onClick:()=>t(c=>Math.min(a,c+1)),disabled:i===a,children:"Suivant"})]})]})}function He({mandates:s,properties:n}){const i=h.useMemo(()=>s.reduce((t,r)=>{if(r.fixed_fee)return t+r.fixed_fee;if(r.commission_rate){const a=n.filter(d=>r.property_id===d.id||r.property_id===null).reduce((d,c)=>d+(c.monthly_rent||0),0);return t+a*r.commission_rate/100}return t},0),[s,n]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs(p,{children:[e.jsxs(v,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Revenus estim√©s"}),e.jsx(X,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(b,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[i.toLocaleString()," FCFA"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Par mois"})]})]}),e.jsxs(p,{children:[e.jsxs(v,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Mandats avec commission"}),e.jsx(ee,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold",children:s.filter(t=>t.commission_rate).length}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Commission moyenne: ",s.filter(t=>t.commission_rate).length>0?(s.filter(t=>t.commission_rate).reduce((t,r)=>t+(r.commission_rate||0),0)/s.filter(t=>t.commission_rate).length).toFixed(1):0,"%"]})]})]}),e.jsxs(p,{children:[e.jsxs(v,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Frais fixes mensuels"}),e.jsx(ge,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(b,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[s.filter(t=>t.fixed_fee&&t.billing_frequency==="mensuel").reduce((t,r)=>t+(r.fixed_fee||0),0).toLocaleString()," FCFA"]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[s.filter(t=>t.fixed_fee).length," mandat",s.filter(t=>t.fixed_fee).length>1?"s":""]})]})]})]}),e.jsxs(p,{children:[e.jsxs(v,{children:[e.jsx(N,{children:"D√©tail des revenus par mandat"}),e.jsx(te,{children:"Estimation bas√©e sur les loyers actuels"})]}),e.jsx(b,{children:e.jsx("div",{className:"space-y-4",children:s.map(t=>{const r=n.filter(d=>t.property_id===d.id||t.property_id===null),l=r.reduce((d,c)=>d+(c.monthly_rent||0),0),a=t.fixed_fee||l*(t.commission_rate||0)/100;return e.jsxs("div",{className:"flex items-center justify-between py-3 border-b last:border-0",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.property_id?"Mandat sp√©cifique":"Mandat global"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[r.length," bien",r.length>1?"s":"",t.commission_rate&&` ‚Ä¢ ${t.commission_rate}% commission`,t.fixed_fee&&` ‚Ä¢ ${t.fixed_fee} FCFA`]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold",children:[a.toLocaleString()," FCFA"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t.billing_frequency||"mensuel"})]})]},t.id)})})})]})]})}function Ve(){const{profile:s}=se(),{pendingMandates:n,activeMandates:i,asAgency:t,isLoading:r}=F(),{stats:l,managedProperties:a}=Oe(),d=i.filter(c=>{if(!c.end_date)return!1;const o=(new Date(c.end_date).getTime()-Date.now())/(1e3*60*60*24);return o>0&&o<=30});return s&&s.user_type!=="agence"?e.jsx(je,{to:"/dashboard",replace:!0}):e.jsxs("div",{className:"container mx-auto py-6 space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Tableau de bord Agence"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"G√©rez vos mandats et propri√©t√©s confi√©es"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(w,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs(O,{to:"/mandates/help",className:"gap-2",children:[e.jsx(pe,{className:"h-4 w-4"}),"Aide"]})}),n.length>0&&e.jsxs(u,{variant:"default",className:"text-lg px-4 py-2",children:[n.length," invitation",n.length>1?"s":""," en attente"]})]})]}),e.jsxs("div",{className:"space-y-4",children:[n.length>0&&e.jsxs(J,{children:[e.jsx(be,{className:"h-4 w-4"}),e.jsxs(K,{children:["Vous avez ",n.length," nouvelle",n.length>1?"s":""," invitation",n.length>1?"s":""," de mandat √† traiter."]})]}),d.length>0&&e.jsxs(J,{variant:"destructive",children:[e.jsx(ve,{className:"h-4 w-4"}),e.jsxs(K,{children:["‚ö†Ô∏è ",d.length," mandat",d.length>1?"s":""," expire",d.length>1?"nt":""," dans les 30 prochains jours. Contactez vos clients pour renouveler."]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs(p,{children:[e.jsxs(v,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Mandats actifs"}),e.jsx(Ne,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold",children:i.length}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[t.length," total"]})]})]}),e.jsxs(p,{children:[e.jsxs(v,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Biens g√©r√©s"}),e.jsx(P,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold",children:l.totalProperties}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[l.availableProperties," disponibles"]})]})]}),e.jsxs(p,{children:[e.jsxs(v,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Propri√©taires"}),e.jsx(W,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold",children:l.totalOwners}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Clients actifs"})]})]}),e.jsxs(p,{children:[e.jsxs(v,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Taux occupation"}),e.jsx(ee,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(b,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[l.totalProperties>0?Math.round(l.rentedProperties/l.totalProperties*100):0,"%"]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[l.rentedProperties," biens lou√©s"]})]})]})]}),e.jsxs($e,{defaultValue:"mandates",className:"space-y-6",children:[e.jsxs(Ee,{className:"grid w-full grid-cols-3",children:[e.jsxs(E,{value:"mandates",children:["Mes mandats (",t.length,")"]}),e.jsxs(E,{value:"properties",children:["Biens g√©r√©s (",l.totalProperties,")"]}),e.jsx(E,{value:"financials",children:"Financier"})]}),e.jsx(R,{value:"mandates",className:"space-y-4",children:e.jsx(Be,{mandates:t,isLoading:r})}),e.jsx(R,{value:"properties",className:"space-y-4",children:e.jsx(Fe,{properties:a,mandates:i})}),e.jsx(R,{value:"financials",className:"space-y-4",children:e.jsx(He,{mandates:i,properties:a})})]})]})}const Qe=Object.freeze(Object.defineProperty({__proto__:null,default:Ve},Symbol.toStringTag,{value:"Module"}));export{Qe as A,Z as O,qe as P,Oe as a,A as t,Re as u};
//# sourceMappingURL=route-agency-BEE2sWoQ.js.map
