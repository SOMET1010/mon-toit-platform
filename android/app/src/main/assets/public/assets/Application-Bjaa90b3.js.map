{"version":3,"file":"Application-Bjaa90b3.js","sources":["../../src/components/application/DocumentUpload.tsx","../../src/pages/Application.tsx"],"sourcesContent":["import { useState } from 'react';\nimport { supabase } from '@/lib/supabase';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { toast } from '@/hooks/use-toast';\nimport { Upload, X, FileText } from 'lucide-react';\nimport { Badge } from '@/components/ui/badge';\nimport { logger } from '@/services/logger';\n\ntype DocumentType = 'id_card' | 'pay_slip' | 'tax_notice' | 'employment_contract' | 'bank_statement' | 'other';\n\ntype Document = {\n  type: DocumentType;\n  url: string;\n  name: string;\n  uploaded_at: string;\n};\n\ninterface DocumentUploadProps {\n  documents: Document[];\n  onDocumentsChange: (documents: Document[]) => void;\n  userId: string;\n}\n\nconst DocumentUpload = ({ documents, onDocumentsChange, userId }: DocumentUploadProps) => {\n  const [uploading, setUploading] = useState(false);\n\n  const documentTypes: { value: DocumentType; label: string }[] = [\n    { value: 'id_card', label: 'Pièce d\\'identité' },\n    { value: 'pay_slip', label: 'Bulletin de salaire' },\n    { value: 'tax_notice', label: 'Avis d\\'imposition' },\n    { value: 'employment_contract', label: 'Contrat de travail' },\n    { value: 'bank_statement', label: 'Relevé bancaire' },\n    { value: 'other', label: 'Autre' },\n  ];\n\n  const handleFileUpload = async (event: React.ChangeEvent<HTMLInputElement>, type: DocumentType) => {\n    const file = event.target.files?.[0];\n    if (!file) return;\n\n    // Validation\n    const maxSize = 5 * 1024 * 1024; // 5MB\n    if (file.size > maxSize) {\n      toast({\n        title: 'Fichier trop volumineux',\n        description: 'La taille maximale est de 5MB',\n        variant: 'destructive',\n      });\n      return;\n    }\n\n    setUploading(true);\n\n    try {\n      const fileExt = file.name.split('.').pop();\n      const fileName = `${userId}/${type}_${Date.now()}.${fileExt}`;\n\n      const { error: uploadError } = await supabase.storage\n        .from('user-documents')\n        .upload(fileName, file);\n\n      if (uploadError) throw uploadError;\n\n      const { data: { publicUrl } } = supabase.storage\n        .from('user-documents')\n        .getPublicUrl(fileName);\n\n      const newDocument: Document = {\n        type,\n        url: publicUrl,\n        name: file.name,\n        uploaded_at: new Date().toISOString(),\n      };\n\n      onDocumentsChange([...documents, newDocument]);\n\n      toast({\n        title: 'Document uploadé',\n        description: 'Le fichier a été ajouté à votre dossier',\n      });\n    } catch (error: any) {\n      logger.logError(error, { context: 'DocumentUpload', action: 'upload' });\n      toast({\n        title: 'Erreur d\\'upload',\n        description: error.message || 'Impossible d\\'uploader le fichier',\n        variant: 'destructive',\n      });\n    } finally {\n      setUploading(false);\n    }\n  };\n\n  const removeDocument = (index: number) => {\n    const newDocuments = documents.filter((_, i) => i !== index);\n    onDocumentsChange(newDocuments);\n  };\n\n  const getDocumentLabel = (type: DocumentType) => {\n    return documentTypes.find(dt => dt.value === type)?.label || type;\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n        {documentTypes.map((docType) => (\n          <div key={docType.value} className=\"space-y-2\">\n            <Label htmlFor={`upload-${docType.value}`}>{docType.label}</Label>\n            <div className=\"flex gap-2\">\n              <Input\n                id={`upload-${docType.value}`}\n                type=\"file\"\n                accept=\".pdf,.jpg,.jpeg,.png\"\n                onChange={(e) => handleFileUpload(e, docType.value)}\n                disabled={uploading}\n                className=\"flex-1\"\n              />\n            </div>\n          </div>\n        ))}\n      </div>\n\n      {documents.length > 0 && (\n        <div className=\"mt-6\">\n          <h3 className=\"text-sm font-medium mb-3\">Documents ajoutés ({documents.length})</h3>\n          <div className=\"space-y-2\">\n            {documents.map((doc, index) => (\n              <div\n                key={index}\n                className=\"flex items-center justify-between p-3 bg-muted/50 rounded-lg\"\n              >\n                <div className=\"flex items-center gap-3 flex-1\">\n                  <FileText className=\"h-5 w-5 text-muted-foreground\" />\n                  <div className=\"flex-1 min-w-0\">\n                    <p className=\"text-sm font-medium truncate\">{doc.name}</p>\n                    <p className=\"text-xs text-muted-foreground\">\n                      {getDocumentLabel(doc.type)}\n                    </p>\n                  </div>\n                  <Badge variant=\"secondary\">\n                    {new Date(doc.uploaded_at).toLocaleDateString('fr-FR')}\n                  </Badge>\n                </div>\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={() => removeDocument(index)}\n                >\n                  <X className=\"h-4 w-4\" />\n                </Button>\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {uploading && (\n        <div className=\"text-center text-sm text-muted-foreground\">\n          Upload en cours...\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default DocumentUpload;\n","import { useState, useEffect } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { useAuth } from '@/hooks/useAuth';\nimport { supabase } from '@/lib/supabase';\nimport Navbar from '@/components/Navbar';\nimport Footer from '@/components/Footer';\nimport { DynamicBreadcrumb } from '@/components/navigation/DynamicBreadcrumb';\nimport { FormProgressIndicator, Step } from '@/components/forms/FormProgressIndicator';\nimport { FormStepper } from '@/components/forms/FormStepper';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Label } from '@/components/ui/label';\nimport { toast } from '@/hooks/use-toast';\nimport { Badge } from '@/components/ui/badge';\nimport { CheckCircle, XCircle, Upload, FileText } from 'lucide-react';\nimport DocumentUpload from '@/components/application/DocumentUpload';\nimport { ApplicationStatusTracker } from '@/components/application/ApplicationStatusTracker';\nimport { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';\nimport { Shield } from 'lucide-react';\nimport { logger } from '@/services/logger';\nimport { celebrateFirstApplication } from '@/utils/confetti';\n\ntype Property = {\n  id: string;\n  title: string;\n  monthly_rent: number;\n  deposit_amount: number;\n  city: string;\n};\n\nconst applicationSteps: Step[] = [\n  { id: 'verification', label: 'Vérification d\\'identité' },\n  { id: 'documents', label: 'Documents justificatifs' },\n  { id: 'review', label: 'Révision du dossier' },\n  { id: 'submit', label: 'Soumission finale' }\n];\n\nconst Application = () => {\n  const { propertyId } = useParams();\n  const { user, profile } = useAuth();\n  const navigate = useNavigate();\n  \n  const [property, setProperty] = useState<Property | null>(null);\n  const [documents, setDocuments] = useState<any[]>([]);\n  const [verification, setVerification] = useState<any>(null);\n  const [loading, setLoading] = useState(true);\n  const [submitting, setSubmitting] = useState(false);\n  const [currentStep, setCurrentStep] = useState(0);\n\n  useEffect(() => {\n    if (propertyId) {\n      fetchPropertyAndVerification();\n    }\n  }, [propertyId]);\n\n  const fetchPropertyAndVerification = async () => {\n    try {\n      const { data: propertyData, error: propError } = await supabase\n        .from('properties')\n        .select('id, title, monthly_rent, deposit_amount, city')\n        .eq('id', propertyId)\n        .single();\n\n      if (propError) throw propError;\n      setProperty(propertyData);\n\n      if (user) {\n        const { data: verificationData } = await supabase\n          .from('user_verifications')\n          .select('*')\n          .eq('user_id', user.id)\n          .single();\n\n        setVerification(verificationData);\n      }\n    } catch (error) {\n      logger.logError(error, { context: 'Application', action: 'fetchData', propertyId });\n      toast({\n        title: 'Erreur',\n        description: 'Impossible de charger les informations',\n        variant: 'destructive',\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleSubmit = async () => {\n    if (!user || !propertyId) return;\n\n    if (documents.length === 0) {\n      toast({\n        title: 'Documents requis',\n        description: 'Veuillez ajouter au moins un document justificatif pour soumettre votre candidature',\n        variant: 'destructive',\n      });\n      return;\n    }\n\n    setSubmitting(true);\n\n    try {\n      // Vérifier si une candidature existe déjà\n      const { data: existingApplication } = await supabase\n        .from('rental_applications')\n        .select('id, status')\n        .eq('property_id', propertyId)\n        .eq('applicant_id', user.id)\n        .maybeSingle();\n\n      if (existingApplication) {\n        toast({\n          title: 'Candidature déjà soumise',\n          description: `Vous avez déjà soumis une candidature pour ce logement (statut: ${existingApplication.status}). Vous ne pouvez pas soumettre une nouvelle candidature.`,\n          variant: 'destructive',\n        });\n        setSubmitting(false);\n        return;\n      }\n\n      // Créer une nouvelle candidature\n      const { data, error } = await supabase\n        .from('rental_applications')\n        .insert({\n          property_id: propertyId,\n          applicant_id: user.id,\n          documents: documents,\n          status: 'pending',\n        })\n        .select()\n        .single();\n\n      if (error) throw error;\n\n      // Calculate tenant score automatically\n      try {\n        const { data: scoringData } = await supabase.functions.invoke('tenant-scoring', {\n          body: {\n            applicantId: user.id,\n            propertyId: propertyId,\n            monthlyRent: property.monthly_rent,\n          },\n        });\n\n        if (scoringData?.score) {\n          await supabase\n            .from('rental_applications')\n            .update({ application_score: scoringData.score })\n            .eq('id', data.id);\n        }\n      } catch (scoringError) {\n        logger.logError(scoringError, { context: 'Application', action: 'calculateScore', propertyId });\n        // Don't block application if scoring fails\n      }\n\n      // Vérifier si c'est la première candidature de l'utilisateur\n      const { count: previousApplicationsCount } = await supabase\n        .from('rental_applications')\n        .select('id', { count: 'exact', head: true })\n        .eq('applicant_id', user.id);\n\n      const isFirstApplication = previousApplicationsCount === 1; // 1 car on vient de créer une\n\n      // 🎉 Célébration pour première candidature\n      if (isFirstApplication) {\n        celebrateFirstApplication();\n      }\n\n      toast({\n        title: isFirstApplication ? '🎉 Première candidature envoyée !' : 'Candidature soumise avec succès !',\n        description: isFirstApplication \n          ? 'Félicitations ! Vous venez de faire le premier pas vers votre nouveau logement' \n          : 'Votre dossier a été envoyé au propriétaire',\n      });\n\n      navigate(`/property/${propertyId}`);\n    } catch (error: any) {\n      logger.logError(error, { context: 'Application', action: 'submitApplication', propertyId });\n      \n      let errorMessage = 'Impossible de soumettre la candidature';\n      \n      // Gérer les différents types d'erreurs\n      if (error.message?.includes('duplicate key')) {\n        errorMessage = 'Vous avez déjà soumis une candidature pour ce logement.';\n      } else if (error.message?.includes('network')) {\n        errorMessage = 'Erreur de connexion. Vérifiez votre connexion internet et réessayez.';\n      } else if (error.message) {\n        errorMessage = error.message;\n      }\n      \n      toast({\n        title: 'Erreur de soumission',\n        description: errorMessage,\n        variant: 'destructive',\n      });\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary\"></div>\n      </div>\n    );\n  }\n\n  if (!property) {\n    return <div>Bien non trouvé</div>;\n  }\n\n  // Update step based on document count and verification status\n  useEffect(() => {\n    if (profile?.oneci_verified || verification?.oneci_status === 'verified') {\n      if (documents.length > 0) {\n        setCurrentStep(2); // Review step\n      } else {\n        setCurrentStep(1); // Documents step\n      }\n    } else {\n      setCurrentStep(0); // Verification step\n    }\n  }, [profile, verification, documents]);\n\n  return (\n    <div className=\"min-h-screen flex flex-col bg-gradient-to-br from-background via-background to-primary/5\">\n      <Navbar />\n      \n      <main className=\"flex-1 container mx-auto px-4 py-6 pt-24 max-w-4xl\">\n        <DynamicBreadcrumb />\n        \n        <div className=\"mb-8\">\n          <Button \n            variant=\"ghost\" \n            onClick={() => navigate(`/property/${propertyId}`)}\n            className=\"mb-4 -ml-2\"\n          >\n            ← Retour au bien\n          </Button>\n          <h1 className=\"text-4xl font-bold text-foreground mb-3\">\n            Postuler pour {property.title}\n          </h1>\n          <p className=\"text-lg text-muted-foreground\">\n            {property.city} • {property.monthly_rent.toLocaleString()} FCFA/mois\n          </p>\n        </div>\n\n        {/* Progress Indicator */}\n        <FormStepper steps={applicationSteps} currentStep={currentStep} />\n        <FormProgressIndicator steps={applicationSteps} currentStep={currentStep} className=\"mt-6\" />\n\n        <div className=\"space-y-6\">\n          {/* ONECI Verification Required Alert */}\n          {!profile?.oneci_verified && verification?.oneci_status !== 'verified' && (\n            <Alert className=\"border-primary/50 bg-primary/5\">\n              <Shield className=\"h-4 w-4\" />\n              <AlertTitle>Vérification ONECI recommandée</AlertTitle>\n              <AlertDescription>\n                Complétez votre vérification d'identité ONECI pour renforcer votre candidature. \n                Les propriétaires accordent plus de confiance aux profils vérifiés.\n              </AlertDescription>\n            </Alert>\n          )}\n\n          {/* Note: ApplicationStatusTracker sera visible après soumission */}\n          \n          {/* Vérifications */}\n          <Card className=\"border-2 shadow-lg\">\n            <CardHeader className=\"pb-4\">\n              <CardTitle className=\"flex items-center gap-2 text-xl\">\n                <CheckCircle className=\"h-5 w-5 text-primary\" />\n                Votre profil de vérification\n              </CardTitle>\n              <CardDescription>\n                Ces informations renforceront votre candidature auprès du propriétaire\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"flex items-center justify-between p-4 rounded-xl bg-muted/50 hover:bg-muted transition-colors\">\n                <div className=\"flex items-center gap-3\">\n                  {profile?.oneci_verified ? (\n                    <div className=\"p-2 rounded-full bg-green-500/10\">\n                      <CheckCircle className=\"h-5 w-5 text-green-600\" />\n                    </div>\n                  ) : (\n                    <div className=\"p-2 rounded-full bg-muted\">\n                      <XCircle className=\"h-5 w-5 text-muted-foreground\" />\n                    </div>\n                  )}\n                  <div>\n                    <p className=\"font-medium\">Vérification ONECI</p>\n                    <p className=\"text-xs text-muted-foreground\">Carte d'identité nationale</p>\n                  </div>\n                </div>\n                {!profile?.oneci_verified && (\n                  <Button variant=\"outline\" size=\"sm\" onClick={() => navigate('/verification')} className=\"rounded-xl\">\n                    Vérifier\n                  </Button>\n                )}\n              </div>\n\n              <div className=\"flex items-center justify-between p-4 rounded-xl bg-muted/50 hover:bg-muted transition-colors\">\n                <div className=\"flex items-center gap-3\">\n                  {profile?.cnam_verified ? (\n                    <div className=\"p-2 rounded-full bg-green-500/10\">\n                      <CheckCircle className=\"h-5 w-5 text-green-600\" />\n                    </div>\n                  ) : (\n                    <div className=\"p-2 rounded-full bg-muted\">\n                      <XCircle className=\"h-5 w-5 text-muted-foreground\" />\n                    </div>\n                  )}\n                  <div>\n                    <p className=\"font-medium\">Vérification CNAM</p>\n                    <p className=\"text-xs text-muted-foreground\">Situation professionnelle</p>\n                  </div>\n                </div>\n                {!profile?.cnam_verified && (\n                  <Button variant=\"outline\" size=\"sm\" onClick={() => navigate('/verification')} className=\"rounded-xl\">\n                    Vérifier\n                  </Button>\n                )}\n              </div>\n\n              {verification && verification.tenant_score > 0 && (\n                <div className=\"mt-4 p-5 bg-gradient-to-br from-primary/10 to-primary/5 rounded-xl border border-primary/20\">\n                  <div className=\"flex items-center justify-between\">\n                    <div>\n                      <p className=\"font-semibold text-lg\">Score locataire</p>\n                      <p className=\"text-sm text-muted-foreground\">Basé sur vos vérifications</p>\n                    </div>\n                    <Badge variant=\"default\" className=\"text-lg px-4 py-2 rounded-xl\">\n                      {verification.tenant_score}/100\n                    </Badge>\n                  </div>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n\n          {/* Documents */}\n          <Card className=\"border-2 shadow-lg\">\n            <CardHeader className=\"pb-4\">\n              <CardTitle className=\"flex items-center gap-2 text-xl\">\n                <Upload className=\"h-5 w-5 text-primary\" />\n                Documents justificatifs\n              </CardTitle>\n              <CardDescription>\n                Ajoutez vos documents pour compléter votre dossier (CNI, fiches de paie, etc.)\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <DocumentUpload \n                documents={documents} \n                onDocumentsChange={setDocuments}\n                userId={user?.id || ''}\n              />\n            </CardContent>\n          </Card>\n\n\n          {/* Récapitulatif */}\n          <Card className=\"border-2 shadow-lg bg-gradient-to-br from-background to-muted/20\">\n            <CardHeader className=\"pb-4\">\n              <CardTitle className=\"text-xl\">Récapitulatif de votre candidature</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-3\">\n              <div className=\"flex justify-between items-center p-3 rounded-xl bg-background\">\n                <span className=\"text-muted-foreground\">Loyer mensuel</span>\n                <span className=\"font-bold text-lg\">{property.monthly_rent.toLocaleString()} FCFA</span>\n              </div>\n              {property.deposit_amount && (\n                <div className=\"flex justify-between items-center p-3 rounded-xl bg-background\">\n                  <span className=\"text-muted-foreground\">Caution</span>\n                  <span className=\"font-bold text-lg\">{property.deposit_amount.toLocaleString()} FCFA</span>\n                </div>\n              )}\n              <div className=\"flex justify-between items-center p-3 rounded-xl bg-background\">\n                <span className=\"text-muted-foreground\">Documents joints</span>\n                <Badge variant={documents.length > 0 ? \"default\" : \"destructive\"} className=\"rounded-xl\">\n                  {documents.length > 0 ? `${documents.length} fichier${documents.length > 1 ? 's' : ''}` : 'Requis'}\n                </Badge>\n              </div>\n            </CardContent>\n          </Card>\n\n          <div className=\"flex gap-4 pt-4\">\n            <Button\n              variant=\"outline\"\n              onClick={() => navigate(`/property/${propertyId}`)}\n              className=\"flex-1 h-14 rounded-xl text-base\"\n            >\n              Annuler\n            </Button>\n            <Button\n              onClick={handleSubmit}\n              disabled={submitting}\n              className=\"flex-1 h-14 rounded-xl text-base font-semibold shadow-lg\"\n            >\n              {submitting ? 'Envoi en cours...' : '📤 Soumettre ma candidature'}\n            </Button>\n          </div>\n        </div>\n      </main>\n\n      <Footer />\n    </div>\n  );\n};\n\nexport default Application;\n"],"names":["DocumentUpload","documents","onDocumentsChange","userId","uploading","setUploading","useState","documentTypes","handleFileUpload","event","type","file","_a","maxSize","toast","fileExt","fileName","uploadError","supabase","publicUrl","newDocument","error","logger","removeDocument","index","newDocuments","_","i","getDocumentLabel","dt","jsxs","jsx","docType","Label","Input","e","doc","FileText","Badge","Button","X","applicationSteps","Application","propertyId","useParams","user","profile","useAuth","navigate","useNavigate","property","setProperty","setDocuments","verification","setVerification","loading","setLoading","submitting","setSubmitting","currentStep","setCurrentStep","useEffect","fetchPropertyAndVerification","propertyData","propError","verificationData","handleSubmit","existingApplication","data","scoringData","scoringError","previousApplicationsCount","isFirstApplication","celebrateFirstApplication","errorMessage","_b","Navbar","DynamicBreadcrumb","FormStepper","FormProgressIndicator","Alert","Shield","AlertTitle","AlertDescription","Card","CardHeader","CardTitle","CheckCircle","CardDescription","CardContent","XCircle","Upload","Footer"],"mappings":"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"}