import{cV as k,r as i,j as e,cq as _,br as R,aa as V,aJ as z,a9 as H,bH as O}from"./react-vendor-CPmH2tz8.js";import{u as J,aj as W,s as d,l as C,X as Y,C as p,b as Z,d as G,e as x,ag as u,_ as S,a7 as E,a8 as F,a9 as T,aa as P,ab as o,B as K,Z as Q,a as h}from"./route-admin-B1Ip8YDE.js";import{D as U}from"./route-owner-C83ejxxl.js";import"./query-vendor-ByjIuei6.js";import"./monitoring-vendor-C7yD_Gmu.js";import"./ui-vendor-Dua12RDV.js";import"./common-vendor-CK5d0rWc.js";import"./charts-vendor-16YcNskv.js";import"./supabase-vendor-CzsKfTY-.js";import"./route-agency-BEE2sWoQ.js";import"./animation-vendor-BJe5VoH_.js";(function(){try{var a=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};a.SENTRY_RELEASE={id:"b65e2d84341e79b518aed72b6e71dcc77eba934a"}}catch{}})();try{(function(){var a=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},n=new a.Error().stack;n&&(a._sentryDebugIds=a._sentryDebugIds||{},a._sentryDebugIds[n]="ffa9d237-88ed-40bb-a84a-ebddc26306ec",a._sentryDebugIdIdentifier="sentry-dbid-ffa9d237-88ed-40bb-a84a-ebddc26306ec")})()}catch{}function le(){const{user:a}=J(),{toast:n}=W(),[I]=k();I.get("lease");const[f,D]=i.useState([]),[y,j]=i.useState(!1),[c,g]=i.useState(""),[l,M]=i.useState("loyer"),[t,q]=i.useState("orange_money"),[v,b]=i.useState("");i.useEffect(()=>{a&&X()},[a]);const X=async()=>{try{const{data:s,error:r}=await d.from("payments").select("*").eq("payer_id",a==null?void 0:a.id).order("created_at",{ascending:!1});if(r)throw r;D(s||[])}catch(s){C.error("Error fetching payments",{error:s,userId:a==null?void 0:a.id}),n({title:"Erreur",description:s instanceof Error?s.message:"Erreur lors de la rÃ©cupÃ©ration des paiements",variant:"destructive"})}},A=async s=>{s.preventDefault(),j(!0);try{const{data:r,error:N}=await d.from("payments").insert({payer_id:a==null?void 0:a.id,receiver_id:a==null?void 0:a.id,amount:parseFloat(c),payment_type:l,payment_method:t,status:"pending"}).select().single();if(N)throw N;const{data:m,error:w}=await d.functions.invoke("mobile-money-payment",{body:{amount:parseFloat(c),phoneNumber:v,provider:t,paymentId:r.id,paymentType:l}});if(w)throw w;m.success?(await d.from("payments").update({status:"completed",completed_at:new Date().toISOString(),transaction_id:m.transactionRef}).eq("id",r.id),n({title:"Paiement rÃ©ussi",description:m.message}),g(""),b(""),X()):(await d.from("payments").update({status:"failed"}).eq("id",r.id),n({title:"Paiement Ã©chouÃ©",description:m.error,variant:"destructive"}))}catch(r){C.error("Error processing payment",{error:r,userId:a==null?void 0:a.id,amount:c,paymentType:l}),n({title:"Erreur",description:r instanceof Error?r.message:"Erreur lors du traitement du paiement",variant:"destructive"})}finally{j(!1)}},B=s=>{switch(s){case"completed":return e.jsxs(h,{className:"bg-green-500",children:[e.jsx(H,{className:"h-3 w-3 mr-1"}),"ComplÃ©tÃ©"]});case"pending":return e.jsxs(h,{className:"bg-yellow-500",children:[e.jsx(z,{className:"h-3 w-3 mr-1"}),"En attente"]});case"failed":return e.jsxs(h,{variant:"destructive",children:[e.jsx(V,{className:"h-3 w-3 mr-1"}),"Ã‰chouÃ©"]});default:return e.jsx(h,{variant:"outline",children:s})}},L=s=>{switch(s){case"orange_money":case"mtn_money":case"wave":return e.jsx(O,{className:"h-4 w-4"});default:return e.jsx(_,{className:"h-4 w-4"})}};return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(Y,{}),e.jsxs("main",{className:"container mx-auto px-4 py-8 pt-24",children:[e.jsx(U,{}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Paiements"}),e.jsx("p",{className:"text-muted-foreground",children:"Effectuez vos paiements de loyer et consultez l'historique"})]}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-8",children:[e.jsxs(p,{children:[e.jsx(Z,{children:e.jsx(G,{children:"Nouveau paiement"})}),e.jsx(x,{children:e.jsxs("form",{onSubmit:A,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"amount",children:"Montant (FCFA)"}),e.jsx(S,{id:"amount",type:"number",value:c,onChange:s=>g(s.target.value),placeholder:"50000",required:!0})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"paymentType",children:"Type de paiement"}),e.jsxs(E,{value:l,onValueChange:M,children:[e.jsx(F,{children:e.jsx(T,{})}),e.jsxs(P,{children:[e.jsx(o,{value:"loyer",children:"Loyer mensuel"}),e.jsx(o,{value:"depot",children:"DÃ©pÃ´t de garantie"}),e.jsx(o,{value:"charges",children:"Charges"})]})]})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"paymentMethod",children:"Mode de paiement"}),e.jsxs(E,{value:t,onValueChange:q,children:[e.jsx(F,{children:e.jsx(T,{})}),e.jsxs(P,{children:[e.jsx(o,{value:"orange_money",children:"ðŸŸ  Orange Money"}),e.jsx(o,{value:"mtn_money",children:"ðŸŸ¡ MTN Money"}),e.jsx(o,{value:"moov_money",children:"ðŸ”µ Moov Money"}),e.jsx(o,{value:"wave",children:"ðŸ’™ Wave"})]})]})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"phone",children:"NumÃ©ro de tÃ©lÃ©phone"}),e.jsx(S,{id:"phone",type:"tel",value:v,onChange:s=>b(s.target.value),placeholder:t==="orange_money"?"07XXXXXXXX ou 227XXXXXXXX":t==="mtn_money"?"05XXXXXXXX ou 054XXXXXXXX":t==="moov_money"?"01XXXXXXXX":"XXXXXXXX",required:!0}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[t==="orange_money"&&"Format: 07 ou 227 + 8 chiffres",t==="mtn_money"&&"Format: 05, 054, 055 ou 056 + 8 chiffres",t==="moov_money"&&"Format: 01 + 8 chiffres",t==="wave"&&"Format: 8 Ã  10 chiffres"]})]}),e.jsx(K,{type:"submit",className:"w-full",disabled:y,children:y?"Traitement en cours...":"Effectuer le paiement"})]})})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Historique des paiements"}),e.jsx("div",{className:"space-y-4",children:f.length===0?e.jsx(p,{children:e.jsxs(x,{className:"p-8 text-center",children:[e.jsx(_,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground",children:"Aucun paiement trouvÃ©"})]})}):f.map(s=>e.jsx(p,{children:e.jsxs(x,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[L(s.payment_method),e.jsxs("span",{className:"font-semibold",children:[s.amount.toLocaleString()," FCFA"]})]}),B(s.status)]}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsx("div",{className:"capitalize",children:s.payment_type}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-3 w-3"}),new Date(s.created_at).toLocaleDateString()]}),s.transaction_id&&e.jsxs("div",{className:"text-xs",children:["RÃ©f: ",s.transaction_id]})]})]})},s.id))})]})]})]}),e.jsx(Q,{})]})}export{le as default};
//# sourceMappingURL=Payments-BqGMhMEA.js.map
