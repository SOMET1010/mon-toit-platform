import{c4 as H,a5 as L,r as d,j as e,bu as $,af as z,bc as S,br as B,aJ as R}from"./react-vendor-CPmH2tz8.js";import{u as V,X as q,C as c,b as o,d as m,j as g,e as x,aU as J,B as u,ae as Y,Z as G,s as D,t as v}from"./route-admin-B1Ip8YDE.js";import{D as U}from"./route-owner-C83ejxxl.js";import{F as X}from"./FormStepper-CogL4h-a.js";import{cf as y,bY as E}from"./common-vendor-CK5d0rWc.js";import"./query-vendor-ByjIuei6.js";import"./monitoring-vendor-C7yD_Gmu.js";import"./ui-vendor-Dua12RDV.js";import"./charts-vendor-16YcNskv.js";import"./supabase-vendor-CzsKfTY-.js";import"./route-agency-BEE2sWoQ.js";import"./animation-vendor-BJe5VoH_.js";(function(){try{var a=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};a.SENTRY_RELEASE={id:"b65e2d84341e79b518aed72b6e71dcc77eba934a"}}catch{}})();try{(function(){var a=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},n=new a.Error().stack;n&&(a._sentryDebugIds=a._sentryDebugIds||{},a._sentryDebugIds[n]="24544c22-adad-4c0f-95e4-5f4d124eac44",a._sentryDebugIdIdentifier="sentry-dbid-24544c22-adad-4c0f-95e4-5f4d124eac44")})()}catch{}const _=[{id:"property",label:"S√©lection de la propri√©t√©"},{id:"schedule",label:"Date et heure de visite"},{id:"confirmation",label:"Confirmation"}],Z=["08:00","08:30","09:00","09:30","10:00","10:30","11:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30","18:00"],de=()=>{const{propertyId:a}=H(),n=L(),{user:p}=V(),[i,N]=d.useState(0),[r,I]=d.useState(),[l,M]=d.useState(""),[h,T]=d.useState(""),[f,w]=d.useState(!1),[s,P]=d.useState(null);d.useState(()=>{(async()=>{if(!a)return;const{data:j,error:b}=await D.from("properties").select("*, profiles:owner_id(full_name)").eq("id",a).single();if(b){v({title:"Erreur",description:"Impossible de charger le bien",variant:"destructive"});return}P(j)})()});const k=async()=>{if(!(!p||!a||!r||!l)){w(!0);try{const t=new Date(r),[j,b]=l.split(":");t.setHours(parseInt(j),parseInt(b));const A=`üè† Demande de visite pour le bien

üìÖ Date : ${E(r,"EEEE d MMMM yyyy",{locale:y})}
‚è∞ Heure : ${l}

üí¨ Message :
${h||"Aucun commentaire additionnel"}`,{error:C}=await D.from("messages").insert({sender_id:p.id,receiver_id:s.owner_id,property_id:a,content:A,message_type:"visit_request"});if(C)throw C;v({title:"Demande envoy√©e !",description:"Le propri√©taire a re√ßu votre demande de visite"}),n(`/property/${a}`)}catch(t){console.error("Error scheduling visit:",t),v({title:"Erreur",description:"Impossible d'envoyer la demande",variant:"destructive"})}finally{w(!1)}}},F=()=>i===0?!!s:i===1?!!r&&!!l:!1;return p?e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx(q,{}),e.jsx("main",{className:"flex-1 container mx-auto px-4 py-8 pt-24",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx(U,{}),e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Demander une visite"}),e.jsx(X,{steps:_,currentStep:i}),e.jsxs("div",{className:"mt-6 space-y-6",children:[i===0&&e.jsxs(c,{children:[e.jsxs(o,{children:[e.jsx(m,{children:"Propri√©t√© s√©lectionn√©e"}),e.jsx(g,{children:"V√©rifiez les d√©tails du bien √† visiter"})]}),e.jsx(x,{children:s?e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex items-start gap-4",children:[s.main_image&&e.jsx("img",{src:s.main_image,alt:s.title,className:"w-32 h-32 object-cover rounded-lg"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg",children:s.title}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mt-2",children:[e.jsx($,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.city,", ",s.neighborhood]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mt-1",children:[e.jsx(z,{className:"w-4 h-4"}),e.jsx("span",{children:s.property_type})]}),e.jsxs("p",{className:"text-primary font-bold mt-2",children:[s.price.toLocaleString()," FCFA/mois"]})]})]})}):e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(S,{className:"h-8 w-8 animate-spin"})})})]}),i===1&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(c,{children:[e.jsx(o,{children:e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5"}),"S√©lectionnez une date"]})}),e.jsx(x,{children:e.jsx(J,{mode:"single",selected:r,onSelect:I,locale:y,disabled:t=>t<new Date||t<new Date(new Date().setHours(0,0,0,0)),className:"rounded-md border"})})]}),e.jsxs(c,{children:[e.jsx(o,{children:e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5"}),"Choisissez un cr√©neau horaire"]})}),e.jsx(x,{children:e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-5 gap-2",children:Z.map(t=>e.jsx(u,{variant:l===t?"default":"outline",onClick:()=>M(t),className:"min-h-[44px]",children:t},t))})})]}),e.jsxs(c,{children:[e.jsxs(o,{children:[e.jsx(m,{children:"Commentaires additionnels"}),e.jsx(g,{children:"Informations compl√©mentaires pour le propri√©taire (optionnel)"})]}),e.jsx(x,{children:e.jsx(Y,{placeholder:"Ex: Je souhaiterais visiter avec mon conjoint...",value:h,onChange:t=>T(t.target.value),rows:4})})]})]}),i===2&&e.jsxs(c,{children:[e.jsxs(o,{children:[e.jsx(m,{children:"R√©capitulatif de votre demande"}),e.jsx(g,{children:"V√©rifiez les informations avant d'envoyer"})]}),e.jsxs(x,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Bien concern√©"}),e.jsx("p",{children:s==null?void 0:s.title}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s==null?void 0:s.city,", ",s==null?void 0:s.neighborhood]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Date et heure"}),e.jsx("p",{children:r&&E(r,"EEEE d MMMM yyyy",{locale:y})}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["√† ",l]})]}),h&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Commentaires"}),e.jsx("p",{className:"text-sm",children:h})]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(u,{type:"button",variant:"outline",onClick:()=>i>0?N(i-1):n(-1),disabled:f,className:"flex-1 min-h-[44px]",children:i===0?"Annuler":"Pr√©c√©dent"}),i<_.length-1?e.jsx(u,{onClick:()=>N(i+1),disabled:!F(),className:"flex-1 min-h-[44px]",children:"Suivant"}):e.jsx(u,{onClick:k,disabled:f||!r||!l,className:"flex-1 min-h-[44px]",children:f?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"mr-2 h-4 w-4 animate-spin"}),"Envoi en cours..."]}):"Confirmer la visite"})]})]})]})}),e.jsx(G,{})]}):(n("/auth"),null)};export{de as default};
//# sourceMappingURL=ScheduleVisit-Dk2FBewP.js.map
