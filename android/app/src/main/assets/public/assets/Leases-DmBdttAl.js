import{r as o,j as e,ap as q,c5 as Ne,ah as _e,bc as Z,bg as F,aa as B,bk as ue,c8 as H,X as be,b4 as ye,ab as P,du as xe,bC as we,bb as De,bd as pe,bx as Ce,aJ as X,a5 as Ee,bu as Se,dv as Le,ae as ne,br as Te,a9 as $}from"./react-vendor-CPmH2tz8.js";import{u as z,D as J,am as W,B as g,h as K,K as ee,L as se,M as te,w as he,x as fe,ag as A,ae as ge,s as w,t as re,l as U,C as S,e as C,b as k,d as M,j as G,c as Ae,aj as V,_ as ie,a7 as Ie,a8 as Fe,a9 as Pe,aa as Ue,ab as ke,aO as Me,a_ as ze,a6 as O,aZ as R,a as I,aE as Re,X as le,Z as ce,T as Oe,y as qe,z as oe,E as de,b3 as Be}from"./route-admin-B1Ip8YDE.js";import{D as Ge}from"./route-owner-C83ejxxl.js";import{E as Ve}from"./index-LMib0YFl.js";import{o as je,Z as Q,s as Y,n as $e,l as He,f as Xe}from"./forms-vendor-DqOZ4YtP.js";import{ce as Qe,cf as Ye}from"./common-vendor-CK5d0rWc.js";import"./query-vendor-ByjIuei6.js";import"./monitoring-vendor-C7yD_Gmu.js";import"./ui-vendor-Dua12RDV.js";import"./charts-vendor-16YcNskv.js";import"./supabase-vendor-CzsKfTY-.js";import"./route-agency-BEE2sWoQ.js";import"./animation-vendor-BJe5VoH_.js";import"./route-property-b6Ka_7KN.js";import"./route-tenant-DNBKfVUX.js";import"./maps-vendor-B7X9GnXQ.js";(function(){try{var a=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};a.SENTRY_RELEASE={id:"b65e2d84341e79b518aed72b6e71dcc77eba934a"}}catch{}})();try{(function(){var a=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},n=new a.Error().stack;n&&(a._sentryDebugIds=a._sentryDebugIds||{},a._sentryDebugIds[n]="7e53fb25-9c05-49d4-bb4d-596477efe50b",a._sentryDebugIdIdentifier="sentry-dbid-7e53fb25-9c05-49d4-bb4d-596477efe50b")})()}catch{}const Ze=({leaseId:a,certificationStatus:n,onRequestSubmitted:N})=>{const{user:h}=z(),[r,d]=o.useState(!1),[i,l]=o.useState(""),[p,_]=o.useState(!1),m=n==="not_requested"||n==="rejected",j=async()=>{if(h){_(!0);try{const{error:f}=await w.from("leases").update({certification_status:"pending",certification_requested_at:new Date().toISOString(),certification_notes:i.trim()||null}).eq("id",a);if(f)throw f;re({title:"✅ Demande envoyée avec succès",description:"Un agent ANSUT examinera votre dossier sous 2-5 jours ouvrables"}),d(!1),l(""),N==null||N()}catch(f){U.logError(f,{context:"CertificationRequest",action:"submit"}),re({title:"Erreur",description:f.message||"Impossible de soumettre la demande",variant:"destructive"})}finally{_(!1)}}};return m?e.jsxs(J,{open:r,onOpenChange:d,children:[e.jsx(W,{asChild:!0,children:e.jsxs(g,{variant:"outline",className:"gap-2",children:[e.jsx(q,{className:"h-4 w-4"}),"Demander la certification ANSUT"]})}),e.jsxs(K,{className:"max-w-2xl",children:[e.jsxs(ee,{children:[e.jsxs(se,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5 text-secondary"}),"Demande de Certification ANSUT"]}),e.jsx(te,{children:"La certification ANSUT garantit la conformité de votre bail avec les normes ivoiriennes"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(he,{children:[e.jsx(Ne,{className:"h-4 w-4"}),e.jsxs(fe,{children:[e.jsx("strong",{children:"Avant de soumettre :"}),e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1 text-sm",children:[e.jsx("li",{children:"Assurez-vous que le bail est signé par les deux parties"}),e.jsx("li",{children:"Vérifiez que toutes les informations sont correctes"}),e.jsx("li",{children:"La certification peut prendre 2-5 jours ouvrables"}),e.jsx("li",{children:"Un agent ANSUT examinera votre dossier complet"})]}),e.jsx("p",{className:"text-sm mt-2",children:e.jsx(_e,{to:"/certification-faq",className:"text-primary underline hover:text-primary/80",children:"Consulter la FAQ complète"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"notes",children:"Notes additionnelles (optionnel)"}),e.jsx(ge,{id:"notes",placeholder:"Ajoutez des informations complémentaires pour faciliter la certification...",value:i,onChange:f=>l(f.target.value),rows:4}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Vous pouvez ajouter des précisions sur le bail ou des documents complémentaires"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(g,{variant:"outline",onClick:()=>d(!1),disabled:p,children:"Annuler"}),e.jsxs(g,{onClick:j,disabled:p,className:"gap-2",children:[p&&e.jsx(Z,{className:"h-4 w-4 animate-spin"}),p?"Envoi en cours...":"Soumettre la demande"]})]})]})]})]}):null},Je=({leaseId:a})=>{const[n,N]=o.useState(null),[h,r]=o.useState(!0);o.useEffect(()=>{d()},[a]);const d=async()=>{try{r(!0);const{data:i,error:l}=await w.rpc("pre_validate_lease_for_certification",{p_lease_id:a});if(l)throw l;N(i)}catch(i){U.logError(i,{context:"PreCertificationChecklist",action:"validate"})}finally{r(!1)}};return h?e.jsx(S,{children:e.jsx(C,{className:"flex items-center justify-center py-8",children:e.jsx(Z,{className:"h-6 w-6 animate-spin text-muted-foreground"})})}):n?e.jsxs(S,{children:[e.jsxs(k,{children:[e.jsxs(M,{className:"flex items-center gap-2",children:[n.all_passed?e.jsx(F,{className:"h-5 w-5 text-success"}):e.jsx(B,{className:"h-5 w-5 text-destructive"}),"Vérifications pré-certification"]}),e.jsx(G,{children:n.all_passed?"Tous les critères sont remplis pour la certification ANSUT":"Certains critères doivent être complétés avant la certification"})]}),e.jsxs(C,{className:"space-y-4",children:[n.checks.map((i,l)=>e.jsxs("div",{className:Ae("flex items-start gap-3 p-3 rounded-lg border animate-fade-in",i.passed&&"border-green-600/20 bg-green-50/50 dark:bg-green-950/20"),style:{animationDelay:`${l*100}ms`},children:[i.passed?e.jsx(F,{className:"h-5 w-5 text-green-600 shrink-0 mt-0.5 animate-scale-in"}):e.jsx(B,{className:"h-5 w-5 text-destructive shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx("p",{className:"font-medium",children:i.label}),e.jsx("p",{className:"text-sm text-muted-foreground",children:i.message})]})]},i.check_name)),!n.all_passed&&e.jsx(he,{children:e.jsx(fe,{children:"Complétez les critères manquants avant de demander la certification ANSUT."})})]})]}):null},We=je({rating:$e().min(1,"Veuillez sélectionner une note").max(5),comment:Y().trim().min(10,"Le commentaire doit contenir au moins 10 caractères").max(1e3,"Le commentaire ne peut pas dépasser 1000 caractères").optional().or(He(""))}),Ke=({revieweeId:a,revieweeName:n,leaseId:N,reviewType:h,onSuccess:r})=>{const{user:d}=z(),{toast:i}=V(),[l,p]=o.useState(0),[_,m]=o.useState(0),[j,f]=o.useState(""),[s,u]=o.useState(!1),D=async x=>{if(x.preventDefault(),!d){i({title:"Erreur",description:"Vous devez être connecté pour laisser un avis",variant:"destructive"});return}try{const v=We.parse({rating:l,comment:j});u(!0);const{error:t}=await w.from("reviews").insert({reviewer_id:d.id,reviewee_id:a,lease_id:N||null,rating:v.rating,comment:v.comment||null,review_type:h});if(t)throw t;i({title:"Avis publié",description:"Votre avis a été publié avec succès"}),p(0),f(""),r==null||r()}catch(v){v instanceof Q?i({title:"Erreur de validation",description:v.errors[0].message,variant:"destructive"}):v instanceof Error&&(v.message.includes("unique_review_per_lease")?i({title:"Avis déjà existant",description:"Vous avez déjà laissé un avis pour cette location",variant:"destructive"}):i({title:"Erreur",description:v.message,variant:"destructive"}))}finally{u(!1)}};return e.jsxs(S,{children:[e.jsxs(k,{children:[e.jsx(M,{children:"Laisser un avis"}),e.jsxs(G,{children:["Partagez votre expérience avec ",n]})]}),e.jsx(C,{children:e.jsxs("form",{onSubmit:D,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Note"}),e.jsx("div",{className:"flex gap-2",children:[1,2,3,4,5].map(x=>e.jsx("button",{type:"button",onClick:()=>p(x),onMouseEnter:()=>m(x),onMouseLeave:()=>m(0),className:"transition-transform hover:scale-110",children:e.jsx(ue,{className:`h-8 w-8 ${x<=(_||l)?"fill-yellow-400 text-yellow-400":"text-gray-300"}`})},x))}),l>0&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:[l===5&&"Excellent",l===4&&"Très bien",l===3&&"Bien",l===2&&"Passable",l===1&&"Décevant"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(A,{htmlFor:"comment",children:["Commentaire ",e.jsx("span",{className:"text-muted-foreground",children:"(optionnel)"})]}),e.jsx(ge,{id:"comment",value:j,onChange:x=>f(x.target.value),placeholder:"Décrivez votre expérience...",rows:4,maxLength:1e3}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[j.length,"/1000 caractères"]})]}),e.jsx(g,{type:"submit",disabled:s||l===0,children:s?"Publication...":"Publier l'avis"})]})})]})},es=["application/pdf","image/jpeg","image/png","image/webp","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],ve=Xe(a=>a instanceof xe,{message:O.FIELD_REQUIRED}).refine(a=>a.size<=ze.MAX_DOCUMENT_SIZE,O.DOCUMENT_TOO_LARGE).refine(a=>es.includes(a.type),O.FILE_TYPE_INVALID),ss=je({file:ve,documentType:Y().min(1,O.FIELD_REQUIRED),name:Y().min(R.MIN_NAME_LENGTH,`Le nom doit contenir au moins ${R.MIN_NAME_LENGTH} caractères`).max(R.MAX_NAME_LENGTH,`Le nom ne peut pas dépasser ${R.MAX_NAME_LENGTH} caractères`)}),ts=[{value:"lease_contract",label:"Contrat de bail"},{value:"inventory_in",label:"État des lieux d'entrée"},{value:"inventory_out",label:"État des lieux de sortie"},{value:"rent_receipt",label:"Quittance de loyer"},{value:"deposit_receipt",label:"Reçu de dépôt de garantie"},{value:"insurance",label:"Attestation d'assurance"},{value:"identity_document",label:"Pièce d'identité"},{value:"income_proof",label:"Justificatif de revenus"},{value:"employment_contract",label:"Contrat de travail"},{value:"other",label:"Autre"}],as=({leaseId:a,onUploadSuccess:n})=>{const{user:N}=z(),{toast:h}=V(),[r,d]=o.useState(null),[i,l]=o.useState(""),[p,_]=o.useState(""),[m,j]=o.useState(!1),[f,s]=o.useState(0),u=t=>t.startsWith("image/")?ye:t==="application/pdf"?P:xe,D=t=>{var b;const c=(b=t.target.files)==null?void 0:b[0];if(c)try{ve.parse(c),d(c),p||_(c.name.replace(/\.[^/.]+$/,""))}catch(y){y instanceof Q&&h({title:"Fichier invalide",description:y.errors[0].message,variant:"destructive"})}},x=async()=>{if(!(!r||!N))try{const t=ss.parse({file:r,documentType:i,name:p});j(!0),s(0);const c=r.name.split(".").pop(),b=`${a}/${Date.now()}_${p}.${c}`,{data:y,error:E}=await w.storage.from("lease-documents").upload(b,r,{cacheControl:"3600",upsert:!1});if(E)throw E;s(50);const{data:{publicUrl:L}}=w.storage.from("lease-documents").getPublicUrl(b),{error:ae}=await w.from("lease_documents").insert({lease_id:a,document_type:t.documentType,name:t.name,file_url:L,file_size:r.size,file_type:r.type,uploaded_by:N.id,status:"pending"});if(ae)throw ae;s(100),h({title:"Document uploadé",description:"Le document a été ajouté avec succès"}),d(null),l(""),_(""),s(0),n==null||n()}catch(t){t instanceof Q?h({title:"Erreur de validation",description:t.errors[0].message,variant:"destructive"}):t instanceof Error&&h({title:"Erreur",description:t.message,variant:"destructive"})}finally{j(!1)}},v=r?u(r.type):H;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"file-upload",children:"Fichier"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{id:"file-upload",type:"file",accept:".pdf,.jpg,.jpeg,.png,.webp,.doc,.docx",onChange:D,disabled:m,className:"hidden"}),e.jsxs(g,{type:"button",variant:"outline",className:"w-full",onClick:()=>{var t;return(t=document.getElementById("file-upload"))==null?void 0:t.click()},disabled:m,children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),r?"Changer de fichier":"Sélectionner un fichier"]})]}),r&&e.jsxs("div",{className:"flex items-center gap-2 p-3 border rounded-lg bg-muted/50",children:[e.jsx(v,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:r.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[(r.size/1024/1024).toFixed(2)," MB"]})]}),e.jsx(g,{type:"button",variant:"ghost",size:"icon",onClick:()=>d(null),disabled:m,children:e.jsx(be,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"document-type",children:"Type de document"}),e.jsxs(Ie,{value:i,onValueChange:l,disabled:m,children:[e.jsx(Fe,{children:e.jsx(Pe,{placeholder:"Sélectionnez le type"})}),e.jsx(Ue,{children:ts.map(t=>e.jsx(ke,{value:t.value,children:t.label},t.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"document-name",children:"Nom du document"}),e.jsx(ie,{id:"document-name",value:p,onChange:t=>_(t.target.value),placeholder:"Ex: Contrat de bail 2024",maxLength:255,disabled:m})]}),m&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(Me,{value:f}),e.jsxs("p",{className:"text-sm text-center text-muted-foreground",children:["Upload en cours... ",f,"%"]})]}),e.jsx(g,{onClick:x,disabled:!r||!i||!p||m,className:"w-full",children:m?"Upload en cours...":"Uploader le document"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Formats acceptés: PDF, JPG, PNG, WEBP, DOC, DOCX (max 10MB)"})]})},me={lease_contract:"Contrat de bail",inventory_in:"État des lieux d'entrée",inventory_out:"État des lieux de sortie",rent_receipt:"Quittance de loyer",deposit_receipt:"Reçu de dépôt de garantie",insurance:"Attestation d'assurance",identity_document:"Pièce d'identité",income_proof:"Justificatif de revenus",employment_contract:"Contrat de travail",other:"Autre"},T=["lease_contract","inventory_in","insurance","identity_document"],ns=({leaseId:a,landlordId:n,tenantId:N})=>{const{user:h}=z(),{toast:r}=V(),[d,i]=o.useState([]),[l,p]=o.useState(!0),[_,m]=o.useState(!1);o.useEffect(()=>{j()},[a]);const j=async()=>{try{const{data:t,error:c}=await w.from("lease_documents").select(`
          *,
          uploader:uploaded_by (full_name)
        `).eq("lease_id",a).order("created_at",{ascending:!1});if(c)throw c;const b=(t==null?void 0:t.map(y=>({...y,uploader:Array.isArray(y.uploader)?y.uploader[0]:y.uploader})))||[];i(b)}catch(t){U.logError(t,{context:"DocumentManager",action:"fetch"})}finally{p(!1)}},f=async(t,c)=>{try{const y=await(await fetch(t)).blob(),E=window.URL.createObjectURL(y),L=document.createElement("a");L.href=E,L.download=c,document.body.appendChild(L),L.click(),window.URL.revokeObjectURL(E),document.body.removeChild(L)}catch{r({title:"Erreur",description:"Impossible de télécharger le fichier",variant:"destructive"})}},s=async(t,c)=>{if(confirm("Êtes-vous sûr de vouloir supprimer ce document ?"))try{const y=c.split("/lease-documents/")[1];y&&await w.storage.from("lease-documents").remove([y]);const{error:E}=await w.from("lease_documents").delete().eq("id",t);if(E)throw E;r({title:"Document supprimé",description:"Le document a été supprimé avec succès"}),j()}catch{r({title:"Erreur",description:"Impossible de supprimer le document",variant:"destructive"})}},u=t=>{switch(t){case"approved":return e.jsxs(I,{className:"bg-green-600",children:[e.jsx(F,{className:"h-3 w-3 mr-1"}),"Approuvé"]});case"rejected":return e.jsxs(I,{variant:"destructive",children:[e.jsx(B,{className:"h-3 w-3 mr-1"}),"Rejeté"]});default:return e.jsxs(I,{variant:"secondary",children:[e.jsx(X,{className:"h-3 w-3 mr-1"}),"En attente"]})}},x=(()=>{const t=d.map(c=>c.document_type);return T.filter(c=>!t.includes(c))})(),v=(T.length-x.length)/T.length*100;return l?e.jsx(S,{children:e.jsx(C,{className:"p-8",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(S,{children:[e.jsxs(k,{children:[e.jsxs(M,{className:"flex items-center gap-2",children:[e.jsx(we,{className:"h-5 w-5"}),"Documents obligatoires"]}),e.jsxs(G,{children:["Complétude: ",v.toFixed(0),"% (",T.length-x.length,"/",T.length,")"]})]}),e.jsx(C,{children:e.jsx("div",{className:"space-y-2",children:T.map(t=>{const c=d.some(b=>b.document_type===t);return e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[c?e.jsx(F,{className:"h-5 w-5 text-green-600"}):e.jsx(B,{className:"h-5 w-5 text-muted-foreground"}),e.jsx("span",{className:c?"font-medium":"text-muted-foreground",children:me[t]})]}),c&&e.jsxs(I,{variant:"outline",className:"bg-green-50",children:[e.jsx(F,{className:"h-3 w-3 mr-1"}),"Uploadé"]})]},t)})})})]}),e.jsxs(S,{children:[e.jsx(k,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(M,{children:"Documents du bail"}),e.jsxs(G,{children:[d.length," document",d.length>1?"s":""," uploadé",d.length>1?"s":""]})]}),e.jsxs(J,{open:_,onOpenChange:m,children:[e.jsx(W,{asChild:!0,children:e.jsxs(g,{children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Ajouter un document"]})}),e.jsxs(K,{children:[e.jsxs(ee,{children:[e.jsx(se,{children:"Uploader un document"}),e.jsx(te,{children:"Ajoutez un document à ce bail"})]}),e.jsx(as,{leaseId:a,onUploadSuccess:()=>{j(),m(!1)}})]})]})]})}),e.jsx(C,{children:e.jsx(Re,{className:"h-[400px]",children:d.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(P,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"Aucun document uploadé"})]}):e.jsx("div",{className:"space-y-3",children:d.map(t=>{var c;return e.jsxs("div",{className:"flex items-start justify-between p-4 border rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx(P,{className:"h-5 w-5 mt-0.5 text-primary"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("p",{className:"font-medium",children:t.name}),u(t.status)]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:me[t.document_type]}),e.jsxs("div",{className:"flex items-center gap-3 mt-2 text-xs text-muted-foreground",children:[e.jsxs("span",{children:["Par ",((c=t.uploader)==null?void 0:c.full_name)||"Inconnu"]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:Qe(new Date(t.created_at),{addSuffix:!0,locale:Ye})}),t.file_size&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("span",{children:[(t.file_size/1024/1024).toFixed(2)," MB"]})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{variant:"ghost",size:"icon",onClick:()=>window.open(t.file_url,"_blank"),children:e.jsx(De,{className:"h-4 w-4"})}),e.jsx(g,{variant:"ghost",size:"icon",onClick:()=>f(t.file_url,t.name),children:e.jsx(pe,{className:"h-4 w-4"})}),(h==null?void 0:h.id)===t.uploaded_by&&e.jsx(g,{variant:"ghost",size:"icon",onClick:()=>s(t.id,t.file_url),children:e.jsx(Ce,{className:"h-4 w-4"})})]})]},t.id)})})})})]})]})};function _s(){const{user:a,profile:n}=z(),N=Ee(),{toast:h}=V(),[r,d]=o.useState([]),[i,l]=o.useState(!0),[p,_]=o.useState(null);o.useEffect(()=>{a&&m()},[a]);const m=async()=>{try{const{data:s,error:u}=await w.from("leases").select(`
          *,
          properties (title, address, city, main_image)
        `).or(`landlord_id.eq.${a==null?void 0:a.id},tenant_id.eq.${a==null?void 0:a.id}`).order("created_at",{ascending:!1});if(u)throw u;const D=await Promise.all((s||[]).map(async x=>{const{data:v}=await w.from("profiles").select("full_name").eq("id",x.tenant_id).single(),{data:t}=await w.from("profiles").select("full_name").eq("id",x.landlord_id).single();return{...x,tenant:v,landlord:t}}));d(D)}catch(s){U.error("Error fetching leases",{error:s,userId:a==null?void 0:a.id}),h({title:"Erreur",description:s instanceof Error?s.message:"Erreur lors du chargement",variant:"destructive"})}finally{l(!1)}},j=async s=>{try{_(s);const{data:u,error:D}=await w.functions.invoke("generate-lease-pdf",{body:{leaseId:s}});if(D)throw D;u!=null&&u.documentUrl&&(window.open(u.documentUrl,"_blank"),h({title:"Contrat généré",description:"Le contrat PDF a été généré avec succès"}),m())}catch(u){U.error("Error generating PDF",{error:u,leaseId:s}),h({title:"Erreur",description:u instanceof Error?u.message:"Impossible de générer le PDF",variant:"destructive"})}finally{_(null)}},f=s=>e.jsx(Be,{status:s.certification_status,certifiedAt:s.ansut_certified_at});return i?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(le,{}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("p",{children:"Chargement..."})}),e.jsx(ce,{})]}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(le,{}),e.jsxs("main",{className:"container mx-auto px-4 py-6 pt-24",children:[e.jsx(Ge,{}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Mes Baux"}),e.jsx("p",{className:"text-muted-foreground",children:"Gérez vos contrats de location et effectuez les paiements"})]}),e.jsx("div",{className:"grid gap-6",children:r.length===0?e.jsx(S,{children:e.jsxs(C,{className:"p-8 text-center",children:[e.jsx(P,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground",children:"Aucun bail trouvé"})]})}):r.map(s=>{var u,D,x;return e.jsxs(S,{children:[e.jsx(k,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(M,{className:"mb-2",children:s.properties.title}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-2",children:[e.jsx(Se,{className:"h-4 w-4"}),s.properties.address,", ",s.properties.city]}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[f(s),e.jsx(I,{variant:"outline",children:s.lease_type})]})]}),s.properties.main_image&&e.jsx("img",{src:s.properties.main_image,alt:s.properties.title,className:"w-24 h-24 object-cover rounded-lg"})]})}),e.jsxs(Oe,{defaultValue:"details",className:"w-full",children:[e.jsxs(qe,{className:"grid w-full grid-cols-2 px-6",children:[e.jsx(oe,{value:"details",children:"Détails"}),e.jsxs(oe,{value:"documents",children:[e.jsx(Le,{className:"h-4 w-4 mr-2"}),"Documents"]})]}),e.jsx(de,{value:"details",children:e.jsxs(C,{children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ne,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"font-semibold",children:[s.monthly_rent.toLocaleString()," FCFA/mois"]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Dépôt: ",((u=s.deposit_amount)==null?void 0:u.toLocaleString())||0," FCFA"]}),s.charges_amount&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Charges: ",s.charges_amount.toLocaleString()," FCFA"]})]}),e.jsx("div",{children:e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Te,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm",children:["Du ",new Date(s.start_date).toLocaleDateString()," au"," ",new Date(s.end_date).toLocaleDateString()]})]})})]}),e.jsxs("div",{className:"space-y-2 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.landlord_signed_at?e.jsx($,{className:"h-4 w-4 text-green-500"}):e.jsx(X,{className:"h-4 w-4 text-yellow-500"}),e.jsxs("span",{children:["Signature propriétaire:"," ",s.landlord_signed_at?new Date(s.landlord_signed_at).toLocaleDateString():"En attente"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.tenant_signed_at?e.jsx($,{className:"h-4 w-4 text-green-500"}):e.jsx(X,{className:"h-4 w-4 text-yellow-500"}),e.jsxs("span",{children:["Signature locataire:"," ",s.tenant_signed_at?new Date(s.tenant_signed_at).toLocaleDateString():"En attente"]})]}),s.ansut_certified_at&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx($,{className:"h-4 w-4 text-green-500"}),e.jsxs("span",{children:["Certifié ANSUT le"," ",new Date(s.ansut_certified_at).toLocaleDateString()]})]}),s.is_electronically_signed&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(q,{className:"h-4 w-4 text-blue-500"}),e.jsx("span",{className:"font-medium text-blue-600 dark:text-blue-400",children:"Signé électroniquement via CryptoNeo"})]})]}),((n==null?void 0:n.user_type)==="proprietaire"&&!s.landlord_signed_at||(n==null?void 0:n.user_type)==="locataire"&&!s.tenant_signed_at)&&e.jsx("div",{className:"mb-4",children:e.jsx(Ve,{lease:s,userType:(n==null?void 0:n.user_type)==="proprietaire"?"proprietaire":"locataire",onSignatureComplete:m})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.tenant_signed_at&&s.landlord_signed_at&&e.jsx(e.Fragment,{children:s.signed_document_url?e.jsxs(g,{onClick:()=>window.open(s.signed_document_url,"_blank"),className:"gap-2",children:[e.jsx(q,{className:"h-4 w-4"}),"Contrat signé électroniquement"]}):s.document_url?e.jsxs(g,{variant:"outline",onClick:()=>window.open(s.document_url,"_blank"),children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),"Télécharger le contrat"]}):e.jsxs(g,{variant:"outline",onClick:()=>j(s.id),disabled:p===s.id,children:[p===s.id?e.jsx(Z,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(P,{className:"h-4 w-4 mr-2"}),p===s.id?"Génération...":"Générer le contrat"]})}),s.tenant_signed_at&&s.landlord_signed_at&&s.certification_status==="not_requested"&&e.jsx("div",{className:"w-full mt-4",children:e.jsx(Je,{leaseId:s.id})}),s.tenant_signed_at&&s.landlord_signed_at&&e.jsx(Ze,{leaseId:s.id,certificationStatus:s.certification_status,onRequestSubmitted:m}),e.jsxs(g,{variant:"outline",onClick:()=>N(`/payments?lease=${s.id}`),children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Paiements"]}),s.status==="signed"&&e.jsxs(J,{children:[e.jsx(W,{asChild:!0,children:e.jsxs(g,{variant:"outline",children:[e.jsx(ue,{className:"h-4 w-4 mr-2"}),"Laisser un avis"]})}),e.jsxs(K,{className:"max-w-2xl",children:[e.jsxs(ee,{children:[e.jsx(se,{children:"Laisser un avis"}),e.jsx(te,{children:"Partagez votre expérience pour cette location"})]}),e.jsx(Ke,{revieweeId:(n==null?void 0:n.user_type)==="locataire"?s.landlord_id:s.tenant_id,revieweeName:(n==null?void 0:n.user_type)==="locataire"?((D=s.landlord)==null?void 0:D.full_name)||"Propriétaire":((x=s.tenant)==null?void 0:x.full_name)||"Locataire",leaseId:s.id,reviewType:(n==null?void 0:n.user_type)==="locataire"?"tenant_to_landlord":"landlord_to_tenant",onSuccess:m})]})]})]})]})}),e.jsx(de,{value:"documents",children:e.jsx(C,{children:e.jsx(ns,{leaseId:s.id,landlordId:s.landlord_id,tenantId:s.tenant_id})})})]})]},s.id)})})]}),e.jsx(ce,{})]})}export{_s as default};
//# sourceMappingURL=Leases-DmBdttAl.js.map
