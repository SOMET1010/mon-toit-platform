{"version":3,"file":"route-property-b6Ka_7KN.js","sources":["../../src/hooks/useFavorites.ts","../../src/hooks/useRecommendations.ts","../../src/components/recommendations/RecommendationCard.tsx","../../src/components/ui/carousel.tsx","../../src/components/recommendations/RecommendationsSection.tsx","../../src/hooks/usePropertyPermissions.ts","../../src/hooks/useUserPhone.ts","../../src/components/application/ApplicantPhoneDisplay.tsx","../../src/pages/PropertyApplications.tsx","../../src/utils/confetti.ts","../../src/components/verification/ONECIForm.tsx","../../src/hooks/useDocumentHead.ts","../../src/components/property/VideoPlayer.tsx","../../src/components/property/FloorPlanViewer.tsx","../../src/components/property/SwipeGallery.tsx","../../src/hooks/usePropertyImageAccess.ts","../../src/hooks/usePanoramaPrefetch.ts","../../src/components/property/MediaGallery.tsx","../../src/components/property/LocationSection.tsx","../../src/components/application/VerificationGuard.tsx","../../src/components/ui/form.tsx","../../src/components/messaging/GuestContactForm.tsx","../../src/components/property/TitleDeedSection.tsx","../../src/components/property/WorkStatusSection.tsx","../../src/pages/PropertyDetail.tsx"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport { supabase } from '@/lib/supabase';\nimport { logger } from '@/services/logger';\nimport { useAuth } from './useAuth';\nimport { toast } from '@/hooks/use-toast';\n\n// Temporary type until Supabase types regenerate\ntype UserFavorite = {\n  id: string;\n  user_id: string;\n  property_id: string;\n  created_at: string;\n};\n\nexport const useFavorites = () => {\n  const { user } = useAuth();\n  const [favorites, setFavorites] = useState<string[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    if (user) {\n      fetchFavorites();\n    } else {\n      setFavorites([]);\n      setLoading(false);\n    }\n  }, [user]);\n\n  const fetchFavorites = async () => {\n    if (!user) return;\n    \n    try {\n      const { data, error } = await supabase\n        .from('user_favorites' as any)\n        .select('property_id')\n        .eq('user_id', user.id) as { data: UserFavorite[] | null; error: any };\n\n      if (error) {\n        logger.error('Error fetching favorites', { error, userId: user.id });\n        const localFavorites = localStorage.getItem(`favorites_${user.id}`);\n        setFavorites(localFavorites ? JSON.parse(localFavorites) : []);\n      } else {\n        setFavorites(data?.map(f => f.property_id) || []);\n      }\n    } catch (err) {\n      logger.error('Exception fetching favorites', { error: err, userId: user.id });\n      const localFavorites = localStorage.getItem(`favorites_${user.id}`);\n      setFavorites(localFavorites ? JSON.parse(localFavorites) : []);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const toggleFavorite = async (propertyId: string) => {\n    if (!user) {\n      toast({\n        title: \"Connexion requise\",\n        description: \"Veuillez vous connecter pour ajouter des favoris\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    const isFavorite = favorites.includes(propertyId);\n\n    try {\n      if (isFavorite) {\n        // Remove favorite\n        const { error } = await supabase\n          .from('user_favorites' as any)\n          .delete()\n          .eq('user_id', user.id)\n          .eq('property_id', propertyId);\n\n        if (error) throw error;\n\n        setFavorites(favorites.filter(id => id !== propertyId));\n        toast({\n          title: \"Favori retiré\",\n          description: \"Le bien a été retiré de vos favoris\"\n        });\n      } else {\n        // Add favorite\n        const { error } = await supabase\n          .from('user_favorites' as any)\n          .insert({ user_id: user.id, property_id: propertyId });\n\n        if (error) throw error;\n\n        setFavorites([...favorites, propertyId]);\n        toast({\n          title: \"Favori ajouté\",\n          description: \"Le bien a été ajouté à vos favoris\"\n        });\n      }\n\n      // Update localStorage as backup\n      localStorage.setItem(`favorites_${user.id}`, JSON.stringify(\n        isFavorite ? favorites.filter(id => id !== propertyId) : [...favorites, propertyId]\n      ));\n    } catch (error) {\n      logger.error('Error toggling favorite', { error, propertyId, userId: user.id });\n      toast({\n        title: \"Erreur\",\n        description: \"Impossible de mettre à jour vos favoris\",\n        variant: \"destructive\"\n      });\n    }\n  };\n\n  const isFavorite = (propertyId: string) => favorites.includes(propertyId);\n\n  return {\n    favorites,\n    loading,\n    toggleFavorite,\n    isFavorite,\n    refetch: fetchFavorites\n  };\n};\n","import { useState, useEffect, useCallback, useRef } from 'react';\nimport { supabase } from '@/lib/supabase';\nimport { logger } from '@/services/logger';\nimport { useAuth } from './useAuth';\nimport { toast } from '@/hooks/use-toast';\n\ninterface Recommendation {\n  id: string;\n  score: number;\n  reasons: string[];\n  type: string;\n  data?: any;\n}\n\ninterface UseRecommendationsOptions {\n  type: 'properties' | 'tenants';\n  propertyId?: string;\n  limit?: number;\n  autoFetch?: boolean;\n}\n\nexport const useRecommendations = ({\n  type,\n  propertyId,\n  limit = 10,\n  autoFetch = true,\n}: UseRecommendationsOptions) => {\n  const { user } = useAuth();\n  const [recommendations, setRecommendations] = useState<Recommendation[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<Error | null>(null);\n  const fetchedRef = useRef(false);\n\n  const fetchRecommendations = useCallback(async () => {\n    if (!user || fetchedRef.current) {\n      setRecommendations([]);\n      return;\n    }\n\n    fetchedRef.current = true;\n\n    setLoading(true);\n    setError(null);\n\n    try {\n      const { data, error: functionError } = await supabase.functions.invoke(\n        'generate-recommendations',\n        {\n          body: {\n            userId: user.id,\n            type,\n            propertyId,\n            limit,\n          },\n        }\n      );\n\n      if (functionError) throw functionError;\n\n      setRecommendations(data || []);\n    } catch (err) {\n      const errorObj = err instanceof Error ? err : new Error('Failed to fetch recommendations');\n      setError(errorObj);\n      logger.error('Error fetching recommendations', { error: err, userId: user?.id, type, propertyId, limit });\n      toast({\n        title: \"Erreur\",\n        description: \"Impossible de charger les recommandations\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  }, [user, type, propertyId, limit]);\n\n  const updatePreferences = useCallback(async (preferences: Record<string, unknown>) => {\n    if (!user) return;\n\n    setLoading(true);\n    try {\n      const { data, error: functionError } = await supabase.functions.invoke(\n        'update-preferences',\n        {\n          body: {\n            userId: user.id,\n            preferences,\n          },\n        }\n      );\n\n      if (functionError) throw functionError;\n\n      if (data?.recommendations) {\n        setRecommendations(data.recommendations);\n      }\n\n      toast({\n        title: \"Préférences mises à jour\",\n        description: \"Vos recommandations ont été actualisées\",\n      });\n\n      return data;\n    } catch (err) {\n      logger.error('Error updating preferences', { error: err, userId: user?.id, preferences });\n      toast({\n        title: \"Erreur\",\n        description: \"Impossible de mettre à jour vos préférences\",\n        variant: \"destructive\",\n      });\n      throw err;\n    } finally {\n      setLoading(false);\n    }\n  }, [user]);\n\n  const trackSearch = useCallback(async (searchFilters: any, resultCount: number, clickedProperties?: string[]) => {\n    if (!user) return;\n\n    try {\n      await supabase.functions.invoke('track-search', {\n        body: {\n          userId: user.id,\n          searchFilters,\n          resultCount,\n          clickedProperties,\n        },\n      });\n    } catch (err) {\n      logger.error('Error tracking search', { error: err, userId: user?.id, searchFilters, resultCount });\n      // Silent fail - don't disrupt user experience\n    }\n  }, [user]);\n\n  useEffect(() => {\n    if (autoFetch && user?.id) {\n      const timeoutId = setTimeout(() => {\n        fetchRecommendations();\n      }, 100);\n      \n      return () => clearTimeout(timeoutId);\n    }\n  }, [autoFetch, user?.id]);\n\n  return {\n    recommendations,\n    loading,\n    error,\n    refetch: fetchRecommendations,\n    updatePreferences,\n    trackSearch,\n  };\n};\n","import { Card, CardContent } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { Star, MapPin, Wrench, Home } from 'lucide-react';\nimport { useNavigate } from 'react-router-dom';\nimport { StatusBadge } from '@/components/properties/StatusBadge';\n\ninterface RecommendationCardProps {\n  item: any;\n  type: 'property' | 'tenant';\n  score: number;\n  reasons: string[];\n}\n\nexport const RecommendationCard = ({ item, type, score, reasons }: RecommendationCardProps) => {\n  const navigate = useNavigate();\n\n  const getScoreColor = (score: number) => {\n    if (score >= 80) return 'bg-green-600 text-white';\n    if (score >= 60) return 'bg-yellow-600 text-white';\n    return 'bg-gray-600 text-white';\n  };\n\n  const handleClick = () => {\n    if (type === 'property') {\n      navigate(`/property/${item.data?.id || item.id}`);\n    } else {\n      // For tenants, navigate to application detail or profile\n      navigate(`/applications`);\n    }\n  };\n\n  if (type === 'property') {\n    const property = item.data || item;\n    return (\n      <Card className=\"overflow-hidden hover:shadow-lg transition-shadow cursor-pointer\" onClick={handleClick}>\n        <div className=\"relative h-48\">\n          <img\n            src={property.main_image || property.images?.[0] || '/placeholder.svg'}\n            alt={property.title}\n            className=\"w-full h-full object-cover\"\n          />\n          <div className=\"absolute top-2 right-2 flex flex-col gap-2\">\n            <Badge className={getScoreColor(score)}>\n              <Star className=\"h-3 w-3 mr-1\" />\n              {score}% Match\n            </Badge>\n            {property.work_status && property.work_status !== 'aucun_travail' && (\n              <Badge variant=\"secondary\" className=\"bg-orange-600 hover:bg-orange-700 text-white\">\n                <Wrench className=\"h-3 w-3 mr-1\" />\n                Travaux\n              </Badge>\n            )}\n          </div>\n        </div>\n        <CardContent className=\"p-4\">\n          <div className=\"flex items-start justify-between mb-2\">\n            <h3 className=\"font-semibold text-lg line-clamp-1 flex-1\">{property.title}</h3>\n            {property.status && (\n              <StatusBadge status={property.status} variant=\"compact\" />\n            )}\n          </div>\n          <div className=\"flex items-center text-muted-foreground text-sm mb-2\">\n            <MapPin className=\"h-4 w-4 mr-1\" />\n            {property.city}\n          </div>\n          <div className=\"text-2xl font-bold text-primary mb-3\">\n            {property.monthly_rent?.toLocaleString()} FCFA/mois\n          </div>\n          <div className=\"space-y-1 mb-4\">\n            {reasons.map((reason, idx) => (\n              <div key={idx} className=\"flex items-start text-sm\">\n                <span className=\"text-green-600 mr-2\">✓</span>\n                <span className=\"text-muted-foreground\">{reason}</span>\n              </div>\n            ))}\n          </div>\n          <Button className=\"w-full\" onClick={(e) => { e.stopPropagation(); handleClick(); }}>\n            Voir les détails\n          </Button>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  // Tenant card\n  const profile = item.profile || item.data?.profile;\n  return (\n    <Card className=\"overflow-hidden hover:shadow-lg transition-shadow\">\n      <CardContent className=\"p-4\">\n        <div className=\"flex items-start gap-4 mb-4\">\n          <img\n            src={profile?.avatar_url || '/placeholder.svg'}\n            alt={profile?.full_name}\n            className=\"w-16 h-16 rounded-full object-cover\"\n          />\n          <div className=\"flex-1\">\n            <h3 className=\"font-semibold text-lg\">{profile?.full_name}</h3>\n            <Badge className={`${getScoreColor(score)} mt-1`}>\n              <Star className=\"h-3 w-3 mr-1\" />\n              {score}% Match\n            </Badge>\n          </div>\n        </div>\n        <div className=\"space-y-1 mb-4\">\n          {reasons.map((reason, idx) => (\n            <div key={idx} className=\"flex items-start text-sm\">\n              <span className=\"text-green-600 mr-2\">✓</span>\n              <span className=\"text-muted-foreground\">{reason}</span>\n            </div>\n          ))}\n        </div>\n        <Button className=\"w-full\" variant=\"outline\">\n          Voir le profil\n        </Button>\n      </CardContent>\n    </Card>\n  );\n};\n","import * as React from \"react\";\nimport useEmblaCarousel, { type UseEmblaCarouselType } from \"embla-carousel-react\";\nimport { ArrowLeft, ArrowRight } from \"lucide-react\";\n\nimport { cn } from \"@/lib/utils\";\nimport { Button } from \"@/components/ui/button\";\n\ntype CarouselApi = UseEmblaCarouselType[1];\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>;\ntype CarouselOptions = UseCarouselParameters[0];\ntype CarouselPlugin = UseCarouselParameters[1];\n\ntype CarouselProps = {\n  opts?: CarouselOptions;\n  plugins?: CarouselPlugin;\n  orientation?: \"horizontal\" | \"vertical\";\n  setApi?: (api: CarouselApi) => void;\n};\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0];\n  api: ReturnType<typeof useEmblaCarousel>[1];\n  scrollPrev: () => void;\n  scrollNext: () => void;\n  canScrollPrev: boolean;\n  canScrollNext: boolean;\n} & CarouselProps;\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null);\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext);\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\");\n  }\n\n  return context;\n}\n\nconst Carousel = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement> & CarouselProps>(\n  ({ orientation = \"horizontal\", opts, setApi, plugins, className, children, ...props }, ref) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins,\n    );\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false);\n    const [canScrollNext, setCanScrollNext] = React.useState(false);\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return;\n      }\n\n      setCanScrollPrev(api.canScrollPrev());\n      setCanScrollNext(api.canScrollNext());\n    }, []);\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev();\n    }, [api]);\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext();\n    }, [api]);\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault();\n          scrollPrev();\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault();\n          scrollNext();\n        }\n      },\n      [scrollPrev, scrollNext],\n    );\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return;\n      }\n\n      setApi(api);\n    }, [api, setApi]);\n\n    React.useEffect(() => {\n      if (!api) {\n        return;\n      }\n\n      onSelect(api);\n      api.on(\"reInit\", onSelect);\n      api.on(\"select\", onSelect);\n\n      return () => {\n        api?.off(\"select\", onSelect);\n      };\n    }, [api, onSelect]);\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation: orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    );\n  },\n);\nCarousel.displayName = \"Carousel\";\n\nconst CarouselContent = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(\n  ({ className, ...props }, ref) => {\n    const { carouselRef, orientation } = useCarousel();\n\n    return (\n      <div ref={carouselRef} className=\"overflow-hidden\">\n        <div\n          ref={ref}\n          className={cn(\"flex\", orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\", className)}\n          {...props}\n        />\n      </div>\n    );\n  },\n);\nCarouselContent.displayName = \"CarouselContent\";\n\nconst CarouselItem = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(\n  ({ className, ...props }, ref) => {\n    const { orientation } = useCarousel();\n\n    return (\n      <div\n        ref={ref}\n        role=\"group\"\n        aria-roledescription=\"slide\"\n        className={cn(\"min-w-0 shrink-0 grow-0 basis-full\", orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\", className)}\n        {...props}\n      />\n    );\n  },\n);\nCarouselItem.displayName = \"CarouselItem\";\n\nconst CarouselPrevious = React.forwardRef<HTMLButtonElement, React.ComponentProps<typeof Button>>(\n  ({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n    const { orientation, scrollPrev, canScrollPrev } = useCarousel();\n\n    return (\n      <Button\n        ref={ref}\n        variant={variant}\n        size={size}\n        className={cn(\n          \"absolute h-8 w-8 rounded-full\",\n          orientation === \"horizontal\"\n            ? \"-left-12 top-1/2 -translate-y-1/2\"\n            : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n          className,\n        )}\n        disabled={!canScrollPrev}\n        onClick={scrollPrev}\n        {...props}\n      >\n        <ArrowLeft className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Previous slide</span>\n      </Button>\n    );\n  },\n);\nCarouselPrevious.displayName = \"CarouselPrevious\";\n\nconst CarouselNext = React.forwardRef<HTMLButtonElement, React.ComponentProps<typeof Button>>(\n  ({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n    const { orientation, scrollNext, canScrollNext } = useCarousel();\n\n    return (\n      <Button\n        ref={ref}\n        variant={variant}\n        size={size}\n        className={cn(\n          \"absolute h-8 w-8 rounded-full\",\n          orientation === \"horizontal\"\n            ? \"-right-12 top-1/2 -translate-y-1/2\"\n            : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n          className,\n        )}\n        disabled={!canScrollNext}\n        onClick={scrollNext}\n        {...props}\n      >\n        <ArrowRight className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Next slide</span>\n      </Button>\n    );\n  },\n);\nCarouselNext.displayName = \"CarouselNext\";\n\nexport { type CarouselApi, Carousel, CarouselContent, CarouselItem, CarouselPrevious, CarouselNext };\n","import { useRecommendations } from '@/hooks/useRecommendations';\nimport { RecommendationCard } from './RecommendationCard';\nimport { Button } from '@/components/ui/button';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { RefreshCw } from 'lucide-react';\nimport { Carousel, CarouselContent, CarouselItem, CarouselNext, CarouselPrevious } from '@/components/ui/carousel';\n\ninterface RecommendationsSectionProps {\n  userId: string;\n  type: 'properties' | 'tenants';\n  propertyId?: string;\n  limit?: number;\n  title?: string;\n}\n\nexport const RecommendationsSection = ({\n  userId,\n  type,\n  propertyId,\n  limit = 5,\n  title,\n}: RecommendationsSectionProps) => {\n  const { recommendations, loading, refetch } = useRecommendations({\n    type,\n    propertyId,\n    limit,\n  });\n\n  if (loading) {\n    return (\n      <div className=\"space-y-4\">\n        <div className=\"flex items-center justify-between\">\n          <Skeleton className=\"h-8 w-64\" />\n          <Skeleton className=\"h-10 w-32\" />\n        </div>\n        <div className=\"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4\">\n          {[...Array(limit)].map((_, i) => (\n            <Skeleton key={i} className=\"h-96\" />\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  if (!recommendations.length) {\n    return null;\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex items-center justify-between\">\n        <h2 className=\"text-2xl font-bold\">\n          {title || (type === 'properties' ? '🎯 Recommandations pour vous' : '⭐ Locataires recommandés')}\n        </h2>\n        <Button\n          variant=\"outline\"\n          onClick={refetch}\n          disabled={loading}\n        >\n          <RefreshCw className={`h-4 w-4 mr-2 ${loading ? 'animate-spin' : ''}`} />\n          Actualiser\n        </Button>\n      </div>\n\n      <Carousel\n        opts={{\n          align: \"start\",\n          loop: false,\n          watchDrag: true,\n          skipSnaps: false,\n        }}\n        plugins={[]}\n        className=\"w-full\"\n      >\n        <CarouselContent className=\"-ml-4\">\n          {recommendations.map((rec) => (\n            <CarouselItem key={rec.id} className=\"pl-4 md:basis-1/2 lg:basis-1/3\">\n              <RecommendationCard\n                item={rec}\n                type={type === 'properties' ? 'property' : 'tenant'}\n                score={rec.score}\n                reasons={rec.reasons}\n              />\n            </CarouselItem>\n          ))}\n        </CarouselContent>\n        <CarouselPrevious className=\"hidden md:flex\" />\n        <CarouselNext className=\"hidden md:flex\" />\n      </Carousel>\n    </div>\n  );\n};\n","import { useAuth } from './useAuth';\nimport { ERROR_MESSAGES } from '@/constants';\nimport { useAgencyMandates } from './useAgencyMandates';\n\n/**\n * Hook for managing property-related permissions\n * Centralizes user type and ownership verification logic\n * Includes agency mandate management\n */\nexport const usePropertyPermissions = () => {\n  const { user, profile, roles } = useAuth();\n  const { activeMandates, asAgency } = useAgencyMandates();\n\n  /**\n   * Check if user can manage properties (create, edit, delete)\n   * Only 'proprietaire' and 'agence' can manage properties\n   */\n  const canManageProperties = (): boolean => {\n    if (!user || !profile) return false;\n    return profile.user_type === 'proprietaire' || profile.user_type === 'agence';\n  };\n\n  /**\n   * Check if user can edit a specific property\n   * User must be the owner OR an agency with an active mandate\n   */\n  const canEditProperty = (ownerId: string, propertyId?: string): boolean => {\n    if (!user || !profile) return false;\n    \n    // Propriétaire du bien\n    if (user.id === ownerId) return true;\n    \n    // Agence avec mandat actif\n    if (profile.user_type === 'agence') {\n      const hasMandate = asAgency.some(mandate => \n        mandate.status === 'active' &&\n        (mandate.property_id === propertyId || mandate.property_id === null) &&\n        mandate.owner_id === ownerId &&\n        mandate.permissions.can_edit_properties === true\n      );\n      return hasMandate;\n    }\n    \n    return false;\n  };\n\n  /**\n   * Vérifier si une agence a une permission spécifique pour un bien\n   */\n  const hasAgencyPermission = (\n    propertyId: string, \n    ownerId: string, \n    permission: keyof typeof activeMandates[0]['permissions']\n  ): boolean => {\n    if (!user || profile?.user_type !== 'agence') return false;\n    \n    const mandate = asAgency.find(m => \n      m.status === 'active' &&\n      (m.property_id === propertyId || m.property_id === null) &&\n      m.owner_id === ownerId\n    );\n    \n    return mandate?.permissions[permission] === true;\n  };\n\n  /**\n   * Require owner access - throws error if user doesn't have permission\n   * Used to protect pages/routes that require owner access\n   */\n  const requireOwnerAccess = (): { hasAccess: boolean; error?: string } => {\n    if (!user) {\n      return { hasAccess: false, error: ERROR_MESSAGES.AUTH_REQUIRED };\n    }\n    \n    if (!profile) {\n      return { hasAccess: false, error: ERROR_MESSAGES.SERVER_ERROR };\n    }\n    \n    if (!canManageProperties()) {\n      return { \n        hasAccess: false, \n        error: ERROR_MESSAGES.UNAUTHORIZED \n      };\n    }\n    \n    return { hasAccess: true };\n  };\n\n  return {\n    canManageProperties: canManageProperties(),\n    canEditProperty,\n    hasAgencyPermission,\n    requireOwnerAccess,\n    activeMandates,\n    asAgency,\n    user,\n    profile,\n  };\n};\n","import { useState, useEffect } from 'react';\nimport { supabase } from '@/lib/supabase';\nimport { logger } from '@/services/logger';\n\n/**\n * Hook pour récupérer le numéro de téléphone d'un utilisateur de manière sécurisée.\n * \n * Le numéro de téléphone est protégé et n'est accessible que dans les cas légitimes :\n * - L'utilisateur demande son propre téléphone\n * - Propriétaire voit le téléphone de ses candidats\n * - Candidat voit le téléphone du propriétaire qu'il a contacté\n * - Parties d'un bail actif\n * - Administrateurs\n * \n * @param userId - ID de l'utilisateur dont on veut récupérer le téléphone\n * @returns { phone, loading } - Le numéro de téléphone (ou null) et l'état de chargement\n */\nexport const useUserPhone = (userId: string | null) => {\n  const [phone, setPhone] = useState<string | null>(null);\n  const [loading, setLoading] = useState(false);\n\n  useEffect(() => {\n    if (!userId) {\n      setPhone(null);\n      return;\n    }\n\n    const fetchPhone = async () => {\n      setLoading(true);\n      try {\n        const { data, error } = await supabase.rpc('get_user_phone', {\n          target_user_id: userId\n        });\n        \n        if (error) {\n          logger.error('Error fetching user phone', { error, userId });\n          setPhone(null);\n        } else {\n          setPhone(data);\n        }\n      } catch (error) {\n        logger.error('Exception fetching user phone', { error, userId });\n        setPhone(null);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchPhone();\n  }, [userId]);\n\n  return { phone, loading };\n};\n","import { useUserPhone } from '@/hooks/useUserPhone';\n\ninterface ApplicantPhoneDisplayProps {\n  applicantId: string;\n}\n\n/**\n * Composant pour afficher le numéro de téléphone d'un candidat de manière sécurisée.\n * Utilise le hook useUserPhone qui vérifie les permissions d'accès via RPC.\n */\nexport const ApplicantPhoneDisplay = ({ applicantId }: ApplicantPhoneDisplayProps) => {\n  const { phone, loading } = useUserPhone(applicantId);\n\n  if (loading) {\n    return (\n      <p className=\"text-sm text-muted-foreground mb-2\">\n        📞 Chargement...\n      </p>\n    );\n  }\n\n  if (!phone) {\n    return null;\n  }\n\n  return (\n    <p className=\"text-sm text-muted-foreground mb-2\">\n      📞 {phone}\n    </p>\n  );\n};\n","import { useState, useEffect } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { supabase } from '@/lib/supabase';\nimport { useAuth } from '@/hooks/useAuth';\nimport { useRecommendations } from '@/hooks/useRecommendations';\nimport { usePropertyPermissions } from '@/hooks/usePropertyPermissions';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { Info } from 'lucide-react';\nimport Navbar from '@/components/Navbar';\nimport Footer from '@/components/Footer';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Avatar, AvatarFallback } from '@/components/ui/avatar';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { toast } from '@/hooks/use-toast';\nimport { \n  ArrowLeft, CheckCircle2, XCircle, Clock, UserCircle, \n  FileText, TrendingUp, Eye, Award, Sparkles\n} from 'lucide-react';\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from '@/components/ui/dialog';\nimport { Textarea } from '@/components/ui/textarea';\nimport { ApplicantPhoneDisplay } from '@/components/application/ApplicantPhoneDisplay';\nimport { logger } from '@/services/logger';\nimport { DynamicBreadcrumb } from '@/components/navigation/DynamicBreadcrumb';\n\ntype Application = {\n  id: string;\n  property_id: string;\n  applicant_id: string;\n  status: string;\n  cover_letter: string;\n  documents: any;\n  created_at: string;\n  application_score: number;\n  recommendation_score?: number;\n  recommendation_reasons?: string[];\n  profiles: {\n    full_name: string;\n    phone: string | null;\n    oneci_verified: boolean;\n    cnam_verified: boolean;\n    face_verified: boolean;\n    avatar_url: string | null;\n  };\n};\n\ntype Property = {\n  id: string;\n  title: string;\n  city: string;\n  monthly_rent: number;\n  owner_id: string;\n};\n\nconst PropertyApplications = () => {\n  const { propertyId } = useParams();\n  const { user } = useAuth();\n  const navigate = useNavigate();\n  const { hasAgencyPermission, activeMandates } = usePropertyPermissions();\n  \n  const [property, setProperty] = useState<Property | null>(null);\n  const [applications, setApplications] = useState<Application[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [rejectDialogOpen, setRejectDialogOpen] = useState(false);\n  const [selectedApplication, setSelectedApplication] = useState<Application | null>(null);\n  const [rejectionNote, setRejectionNote] = useState('');\n  const [sortBy, setSortBy] = useState<'date' | 'score'>('score');\n  const [filterMatch, setFilterMatch] = useState<'all' | 'high' | 'good'>('all');\n  const [isAgencyView, setIsAgencyView] = useState(false);\n  const [canManageApps, setCanManageApps] = useState(false);\n\n  const { recommendations, loading: recsLoading } = useRecommendations({\n    type: 'tenants',\n    propertyId: propertyId || undefined,\n    autoFetch: true,\n  });\n\n  useEffect(() => {\n    if (propertyId) {\n      fetchData();\n    }\n  }, [propertyId]);\n\n  const fetchData = async () => {\n    try {\n      const { data: propertyData, error: propError } = await supabase\n        .from('properties')\n        .select('id, title, city, monthly_rent, owner_id')\n        .eq('id', propertyId)\n        .single();\n\n      if (propError) throw propError;\n      \n      // Check if user is owner or has agency permissions\n      const isOwner = propertyData.owner_id === user?.id;\n      const hasViewPerm = hasAgencyPermission(propertyId, propertyData.owner_id, 'can_view_applications');\n      const hasManagePerm = hasAgencyPermission(propertyId, propertyData.owner_id, 'can_manage_applications');\n      \n      if (!isOwner && !hasViewPerm) {\n        toast({\n          title: 'Accès refusé',\n          description: 'Vous n\\'avez pas accès aux candidatures de ce bien',\n          variant: 'destructive',\n        });\n        navigate('/');\n        return;\n      }\n\n      setIsAgencyView(!isOwner && hasViewPerm);\n      setCanManageApps(isOwner || hasManagePerm);\n\n      setProperty(propertyData);\n\n      const { data: applicationsData, error: appError } = await supabase\n        .from('rental_applications')\n        .select(`\n          *,\n          profiles (\n            full_name,\n            phone,\n            oneci_verified,\n            cnam_verified,\n            face_verified,\n            avatar_url\n          )\n        `)\n        .eq('property_id', propertyId)\n        .order('created_at', { ascending: false });\n\n      if (appError) throw appError;\n\n      // Merge applications with recommendation scores\n      const enrichedApplications = (applicationsData as any || []).map((app: Application) => {\n        const rec = recommendations.find(r => r.id === app.applicant_id);\n        return {\n          ...app,\n          recommendation_score: rec?.score || 0,\n          recommendation_reasons: rec?.reasons || [],\n        };\n      });\n\n      setApplications(enrichedApplications);\n    } catch (error) {\n      logger.logError(error, { context: 'PropertyApplications', action: 'fetchData', propertyId });\n      toast({\n        title: 'Erreur',\n        description: 'Impossible de charger les données',\n        variant: 'destructive',\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const updateApplicationStatus = async (applicationId: string, status: string, note?: string) => {\n    try {\n      const { error } = await supabase\n        .from('rental_applications')\n        .update({ \n          status,\n          reviewed_at: new Date().toISOString()\n        })\n        .eq('id', applicationId);\n\n      if (error) throw error;\n\n      const application = applications.find(app => app.id === applicationId);\n      if (application) {\n        await supabase.from('notifications').insert({\n          user_id: application.applicant_id,\n          type: status === 'approved' ? 'application_approved' : 'application_rejected',\n          title: status === 'approved' ? 'Candidature approuvée !' : 'Candidature rejetée',\n          message: status === 'approved' \n            ? `Votre candidature pour \"${property?.title}\" a été approuvée !`\n            : `Votre candidature pour \"${property?.title}\" a été rejetée. ${note || ''}`,\n          link: '/candidatures',\n        });\n      }\n\n      toast({\n        title: 'Mise à jour effectuée',\n        description: `Candidature ${status === 'approved' ? 'approuvée' : 'rejetée'}`,\n      });\n\n      fetchData();\n      setRejectDialogOpen(false);\n      setRejectionNote('');\n      setSelectedApplication(null);\n    } catch (error: any) {\n      logger.logError(error, { context: 'PropertyApplications', action: 'updateApplication', applicationId });\n      toast({\n        title: 'Erreur',\n        description: error.message,\n        variant: 'destructive',\n      });\n    }\n  };\n\n  const handleReject = (application: Application) => {\n    setSelectedApplication(application);\n    setRejectDialogOpen(true);\n  };\n\n  const getStatusBadge = (status: string) => {\n    const variants: Record<string, 'default' | 'secondary' | 'destructive' | 'outline'> = {\n      'pending': 'outline',\n      'approved': 'default',\n      'rejected': 'destructive',\n    };\n\n    const labels: Record<string, string> = {\n      'pending': 'En attente',\n      'approved': 'Approuvée',\n      'rejected': 'Rejetée',\n    };\n\n    return <Badge variant={variants[status]}>{labels[status]}</Badge>;\n  };\n\n  const getScoreBadge = (score: number) => {\n    if (score >= 70) return <Badge className=\"bg-green-500 text-white\">Excellent</Badge>;\n    if (score >= 50) return <Badge variant=\"secondary\">Bon</Badge>;\n    return <Badge variant=\"destructive\">Faible</Badge>;\n  };\n\n  const getMatchBadge = (score: number) => {\n    if (score >= 80) {\n      return (\n        <Badge className=\"bg-gradient-to-r from-yellow-400 to-orange-500 text-white gap-1\">\n          <Sparkles className=\"h-3 w-3\" />\n          Highly Recommended\n        </Badge>\n      );\n    }\n    if (score >= 60) {\n      return (\n        <Badge variant=\"secondary\" className=\"gap-1\">\n          <CheckCircle2 className=\"h-3 w-3\" />\n          Good Match\n        </Badge>\n      );\n    }\n    return null;\n  };\n\n  // Sort and filter applications\n  const processedApps = [...applications]\n    .filter(app => {\n      if (filterMatch === 'all') return true;\n      if (filterMatch === 'high') return (app.recommendation_score || 0) >= 80;\n      if (filterMatch === 'good') return (app.recommendation_score || 0) >= 60;\n      return true;\n    })\n    .sort((a, b) => {\n      if (sortBy === 'score') {\n        return (b.recommendation_score || 0) - (a.recommendation_score || 0);\n      }\n      return new Date(b.created_at).getTime() - new Date(a.created_at).getTime();\n    });\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary\"></div>\n      </div>\n    );\n  }\n\n  if (!property) {\n    return <div>Bien non trouvé</div>;\n  }\n\n  const pendingApps = processedApps.filter(app => app.status === 'pending');\n  const approvedApps = processedApps.filter(app => app.status === 'approved');\n  const rejectedApps = processedApps.filter(app => app.status === 'rejected');\n\n  return (\n    <div className=\"min-h-screen flex flex-col\">\n      <Navbar />\n      \n      <main className=\"flex-1 container mx-auto px-4 py-8 pt-24 max-w-7xl\">\n        <DynamicBreadcrumb />\n        <div className=\"mb-8\">\n          {isAgencyView && (\n            <Alert className=\"mb-4\">\n              <Info className=\"h-4 w-4\" />\n              <AlertDescription>\n                <strong>Vue Agence</strong> - Vous consultez les candidatures pour le compte du propriétaire.\n                {canManageApps ? ' Vous pouvez gérer ces candidatures.' : ' Accès en lecture seule.'}\n              </AlertDescription>\n            </Alert>\n          )}\n          \n          <Button\n            variant=\"ghost\" \n            onClick={() => navigate(`/property/${propertyId}`)}\n            className=\"mb-4 -ml-2\"\n          >\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\n            Retour au bien\n          </Button>\n          <h1 className=\"text-4xl font-bold mb-3 flex items-center gap-3\">\n            <UserCircle className=\"h-8 w-8 text-primary\" />\n            Candidatures\n          </h1>\n          <div className=\"flex flex-col sm:flex-row sm:items-center gap-2\">\n            <p className=\"text-lg text-muted-foreground\">{property.title}</p>\n            <span className=\"text-muted-foreground hidden sm:inline\">•</span>\n            <p className=\"text-lg text-muted-foreground\">{property.city}</p>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8\">\n          <Card className=\"border-2\">\n            <CardHeader className=\"pb-3\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground\">Total</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"flex items-center gap-3\">\n                <FileText className=\"h-8 w-8 text-primary\" />\n                <span className=\"text-3xl font-bold\">{applications.length}</span>\n              </div>\n            </CardContent>\n          </Card>\n          <Card className=\"border-2\">\n            <CardHeader className=\"pb-3\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground\">En attente</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"flex items-center gap-3\">\n                <Clock className=\"h-8 w-8 text-orange-500\" />\n                <span className=\"text-3xl font-bold\">{pendingApps.length}</span>\n              </div>\n            </CardContent>\n          </Card>\n          <Card className=\"border-2\">\n            <CardHeader className=\"pb-3\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground\">Approuvées</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"flex items-center gap-3\">\n                <CheckCircle2 className=\"h-8 w-8 text-green-500\" />\n                <span className=\"text-3xl font-bold\">{approvedApps.length}</span>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Filters and Sort */}\n        <Card className=\"mb-6\">\n          <CardContent className=\"pt-6\">\n            <div className=\"flex flex-col sm:flex-row gap-4\">\n              <div className=\"flex-1\">\n                <label className=\"text-sm font-medium mb-2 block\">Trier par</label>\n                <Select value={sortBy} onValueChange={(v: 'date' | 'score') => setSortBy(v)}>\n                  <SelectTrigger>\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"score\">Score de compatibilité</SelectItem>\n                    <SelectItem value=\"date\">Date de candidature</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <div className=\"flex-1\">\n                <label className=\"text-sm font-medium mb-2 block\">Filtrer par matching</label>\n                <Select value={filterMatch} onValueChange={(v: 'all' | 'high' | 'good') => setFilterMatch(v)}>\n                  <SelectTrigger>\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\">Tous les candidats</SelectItem>\n                    <SelectItem value=\"high\">Highly Recommended (80%+)</SelectItem>\n                    <SelectItem value=\"good\">Good Match (60%+)</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Tabs defaultValue=\"all\" className=\"w-full\">\n          <TabsList className=\"mb-6\">\n            <TabsTrigger value=\"all\">Toutes ({processedApps.length})</TabsTrigger>\n            <TabsTrigger value=\"pending\">En attente ({pendingApps.length})</TabsTrigger>\n            <TabsTrigger value=\"approved\">Approuvées ({approvedApps.length})</TabsTrigger>\n            <TabsTrigger value=\"rejected\">Rejetées ({rejectedApps.length})</TabsTrigger>\n          </TabsList>\n\n          {[\n            { value: 'all', apps: applications },\n            { value: 'pending', apps: pendingApps },\n            { value: 'approved', apps: approvedApps },\n            { value: 'rejected', apps: rejectedApps },\n          ].map(({ value, apps }) => (\n            <TabsContent key={value} value={value} className=\"space-y-4\">\n              {apps.length === 0 ? (\n                <Card className=\"p-12 text-center border-2\">\n                  <FileText className=\"h-16 w-16 mx-auto text-muted-foreground mb-4 opacity-50\" />\n                  <p className=\"text-muted-foreground text-lg\">Aucune candidature</p>\n                </Card>\n              ) : (\n                apps.map((application) => (\n                  <Card key={application.id} className=\"border-2 hover:shadow-lg transition-shadow\">\n                    <CardContent className=\"pt-6\">\n                      <div className=\"grid md:grid-cols-[1fr,auto] gap-6\">\n                        <div className=\"space-y-4\">\n                          <div className=\"flex items-start gap-4\">\n                            <Avatar className=\"h-14 w-14\">\n                              <AvatarFallback className=\"bg-primary/10 text-primary text-lg font-semibold\">\n                                {application.profiles.full_name.charAt(0).toUpperCase()}\n                              </AvatarFallback>\n                            </Avatar>\n                            <div className=\"flex-1\">\n                              <div className=\"flex items-center gap-3 mb-2 flex-wrap\">\n                                <h3 className=\"text-xl font-semibold\">\n                                  {application.profiles.full_name}\n                                </h3>\n                                {getStatusBadge(application.status)}\n                                {application.recommendation_score && getMatchBadge(application.recommendation_score)}\n                              </div>\n                              <ApplicantPhoneDisplay applicantId={application.applicant_id} />\n                              <p className=\"text-sm text-muted-foreground\">\n                                Candidature du {new Date(application.created_at).toLocaleDateString('fr-FR')}\n                              </p>\n                            </div>\n                          </div>\n\n                          <div className=\"flex flex-wrap gap-2\">\n                            {application.profiles.oneci_verified && (\n                              <Badge variant=\"outline\" className=\"rounded-full\">\n                                <CheckCircle2 className=\"h-3 w-3 mr-1 text-green-600\" />\n                                ONECI\n                              </Badge>\n                            )}\n                            {application.profiles.cnam_verified && (\n                              <Badge variant=\"outline\" className=\"rounded-full\">\n                                <CheckCircle2 className=\"h-3 w-3 mr-1 text-green-600\" />\n                                CNAM\n                              </Badge>\n                            )}\n                            {application.profiles.face_verified && (\n                              <Badge variant=\"outline\" className=\"rounded-full\">\n                                <CheckCircle2 className=\"h-3 w-3 mr-1 text-green-600\" />\n                                Visage\n                              </Badge>\n                            )}\n                          </div>\n\n                          <div className=\"space-y-2\">\n                            {application.application_score > 0 && (\n                              <div className=\"flex items-center gap-3 p-3 bg-muted/50 rounded-xl\">\n                                <TrendingUp className=\"h-5 w-5 text-primary\" />\n                                <span className=\"text-sm font-medium\">Score locataire:</span>\n                                <Badge variant=\"default\" className=\"rounded-xl\">\n                                  {application.application_score}/100\n                                </Badge>\n                                {getScoreBadge(application.application_score)}\n                              </div>\n                            )}\n\n                            {application.recommendation_score && application.recommendation_score > 0 && (\n                              <div className=\"flex items-center gap-3 p-3 bg-primary/5 rounded-xl border border-primary/20\">\n                                <Award className=\"h-5 w-5 text-primary\" />\n                                <span className=\"text-sm font-medium\">Compatibilité:</span>\n                                <Badge variant=\"default\" className=\"rounded-xl bg-primary\">\n                                  {Math.round(application.recommendation_score)}%\n                                </Badge>\n                              </div>\n                            )}\n\n                            {application.recommendation_reasons && application.recommendation_reasons.length > 0 && (\n                              <div className=\"p-3 bg-primary/5 rounded-xl border border-primary/10\">\n                                <p className=\"text-xs font-medium text-primary mb-2\">POURQUOI CE CANDIDAT ?</p>\n                                <ul className=\"text-sm space-y-1\">\n                                  {application.recommendation_reasons.map((reason, idx) => (\n                                    <li key={idx} className=\"flex items-start gap-2\">\n                                      <CheckCircle2 className=\"h-3 w-3 text-primary mt-0.5 flex-shrink-0\" />\n                                      <span>{reason}</span>\n                                    </li>\n                                  ))}\n                                </ul>\n                              </div>\n                            )}\n                          </div>\n\n                          {application.cover_letter && (\n                            <div className=\"p-4 bg-muted/30 rounded-xl\">\n                              <p className=\"text-xs font-medium text-muted-foreground mb-2\">\n                                LETTRE DE MOTIVATION\n                              </p>\n                              <p className=\"text-sm line-clamp-3\">\n                                {application.cover_letter}\n                              </p>\n                            </div>\n                          )}\n                        </div>\n\n                        <div className=\"flex flex-col gap-3 md:min-w-[200px]\">\n                          <Button\n                            variant=\"outline\"\n                            onClick={() => navigate(`/candidatures?view=${application.id}`)}\n                            className=\"rounded-xl h-11\"\n                          >\n                            <Eye className=\"h-4 w-4 mr-2\" />\n                            Voir détails\n                          </Button>\n                          \n                          {application.status === 'pending' && canManageApps && (\n                            <>\n                              <Button\n                                onClick={() => updateApplicationStatus(application.id, 'approved')}\n                                className=\"rounded-xl h-11 bg-green-600 hover:bg-green-700\"\n                              >\n                                <CheckCircle2 className=\"h-4 w-4 mr-2\" />\n                                Approuver\n                              </Button>\n                              <Button\n                                variant=\"destructive\"\n                                onClick={() => handleReject(application)}\n                                className=\"rounded-xl h-11\"\n                              >\n                                <XCircle className=\"h-4 w-4 mr-2\" />\n                                Rejeter\n                              </Button>\n                            </>\n                          )}\n\n                          {application.status === 'approved' && (\n                            <Button\n                              variant=\"outline\"\n                              onClick={async () => {\n                                try {\n                                  const startDate = new Date();\n                                  const endDate = new Date();\n                                  endDate.setFullYear(endDate.getFullYear() + 1);\n\n                                  const { error } = await supabase.from('leases').insert({\n                                    property_id: application.property_id,\n                                    landlord_id: property.owner_id,\n                                    tenant_id: application.applicant_id,\n                                    monthly_rent: property.monthly_rent,\n                                    lease_type: 'location_meublee',\n                                    start_date: startDate.toISOString().split('T')[0],\n                                    end_date: endDate.toISOString().split('T')[0],\n                                    status: 'draft',\n                                  });\n\n                                  if (error) throw error;\n\n                                  toast({\n                                    title: 'Bail créé',\n                                    description: 'Le bail a été créé avec succès',\n                                  });\n\n                                  navigate('/baux');\n                                } catch (error: any) {\n                                  toast({\n                                    title: 'Erreur',\n                                    description: error.message,\n                                    variant: 'destructive',\n                                  });\n                                }\n                              }}\n                              className=\"rounded-xl h-11\"\n                            >\n                              📄 Créer le bail\n                            </Button>\n                          )}\n                        </div>\n                      </div>\n                    </CardContent>\n                  </Card>\n                ))\n              )}\n            </TabsContent>\n          ))}\n        </Tabs>\n      </main>\n\n      <Dialog open={rejectDialogOpen} onOpenChange={setRejectDialogOpen}>\n        <DialogContent className=\"rounded-xl\">\n          <DialogHeader>\n            <DialogTitle>Rejeter la candidature</DialogTitle>\n            <DialogDescription>\n              Vous pouvez ajouter une note pour expliquer le rejet au candidat (optionnel).\n            </DialogDescription>\n          </DialogHeader>\n          <Textarea\n            placeholder=\"Raison du rejet (optionnel)...\"\n            value={rejectionNote}\n            onChange={(e) => setRejectionNote(e.target.value)}\n            className=\"min-h-[120px] rounded-xl\"\n          />\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setRejectDialogOpen(false)} className=\"rounded-xl\">\n              Annuler\n            </Button>\n            <Button\n              variant=\"destructive\"\n              onClick={() => selectedApplication && updateApplicationStatus(selectedApplication.id, 'rejected', rejectionNote)}\n              className=\"rounded-xl\"\n            >\n              Confirmer le rejet\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      <Footer />\n    </div>\n  );\n};\n\nexport default PropertyApplications;\n","import confetti from 'canvas-confetti';\n\n/**\n * Confetti pour certification ANSUT réussie\n * Couleurs: Or, Orange (couleurs ANSUT)\n */\nexport const celebrateCertification = () => {\n  const duration = 3000;\n  const animationEnd = Date.now() + duration;\n  const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 9999 };\n\n  const randomInRange = (min: number, max: number) => {\n    return Math.random() * (max - min) + min;\n  };\n\n  const interval = setInterval(() => {\n    const timeLeft = animationEnd - Date.now();\n\n    if (timeLeft <= 0) {\n      return clearInterval(interval);\n    }\n\n    const particleCount = 50 * (timeLeft / duration);\n\n    // Confetti doré et orange (couleurs ANSUT)\n    confetti({\n      ...defaults,\n      particleCount,\n      origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 },\n      colors: ['#FFD700', '#FF8F00', '#FFA500', '#FFB700'],\n    });\n    confetti({\n      ...defaults,\n      particleCount,\n      origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 },\n      colors: ['#FFD700', '#FF8F00', '#FFA500', '#FFB700'],\n    });\n  }, 250);\n};\n\n/**\n * Confetti pour première candidature envoyée\n * Couleurs: Bleu primaire, Violet\n */\nexport const celebrateFirstApplication = () => {\n  confetti({\n    particleCount: 100,\n    spread: 70,\n    origin: { y: 0.6 },\n    colors: ['#2563eb', '#7c3aed', '#3b82f6', '#8b5cf6'],\n    zIndex: 9999,\n  });\n};\n\n/**\n * Confetti pour bail signé électroniquement\n * Couleurs: Vert succès, Animation spectaculaire\n */\nexport const celebrateLeaseSigned = () => {\n  const count = 200;\n  const defaults = {\n    origin: { y: 0.7 },\n    zIndex: 9999,\n  };\n\n  const fire = (particleRatio: number, opts: confetti.Options) => {\n    confetti({\n      ...defaults,\n      ...opts,\n      particleCount: Math.floor(count * particleRatio),\n      colors: ['#22c55e', '#16a34a', '#4ade80', '#86efac'],\n    });\n  };\n\n  fire(0.25, {\n    spread: 26,\n    startVelocity: 55,\n  });\n  fire(0.2, {\n    spread: 60,\n  });\n  fire(0.35, {\n    spread: 100,\n    decay: 0.91,\n    scalar: 0.8,\n  });\n  fire(0.1, {\n    spread: 120,\n    startVelocity: 25,\n    decay: 0.92,\n    scalar: 1.2,\n  });\n  fire(0.1, {\n    spread: 120,\n    startVelocity: 45,\n  });\n};\n","import { useState, useRef, useCallback, useEffect } from 'react';\nimport { useAuth } from '@/hooks/useAuth';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { Label } from '@/components/ui/label';\nimport { toast } from 'sonner';\nimport { logger } from '@/services/logger';\nimport { supabase } from '@/lib/supabase';\nimport { celebrateCertification } from '@/utils/confetti';\nimport { Camera, Upload, CheckCircle, XCircle, AlertCircle, Shield, RefreshCw } from 'lucide-react';\n\n// Configuration\nconst MAX_IMAGE_SIZE = 5 * 1024 * 1024; // 5MB\nconst ACCEPTED_IMAGE_TYPES = ['image/jpeg', 'image/png', 'image/jpg'];\nconst IMAGE_QUALITY = 0.85;\nconst MAX_IMAGE_DIMENSION = 1920;\n\n// Simple progress bar component\nconst SimpleProgress = ({ value, className }: { value: number; className?: string }) => (\n  <div className={`relative h-2 w-full overflow-hidden rounded-full bg-secondary ${className}`}>\n    <div \n      className=\"h-full bg-primary transition-all duration-300 ease-in-out\"\n      style={{ width: `${Math.min(100, Math.max(0, value))}%` }}\n      role=\"progressbar\"\n      aria-valuenow={value}\n      aria-valuemin={0}\n      aria-valuemax={100}\n    />\n  </div>\n);\n\n// Fonction utilitaire pour compresser une image\nconst compressImage = async (\n  base64: string,\n  maxWidth: number = MAX_IMAGE_DIMENSION,\n  quality: number = IMAGE_QUALITY\n): Promise<string> => {\n  logger.debug('Compression image démarrée');\n  return new Promise((resolve, reject) => {\n    const img = new Image();\n    img.onload = () => {\n      const canvas = document.createElement('canvas');\n      let { width, height } = img;\n\n      logger.debug('Dimensions originales image', { width, height });\n\n      // Calculer les nouvelles dimensions en gardant le ratio\n      if (width > maxWidth || height > maxWidth) {\n        if (width > height) {\n          height = (height / width) * maxWidth;\n          width = maxWidth;\n        } else {\n          width = (width / height) * maxWidth;\n          height = maxWidth;\n        }\n        logger.debug('Nouvelles dimensions', { width, height });\n      }\n\n      canvas.width = width;\n      canvas.height = height;\n\n      const ctx = canvas.getContext('2d');\n      if (!ctx) {\n        reject(new Error('Impossible de créer le contexte canvas'));\n        return;\n      }\n\n      ctx.imageSmoothingEnabled = true;\n      ctx.imageSmoothingQuality = 'high';\n      ctx.drawImage(img, 0, 0, width, height);\n      \n      const compressed = canvas.toDataURL('image/jpeg', quality);\n      const originalSize = (base64.length * 3) / 4 / 1024 / 1024;\n      const compressedSize = (compressed.length * 3) / 4 / 1024 / 1024;\n      const reduction = ((1 - compressedSize / originalSize) * 100).toFixed(1);\n      \n      logger.debug('Compression terminée', {\n        original: `${originalSize.toFixed(2)}MB`,\n        compressed: `${compressedSize.toFixed(2)}MB`,\n        reduction: `${reduction}%`\n      });\n      \n      resolve(compressed);\n    };\n    img.onerror = () => {\n      logger.error('Erreur chargement image pour compression');\n      reject(new Error('Erreur de chargement de l\\'image'));\n    };\n    img.src = base64;\n  });\n};\n\n// Fonction de validation d'image\nconst validateImage = (file: File): { valid: boolean; error?: string } => {\n  logger.debug('Validation fichier', {\n    name: file.name,\n    type: file.type,\n    size: `${(file.size / 1024 / 1024).toFixed(2)}MB`\n  });\n  \n  if (!ACCEPTED_IMAGE_TYPES.includes(file.type)) {\n    return { valid: false, error: 'Format non supporté. Utilisez JPG ou PNG.' };\n  }\n  if (file.size > MAX_IMAGE_SIZE) {\n    return { valid: false, error: `Taille maximale: ${MAX_IMAGE_SIZE / 1024 / 1024}MB` };\n  }\n  return { valid: true };\n};\n\ninterface ONECIFormProps {\n  onSubmit?: () => void;\n}\n\nconst ONECIForm = ({ onSubmit }: ONECIFormProps = {}) => {\n  const { user } = useAuth();\n  const [cniImage, setCniImage] = useState<string | null>(null);\n  const [selfieImage, setSelfieImage] = useState<string | null>(null);\n  const [isCapturing, setIsCapturing] = useState(false);\n  const [isVideoLoading, setIsVideoLoading] = useState(false);\n  const [isVerifying, setIsVerifying] = useState(false);\n  const [uploadProgress, setUploadProgress] = useState(0);\n  const [verificationResult, setVerificationResult] = useState<{\n    verified: boolean;\n    similarityScore: string;\n    message: string;\n    canRetry: boolean;\n    resultText?: string;\n  } | null>(null);\n  \n  const videoRef = useRef<HTMLVideoElement>(null);\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const streamRef = useRef<MediaStream | null>(null);\n\n  // Nettoyage lors du démontage du composant\n  useEffect(() => {\n    return () => {\n      logger.debug('Nettoyage composant ONECIForm');\n      if (streamRef.current) {\n        streamRef.current.getTracks().forEach(track => {\n          track.stop();\n          logger.debug('Track arrêté', { label: track.label });\n        });\n        streamRef.current = null;\n      }\n    };\n  }, []);\n\n  const startCamera = async () => {\n    try {\n      logger.info('Démarrage de la caméra');\n      setIsVideoLoading(true);\n      \n      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {\n        throw new Error('L\\'API MediaDevices n\\'est pas supportée par ce navigateur');\n      }\n\n      const stream = await navigator.mediaDevices.getUserMedia({ \n        video: { \n          facingMode: 'user',\n          width: { ideal: 1280 },\n          height: { ideal: 720 }\n        } \n      });\n      \n      logger.debug('Stream vidéo obtenu', { settings: stream.getVideoTracks()[0].getSettings() });\n      \n      if (!videoRef.current) {\n        throw new Error('Référence vidéo non disponible');\n      }\n\n      const video = videoRef.current;\n      streamRef.current = stream;\n      \n      // IMPORTANT: Définir srcObject APRÈS avoir configuré les événements\n      const playPromise = new Promise<void>((resolve, reject) => {\n        const onCanPlay = () => {\n          logger.debug('Vidéo prête (canplay)', {\n            width: video.videoWidth,\n            height: video.videoHeight,\n            readyState: video.readyState\n          });\n          \n          if (video.videoWidth > 0 && video.videoHeight > 0) {\n            setIsCapturing(true);\n            setIsVideoLoading(false);\n            logger.info('Caméra prête à capturer');\n            toast.success('Caméra activée !', { \n              description: 'Positionnez votre visage au centre' \n            });\n            resolve();\n          }\n        };\n\n        const onError = (e: Event) => {\n          logger.error('Erreur vidéo', { error: e });\n          reject(new Error('Erreur de chargement de la vidéo'));\n        };\n\n        // Utiliser 'canplay' au lieu de 'loadedmetadata' (plus fiable)\n        video.addEventListener('canplay', onCanPlay, { once: true });\n        video.addEventListener('error', onError, { once: true });\n        \n        // Timeout de sécurité\n        setTimeout(() => {\n          video.removeEventListener('canplay', onCanPlay);\n          video.removeEventListener('error', onError);\n          \n          // Vérifier manuellement si la vidéo est prête\n          if (video.readyState >= 2 && video.videoWidth > 0) {\n            logger.debug('Timeout mais vidéo prête', {\n              readyState: video.readyState,\n              width: video.videoWidth,\n              height: video.videoHeight\n            });\n            setIsCapturing(true);\n            setIsVideoLoading(false);\n            toast.success('Caméra activée !');\n            resolve();\n          } else {\n            logger.error('Timeout: vidéo non prête', {\n              readyState: video.readyState,\n              width: video.videoWidth,\n              height: video.videoHeight\n            });\n            reject(new Error('La vidéo n\\'a pas pu se charger'));\n          }\n        }, 5000);\n      });\n\n      // Assigner le stream à la vidéo\n      video.srcObject = stream;\n      \n      // Forcer le play (nécessaire sur certains navigateurs)\n      try {\n        await video.play();\n        logger.debug('video.play() appelé avec succès');\n      } catch (playError) {\n        logger.warn('video.play() a échoué (peut-être déjà en lecture)', { error: playError });\n      }\n\n      await playPromise;\n    } catch (error) {\n      logger.error('Error accessing camera', { error });\n      setIsVideoLoading(false);\n      setIsCapturing(false);\n      \n      let errorMessage = 'Impossible d\\'accéder à la caméra';\n      let errorDescription = 'Vérifiez vos permissions et réessayez';\n      \n      if (error instanceof Error) {\n        if (error.name === 'NotAllowedError') {\n          errorMessage = 'Autorisation caméra refusée';\n          errorDescription = 'Autorisez l\\'accès à la caméra dans les paramètres de votre navigateur';\n        } else if (error.name === 'NotFoundError') {\n          errorMessage = 'Aucune caméra trouvée';\n          errorDescription = 'Vérifiez qu\\'une caméra est connectée à votre appareil';\n        } else if (error.name === 'NotReadableError') {\n          errorMessage = 'La caméra est déjà utilisée';\n          errorDescription = 'Fermez les autres applications utilisant la caméra';\n        } else if (error.message.includes('Timeout') || error.message.includes('charger')) {\n          errorMessage = 'La caméra n\\'a pas pu se charger';\n          errorDescription = 'Réessayez ou rechargez la page';\n        }\n      }\n      \n      toast.error(errorMessage, { description: errorDescription });\n      \n      // Nettoyer le stream en cas d'erreur\n      if (streamRef.current) {\n        streamRef.current.getTracks().forEach(track => {\n          track.stop();\n          logger.debug('Track arrêté (erreur)', { label: track.label });\n        });\n        streamRef.current = null;\n      }\n    }\n  };\n\n  const stopCamera = useCallback(() => {\n    logger.debug('Arrêt de la caméra');\n    if (streamRef.current) {\n      streamRef.current.getTracks().forEach(track => track.stop());\n      streamRef.current = null;\n    }\n    setIsCapturing(false);\n    setIsVideoLoading(false);\n  }, []);\n\n  const captureSelfie = () => {\n    logger.debug('Tentative de capture du selfie');\n    \n    if (!videoRef.current || !canvasRef.current) {\n      toast.error('Erreur de capture', { description: 'Références vidéo manquantes' });\n      return;\n    }\n\n    const video = videoRef.current;\n    const canvas = canvasRef.current;\n    \n    // Vérifier que la vidéo a des dimensions valides\n    if (video.videoWidth === 0 || video.videoHeight === 0) {\n      logger.error('Dimensions vidéo invalides', {\n        width: video.videoWidth,\n        height: video.videoHeight\n      });\n      toast.error('Vidéo non prête', { \n        description: 'Attendez que la caméra charge complètement' \n      });\n      return;\n    }\n\n    // Vérifier que le stream est actif\n    if (!streamRef.current || streamRef.current.getTracks().length === 0) {\n      logger.error('Aucun stream actif');\n      toast.error('Caméra inactive', { \n        description: 'Relancez la caméra et réessayez' \n      });\n      return;\n    }\n\n    logger.debug('Capture du selfie', {\n      width: video.videoWidth,\n      height: video.videoHeight\n    });\n\n    canvas.width = video.videoWidth;\n    canvas.height = video.videoHeight;\n    \n    const ctx = canvas.getContext('2d');\n    if (ctx) {\n      ctx.drawImage(video, 0, 0);\n      const imageData = canvas.toDataURL('image/jpeg', 0.8);\n      setSelfieImage(imageData);\n      stopCamera();\n      logger.info('Selfie capturé avec succès');\n      toast.success('Selfie capturé !');\n    } else {\n      logger.error('Impossible d\\'obtenir le contexte canvas');\n      toast.error('Erreur de capture', { description: 'Impossible de traiter l\\'image' });\n    }\n  };\n\n  const handleCniUpload = useCallback(async (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (!file) {\n      logger.debug('Aucun fichier sélectionné');\n      return;\n    }\n\n    logger.debug('Fichier sélectionné', {\n      name: file.name,\n      type: file.type,\n      size: `${(file.size / 1024 / 1024).toFixed(2)}MB`\n    });\n\n    // Validation\n    const validation = validateImage(file);\n    if (!validation.valid) {\n      logger.error('Validation échouée', { error: validation.error });\n      toast.error('Fichier invalide', { description: validation.error });\n      event.target.value = ''; // Reset input\n      return;\n    }\n\n    logger.debug('Validation réussie, début de la lecture');\n    setUploadProgress(0);\n    \n    try {\n      const reader = new FileReader();\n      \n      reader.onprogress = (e) => {\n        if (e.lengthComputable) {\n          const progress = (e.loaded / e.total) * 100;\n          setUploadProgress(progress);\n          logger.debug(`Progression upload: ${progress.toFixed(1)}%`);\n        }\n      };\n\n      reader.onloadend = async () => {\n        try {\n          logger.debug('Fichier chargé, début de la compression');\n          let imageData = reader.result as string;\n          \n          const originalSize = (imageData.length * 3) / 4 / 1024 / 1024;\n          logger.debug(`Taille originale: ${originalSize.toFixed(2)}MB`);\n          \n          // Compresser l'image\n          imageData = await compressImage(imageData);\n          \n          const compressedSize = (imageData.length * 3) / 4 / 1024 / 1024;\n          logger.debug(`Taille compressée: ${compressedSize.toFixed(2)}MB`);\n          \n          logger.debug('setCniImage appelé avec image compressée');\n          setCniImage(imageData);\n          setUploadProgress(100);\n          \n          toast.success('Photo de CNI chargée !', {\n            description: `Taille: ${compressedSize.toFixed(2)}MB`\n          });\n          \n          // Reset progress après 1 seconde\n          setTimeout(() => {\n            setUploadProgress(0);\n            logger.debug('Progress bar réinitialisée');\n          }, 1000);\n        } catch (error) {\n          logger.error('Erreur de compression', { error });\n          toast.error('Erreur de traitement', {\n            description: 'Impossible de traiter l\\'image'\n          });\n          setUploadProgress(0);\n        }\n      };\n\n      reader.onerror = (error) => {\n        logger.error('Erreur de lecture du fichier', { error });\n        toast.error('Erreur de lecture', {\n          description: 'Impossible de lire le fichier'\n        });\n        setUploadProgress(0);\n      };\n\n      reader.readAsDataURL(file);\n    } catch (error) {\n      logger.error('Erreur lors du chargement', { error });\n      toast.error('Erreur', {\n        description: 'Impossible de charger le fichier'\n      });\n      setUploadProgress(0);\n    }\n    \n    // Reset input pour permettre le re-upload du même fichier\n    event.target.value = '';\n  }, []);\n\n  const handleVerify = async () => {\n    if (!cniImage || !selfieImage) {\n      toast.error('Veuillez fournir les deux images');\n      return;\n    }\n\n    setIsVerifying(true);\n    setVerificationResult(null);\n\n    try {\n      const { data, error } = await supabase.functions.invoke('smile-id-verification', {\n        body: {\n          cniImageBase64: cniImage,\n          selfieBase64: selfieImage,\n        },\n      });\n\n      if (error) throw error;\n\n      setVerificationResult(data);\n\n      if (data.verified) {\n        // Update profile\n        await supabase\n          .from('profiles')\n          .update({ oneci_verified: true })\n          .eq('id', user?.id);\n\n        // 🎉 Célébration avec confetti\n        celebrateCertification();\n\n        toast.success('🎉 Certification ANSUT réussie !', {\n          description: `Score de similarité : ${data.similarityScore}% • Vous êtes maintenant certifié ANSUT`,\n          duration: 5000,\n        });\n        onSubmit?.();\n      } else {\n        toast.error('Vérification échouée', {\n          description: data.message || data.resultText\n        });\n      }\n    } catch (error) {\n      logger.error('ONECI Smile ID verification error', { error });\n      toast.error('Erreur lors de la vérification', {\n        description: error instanceof Error ? error.message : 'Une erreur est survenue'\n      });\n    } finally {\n      setIsVerifying(false);\n    }\n  };\n\n  const reset = () => {\n    setCniImage(null);\n    setSelfieImage(null);\n    setVerificationResult(null);\n    stopCamera();\n  };\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle className=\"flex items-center gap-2\">\n          <Shield className=\"h-6 w-6 text-primary\" />\n          Vérification d'Identité ONECI\n        </CardTitle>\n        <CardDescription>\n          Vérification sécurisée via Smile ID pour ressortissants ivoiriens\n        </CardDescription>\n      </CardHeader>\n      <CardContent className=\"space-y-6\">\n        <Alert>\n          <AlertCircle className=\"h-4 w-4\" />\n          <AlertDescription>\n            <strong>Instructions importantes :</strong>\n            <ul className=\"mt-2 space-y-1 text-sm list-disc list-inside\">\n              <li>Téléchargez une photo <strong>claire et nette</strong> de votre CNI ivoirienne</li>\n              <li>Assurez-vous que <strong>toutes les informations</strong> sur la CNI sont lisibles</li>\n              <li>Prenez un selfie avec un <strong>bon éclairage</strong> (lumière naturelle de préférence)</li>\n              <li>Regardez <strong>directement la caméra</strong>, expression neutre</li>\n              <li>Retirez <strong>lunettes, masque, chapeau</strong> ou tout accessoire</li>\n            </ul>\n          </AlertDescription>\n        </Alert>\n\n        <div className=\"grid md:grid-cols-2 gap-6\">\n          {/* CNI Upload */}\n          <div className=\"space-y-3\">\n            <Label htmlFor=\"cni-upload\" className=\"text-base font-semibold\">\n              1. Photo de votre Carte Nationale d'Identité\n            </Label>\n            <p className=\"text-sm text-muted-foreground\">\n              Téléchargez une photo claire du recto de votre CNI\n            </p>\n            {cniImage ? (\n              <div className=\"relative group\">\n                <img \n                  src={cniImage} \n                  alt=\"Carte Nationale d'Identité\" \n                  className=\"w-full h-48 object-cover rounded-lg border-2 border-primary shadow-sm\"\n                />\n                <div className=\"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center\">\n                  <Button\n                    size=\"sm\"\n                    variant=\"destructive\"\n                    onClick={() => {\n                      setCniImage(null);\n                      setVerificationResult(null);\n                    }}\n                  >\n                    <XCircle className=\"mr-2 h-4 w-4\" />\n                    Retirer\n                  </Button>\n                </div>\n                <div className=\"absolute top-2 right-2 bg-green-500 text-white px-2 py-1 rounded-full text-xs font-medium flex items-center gap-1\">\n                  <CheckCircle className=\"h-3 w-3\" />\n                  Chargée\n                </div>\n              </div>\n            ) : (\n              <div className=\"space-y-2\">\n                <label \n                  htmlFor=\"cni-upload\"\n                  className=\"flex flex-col items-center justify-center h-48 border-2 border-dashed rounded-lg cursor-pointer hover:border-primary hover:bg-primary/5 transition-all bg-muted/30\"\n                >\n                  <Upload className=\"h-10 w-10 mb-3 text-primary\" />\n                  <span className=\"text-sm font-medium\">Cliquez pour télécharger</span>\n                  <span className=\"text-xs text-muted-foreground mt-1\">JPG, PNG (max 5MB)</span>\n                  <input\n                    id=\"cni-upload\"\n                    type=\"file\"\n                    accept=\"image/jpeg,image/jpg,image/png\"\n                    className=\"hidden\"\n                    onChange={handleCniUpload}\n                    aria-label=\"Télécharger photo de CNI\"\n                  />\n                </label>\n                {uploadProgress > 0 && uploadProgress < 100 && (\n                  <SimpleProgress value={uploadProgress} />\n                )}\n              </div>\n            )}\n          </div>\n\n          {/* Selfie Capture */}\n          <div className=\"space-y-3\">\n            <Label className=\"text-base font-semibold\">\n              2. Selfie de vérification\n            </Label>\n            <p className=\"text-sm text-muted-foreground\">\n              Prenez une photo de votre visage pour vérification biométrique\n            </p>\n            {selfieImage ? (\n              <div className=\"relative group\">\n                <img \n                  src={selfieImage} \n                  alt=\"Selfie de vérification\" \n                  className=\"w-full h-48 object-cover rounded-lg border-2 border-primary shadow-sm\"\n                />\n                <div className=\"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center\">\n                  <Button\n                    size=\"sm\"\n                    variant=\"destructive\"\n                    onClick={() => {\n                      setSelfieImage(null);\n                      setVerificationResult(null);\n                      stopCamera();\n                    }}\n                  >\n                    <XCircle className=\"mr-2 h-4 w-4\" />\n                    Retirer\n                  </Button>\n                </div>\n                <div className=\"absolute top-2 right-2 bg-green-500 text-white px-2 py-1 rounded-full text-xs font-medium flex items-center gap-1\">\n                  <CheckCircle className=\"h-3 w-3\" />\n                  Capturé\n                </div>\n              </div>\n            ) : (isCapturing || isVideoLoading) ? (\n              <div className=\"space-y-2\">\n                <div className=\"relative\">\n                  <video\n                    ref={videoRef}\n                    autoPlay\n                    playsInline\n                    muted\n                    className=\"w-full h-48 object-cover rounded-lg border-2 border-primary\"\n                  />\n                  {isVideoLoading && (\n                    <div className=\"absolute inset-0 flex items-center justify-center bg-black/70 rounded-lg\">\n                      <div className=\"text-center text-white\">\n                        <div className=\"animate-spin rounded-full h-12 w-12 border-4 border-white border-t-transparent mx-auto mb-3\" />\n                        <p className=\"text-sm font-medium\">Chargement de la caméra...</p>\n                        <p className=\"text-xs text-white/70 mt-1\">Patientez quelques secondes</p>\n                      </div>\n                    </div>\n                  )}\n                </div>\n                <div className=\"flex gap-2\">\n                  <Button \n                    onClick={captureSelfie} \n                    className=\"flex-1\"\n                    disabled={isVideoLoading}\n                  >\n                    {isVideoLoading ? 'Chargement...' : (\n                      <>\n                        <Camera className=\"mr-2 h-4 w-4\" />\n                        Capturer\n                      </>\n                    )}\n                  </Button>\n                  <Button onClick={stopCamera} variant=\"outline\">\n                    Annuler\n                  </Button>\n                </div>\n              </div>\n            ) : (\n              <Button\n                onClick={startCamera}\n                className=\"w-full h-48 flex flex-col gap-3 bg-muted/30\"\n                variant=\"outline\"\n              >\n                <Camera className=\"h-10 w-10 text-primary\" />\n                <span className=\"font-medium\">Ouvrir la caméra</span>\n                <span className=\"text-xs text-muted-foreground\">Selfie en direct</span>\n              </Button>\n            )}\n          </div>\n        </div>\n\n        <canvas ref={canvasRef} className=\"hidden\" />\n\n        {verificationResult && (\n          <Alert variant={verificationResult.verified ? \"default\" : \"destructive\"}>\n            {verificationResult.verified ? (\n              <CheckCircle className=\"h-4 w-4\" />\n            ) : (\n              <XCircle className=\"h-4 w-4\" />\n            )}\n            <AlertDescription>\n              <div className=\"space-y-2\">\n                <p className=\"font-medium\">{verificationResult.message}</p>\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"text-sm\">Score de similarité :</span>\n                  <SimpleProgress value={parseFloat(verificationResult.similarityScore)} className=\"flex-1\" />\n                  <span className=\"text-sm font-bold\">{verificationResult.similarityScore}%</span>\n                </div>\n                {!verificationResult.verified && verificationResult.canRetry && (\n                  <p className=\"text-sm\">\n                    Vous pouvez réessayer avec de meilleures conditions.\n                  </p>\n                )}\n              </div>\n            </AlertDescription>\n          </Alert>\n        )}\n\n        <div className=\"flex flex-col gap-3\">\n          <Button\n            onClick={handleVerify}\n            disabled={!cniImage || !selfieImage || isVerifying || uploadProgress > 0}\n            size=\"lg\"\n            className=\"w-full\"\n          >\n            {isVerifying ? (\n              <>\n                <RefreshCw className=\"mr-2 h-5 w-5 animate-spin\" />\n                Vérification en cours...\n              </>\n            ) : (\n              <>\n                <Shield className=\"mr-2 h-5 w-5\" />\n                Vérifier mon identité ONECI\n              </>\n            )}\n          </Button>\n          \n          {(cniImage || selfieImage || verificationResult) && (\n            <Button \n              onClick={reset} \n              variant=\"outline\" \n              size=\"lg\" \n              className=\"w-full\"\n              disabled={isVerifying}\n            >\n              <RefreshCw className=\"mr-2 h-4 w-4\" />\n              Recommencer la vérification\n            </Button>\n          )}\n        </div>\n\n        <Alert className=\"bg-muted\">\n          <Shield className=\"h-4 w-4\" />\n          <AlertDescription className=\"text-xs\">\n            <strong>Sécurité et confidentialité :</strong> Vos images sont transmises de manière sécurisée à Smile ID \n            pour vérification biométrique. Elles ne sont <strong>jamais stockées</strong> sur nos serveurs. \n            Seul le résultat de vérification (score de correspondance) est conservé dans votre profil.\n          </AlertDescription>\n        </Alert>\n      </CardContent>\n    </Card>\n  );\n};\n\nexport default ONECIForm;\n","import { useEffect } from 'react';\n\ninterface DocumentHeadOptions {\n  title?: string;\n  description?: string;\n  ogTitle?: string;\n  ogDescription?: string;\n  ogImage?: string;\n  ogUrl?: string;\n  twitterCard?: string;\n  structuredData?: object[];\n}\n\n/**\n * Hook to manage document head (title, meta tags, structured data)\n * Simple alternative to react-helmet that works without additional dependencies\n */\nexport const useDocumentHead = (options: DocumentHeadOptions) => {\n  useEffect(() => {\n    const originalTitle = document.title;\n    const addedElements: HTMLElement[] = [];\n\n    // Set title\n    if (options.title) {\n      document.title = options.title;\n    }\n\n    // Helper to create or update meta tag\n    const setMetaTag = (property: string, content: string, isProperty = false) => {\n      const attribute = isProperty ? 'property' : 'name';\n      let element = document.querySelector(`meta[${attribute}=\"${property}\"]`) as HTMLMetaElement;\n\n      if (!element) {\n        element = document.createElement('meta');\n        element.setAttribute(attribute, property);\n        document.head.appendChild(element);\n        addedElements.push(element);\n      }\n\n      element.content = content;\n    };\n\n    // Set meta description\n    if (options.description) {\n      setMetaTag('description', options.description);\n    }\n\n    // Set Open Graph tags\n    if (options.ogTitle) {\n      setMetaTag('og:title', options.ogTitle, true);\n    }\n    if (options.ogDescription) {\n      setMetaTag('og:description', options.ogDescription, true);\n    }\n    if (options.ogImage) {\n      setMetaTag('og:image', options.ogImage, true);\n    }\n    if (options.ogUrl) {\n      setMetaTag('og:url', options.ogUrl, true);\n    }\n\n    // Set Twitter Card tags\n    if (options.twitterCard) {\n      setMetaTag('twitter:card', options.twitterCard);\n    }\n    if (options.ogTitle) {\n      setMetaTag('twitter:title', options.ogTitle);\n    }\n    if (options.ogDescription) {\n      setMetaTag('twitter:description', options.ogDescription);\n    }\n    if (options.ogImage) {\n      setMetaTag('twitter:image', options.ogImage);\n    }\n\n    // Add structured data (JSON-LD)\n    if (options.structuredData) {\n      options.structuredData.forEach((data) => {\n        const script = document.createElement('script');\n        script.type = 'application/ld+json';\n        script.textContent = JSON.stringify(data);\n        document.head.appendChild(script);\n        addedElements.push(script);\n      });\n    }\n\n    // Cleanup on unmount\n    return () => {\n      document.title = originalTitle;\n      addedElements.forEach((element) => {\n        if (element.parentNode) {\n          element.parentNode.removeChild(element);\n        }\n      });\n    };\n  }, [\n    options.title,\n    options.description,\n    options.ogTitle,\n    options.ogDescription,\n    options.ogImage,\n    options.ogUrl,\n    options.twitterCard,\n    JSON.stringify(options.structuredData),\n  ]);\n};\n","import { useState } from \"react\";\nimport { Play } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\n\ninterface VideoPlayerProps {\n  url: string;\n  thumbnail?: string;\n}\n\nexport const VideoPlayer = ({ url, thumbnail }: VideoPlayerProps) => {\n  const [isPlaying, setIsPlaying] = useState(false);\n\n  if (!isPlaying) {\n    return (\n      <div className=\"relative w-full aspect-video bg-muted rounded-lg overflow-hidden group cursor-pointer\">\n        {thumbnail && (\n          <img\n            src={thumbnail}\n            alt=\"Video thumbnail\"\n            className=\"w-full h-full object-cover\"\n          />\n        )}\n        <div className=\"absolute inset-0 bg-black/40 flex items-center justify-center group-hover:bg-black/50 transition-colors\">\n          <Button\n            size=\"lg\"\n            onClick={() => setIsPlaying(true)}\n            className=\"rounded-full w-20 h-20\"\n          >\n            <Play className=\"h-8 w-8 fill-current\" />\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  // Check if it's a YouTube or Vimeo URL\n  const isYouTube = url.includes('youtube.com') || url.includes('youtu.be');\n  const isVimeo = url.includes('vimeo.com');\n\n  if (isYouTube || isVimeo) {\n    let embedUrl = url;\n    if (isYouTube) {\n      const videoId = url.includes('youtu.be') \n        ? url.split('youtu.be/')[1]?.split('?')[0]\n        : url.split('v=')[1]?.split('&')[0];\n      embedUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1`;\n    } else if (isVimeo) {\n      const videoId = url.split('vimeo.com/')[1]?.split('?')[0];\n      embedUrl = `https://player.vimeo.com/video/${videoId}?autoplay=1`;\n    }\n\n    return (\n      <div className=\"relative w-full aspect-video bg-black rounded-lg overflow-hidden\">\n        <iframe\n          src={embedUrl}\n          className=\"w-full h-full\"\n          allow=\"autoplay; fullscreen; picture-in-picture\"\n          allowFullScreen\n        />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"relative w-full aspect-video bg-black rounded-lg overflow-hidden\">\n      <video\n        src={url}\n        className=\"w-full h-full\"\n        controls\n        autoPlay\n      />\n    </div>\n  );\n};\n","import { useState } from \"react\";\nimport { TransformWrapper, TransformComponent } from \"react-zoom-pan-pinch\";\nimport { ZoomIn, ZoomOut, Maximize2, RotateCw } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { OptimizedImage } from \"./OptimizedImage\";\n\ninterface FloorPlan {\n  url: string;\n  title: string;\n  floor?: string;\n  surface?: number;\n}\n\ninterface FloorPlanViewerProps {\n  plans: FloorPlan[];\n}\n\nexport const FloorPlanViewer = ({ plans }: FloorPlanViewerProps) => {\n  const [activeIndex, setActiveIndex] = useState(0);\n  const activePlan = plans[activeIndex];\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Plan navigation */}\n      {plans.length > 1 && (\n        <div className=\"flex gap-2 overflow-x-auto pb-2\">\n          {plans.map((plan, index) => (\n            <Button\n              key={index}\n              variant={index === activeIndex ? \"default\" : \"outline\"}\n              size=\"sm\"\n              onClick={() => setActiveIndex(index)}\n              className=\"whitespace-nowrap\"\n            >\n              {plan.title}\n            </Button>\n          ))}\n        </div>\n      )}\n\n      {/* Plan viewer */}\n      <TransformWrapper\n        initialScale={1}\n        minScale={0.5}\n        maxScale={4}\n        centerOnInit\n      >\n        {({ zoomIn, zoomOut, resetTransform }) => (\n          <div className=\"relative\">\n            <div className=\"absolute top-4 right-4 z-10 flex gap-2\">\n              <Button\n                size=\"icon\"\n                variant=\"secondary\"\n                onClick={() => zoomIn()}\n                className=\"bg-background/80 backdrop-blur-sm\"\n              >\n                <ZoomIn className=\"h-4 w-4\" />\n              </Button>\n              <Button\n                size=\"icon\"\n                variant=\"secondary\"\n                onClick={() => zoomOut()}\n                className=\"bg-background/80 backdrop-blur-sm\"\n              >\n                <ZoomOut className=\"h-4 w-4\" />\n              </Button>\n              <Button\n                size=\"icon\"\n                variant=\"secondary\"\n                onClick={() => resetTransform()}\n                className=\"bg-background/80 backdrop-blur-sm\"\n              >\n                <Maximize2 className=\"h-4 w-4\" />\n              </Button>\n            </div>\n\n            <TransformComponent\n              wrapperClass=\"!w-full !h-[600px] bg-muted rounded-lg overflow-hidden\"\n              contentClass=\"!w-full !h-full flex items-center justify-center\"\n            >\n              <OptimizedImage\n                src={activePlan.url}\n                alt={activePlan.title}\n                className=\"max-w-full max-h-full object-contain\"\n              />\n            </TransformComponent>\n\n            {/* Plan info */}\n            <div className=\"absolute bottom-4 left-4 bg-background/90 backdrop-blur-sm px-4 py-2 rounded-md\">\n              <h3 className=\"font-semibold\">{activePlan.title}</h3>\n              {activePlan.floor && (\n                <p className=\"text-sm text-muted-foreground\">\n                  Étage: {activePlan.floor}\n                </p>\n              )}\n              {activePlan.surface && (\n                <p className=\"text-sm text-muted-foreground\">\n                  Surface: {activePlan.surface} m²\n                </p>\n              )}\n            </div>\n          </div>\n        )}\n      </TransformWrapper>\n    </div>\n  );\n};\n","import { useState, useEffect, useMemo, useRef } from 'react';\nimport { useSwipeable } from 'react-swipeable';\nimport { ChevronLeft, ChevronRight } from 'lucide-react';\nimport { OptimizedImage } from './OptimizedImage';\nimport { triggerHapticFeedback } from '@/utils/haptics';\nimport { Button } from '@/components/ui/button';\n\ninterface SwipeGalleryProps {\n  images: string[];\n  onImageChange?: (index: number) => void;\n  className?: string;\n}\n\nexport const SwipeGallery = ({ images, onImageChange, className }: SwipeGalleryProps) => {\n  const [currentIndex, setCurrentIndex] = useState(0);\n  const [scale, setScale] = useState(1);\n  const [position, setPosition] = useState({ x: 0, y: 0 });\n  const [lastTap, setLastTap] = useState(0);\n\n  // Preload adjacent images\n  useEffect(() => {\n    [currentIndex - 1, currentIndex + 1, currentIndex + 2].forEach(idx => {\n      if (idx >= 0 && idx < images.length) {\n        const img = new Image();\n        img.src = images[idx];\n      }\n    });\n  }, [currentIndex, images]);\n\n  // Virtual scrolling for performance\n  const visibleRange = useMemo(() => {\n    const start = Math.max(0, currentIndex - 2);\n    const end = Math.min(images.length, currentIndex + 3);\n    return { start, end, images: images.slice(start, end) };\n  }, [currentIndex, images]);\n\n  const handleNext = () => {\n    if (currentIndex < images.length - 1) {\n      triggerHapticFeedback('medium');\n      const newIndex = currentIndex + 1;\n      setCurrentIndex(newIndex);\n      onImageChange?.(newIndex);\n    }\n  };\n\n  const handlePrevious = () => {\n    if (currentIndex > 0) {\n      triggerHapticFeedback('medium');\n      const newIndex = currentIndex - 1;\n      setCurrentIndex(newIndex);\n      onImageChange?.(newIndex);\n    }\n  };\n\n  // Swipe handlers\n  const swipeHandlers = useSwipeable({\n    onSwipedLeft: handleNext,\n    onSwipedRight: handlePrevious,\n    trackMouse: false,\n    delta: 50,\n    preventScrollOnSwipe: true,\n  });\n\n  // Double tap to zoom\n  const handleTap = () => {\n    const now = Date.now();\n    const DOUBLE_TAP_DELAY = 300;\n    \n    if (now - lastTap < DOUBLE_TAP_DELAY) {\n      triggerHapticFeedback('light');\n      setScale(scale === 1 ? 2 : 1);\n      if (scale !== 1) {\n        setPosition({ x: 0, y: 0 });\n      }\n    }\n    setLastTap(now);\n  };\n\n  // Pinch to zoom with touch events\n  const touchStartRef = useRef<{ distance: number; scale: number } | null>(null);\n\n  const getTouchDistance = (touches: React.TouchList) => {\n    const dx = touches[0].clientX - touches[1].clientX;\n    const dy = touches[0].clientY - touches[1].clientY;\n    return Math.sqrt(dx * dx + dy * dy);\n  };\n\n  const handleTouchStart = (e: React.TouchEvent) => {\n    if (e.touches.length === 2) {\n      touchStartRef.current = {\n        distance: getTouchDistance(e.touches),\n        scale,\n      };\n    }\n  };\n\n  const handleTouchMove = (e: React.TouchEvent) => {\n    if (e.touches.length === 2 && touchStartRef.current) {\n      const currentDistance = getTouchDistance(e.touches);\n      const scaleChange = currentDistance / touchStartRef.current.distance;\n      const newScale = Math.max(1, Math.min(3, touchStartRef.current.scale * scaleChange));\n      setScale(newScale);\n      if (newScale === 1) {\n        setPosition({ x: 0, y: 0 });\n      }\n    }\n  };\n\n  const handleTouchEnd = () => {\n    touchStartRef.current = null;\n  };\n\n  return (\n    <div \n      className=\"relative w-full\"\n      role=\"region\"\n      aria-label=\"Galerie de photos du bien\"\n      aria-live=\"polite\"\n      aria-atomic=\"true\"\n    >\n      <span className=\"sr-only\">\n        Image {currentIndex + 1} sur {images.length}\n      </span>\n      \n      {/* Main image container */}\n      <div\n        {...swipeHandlers}\n        onTouchStart={handleTouchStart}\n        onTouchMove={handleTouchMove}\n        onTouchEnd={handleTouchEnd}\n        onClick={handleTap}\n        className={`relative aspect-video w-full overflow-hidden rounded-lg bg-muted touch-none ${className || ''}`}\n      >\n        <div\n          className=\"w-full h-full transition-transform duration-200\"\n          style={{\n            transform: `scale(${scale}) translate(${position.x}px, ${position.y}px)`,\n          }}\n        >\n          <OptimizedImage\n            src={images[currentIndex]}\n            alt={`Image ${currentIndex + 1}`}\n            className=\"w-full h-full object-cover\"\n            priority={currentIndex === 0}\n          />\n        </div>\n\n        {/* Counter overlay */}\n        <div className=\"absolute top-3 right-3 bg-black/60 backdrop-blur-sm text-white px-3 py-1 rounded-full text-sm font-medium\">\n          {currentIndex + 1}/{images.length}\n        </div>\n\n        {/* Navigation arrows */}\n        {currentIndex > 0 && (\n          <Button\n            variant=\"secondary\"\n            size=\"icon\"\n            className=\"absolute left-3 top-1/2 -translate-y-1/2 rounded-full bg-background/80 backdrop-blur-sm\"\n            onClick={(e) => {\n              e.stopPropagation();\n              handlePrevious();\n            }}\n          >\n            <ChevronLeft className=\"h-5 w-5\" />\n          </Button>\n        )}\n        {currentIndex < images.length - 1 && (\n          <Button\n            variant=\"secondary\"\n            size=\"icon\"\n            className=\"absolute right-3 top-1/2 -translate-y-1/2 rounded-full bg-background/80 backdrop-blur-sm\"\n            onClick={(e) => {\n              e.stopPropagation();\n              handleNext();\n            }}\n          >\n            <ChevronRight className=\"h-5 w-5\" />\n          </Button>\n        )}\n      </div>\n\n      {/* Dots navigation */}\n      <div className=\"flex justify-center gap-1.5 mt-3\">\n        {images.map((_, idx) => (\n          <button\n            key={idx}\n            onClick={() => {\n              triggerHapticFeedback('light');\n              setCurrentIndex(idx);\n              onImageChange?.(idx);\n              setScale(1);\n              setPosition({ x: 0, y: 0 });\n            }}\n            className={`h-2 rounded-full transition-all ${\n              idx === currentIndex\n                ? 'w-6 bg-primary'\n                : 'w-2 bg-muted-foreground/30'\n            }`}\n            aria-label={`Voir image ${idx + 1}`}\n          />\n        ))}\n      </div>\n\n      {/* Zoom hint */}\n      {scale === 1 && (\n        <p className=\"text-xs text-muted-foreground text-center mt-2\">\n          Double tap pour zoomer • Pincer pour zoomer\n        </p>\n      )}\n    </div>\n  );\n};\n","import { useAuth } from './useAuth';\nimport { useQuery } from '@tanstack/react-query';\nimport { supabase } from '@/lib/supabase';\nimport { logger } from '@/services/logger';\n\ninterface ImageAccessResult {\n  maxImages: number;\n  showBlur: boolean;\n  showHDPhotos: boolean;\n  show3DTour: boolean;\n  showFloorPlans: boolean;\n  hasValidatedDossier: boolean;\n}\n\nexport const usePropertyImageAccess = (propertyId: string): ImageAccessResult => {\n  const { user } = useAuth();\n\n  const { data: hasValidatedDossier = false } = useQuery({\n    queryKey: ['validated-dossier', propertyId, user?.id],\n    queryFn: async () => {\n      if (!user || !propertyId) return false;\n\n      const { data, error } = await supabase\n        .from('rental_applications')\n        .select('status')\n        .eq('property_id', propertyId)\n        .eq('applicant_id', user.id)\n        .maybeSingle();\n\n      if (error) {\n        logger.error('Failed to check dossier status', { userId: user.id, propertyId });\n        return false;\n      }\n\n      return data?.status === 'approved';\n    },\n    enabled: !!user && !!propertyId\n  });\n\n  // Logique de restriction :\n  // - Visiteur non connecté : 4 images max (floues)\n  // - Utilisateur connecté sans dossier validé : 6 images\n  // - Dossier validé : Toutes images + 3D + plans\n  \n  return {\n    maxImages: !user ? 4 : hasValidatedDossier ? Infinity : 6,\n    showBlur: !user,\n    showHDPhotos: hasValidatedDossier,\n    show3DTour: hasValidatedDossier,\n    showFloorPlans: hasValidatedDossier,\n    hasValidatedDossier\n  };\n};\n","import { useEffect, useRef } from 'react';\n\ninterface PrefetchOptions {\n  enabled?: boolean;\n  priority?: 'high' | 'low' | 'auto';\n}\n\nexport const usePanoramaPrefetch = (\n  imageUrls: string[],\n  options: PrefetchOptions = {}\n) => {\n  const { enabled = true, priority = 'low' } = options;\n  const prefetchedRef = useRef<Set<string>>(new Set());\n\n  useEffect(() => {\n    if (!enabled || imageUrls.length === 0) return;\n\n    const prefetchImage = (url: string) => {\n      if (prefetchedRef.current.has(url)) return;\n\n      const link = document.createElement('link');\n      link.rel = 'prefetch';\n      link.href = url;\n      link.as = 'image';\n\n      if (priority !== 'auto') {\n        link.setAttribute('fetchpriority', priority);\n      }\n\n      document.head.appendChild(link);\n      prefetchedRef.current.add(url);\n\n      return () => {\n        document.head.removeChild(link);\n      };\n    };\n\n    const cleanupFns = imageUrls.map(prefetchImage);\n\n    return () => {\n      cleanupFns.forEach(cleanup => cleanup?.());\n    };\n  }, [imageUrls, enabled, priority]);\n\n  const prefetchOnHover = (url: string) => {\n    if (prefetchedRef.current.has(url)) return;\n\n    const img = new Image();\n    img.src = url;\n    prefetchedRef.current.add(url);\n  };\n\n  return { prefetchOnHover };\n};\n","import { useState } from \"react\";\nimport Lightbox from \"yet-another-react-lightbox\";\nimport \"yet-another-react-lightbox/styles.css\";\nimport Zoom from \"yet-another-react-lightbox/plugins/zoom\";\nimport Fullscreen from \"yet-another-react-lightbox/plugins/fullscreen\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Alert, AlertDescription, AlertTitle } from \"@/components/ui/alert\";\nimport { Button } from \"@/components/ui/button\";\nimport { VideoPlayer } from \"./VideoPlayer\";\n\nimport { PanoramaNavigation } from \"./PanoramaNavigation\";\nimport { FloorPlanViewer } from \"./FloorPlanViewer\";\nimport { OptimizedImage } from \"./OptimizedImage\";\nimport { SwipeGallery } from \"./SwipeGallery\";\nimport { useIsMobile } from \"@/hooks/use-mobile\";\nimport { usePropertyImageAccess } from \"@/hooks/usePropertyImageAccess\";\nimport { usePanoramaPrefetch } from \"@/hooks/usePanoramaPrefetch\";\nimport { Image, Video, Globe, Layout, Lock, HelpCircle } from \"lucide-react\";\nimport { Link } from \"react-router-dom\";\nimport { cn } from \"@/lib/utils\";\n\ninterface MediaGalleryProps {\n  propertyId: string;\n  images: string[];\n  videoUrl?: string;\n  virtualTourUrl?: string;\n  panoramicImages?: Array<{ url: string; title?: string }>;\n  floorPlans?: Array<{ url: string; title: string; floor?: string; surface?: number }>;\n}\n\nexport const MediaGallery = ({\n  propertyId,\n  images = [],\n  videoUrl,\n  virtualTourUrl,\n  panoramicImages = [],\n  floorPlans = [],\n}: MediaGalleryProps) => {\n  const [lightboxOpen, setLightboxOpen] = useState(false);\n  const [lightboxIndex, setLightboxIndex] = useState(0);\n  const [currentPanoramaIndex, setCurrentPanoramaIndex] = useState(0);\n  const isMobile = useIsMobile();\n\n  // Hook pour accès images\n  const {\n    maxImages,\n    showBlur,\n    showHDPhotos,\n    show3DTour,\n    showFloorPlans\n  } = usePropertyImageAccess(propertyId);\n\n  // Prefetch panoramic images when 360 tab is available\n  const panoramaUrls = panoramicImages.map(p => p.url);\n  const { prefetchOnHover } = usePanoramaPrefetch(panoramaUrls, {\n    enabled: show3DTour && panoramaUrls.length > 0,\n    priority: 'low'\n  });\n\n  // Limiter les images affichées\n  const displayImages = images.slice(0, maxImages);\n  const hiddenImagesCount = images.length - displayImages.length;\n\n  const hasVideo = !!videoUrl;\n  const has360 = panoramicImages.length > 0;\n  const hasPlans = floorPlans.length > 0;\n\n  const openLightbox = (index: number) => {\n    setLightboxIndex(index);\n    setLightboxOpen(true);\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <Tabs defaultValue=\"photos\" className=\"w-full\">\n        <TabsList className=\"w-full justify-start\">\n          <TabsTrigger value=\"photos\" className=\"gap-2\">\n            <Image className=\"h-4 w-4\" />\n            Photos ({displayImages.length}/{images.length})\n          </TabsTrigger>\n          {hasVideo && (\n            <TabsTrigger value=\"video\" className=\"gap-2\">\n              <Video className=\"h-4 w-4\" />\n              Vidéo\n              <Badge variant=\"secondary\" className=\"ml-1\">\n                Nouveau\n              </Badge>\n            </TabsTrigger>\n          )}\n          {has360 && show3DTour && (\n            <TabsTrigger\n              value=\"360\"\n              className=\"gap-2\"\n              onMouseEnter={() => {\n                panoramaUrls.forEach(url => prefetchOnHover(url));\n              }}\n            >\n              <Globe className=\"h-4 w-4\" />\n              Vue 360°\n              <Badge variant=\"secondary\" className=\"ml-1\">\n                {panoramicImages.length}\n              </Badge>\n            </TabsTrigger>\n          )}\n          {hasPlans && showFloorPlans && (\n            <TabsTrigger value=\"plans\" className=\"gap-2\">\n              <Layout className=\"h-4 w-4\" />\n              Plans\n            </TabsTrigger>\n          )}\n        </TabsList>\n\n        <TabsContent value=\"photos\" className=\"space-y-4\">\n          {/* Alert si photos limitées */}\n          {!showHDPhotos && (\n            <Alert className=\"border-2 border-primary/20 bg-gradient-to-r from-primary/5 to-accent/5\">\n              <Lock className=\"h-5 w-5 text-primary\" />\n              <AlertTitle className=\"text-lg font-semibold\">\n                {showBlur \n                  ? '🔒 Aperçu limité - Créez un compte gratuit' \n                  : '🎯 Débloquez tout le contenu premium'\n                }\n              </AlertTitle>\n              <AlertDescription className=\"space-y-3 mt-2\">\n                <div className=\"space-y-2\">\n                  <p className=\"font-medium\">\n                    {showBlur \n                      ? 'Sans compte, vous voyez seulement 4 photos (floues).'\n                      : `Votre dossier n'est pas encore validé. Débloquez :`\n                    }\n                  </p>\n                  {!showBlur && hiddenImagesCount > 0 && (\n                    <ul className=\"list-disc list-inside text-sm space-y-1 ml-2\">\n                      <li><strong>{hiddenImagesCount} photos HD</strong> supplémentaires</li>\n                      <li><strong>Visite virtuelle 3D</strong> interactive</li>\n                      <li><strong>Plans détaillés</strong> du bien</li>\n                      <li><strong>Vidéos</strong> de présentation</li>\n                    </ul>\n                  )}\n                </div>\n                \n                <div className=\"flex flex-col sm:flex-row gap-2 pt-2\">\n                  <Button asChild size=\"sm\" className=\"font-semibold\">\n                    <Link to={showBlur ? '/auth' : '/verification'}>\n                      <Lock className=\"mr-2 h-4 w-4\" />\n                      {showBlur ? 'Créer un compte gratuit' : 'Valider mon dossier'}\n                    </Link>\n                  </Button>\n                  {!showBlur && (\n                    <Button asChild size=\"sm\" variant=\"outline\">\n                      <Link to=\"/guide#dossier-locataire\">\n                        Comment ça marche ?\n                      </Link>\n                    </Button>\n                  )}\n                </div>\n              </AlertDescription>\n            </Alert>\n          )}\n\n          {isMobile ? (\n            /* Mobile: SwipeGallery */\n            <SwipeGallery \n              images={displayImages}\n              onImageChange={(idx) => setLightboxIndex(idx)}\n              className={cn(showBlur && 'blur-sm')}\n            />\n          ) : (\n            /* Desktop: Original layout */\n            <>\n              {/* Main image */}\n              {displayImages.length > 0 && (\n                <div\n                  className={cn(\n                    \"relative aspect-video w-full overflow-hidden rounded-lg cursor-pointer group\",\n                    showBlur && \"blur-sm\"\n                  )}\n                  onClick={() => !showBlur && openLightbox(0)}\n                >\n                  <OptimizedImage\n                    src={displayImages[0]}\n                    alt=\"Photo principale\"\n                    priority={true}\n                    className=\"w-full h-full object-cover transition-transform group-hover:scale-105\"\n                  />\n                  {showBlur && (\n                    <div className=\"absolute inset-0 bg-black/20 flex items-center justify-center\">\n                      <Lock className=\"h-12 w-12 text-white\" />\n                    </div>\n                  )}\n                </div>\n              )}\n\n              {/* Thumbnail grid */}\n              {displayImages.length > 1 && (\n                <div className=\"grid grid-cols-4 gap-2\">\n                  {displayImages.slice(1, 5).map((image, index) => (\n                    <div\n                      key={index + 1}\n                      className={cn(\n                        \"relative aspect-video overflow-hidden rounded-md cursor-pointer group\",\n                        showBlur && \"blur-sm\"\n                      )}\n                      onClick={() => !showBlur && openLightbox(index + 1)}\n                    >\n                      <OptimizedImage\n                        src={image}\n                        alt={`Photo ${index + 2}`}\n                        className=\"w-full h-full object-cover transition-transform group-hover:scale-105\"\n                      />\n                      {index === 3 && hiddenImagesCount > 0 && (\n                        <div className=\"absolute inset-0 bg-black/60 flex items-center justify-center text-white font-semibold\">\n                          <Lock className=\"h-6 w-6 mr-2\" />\n                          +{hiddenImagesCount}\n                        </div>\n                      )}\n                    </div>\n                  ))}\n                </div>\n              )}\n            </>\n          )}\n        </TabsContent>\n\n        {hasVideo && (\n          <TabsContent value=\"video\">\n            <VideoPlayer url={videoUrl} thumbnail={images[0]} />\n          </TabsContent>\n        )}\n\n        {has360 && (\n          <TabsContent value=\"360\">\n            <div className=\"space-y-4\">\n              <Alert>\n                <Globe className=\"h-4 w-4\" />\n                <AlertTitle>Visite 360° Temporairement Indisponible</AlertTitle>\n                <AlertDescription>\n                  La fonctionnalité de visite panoramique est en cours de maintenance.\n                </AlertDescription>\n              </Alert>\n            </div>\n          </TabsContent>\n        )}\n\n        {hasPlans && (\n          <TabsContent value=\"plans\">\n            <FloorPlanViewer plans={floorPlans} />\n          </TabsContent>\n        )}\n      </Tabs>\n\n      {/* Lightbox */}\n      <Lightbox\n        open={lightboxOpen}\n        close={() => setLightboxOpen(false)}\n        index={lightboxIndex}\n        slides={images.map((src) => ({ src }))}\n        plugins={[Zoom, Fullscreen]}\n        zoom={{\n          maxZoomPixelRatio: 3,\n          scrollToZoom: true,\n        }}\n      />\n    </div>\n  );\n};\n","import { useAuth } from '@/hooks/useAuth';\nimport { useQuery } from '@tanstack/react-query';\nimport { supabase } from '@/lib/supabase';\nimport { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';\nimport { Button } from '@/components/ui/button';\nimport { Lock, MapPin } from 'lucide-react';\nimport { Link } from 'react-router-dom';\n\ninterface LocationSectionProps {\n  propertyId: string;\n  latitude: number;\n  longitude: number;\n  city: string;\n  address: string;\n}\n\nexport const LocationSection = ({\n  propertyId,\n  latitude,\n  longitude,\n  city,\n  address\n}: LocationSectionProps) => {\n  const { user } = useAuth();\n\n  const { data: canViewMap = false } = useQuery({\n    queryKey: ['can-view-map', propertyId, user?.id],\n    queryFn: async () => {\n      if (!user || !propertyId) return false;\n\n      const { data, error } = await supabase\n        .from('rental_applications')\n        .select('status')\n        .eq('property_id', propertyId)\n        .eq('applicant_id', user.id)\n        .maybeSingle();\n\n      if (error) return false;\n      return data?.status === 'approved';\n    },\n    enabled: !!user && !!propertyId\n  });\n\n  if (canViewMap) {\n    return (\n      <div className=\"space-y-4\">\n        <div className=\"flex items-start gap-2 mb-4\">\n          <MapPin className=\"h-5 w-5 text-primary mt-0.5\" />\n          <div>\n            <p className=\"font-medium\">{city}</p>\n            <p className=\"text-sm text-muted-foreground mt-1\">{address}</p>\n          </div>\n        </div>\n        <div className=\"aspect-video bg-muted rounded-lg overflow-hidden\">\n          <iframe\n            width=\"100%\"\n            height=\"100%\"\n            frameBorder=\"0\"\n            src={`https://www.openstreetmap.org/export/embed.html?bbox=${longitude-0.01},${latitude-0.01},${longitude+0.01},${latitude+0.01}&layer=mapnik&marker=${latitude},${longitude}`}\n            style={{ border: 0 }}\n          />\n        </div>\n        <Button asChild className=\"w-full\" variant=\"outline\">\n          <a\n            href={`https://www.google.com/maps/search/?api=1&query=${latitude},${longitude}`}\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n          >\n            <MapPin className=\"mr-2 h-4 w-4\" />\n            Ouvrir dans Google Maps\n          </a>\n        </Button>\n      </div>\n    );\n  }\n\n  return (\n    <Alert>\n      <Lock className=\"h-4 w-4\" />\n      <AlertTitle>Localisation précise</AlertTitle>\n      <AlertDescription className=\"space-y-2\">\n        <p>\n          La carte interactive et la localisation exacte (GPS) sont disponibles \n          après validation de votre dossier locataire.\n        </p>\n        <div className=\"flex items-start gap-2 mb-3 pt-2\">\n          <MapPin className=\"h-5 w-5 text-muted-foreground mt-0.5\" />\n          <div>\n            <p className=\"font-medium text-foreground\">{city}</p>\n            <p className=\"text-sm text-muted-foreground mt-1\">Quartier: {address.split(',')[0]}</p>\n          </div>\n        </div>\n        {user ? (\n          <Button asChild size=\"sm\" variant=\"outline\">\n            <Link to=\"/verification\">\n              <Lock className=\"mr-2 h-4 w-4\" />\n              Valider mon dossier\n            </Link>\n          </Button>\n        ) : (\n          <Button asChild size=\"sm\">\n            <Link to=\"/auth\">\n              Créer un compte\n            </Link>\n          </Button>\n        )}\n      </AlertDescription>\n    </Alert>\n  );\n};\n","import { useState, useEffect, useCallback, useMemo } from 'react';\nimport { useAuth } from '@/hooks/useAuth';\nimport { useNavigate } from 'react-router-dom';\nimport { supabase } from '@/lib/supabase';\nimport { Button } from '@/components/ui/button';\nimport { logger } from '@/services/logger';\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from '@/components/ui/dialog';\nimport { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';\nimport ONECIForm from '@/components/verification/ONECIForm';\nimport { Shield, AlertTriangle, CheckCircle2, FileText, Loader2 } from 'lucide-react';\nimport { toast } from '@/hooks/use-toast';\n\ninterface VerificationGuardProps {\n  propertyId: string;\n  onVerified?: () => void;\n  children: React.ReactNode;\n}\n\ntype VerificationStatus = 'pending' | 'pending_review' | 'verified' | 'rejected';\n\ninterface UserVerification {\n  oneci_status: VerificationStatus;\n  oneci_verified_at: string | null;\n}\n\ntype ComponentStatus = 'loading' | 'not_verified' | 'pending' | 'verified' | 'error';\n\nexport const VerificationGuard = ({ propertyId, onVerified, children }: VerificationGuardProps) => {\n  const { user, profile } = useAuth();\n  const navigate = useNavigate();\n  const [dialogOpen, setDialogOpen] = useState(false);\n  const [verification, setVerification] = useState<UserVerification | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [verifying, setVerifying] = useState(false);\n  const [formSubmitted, setFormSubmitted] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  // Mémorise le statut de vérification\n  const verificationStatus = useMemo((): ComponentStatus => {\n    if (loading) return 'loading';\n    if (error) return 'error';\n    if (profile?.oneci_verified || (profile as any)?.passport_verified || verification?.oneci_status === 'verified') return 'verified';\n    if (verification?.oneci_status === 'pending' || verification?.oneci_status === 'pending_review') return 'pending';\n    return 'not_verified';\n  }, [loading, error, profile?.oneci_verified, (profile as any)?.passport_verified, verification?.oneci_status]);\n\n  const isVerified = verificationStatus === 'verified';\n  const isPending = verificationStatus === 'pending';\n\n  // Vérifie le statut de vérification\n  const checkVerificationStatus = useCallback(async () => {\n    if (!user?.id) return;\n\n    try {\n      setError(null);\n      const { data, error: fetchError } = await supabase\n        .from('user_verifications')\n        .select('oneci_status, oneci_verified_at')\n        .eq('user_id', user.id)\n        .maybeSingle();\n\n      if (fetchError) throw fetchError;\n\n      setVerification(data as UserVerification);\n    } catch (err) {\n      const errorMessage = err instanceof Error ? err.message : 'Erreur de chargement';\n      logger.logError(err, { context: 'VerificationGuard', action: 'checkVerificationStatus' });\n      setError(errorMessage);\n      toast({\n        title: \"Erreur\",\n        description: \"Impossible de vérifier votre statut. Veuillez réessayer.\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setLoading(false);\n    }\n  }, [user?.id]);\n\n  useEffect(() => {\n    if (user) {\n      checkVerificationStatus();\n    } else {\n      setLoading(false);\n    }\n  }, [user, checkVerificationStatus]);\n\n  // Procède à l'étape suivante (application ou callback)\n  const proceedToNextStep = useCallback(() => {\n    if (onVerified) {\n      onVerified();\n    } else {\n      navigate(`/application/${propertyId}`);\n    }\n  }, [onVerified, navigate, propertyId]);\n\n  // Gère le clic sur l'élément enfant\n  const handleClick = useCallback(() => {\n    if (!user) {\n      toast({\n        title: \"Connexion requise\",\n        description: \"Veuillez vous connecter pour continuer\",\n        variant: \"destructive\"\n      });\n      navigate('/auth');\n      return;\n    }\n\n    if (!isVerified && !isPending) {\n      setDialogOpen(true);\n    } else {\n      proceedToNextStep();\n    }\n  }, [user, isVerified, isPending, navigate, proceedToNextStep]);\n\n  // Gère la soumission du formulaire\n  const handleFormSubmit = useCallback(() => {\n    setFormSubmitted(true);\n  }, []);\n\n  // Gère le succès de la vérification\n  const handleVerificationSuccess = useCallback(async () => {\n    if (!formSubmitted) {\n      toast({\n        title: \"Attention\",\n        description: \"Veuillez d'abord compléter le formulaire de vérification\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    setVerifying(true);\n    \n    try {\n      // Revérifie le statut\n      await checkVerificationStatus();\n      \n      toast({\n        title: \"Vérification soumise !\",\n        description: \"Votre demande de vérification a été envoyée. Vous pouvez maintenant continuer votre candidature.\",\n      });\n\n      setDialogOpen(false);\n      proceedToNextStep();\n    } catch (err) {\n      toast({\n        title: \"Erreur\",\n        description: \"Impossible de valider la vérification. Veuillez réessayer.\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setVerifying(false);\n    }\n  }, [formSubmitted, checkVerificationStatus, proceedToNextStep]);\n\n  // Gestion du clavier pour l'accessibilité\n  const handleKeyDown = useCallback((e: React.KeyboardEvent) => {\n    if (e.key === 'Enter' || e.key === ' ') {\n      e.preventDefault();\n      handleClick();\n    }\n  }, [handleClick]);\n\n  return (\n    <>\n      <div \n        onClick={handleClick}\n        onKeyDown={handleKeyDown}\n        role=\"button\"\n        tabIndex={0}\n        style={{ cursor: 'pointer' }}\n      >\n        {children}\n      </div>\n\n      <Dialog open={dialogOpen} onOpenChange={setDialogOpen}>\n        <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2 text-2xl\">\n              <Shield className=\"h-6 w-6 text-primary\" />\n              Vérification d'identité requise\n            </DialogTitle>\n            <DialogDescription>\n              Pour postuler à ce bien, vous devez d'abord vérifier votre identité via ONECI\n            </DialogDescription>\n          </DialogHeader>\n\n          <div className=\"space-y-6 py-4\">\n            {/* Why verification is needed */}\n            <Alert>\n              <AlertTriangle className=\"h-4 w-4\" />\n              <AlertTitle>Pourquoi cette vérification ?</AlertTitle>\n              <AlertDescription>\n                La vérification ONECI permet aux propriétaires de confirmer votre identité \n                et d'augmenter la confiance dans votre candidature. C'est une étape rapide \n                et sécurisée.\n              </AlertDescription>\n            </Alert>\n\n            {/* Benefits */}\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\n              <div className=\"flex flex-col items-center text-center p-4 rounded-lg bg-muted/50\">\n                <Shield className=\"h-8 w-8 text-primary mb-2\" />\n                <h4 className=\"font-semibold mb-1\">Sécurisé</h4>\n                <p className=\"text-xs text-muted-foreground\">\n                  Vos données sont protégées\n                </p>\n              </div>\n              <div className=\"flex flex-col items-center text-center p-4 rounded-lg bg-muted/50\">\n                <CheckCircle2 className=\"h-8 w-8 text-green-600 mb-2\" />\n                <h4 className=\"font-semibold mb-1\">Rapide</h4>\n                <p className=\"text-xs text-muted-foreground\">\n                  Seulement quelques minutes\n                </p>\n              </div>\n              <div className=\"flex flex-col items-center text-center p-4 rounded-lg bg-muted/50\">\n                <FileText className=\"h-8 w-8 text-blue-600 mb-2\" />\n                <h4 className=\"font-semibold mb-1\">Une seule fois</h4>\n                <p className=\"text-xs text-muted-foreground\">\n                  Valable pour toutes vos candidatures\n                </p>\n              </div>\n            </div>\n\n            {/* Statut de vérification en attente */}\n            {isPending && (\n              <Alert>\n                <CheckCircle2 className=\"h-4 w-4\" />\n                <AlertTitle>Vérification en cours</AlertTitle>\n                <AlertDescription>\n                  Votre demande de vérification est en cours de traitement. \n                  Vous pouvez continuer votre candidature pendant ce temps.\n                </AlertDescription>\n              </Alert>\n            )}\n\n            {/* Message de rejet */}\n            {verification?.oneci_status === 'rejected' && (\n              <Alert variant=\"destructive\">\n                <AlertTriangle className=\"h-4 w-4\" />\n                <AlertTitle>Vérification refusée</AlertTitle>\n                <AlertDescription>\n                  Votre vérification a été refusée. Veuillez soumettre à nouveau avec des informations correctes.\n                </AlertDescription>\n              </Alert>\n            )}\n\n            {/* ONECI Form */}\n            {!isVerified && !isPending && (\n              <div className=\"border rounded-lg p-6 bg-muted/20\">\n                <h3 className=\"font-semibold mb-4 flex items-center gap-2\">\n                  <Shield className=\"h-5 w-5\" />\n                  Vérification ONECI\n                </h3>\n                <p className=\"text-sm text-muted-foreground mb-4\">\n                  Complétez le formulaire ci-dessous pour vérifier votre identité. \n                  Une fois validé, vous pourrez continuer votre candidature.\n                </p>\n                <ONECIForm onSubmit={handleFormSubmit} />\n                <div className=\"mt-4\">\n                  <Button \n                    onClick={handleVerificationSuccess} \n                    className=\"w-full\"\n                    disabled={verifying || !formSubmitted}\n                  >\n                    {verifying ? (\n                      <>\n                        <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                        Traitement en cours...\n                      </>\n                    ) : (\n                      'J\\'ai soumis ma vérification'\n                    )}\n                  </Button>\n                  {!formSubmitted && (\n                    <p className=\"text-xs text-muted-foreground mt-2 text-center\">\n                      Veuillez d'abord compléter le formulaire ci-dessus\n                    </p>\n                  )}\n                </div>\n              </div>\n            )}\n\n            {/* Actions */}\n            <div className=\"flex gap-3 pt-4\">\n              <Button\n                variant=\"outline\"\n                onClick={() => setDialogOpen(false)}\n                className=\"flex-1\"\n              >\n                Annuler\n              </Button>\n              {isPending && (\n                <Button\n                  onClick={() => {\n                    setDialogOpen(false);\n                    proceedToNextStep();\n                  }}\n                  className=\"flex-1\"\n                >\n                  Continuer la candidature\n                </Button>\n              )}\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </>\n  );\n};","import * as React from \"react\";\nimport * as LabelPrimitive from \"@radix-ui/react-label\";\nimport { Slot } from \"@radix-ui/react-slot\";\nimport { Controller, ControllerProps, FieldPath, FieldValues, FormProvider, useFormContext } from \"react-hook-form\";\n\nimport { cn } from \"@/lib/utils\";\nimport { Label } from \"@/components/ui/label\";\n\nconst Form = FormProvider;\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,\n> = {\n  name: TName;\n};\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>({} as FormFieldContextValue);\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  );\n};\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext);\n  const itemContext = React.useContext(FormItemContext);\n  const { getFieldState, formState } = useFormContext();\n\n  const fieldState = getFieldState(fieldContext.name, formState);\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\");\n  }\n\n  const { id } = itemContext;\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  };\n};\n\ntype FormItemContextValue = {\n  id: string;\n};\n\nconst FormItemContext = React.createContext<FormItemContextValue>({} as FormItemContextValue);\n\nconst FormItem = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(\n  ({ className, ...props }, ref) => {\n    const id = React.useId();\n\n    return (\n      <FormItemContext.Provider value={{ id }}>\n        <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n      </FormItemContext.Provider>\n    );\n  },\n);\nFormItem.displayName = \"FormItem\";\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField();\n\n  return <Label ref={ref} className={cn(error && \"text-destructive\", className)} htmlFor={formItemId} {...props} />;\n});\nFormLabel.displayName = \"FormLabel\";\n\nconst FormControl = React.forwardRef<React.ElementRef<typeof Slot>, React.ComponentPropsWithoutRef<typeof Slot>>(\n  ({ ...props }, ref) => {\n    const { error, formItemId, formDescriptionId, formMessageId } = useFormField();\n\n    return (\n      <Slot\n        ref={ref}\n        id={formItemId}\n        aria-describedby={!error ? `${formDescriptionId}` : `${formDescriptionId} ${formMessageId}`}\n        aria-invalid={!!error}\n        {...props}\n      />\n    );\n  },\n);\nFormControl.displayName = \"FormControl\";\n\nconst FormDescription = React.forwardRef<HTMLParagraphElement, React.HTMLAttributes<HTMLParagraphElement>>(\n  ({ className, ...props }, ref) => {\n    const { formDescriptionId } = useFormField();\n\n    return <p ref={ref} id={formDescriptionId} className={cn(\"text-sm text-muted-foreground\", className)} {...props} />;\n  },\n);\nFormDescription.displayName = \"FormDescription\";\n\nconst FormMessage = React.forwardRef<HTMLParagraphElement, React.HTMLAttributes<HTMLParagraphElement>>(\n  ({ className, children, ...props }, ref) => {\n    const { error, formMessageId } = useFormField();\n    const body = error ? String(error?.message) : children;\n\n    if (!body) {\n      return null;\n    }\n\n    return (\n      <p ref={ref} id={formMessageId} className={cn(\"text-sm font-medium text-destructive\", className)} {...props}>\n        {body}\n      </p>\n    );\n  },\n);\nFormMessage.displayName = \"FormMessage\";\n\nexport { useFormField, Form, FormItem, FormLabel, FormControl, FormDescription, FormMessage, FormField };\n","import { useState, useEffect } from 'react';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { useForm } from 'react-hook-form';\nimport * as z from 'zod';\nimport { Button } from '@/components/ui/button';\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from '@/components/ui/form';\nimport { Input } from '@/components/ui/input';\nimport { Textarea } from '@/components/ui/textarea';\nimport { supabase } from '@/lib/supabase';\nimport { useToast } from '@/hooks/use-toast';\nimport { getDeviceFingerprint } from '@/lib/ipUtils';\nimport { MessageCircle, Loader2, CheckCircle2 } from 'lucide-react';\nimport { logger } from '@/services/logger';\n\nconst guestContactSchema = z.object({\n  guestName: z.string().min(2, 'Le nom doit contenir au moins 2 caractères').max(100),\n  guestEmail: z.string().email('Email invalide').max(255),\n  guestPhone: z.string().optional(),\n  message: z.string()\n    .min(10, 'Le message doit contenir au moins 10 caractères')\n    .max(1000, 'Le message ne doit pas dépasser 1000 caractères'),\n  honeypot: z.string().optional(), // Champ anti-bot invisible\n});\n\ntype GuestContactFormValues = z.infer<typeof guestContactSchema>;\n\ninterface GuestContactFormProps {\n  propertyId: string;\n  ownerId: string;\n  propertyTitle: string;\n}\n\nexport const GuestContactForm = ({ propertyId, ownerId, propertyTitle }: GuestContactFormProps) => {\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [isSuccess, setIsSuccess] = useState(false);\n  const [cooldownSeconds, setCooldownSeconds] = useState(0);\n  const { toast } = useToast();\n\n  const form = useForm<GuestContactFormValues>({\n    resolver: zodResolver(guestContactSchema),\n    defaultValues: {\n      guestName: '',\n      guestEmail: '',\n      guestPhone: '',\n      message: '',\n      honeypot: '',\n    },\n  });\n\n  // Vérifier le cooldown au chargement\n  useEffect(() => {\n    const lastSentKey = `guest_message_${propertyId}`;\n    const lastSent = localStorage.getItem(lastSentKey);\n    \n    if (lastSent) {\n      const timeSinceLastSent = Date.now() - parseInt(lastSent);\n      const cooldownMs = 60000; // 60 secondes\n      \n      if (timeSinceLastSent < cooldownMs) {\n        const remaining = Math.ceil((cooldownMs - timeSinceLastSent) / 1000);\n        setCooldownSeconds(remaining);\n      }\n    }\n  }, [propertyId]);\n\n  // Décompte du cooldown\n  useEffect(() => {\n    if (cooldownSeconds > 0) {\n      const timer = setTimeout(() => {\n        setCooldownSeconds(cooldownSeconds - 1);\n      }, 1000);\n      return () => clearTimeout(timer);\n    }\n  }, [cooldownSeconds]);\n\n  const onSubmit = async (values: GuestContactFormValues) => {\n    // Vérifier le honeypot (anti-bot)\n    if (values.honeypot) {\n      logger.warn('Bot detected in guest contact form', { propertyId });\n      return;\n    }\n\n    setIsSubmitting(true);\n\n    try {\n      // Appeler l'edge function\n      const { data, error } = await supabase.functions.invoke('send-guest-message', {\n        body: {\n          propertyId,\n          ownerId,\n          guestName: values.guestName,\n          guestEmail: values.guestEmail,\n          guestPhone: values.guestPhone,\n          message: values.message,\n          honeypot: values.honeypot,\n        },\n      });\n\n      if (error) {\n        throw error;\n      }\n\n      if (data?.error) {\n        // Erreur métier (rate limit, etc.)\n        toast({\n          title: 'Impossible d\\'envoyer le message',\n          description: data.error,\n          variant: 'destructive',\n        });\n\n        // Si rate limit, gérer le cooldown\n        if (data.retryAfter) {\n          const retryDate = new Date(data.retryAfter);\n          const waitSeconds = Math.ceil((retryDate.getTime() - Date.now()) / 1000);\n          setCooldownSeconds(waitSeconds);\n        }\n        return;\n      }\n\n      // Succès\n      setIsSuccess(true);\n      form.reset();\n      \n      // Stocker l'heure d'envoi pour cooldown\n      const lastSentKey = `guest_message_${propertyId}`;\n      localStorage.setItem(lastSentKey, Date.now().toString());\n      setCooldownSeconds(60);\n\n      toast({\n        title: 'Message envoyé !',\n        description: 'Le propriétaire vous répondra par email.',\n        variant: 'default',\n      });\n\n      // Réinitialiser le succès après 5 secondes\n      setTimeout(() => {\n        setIsSuccess(false);\n      }, 5000);\n\n    } catch (error: any) {\n      logger.logError(error, { context: 'GuestContactForm', action: 'submit', propertyId });\n      toast({\n        title: 'Erreur',\n        description: error.message || 'Une erreur est survenue lors de l\\'envoi du message',\n        variant: 'destructive',\n      });\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  const isDisabled = isSubmitting || cooldownSeconds > 0 || isSuccess;\n\n  return (\n    <div className=\"bg-card border border-border rounded-lg p-6 shadow-sm\">\n      <div className=\"flex items-center gap-2 mb-4\">\n        <MessageCircle className=\"h-5 w-5 text-primary\" />\n        <h3 className=\"text-lg font-semibold\">Contacter le propriétaire</h3>\n      </div>\n\n      {isSuccess ? (\n        <div className=\"flex flex-col items-center justify-center py-8 text-center\">\n          <CheckCircle2 className=\"h-12 w-12 text-green-500 mb-4\" />\n          <p className=\"text-lg font-medium text-foreground mb-2\">Message envoyé !</p>\n          <p className=\"text-sm text-muted-foreground\">\n            Le propriétaire vous répondra par email dans les plus brefs délais.\n          </p>\n        </div>\n      ) : (\n        <Form {...form}>\n          <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n            <FormField\n              control={form.control}\n              name=\"guestName\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Votre nom *</FormLabel>\n                  <FormControl>\n                    <Input placeholder=\"Jean Dupont\" {...field} />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"guestEmail\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Votre email *</FormLabel>\n                  <FormControl>\n                    <Input type=\"email\" placeholder=\"jean@example.com\" {...field} />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"guestPhone\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Votre téléphone (optionnel)</FormLabel>\n                  <FormControl>\n                    <Input type=\"tel\" placeholder=\"+225 01 23 45 67 89\" {...field} />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"message\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Votre message *</FormLabel>\n                  <FormControl>\n                    <Textarea\n                      placeholder={`Bonjour, je suis intéressé(e) par \"${propertyTitle}\". Pourriez-vous me donner plus d'informations ?`}\n                      className=\"min-h-[120px]\"\n                      {...field}\n                    />\n                  </FormControl>\n                  <FormMessage />\n                  <p className=\"text-xs text-muted-foreground\">\n                    {field.value?.length || 0} / 1000 caractères\n                  </p>\n                </FormItem>\n              )}\n            />\n\n            {/* Honeypot invisible (anti-bot) */}\n            <FormField\n              control={form.control}\n              name=\"honeypot\"\n              render={({ field }) => (\n                <FormItem className=\"hidden\">\n                  <FormControl>\n                    <Input tabIndex={-1} autoComplete=\"off\" {...field} />\n                  </FormControl>\n                </FormItem>\n              )}\n            />\n\n            <div className=\"pt-2\">\n              <Button \n                type=\"submit\" \n                className=\"w-full\" \n                disabled={isDisabled}\n              >\n                {isSubmitting ? (\n                  <>\n                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                    Envoi en cours...\n                  </>\n                ) : cooldownSeconds > 0 ? (\n                  <>Réessayer dans {cooldownSeconds}s</>\n                ) : (\n                  <>\n                    <MessageCircle className=\"mr-2 h-4 w-4\" />\n                    Envoyer le message\n                  </>\n                )}\n              </Button>\n            </div>\n\n            <p className=\"text-xs text-muted-foreground text-center\">\n              En envoyant ce message, vous acceptez que vos données soient utilisées pour vous recontacter.\n            </p>\n          </form>\n        </Form>\n      )}\n    </div>\n  );\n};\n","import { useState, useEffect } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { FileText, Download, Lock, CheckCircle, Loader2 } from \"lucide-react\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { supabase } from \"@/lib/supabase\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { logger } from \"@/services/logger\";\n\ninterface TitleDeedSectionProps {\n  propertyId: string;\n  titleDeedUrl?: string | null;\n  ownerId: string;\n}\n\nexport const TitleDeedSection = ({ propertyId, titleDeedUrl, ownerId }: TitleDeedSectionProps) => {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const [loading, setLoading] = useState(true);\n  const [downloading, setDownloading] = useState(false);\n  const [canAccess, setCanAccess] = useState(false);\n  const [accessReason, setAccessReason] = useState<string>(\"\");\n\n  // ✅ CORRECTION : useEffect au lieu de useState\n  useEffect(() => {\n    const checkAccess = async () => {\n      if (!user || !titleDeedUrl) {\n        setLoading(false);\n        return;\n      }\n\n      try {\n        // Vérifier si propriétaire\n        if (user.id === ownerId) {\n          setCanAccess(true);\n          setAccessReason(\"owner\");\n          setLoading(false);\n          return;\n        }\n\n        // Vérifier si admin\n        const { data: roles } = await supabase\n          .from(\"user_roles\")\n          .select(\"role\")\n          .eq(\"user_id\", user.id)\n          .in(\"role\", [\"admin\", \"super_admin\"]);\n\n        if (roles && roles.length > 0) {\n          setCanAccess(true);\n          setAccessReason(\"admin\");\n          setLoading(false);\n          return;\n        }\n\n        // Vérifier si locataire actif\n        const { data: lease, error } = await supabase\n          .from(\"leases\")\n          .select(\"id, status\")\n          .eq(\"property_id\", propertyId)\n          .eq(\"tenant_id\", user.id)\n          .eq(\"status\", \"active\")\n          .maybeSingle();\n\n        if (error) throw error;\n\n        if (lease) {\n          setCanAccess(true);\n          setAccessReason(\"tenant\");\n        }\n      } catch (error) {\n        logger.logError(error, { context: 'TitleDeedSection', action: 'checkAccess', propertyId });\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    checkAccess();\n  }, [user, titleDeedUrl, propertyId, ownerId]);\n\n  const handleDownload = async () => {\n    if (!titleDeedUrl || !canAccess) return;\n\n    setDownloading(true);\n    try {\n      // ✅ Logger l'accès AVANT le téléchargement\n      await supabase.from(\"title_deed_access_log\").insert({\n        property_id: propertyId,\n        requester_id: user?.id,\n        access_granted: true,\n        access_reason: accessReason,\n      });\n\n      await supabase.from(\"admin_audit_logs\").insert({\n        admin_id: user?.id,\n        action_type: \"title_deed_accessed\",\n        target_type: \"property\",\n        target_id: propertyId,\n        notes: `Accès titre de propriété (raison: ${accessReason})`,\n      });\n\n      // ✅ SÉCURISÉ : Utiliser signedUrl avec expiration si c'est dans le bucket\n      if (titleDeedUrl.includes('property-documents')) {\n        const pathParts = titleDeedUrl.split('/property-documents/')[1];\n        const { data, error } = await supabase.storage\n          .from('property-documents')\n          .createSignedUrl(pathParts, 60);\n\n        if (error) throw error;\n        window.open(data.signedUrl, \"_blank\");\n      } else {\n        // Ancien système (URL directe)\n        window.open(titleDeedUrl, \"_blank\");\n      }\n      \n      toast({\n        title: \"✅ Accès autorisé\",\n        description: \"Le titre de propriété s'ouvrira dans un nouvel onglet\",\n      });\n    } catch (error: any) {\n      logger.logError(error, { context: 'TitleDeedSection', action: 'download', propertyId });\n      \n      // Logger échec\n      await supabase.from(\"title_deed_access_log\").insert({\n        property_id: propertyId,\n        requester_id: user?.id,\n        access_granted: false,\n        access_reason: `denied: ${error.message}`,\n      });\n      \n      // Gestion des erreurs RLS\n      if (error.message?.includes(\"RLS\") || error.message?.includes(\"policy\")) {\n        toast({\n          title: \"🔒 Accès refusé\",\n          description: \"Vous n'avez pas les droits pour accéder à ce document\",\n          variant: \"destructive\",\n        });\n      } else {\n        toast({\n          title: \"❌ Erreur\",\n          description: \"Impossible de télécharger le titre de propriété\",\n          variant: \"destructive\",\n        });\n      }\n    } finally {\n      setDownloading(false);\n    }\n  };\n\n  if (!titleDeedUrl) return null;\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle className=\"flex items-center gap-2\">\n          <FileText className=\"h-5 w-5 text-primary\" />\n          Titre de propriété\n        </CardTitle>\n        <CardDescription>\n          Document officiel attestant de la propriété du bien\n        </CardDescription>\n      </CardHeader>\n      <CardContent>\n        {loading ? (\n          <div className=\"flex items-center justify-center py-8\">\n            <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n          </div>\n        ) : canAccess ? (\n          <div className=\"space-y-4\">\n            <Alert className=\"border-success bg-success/10\">\n              <CheckCircle className=\"h-4 w-4 text-success\" />\n              <AlertDescription>\n                {accessReason === \"tenant\" \n                  ? \"En tant que locataire actif, vous avez accès au titre de propriété\"\n                  : accessReason === \"admin\"\n                  ? \"En tant qu'administrateur, vous avez accès au titre de propriété\"\n                  : \"En tant que propriétaire, vous avez accès au titre de propriété\"}\n              </AlertDescription>\n            </Alert>\n            \n            <Button \n              onClick={handleDownload}\n              disabled={downloading}\n              className=\"w-full\"\n            >\n              {downloading ? (\n                <>\n                  <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                  Chargement...\n                </>\n              ) : (\n                <>\n                  <Download className=\"h-4 w-4 mr-2\" />\n                  Télécharger le titre de propriété\n                </>\n              )}\n            </Button>\n          </div>\n        ) : (\n          <Alert>\n            <Lock className=\"h-4 w-4\" />\n            <AlertDescription>\n              Le titre de propriété est accessible uniquement :\n              <ul className=\"list-disc list-inside mt-2 space-y-1 text-sm\">\n                <li>Au propriétaire du bien</li>\n                <li>Aux locataires ayant un bail actif</li>\n                <li>Aux administrateurs de la plateforme</li>\n              </ul>\n            </AlertDescription>\n          </Alert>\n        )}\n      </CardContent>\n    </Card>\n  );\n};\n","import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { AlertTriangle, DollarSign, Calendar, Clock } from \"lucide-react\";\nimport Lightbox from \"yet-another-react-lightbox\";\nimport Zoom from \"yet-another-react-lightbox/plugins/zoom\";\nimport { useState } from \"react\";\n\ninterface WorkStatusSectionProps {\n  workStatus: string;\n  workDescription?: string | null;\n  workImages?: string[];\n  workEstimatedCost?: number | null;\n  workEstimatedDuration?: string | null;\n  workStartDate?: string | null;\n}\n\nexport const WorkStatusSection = ({\n  workStatus,\n  workDescription,\n  workImages = [],\n  workEstimatedCost,\n  workEstimatedDuration,\n  workStartDate,\n}: WorkStatusSectionProps) => {\n  const [lightboxOpen, setLightboxOpen] = useState(false);\n  const [lightboxIndex, setLightboxIndex] = useState(0);\n\n  if (workStatus !== 'travaux_a_effectuer') return null;\n\n  const slides = workImages.map(url => ({ src: url }));\n\n  return (\n    <Card className=\"border-orange-200 bg-orange-50/50\">\n      <CardHeader>\n        <div className=\"flex items-center gap-3\">\n          <Badge className=\"bg-orange-600 hover:bg-orange-700 text-white text-base px-4 py-2\">\n            <AlertTriangle className=\"h-5 w-5 mr-2\" />\n            ⚠️ Travaux à prévoir\n          </Badge>\n        </div>\n        <CardTitle className=\"text-xl mt-4\">État des travaux</CardTitle>\n      </CardHeader>\n      <CardContent className=\"space-y-6\">\n        {/* Description */}\n        {workDescription && (\n          <div>\n            <h4 className=\"font-semibold mb-2 text-orange-800\">Description des travaux</h4>\n            <p className=\"text-muted-foreground whitespace-pre-line bg-white p-4 rounded-lg border\">\n              {workDescription}\n            </p>\n          </div>\n        )}\n\n        {/* Galerie photos */}\n        {workImages.length > 0 && (\n          <div>\n            <h4 className=\"font-semibold mb-3 text-orange-800\">\n              Photos de l'état actuel ({workImages.length})\n            </h4>\n            <div className=\"grid grid-cols-2 md:grid-cols-3 gap-3\">\n              {workImages.map((url, index) => (\n                <div\n                  key={index}\n                  className=\"relative aspect-video cursor-pointer group overflow-hidden rounded-lg border-2 border-orange-200 hover:border-orange-400 transition-colors\"\n                  onClick={() => {\n                    setLightboxIndex(index);\n                    setLightboxOpen(true);\n                  }}\n                >\n                  <img\n                    src={url}\n                    alt={`Travaux ${index + 1}`}\n                    className=\"w-full h-full object-cover transition-transform group-hover:scale-105\"\n                  />\n                  <div className=\"absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors flex items-center justify-center\">\n                    <span className=\"text-white opacity-0 group-hover:opacity-100 text-sm font-semibold\">\n                      Agrandir\n                    </span>\n                  </div>\n                </div>\n              ))}\n            </div>\n\n            <Lightbox\n              open={lightboxOpen}\n              close={() => setLightboxOpen(false)}\n              index={lightboxIndex}\n              slides={slides}\n              plugins={[Zoom]}\n            />\n          </div>\n        )}\n\n        {/* Estimations (si renseignées) */}\n        {(workEstimatedCost || workEstimatedDuration || workStartDate) && (\n          <div className=\"bg-white p-4 rounded-lg border border-orange-200\">\n            <h4 className=\"font-semibold mb-3 text-orange-800 flex items-center gap-2\">\n              <Calendar className=\"h-5 w-5\" />\n              Informations complémentaires\n            </h4>\n            <div className=\"space-y-2 text-sm\">\n              {workEstimatedCost && (\n                <div className=\"flex items-center gap-2\">\n                  <DollarSign className=\"h-4 w-4 text-orange-600\" />\n                  <span className=\"text-muted-foreground\">Coût estimé :</span>\n                  <span className=\"font-semibold\">\n                    {workEstimatedCost.toLocaleString('fr-FR')} FCFA\n                  </span>\n                </div>\n              )}\n              {workEstimatedDuration && (\n                <div className=\"flex items-center gap-2\">\n                  <Clock className=\"h-4 w-4 text-orange-600\" />\n                  <span className=\"text-muted-foreground\">Durée estimée :</span>\n                  <span className=\"font-semibold\">{workEstimatedDuration}</span>\n                </div>\n              )}\n              {workStartDate && (\n                <div className=\"flex items-center gap-2\">\n                  <Calendar className=\"h-4 w-4 text-orange-600\" />\n                  <span className=\"text-muted-foreground\">Début prévu :</span>\n                  <span className=\"font-semibold\">\n                    {new Date(workStartDate).toLocaleDateString('fr-FR')}\n                  </span>\n                </div>\n              )}\n            </div>\n          </div>\n        )}\n\n        {/* Message d'information */}\n        <div className=\"bg-orange-100 border border-orange-200 p-4 rounded-lg\">\n          <p className=\"text-sm text-orange-800\">\n            <strong>ℹ️ Information importante :</strong> Les travaux seront effectués par le propriétaire \n            avant votre emménagement. Le loyer indiqué s'appliquera une fois les travaux terminés.\n          </p>\n        </div>\n      </CardContent>\n    </Card>\n  );\n};\n","import { useState, useEffect } from 'react';\nimport { useParams, useNavigate, Link } from 'react-router-dom';\nimport { supabase } from '@/lib/supabase';\nimport type { AgencyMandate } from '@/types/admin';\nimport { useQuery } from '@tanstack/react-query';\n\nimport { useDocumentHead } from '@/hooks/useDocumentHead';\nimport Navbar from '@/components/Navbar';\nimport Footer from '@/components/Footer';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\nimport { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';\nimport { Badge } from '@/components/ui/badge';\nimport { Separator } from '@/components/ui/separator';\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Avatar, AvatarFallback } from '@/components/ui/avatar';\nimport { \n  Heart, MapPin, Bed, Bath, Maximize, Home, CheckCircle2, \n  ArrowLeft, MessageCircle, Calendar, DollarSign, Edit, Users,\n  Eye, Star, FileText, TrendingUp, Clock, Lock, ExternalLink, Building2, Info\n} from 'lucide-react';\nimport { getPropertyStatusLabel } from '@/constants';\nimport { useFavorites } from '@/hooks/useFavorites';\nimport { useAuth } from '@/hooks/useAuth';\nimport { usePermissions } from '@/hooks/usePermissions';\nimport { toast } from '@/hooks/use-toast';\nimport { RecommendationsSection } from '@/components/recommendations/RecommendationsSection';\nimport { MediaGallery } from '@/components/property/MediaGallery';\nimport { LocationSection } from '@/components/property/LocationSection';\nimport { VerificationGuard } from '@/components/application/VerificationGuard';\nimport { GuestContactForm } from '@/components/messaging/GuestContactForm';\nimport { TitleDeedSection } from '@/components/property/TitleDeedSection';\nimport { WorkStatusSection } from '@/components/property/WorkStatusSection';\nimport { logger } from '@/services/logger';\nimport type { Property, Application, PropertyStats } from '@/types';\n\ninterface PropertyOwner {\n  id: string;\n  full_name: string;\n  user_type: string;\n  phone: string | null;\n}\n\ninterface ApplicationDisplay extends Application {\n  profiles: {\n    full_name: string;\n    phone: string | null;\n  };\n  user_verifications: {\n    tenant_score: number | null;\n    oneci_status: string;\n    cnam_status: string;\n  }[];\n}\n\nconst PropertyDetail = () => {\n  const { id } = useParams<{ id: string }>();\n  const navigate = useNavigate();\n  const { user } = useAuth();\n  const { canAccessAdminDashboard } = usePermissions();\n  const { toggleFavorite, isFavorite } = useFavorites();\n  const [property, setProperty] = useState<Property | null>(null);\n  const [owner, setOwner] = useState<PropertyOwner | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [selectedImage, setSelectedImage] = useState<string | null>(null);\n  const [applications, setApplications] = useState<ApplicationDisplay[]>([]);\n  const [stats, setStats] = useState<PropertyStats | null>(null);\n  const [newStatus, setNewStatus] = useState<string>('');\n  const [statusDialogOpen, setStatusDialogOpen] = useState(false);\n  const [agencyMandate, setAgencyMandate] = useState<AgencyMandate | null>(null);\n\n  const isOwner = user?.id === property?.owner_id;\n\n  useEffect(() => {\n    if (id) {\n      fetchPropertyDetails();\n      fetchAgencyMandate();\n      if (isOwner) {\n        fetchApplications();\n        fetchStats();\n      }\n    }\n  }, [id, isOwner]);\n\n  const fetchAgencyMandate = async () => {\n    if (!id) return;\n    \n    const { data } = await supabase\n      .from('agency_mandates')\n      .select('*, profiles!agency_mandates_agency_id_fkey(full_name, phone)')\n      .eq('property_id', id)\n      .eq('status', 'active')\n      .maybeSingle();\n    \n    setAgencyMandate(data);\n  };\n\n  const fetchPropertyDetails = async () => {\n    // Validate UUID before query\n    const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;\n    if (!id || !uuidRegex.test(id)) {\n      setLoading(false);\n      return; // Show \"Bien introuvable\"\n    }\n\n    try {\n      const { data: propertyData, error: propertyError } = await supabase\n        .from('properties')\n        .select('*')\n        .eq('id', id)\n        .maybeSingle(); // Use maybeSingle() instead of single()\n\n      if (propertyError) throw propertyError;\n      \n      if (!propertyData) {\n        // Property doesn't exist (deleted or never existed)\n        setLoading(false);\n        return; // Just show \"Bien introuvable\", no toast\n      }\n\n      // Vérifier si bien loué ET utilisateur n'est pas le propriétaire\n      if (\n        propertyData.status === 'loué' && \n        propertyData.owner_id !== user?.id &&\n        !canAccessAdminDashboard\n      ) {\n        toast({\n          title: \"Bien non disponible\",\n          description: \"Ce bien n'est plus disponible à la location.\",\n          variant: \"destructive\"\n        });\n        navigate('/recherche');\n        return;\n      }\n\n      setProperty(propertyData);\n      setSelectedImage(propertyData.main_image);\n\n      // Fetch owner details\n      const { data: ownerData, error: ownerError } = await supabase\n        .from('profiles')\n        .select('id, full_name, user_type, phone')\n        .eq('id', propertyData.owner_id)\n        .maybeSingle(); // Also maybeSingle() here\n\n      if (ownerError) throw ownerError;\n      \n      if (ownerData) {\n        setOwner(ownerData);\n      }\n    } catch (error) {\n      // Toast error ONLY for technical errors\n      logger.error('Error fetching property details', { error, propertyId: id });\n      toast({\n        title: \"Erreur technique\",\n        description: \"Impossible de charger les détails du bien. Veuillez réessayer plus tard.\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchApplications = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('rental_applications')\n        .select(`\n          id,\n          applicant_id,\n          status,\n          created_at,\n          application_score,\n          profiles:applicant_id(full_name, phone)\n        `)\n        .eq('property_id', id)\n        .order('created_at', { ascending: false });\n\n      if (error) throw error;\n      \n      // Fetch user verifications separately\n      if (data) {\n        const applicationsWithVerifications = await Promise.all(\n          data.map(async (app: any) => {\n            const { data: verificationData } = await supabase\n              .from('user_verifications')\n              .select('tenant_score, oneci_status, cnam_status')\n              .eq('user_id', app.applicant_id)\n              .single();\n\n            return {\n              ...app,\n              user_verifications: verificationData ? [verificationData] : [],\n            };\n          })\n        );\n        setApplications(applicationsWithVerifications as ApplicationDisplay[]);\n      }\n    } catch (error) {\n      logger.error('Error fetching applications', { error, propertyId: id });\n    }\n  };\n\n  const fetchStats = async () => {\n    try {\n      // Get favorites count\n      const { count: favCount } = await supabase\n        .from('user_favorites')\n        .select('*', { count: 'exact', head: true })\n        .eq('property_id', id);\n\n      // Get applications count\n      const { count: appCount } = await supabase\n        .from('rental_applications')\n        .select('*', { count: 'exact', head: true })\n        .eq('property_id', id);\n\n      // Get property view count\n      const { data: propertyData } = await supabase\n        .from('properties')\n        .select('view_count')\n        .eq('id', id)\n        .single();\n\n      setStats({\n        views: propertyData?.view_count || 0,\n        favorites: favCount || 0,\n        applications: appCount || 0,\n        conversionRate: 0,\n        view_count: propertyData?.view_count || 0,\n        favorites_count: favCount || 0,\n        applications_count: appCount || 0,\n      });\n    } catch (error) {\n      logger.error('Error fetching property stats', { error, propertyId: id });\n    }\n  };\n\n  const handleStatusChange = async () => {\n    if (!newStatus || !property) return;\n\n    try {\n      const { error } = await supabase\n        .from('properties')\n        .update({ status: newStatus })\n        .eq('id', property.id);\n\n      if (error) throw error;\n\n      setProperty({ ...property, status: newStatus });\n      setStatusDialogOpen(false);\n      toast({\n        title: 'Succès',\n        description: 'Statut mis à jour avec succès',\n      });\n    } catch (error) {\n      logger.error('Error updating property status', { error, propertyId: property.id, newStatus });\n      toast({\n        title: 'Erreur',\n        description: 'Erreur lors de la mise à jour du statut',\n        variant: 'destructive',\n      });\n    }\n  };\n\n  const handleContact = () => {\n    if (!user) {\n      toast({\n        title: \"Connexion requise\",\n        description: \"Veuillez vous connecter pour contacter le propriétaire\",\n        variant: \"destructive\"\n      });\n      navigate('/auth');\n      return;\n    }\n    // Navigate to messaging with owner\n    navigate(`/messages?recipient=${property?.owner_id}`);\n  };\n\n  const handleApply = () => {\n    if (!user) {\n      toast({\n        title: \"Connexion requise\",\n        description: \"Veuillez vous connecter pour postuler\",\n        variant: \"destructive\"\n      });\n      navigate('/auth');\n      return;\n    }\n    navigate(`/application/${property?.id}`);\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary\"></div>\n      </div>\n    );\n  }\n\n  if (!property) {\n    return (\n      <div className=\"min-h-screen flex flex-col\">\n        <Navbar />\n        <main className=\"flex-1 container mx-auto px-4 py-16 text-center\">\n          <h1 className=\"text-2xl font-bold mb-4\">Bien introuvable</h1>\n          <Button asChild>\n            <Link to=\"/recherche\">Retour à la recherche</Link>\n          </Button>\n        </main>\n        <Footer />\n      </div>\n    );\n  }\n\n  const allImages = [\n    property.main_image,\n    ...(property.images || [])\n  ].filter(Boolean) as string[];\n\n  const favorite = isFavorite(property.id);\n\n\n  // Set document head with meta tags\n  useDocumentHead({\n    title: `${property.title} - ${property.city} | Mon Toit`,\n    description: property.description?.substring(0, 155) || `${property.property_type} à ${property.city} - ${property.monthly_rent?.toLocaleString()} FCFA/mois`,\n    ogTitle: `${property.title} - ${property.city}`,\n    ogDescription: property.description?.substring(0, 200),\n    ogImage: property.main_image || property.images?.[0] || 'https://mon-toit.lovable.app/placeholder.svg',\n    ogUrl: `https://mon-toit.lovable.app/properties/${property.id}`,\n    twitterCard: 'summary_large_image'\n  });\n\n  return (\n    <div className=\"min-h-screen flex flex-col\">\n      <Navbar />\n      <main className=\"flex-1 container mx-auto px-4 py-8 pt-24\">\n        <div className=\"max-w-7xl mx-auto\">\n          {/* Back button */}\n          <Button variant=\"ghost\" className=\"mb-4\" onClick={() => navigate(-1)}>\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\n            Retour\n          </Button>\n\n          <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n            {/* Images and main content */}\n            <div className=\"lg:col-span-2 space-y-6\">\n              {/* Multimedia Gallery */}\n              <div className=\"relative\">\n                <MediaGallery\n                  propertyId={property.id}\n                  images={allImages}\n                  videoUrl={property.video_url || undefined}\n                  virtualTourUrl={property.virtual_tour_url || undefined}\n                  panoramicImages={Array.isArray(property.panoramic_images) ? property.panoramic_images : []}\n                  floorPlans={Array.isArray(property.floor_plans) ? property.floor_plans : []}\n                />\n                <Button\n                  size=\"icon\"\n                  variant=\"secondary\"\n                  className=\"absolute top-4 right-4 z-10\"\n                  onClick={() => toggleFavorite(property.id)}\n                >\n                  <Heart className={`h-5 w-5 ${favorite ? 'fill-current text-destructive' : ''}`} />\n                </Button>\n                <Badge \n                  className={`absolute top-4 left-4 z-10 flex items-center gap-1 ${\n                    property.status === 'disponible' \n                      ? 'bg-green-500 hover:bg-green-600 text-white' \n                      : property.status === 'en_negociation'\n                      ? 'bg-orange-500 hover:bg-orange-600 text-white'\n                      : 'bg-gray-400 hover:bg-gray-500 text-white'\n                  }`}\n                >\n                  {property.status === 'en_negociation' && <Clock className=\"h-3 w-3\" />}\n                  {property.status === 'loué' && <Lock className=\"h-3 w-3\" />}\n                  {getPropertyStatusLabel(property.status)}\n                </Badge>\n              </div>\n\n              {/* Agency Management Info */}\n              {agencyMandate && (\n                <Alert>\n                  <Building2 className=\"h-4 w-4\" />\n                  <AlertTitle>Géré par une agence</AlertTitle>\n                  <AlertDescription>\n                    <p className=\"mb-2\">\n                      Ce bien est actuellement géré par une agence immobilière\n                    </p>\n                    <div className=\"flex flex-wrap gap-2 mt-3\">\n                      <Badge variant=\"secondary\">\n                        {agencyMandate.mandate_type === 'location' ? 'Location' : \n                         agencyMandate.mandate_type === 'gestion_complete' ? 'Gestion complète' : 'Vente'}\n                      </Badge>\n                      {agencyMandate.commission_rate && (\n                        <Badge variant=\"outline\">Commission: {agencyMandate.commission_rate}%</Badge>\n                      )}\n                    </div>\n                  </AlertDescription>\n                </Alert>\n              )}\n\n              {/* Description */}\n              <Card>\n                <CardHeader>\n                  <CardTitle>Description</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <p className=\"text-muted-foreground whitespace-pre-line\">\n                    {property.description || 'Aucune description disponible.'}\n                  </p>\n                </CardContent>\n              </Card>\n\n              {/* Characteristics */}\n              <Card>\n                <CardHeader>\n                  <CardTitle>Caractéristiques</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <div className=\"flex items-center gap-2\">\n                      <Home className=\"h-5 w-5 text-primary\" />\n                      <div>\n                        <p className=\"text-sm text-muted-foreground\">Type</p>\n                        <p className=\"font-medium\">{property.property_type}</p>\n                      </div>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <Maximize className=\"h-5 w-5 text-primary\" />\n                      <div>\n                        <p className=\"text-sm text-muted-foreground\">Surface</p>\n                        <p className=\"font-medium\">{property.surface_area || 'N/A'} m²</p>\n                      </div>\n                    </div>\n                <div className=\"flex items-center gap-2\">\n                  <Bed className=\"h-5 w-5 text-primary\" />\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">Chambres</p>\n                    <p className=\"font-medium\">\n                      {property.bedrooms === 0 \n                        ? 'Studio (0 chambre séparée)' \n                        : property.bedrooms\n                      }\n                    </p>\n                  </div>\n                </div>\n                    <div className=\"flex items-center gap-2\">\n                      <Bath className=\"h-5 w-5 text-primary\" />\n                      <div>\n                        <p className=\"text-sm text-muted-foreground\">Salles de bain</p>\n                        <p className=\"font-medium\">{property.bathrooms}</p>\n                      </div>\n                    </div>\n                  </div>\n\n                  <Separator className=\"my-4\" />\n\n                  <div className=\"flex flex-wrap gap-2\">\n                    {property.is_furnished && (\n                      <Badge variant=\"secondary\" className=\"gap-1\">\n                        <CheckCircle2 className=\"h-3 w-3\" />\n                        Meublé\n                      </Badge>\n                    )}\n                    {property.has_ac && (\n                      <Badge variant=\"secondary\" className=\"gap-1\">\n                        <CheckCircle2 className=\"h-3 w-3\" />\n                        Climatisation\n                      </Badge>\n                    )}\n                    {property.has_parking && (\n                      <Badge variant=\"secondary\" className=\"gap-1\">\n                        <CheckCircle2 className=\"h-3 w-3\" />\n                        Parking\n                      </Badge>\n                    )}\n                    {property.has_garden && (\n                      <Badge variant=\"secondary\" className=\"gap-1\">\n                        <CheckCircle2 className=\"h-3 w-3\" />\n                        Jardin\n                      </Badge>\n                    )}\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Location */}\n              {property.latitude && property.longitude && (\n                <Card>\n                  <CardHeader>\n                    <div className=\"flex items-center justify-between\">\n                      <CardTitle className=\"flex items-center gap-2\">\n                        <MapPin className=\"h-5 w-5\" />\n                        Localisation\n                      </CardTitle>\n                      <Button \n                        variant=\"outline\" \n                        size=\"sm\" \n                        asChild\n                      >\n                        <a \n                          href={`https://maps.google.com/?q=${property.latitude},${property.longitude}`}\n                          target=\"_blank\" \n                          rel=\"noopener noreferrer\"\n                          className=\"gap-2\"\n                        >\n                          <ExternalLink className=\"h-4 w-4\" />\n                          Google Maps\n                        </a>\n                      </Button>\n                    </div>\n                  </CardHeader>\n                  <CardContent>\n                    <LocationSection \n                      propertyId={property.id}\n                      latitude={property.latitude}\n                      longitude={property.longitude}\n                      city={property.city}\n                      address={property.address}\n                    />\n                  </CardContent>\n                </Card>\n              )}\n\n              {/* Work Status Section */}\n              <WorkStatusSection\n                workStatus={property.work_status || 'aucun_travail'}\n                workDescription={property.work_description}\n                workImages={Array.isArray(property.work_images) ? property.work_images : []}\n                workEstimatedCost={property.work_estimated_cost}\n                workEstimatedDuration={property.work_estimated_duration}\n                workStartDate={property.work_start_date}\n              />\n\n              {/* Title Deed Section */}\n              <TitleDeedSection \n                propertyId={property.id}\n                titleDeedUrl={property.title_deed_url}\n                ownerId={property.owner_id}\n              />\n            </div>\n\n            {/* Sidebar */}\n            <div className=\"space-y-6\">\n              {/* Owner actions */}\n              {isOwner && (\n                <Card className=\"border-primary\">\n                  <CardHeader>\n                    <CardTitle>Actions propriétaire</CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-2\">\n                    <Button \n                      variant=\"outline\" \n                      className=\"w-full gap-2\" \n                      onClick={() => navigate(`/biens/${property.id}/modifier`)}\n                    >\n                      <Edit className=\"h-4 w-4\" />\n                      Modifier ce bien\n                    </Button>\n                    \n                    <Dialog open={statusDialogOpen} onOpenChange={setStatusDialogOpen}>\n                      <DialogTrigger asChild>\n                        <Button variant=\"outline\" className=\"w-full gap-2\">\n                          <TrendingUp className=\"h-4 w-4\" />\n                          Changer le statut\n                        </Button>\n                      </DialogTrigger>\n                      <DialogContent>\n                        <DialogHeader>\n                          <DialogTitle>Changer le statut du bien</DialogTitle>\n                          <DialogDescription>\n                            Sélectionnez le nouveau statut pour ce bien\n                          </DialogDescription>\n                        </DialogHeader>\n                        <Select value={newStatus} onValueChange={setNewStatus}>\n                          <SelectTrigger>\n                            <SelectValue placeholder=\"Sélectionner un statut\" />\n                          </SelectTrigger>\n                          <SelectContent>\n                            <SelectItem value=\"disponible\">Disponible</SelectItem>\n                            <SelectItem value=\"loué\">Loué</SelectItem>\n                            <SelectItem value=\"retiré\">Retiré</SelectItem>\n                          </SelectContent>\n                        </Select>\n                        <DialogFooter>\n                          <Button variant=\"outline\" onClick={() => setStatusDialogOpen(false)}>\n                            Annuler\n                          </Button>\n                          <Button onClick={handleStatusChange}>\n                            Confirmer\n                          </Button>\n                        </DialogFooter>\n                      </DialogContent>\n                    </Dialog>\n                  </CardContent>\n                </Card>\n              )}\n\n              {/* Statistics for owner */}\n              {isOwner && stats && (\n                <Card>\n                  <CardHeader>\n                    <CardTitle>Statistiques</CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-3\">\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center gap-2 text-muted-foreground\">\n                        <Eye className=\"h-4 w-4\" />\n                        <span className=\"text-sm\">Vues</span>\n                      </div>\n                      <span className=\"font-semibold\">{stats.view_count}</span>\n                    </div>\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center gap-2 text-muted-foreground\">\n                        <Star className=\"h-4 w-4\" />\n                        <span className=\"text-sm\">Favoris</span>\n                      </div>\n                      <span className=\"font-semibold\">{stats.favorites_count}</span>\n                    </div>\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center gap-2 text-muted-foreground\">\n                        <FileText className=\"h-4 w-4\" />\n                        <span className=\"text-sm\">Candidatures</span>\n                      </div>\n                      <span className=\"font-semibold\">{stats.applications_count}</span>\n                    </div>\n                  </CardContent>\n                </Card>\n              )}\n\n              {/* Price card */}\n              <Card>\n                <CardHeader>\n                  <h1 className=\"text-3xl font-bold\">{property.title}</h1>\n                  <p className=\"text-3xl font-bold text-primary mt-2\">\n                    {property.monthly_rent.toLocaleString()} FCFA\n                    <span className=\"text-sm text-muted-foreground font-normal\">/mois</span>\n                  </p>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  {property.deposit_amount && (\n                    <div className=\"flex items-center justify-between text-sm\">\n                      <span className=\"text-muted-foreground\">Caution</span>\n                      <span className=\"font-medium\">{property.deposit_amount.toLocaleString()} FCFA</span>\n                    </div>\n                  )}\n\n                  <Separator />\n\n                  {!isOwner && !user && property.status === 'disponible' && (\n                    <div className=\"space-y-2\">\n                      <Button asChild size=\"lg\" className=\"w-full gap-2\">\n                        <Link to=\"/auth\">\n                          <Users className=\"h-5 w-5\" />\n                          Créer un compte pour postuler\n                        </Link>\n                      </Button>\n                      <p className=\"text-xs text-center text-muted-foreground\">\n                        Inscription gratuite en 2 minutes\n                      </p>\n                    </div>\n                  )}\n                  \n                  {!isOwner && user && (\n                    <div className=\"space-y-2\">\n                      <Button className=\"w-full gap-2\" onClick={handleContact}>\n                        <MessageCircle className=\"h-4 w-4\" />\n                        Contacter le propriétaire\n                      </Button>\n                      {property.status === 'disponible' && (\n                        <VerificationGuard propertyId={property.id}>\n                          <Button variant=\"outline\" className=\"w-full gap-2\">\n                            <Calendar className=\"h-4 w-4\" />\n                            Postuler\n                          </Button>\n                        </VerificationGuard>\n                      )}\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n\n              {/* Guest Contact Form (for non-authenticated users) */}\n              {!isOwner && !user && property.status === 'disponible' && owner && (\n                <GuestContactForm \n                  propertyId={property.id}\n                  ownerId={owner.id}\n                  propertyTitle={property.title}\n                />\n              )}\n\n              {/* Owner card */}\n              {owner && !isOwner && (\n                <Card>\n                  <CardHeader>\n                    <CardTitle>Propriétaire</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"flex items-center gap-3\">\n                      <Avatar className=\"h-12 w-12\">\n                        <AvatarFallback>\n                          {owner.full_name.charAt(0).toUpperCase()}\n                        </AvatarFallback>\n                      </Avatar>\n                      <div className=\"flex-1\">\n                        <p className=\"font-medium\">{owner.full_name}</p>\n                        <p className=\"text-sm text-muted-foreground capitalize\">\n                          {owner.user_type}\n                        </p>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              )}\n\n              {/* Applications for owner */}\n              {isOwner && applications.length > 0 && (\n                <Card>\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center gap-2\">\n                      <Users className=\"h-5 w-5\" />\n                      Candidatures ({applications.length})\n                    </CardTitle>\n                    <CardDescription>\n                      Liste des candidats pour ce bien\n                    </CardDescription>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"space-y-3\">\n                      {applications.slice(0, 5).map((app) => (\n                        <div key={app.id} className=\"flex items-center justify-between p-3 border rounded-lg\">\n                          <div className=\"flex-1\">\n                            <p className=\"font-medium\">{app.profiles.full_name}</p>\n                            <div className=\"flex items-center gap-2 mt-1\">\n                              <Badge variant={app.status === 'pending' ? 'secondary' : app.status === 'approved' ? 'default' : 'destructive'}>\n                                {app.status === 'pending' ? 'En attente' : app.status === 'approved' ? 'Approuvé' : 'Rejeté'}\n                              </Badge>\n                              {app.user_verifications[0]?.tenant_score && (\n                                <Badge variant=\"outline\">\n                                  Score: {app.user_verifications[0].tenant_score}/100\n                                </Badge>\n                              )}\n                            </div>\n                          </div>\n                          <Button \n                            size=\"sm\" \n                            variant=\"ghost\"\n                            onClick={() => navigate(`/candidatures`)}\n                          >\n                            Voir\n                          </Button>\n                        </div>\n                      ))}\n                      {applications.length > 5 && (\n                        <Button \n                          variant=\"outline\" \n                          className=\"w-full\"\n                          onClick={() => navigate(`/candidatures`)}\n                        >\n                          Voir toutes les candidatures\n                        </Button>\n                      )}\n                    </div>\n                  </CardContent>\n                </Card>\n              )}\n\n              {/* Info card */}\n              <Card>\n                <CardContent className=\"pt-6\">\n                  <div className=\"space-y-2 text-sm text-muted-foreground\">\n                    <p className=\"flex items-center gap-2\">\n                      <Calendar className=\"h-4 w-4\" />\n                      Publié le {new Date(property.created_at).toLocaleDateString('fr-FR')}\n                    </p>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          </div>\n\n          {/* Similar Properties Section */}\n          {!isOwner && user && (\n            <div className=\"mt-12\">\n              <RecommendationsSection\n                userId={user.id}\n                type=\"properties\"\n                limit={4}\n                title=\"Biens similaires\"\n              />\n            </div>\n          )}\n        </div>\n      </main>\n      <Footer />\n    </div>\n  );\n};\n\nexport default PropertyDetail;\n"],"names":["useFavorites","user","useAuth","favorites","setFavorites","useState","loading","setLoading","useEffect","fetchFavorites","data","error","supabase","logger","localFavorites","f","err","propertyId","toast","isFavorite","id","useRecommendations","type","limit","autoFetch","recommendations","setRecommendations","setError","fetchedRef","useRef","fetchRecommendations","useCallback","functionError","errorObj","updatePreferences","preferences","trackSearch","searchFilters","resultCount","clickedProperties","timeoutId","RecommendationCard","item","score","reasons","navigate","useNavigate","getScoreColor","handleClick","_a","property","jsxs","Card","jsx","Badge","Star","Wrench","CardContent","StatusBadge","MapPin","_b","reason","idx","Button","e","profile","_c","CarouselContext","React.createContext","useCarousel","context","React.useContext","Carousel","React.forwardRef","orientation","opts","setApi","plugins","className","children","props","ref","carouselRef","api","useEmblaCarousel","canScrollPrev","setCanScrollPrev","React.useState","canScrollNext","setCanScrollNext","onSelect","React.useCallback","scrollPrev","scrollNext","handleKeyDown","event","React.useEffect","cn","CarouselContent","CarouselItem","CarouselPrevious","variant","size","ArrowLeft","CarouselNext","ArrowRight","RecommendationsSection","userId","title","refetch","Skeleton","_","i","RefreshCw","rec","usePropertyPermissions","roles","activeMandates","asAgency","useAgencyMandates","canManageProperties","canEditProperty","ownerId","mandate","hasAgencyPermission","permission","m","requireOwnerAccess","ERROR_MESSAGES","useUserPhone","phone","setPhone","ApplicantPhoneDisplay","applicantId","PropertyApplications","useParams","setProperty","applications","setApplications","rejectDialogOpen","setRejectDialogOpen","selectedApplication","setSelectedApplication","rejectionNote","setRejectionNote","sortBy","setSortBy","filterMatch","setFilterMatch","isAgencyView","setIsAgencyView","canManageApps","setCanManageApps","fetchData","propertyData","propError","isOwner","hasViewPerm","hasManagePerm","applicationsData","appError","enrichedApplications","app","r","updateApplicationStatus","applicationId","status","note","application","handleReject","getStatusBadge","variants","labels","getScoreBadge","getMatchBadge","Sparkles","CheckCircle2","processedApps","a","b","pendingApps","approvedApps","rejectedApps","Navbar","DynamicBreadcrumb","Alert","Info","AlertDescription","UserCircle","CardHeader","CardTitle","FileText","Clock","Select","v","SelectTrigger","SelectValue","SelectContent","SelectItem","Tabs","TabsList","TabsTrigger","value","apps","TabsContent","Avatar","AvatarFallback","TrendingUp","Award","Eye","Fragment","XCircle","startDate","endDate","Dialog","DialogContent","DialogHeader","DialogTitle","DialogDescription","Textarea","DialogFooter","Footer","celebrateCertification","animationEnd","defaults","randomInRange","min","max","interval","timeLeft","particleCount","confetti","celebrateFirstApplication","celebrateLeaseSigned","fire","particleRatio","MAX_IMAGE_SIZE","ACCEPTED_IMAGE_TYPES","IMAGE_QUALITY","MAX_IMAGE_DIMENSION","SimpleProgress","compressImage","base64","maxWidth","quality","resolve","reject","img","canvas","width","height","ctx","compressed","originalSize","compressedSize","reduction","validateImage","file","ONECIForm","onSubmit","cniImage","setCniImage","selfieImage","setSelfieImage","isCapturing","setIsCapturing","isVideoLoading","setIsVideoLoading","isVerifying","setIsVerifying","uploadProgress","setUploadProgress","verificationResult","setVerificationResult","videoRef","canvasRef","streamRef","track","startCamera","stream","video","playPromise","onCanPlay","onError","playError","errorMessage","errorDescription","stopCamera","captureSelfie","imageData","handleCniUpload","validation","reader","progress","handleVerify","reset","Shield","CardDescription","AlertCircle","Label","CheckCircle","Upload","Camera","useDocumentHead","options","originalTitle","addedElements","setMetaTag","content","isProperty","attribute","element","script","VideoPlayer","url","thumbnail","isPlaying","setIsPlaying","Play","isYouTube","isVimeo","embedUrl","FloorPlanViewer","plans","activeIndex","setActiveIndex","activePlan","plan","index","TransformWrapper","zoomIn","zoomOut","resetTransform","ZoomIn","ZoomOut","Maximize2","TransformComponent","OptimizedImage","SwipeGallery","images","onImageChange","currentIndex","setCurrentIndex","scale","setScale","position","setPosition","lastTap","setLastTap","useMemo","start","end","handleNext","triggerHapticFeedback","newIndex","handlePrevious","swipeHandlers","useSwipeable","handleTap","now","touchStartRef","getTouchDistance","touches","dx","dy","handleTouchStart","handleTouchMove","scaleChange","newScale","handleTouchEnd","ChevronLeft","ChevronRight","usePropertyImageAccess","hasValidatedDossier","useQuery","usePanoramaPrefetch","imageUrls","enabled","priority","prefetchedRef","prefetchImage","link","cleanupFns","cleanup","MediaGallery","videoUrl","virtualTourUrl","panoramicImages","floorPlans","lightboxOpen","setLightboxOpen","lightboxIndex","setLightboxIndex","currentPanoramaIndex","setCurrentPanoramaIndex","isMobile","useIsMobile","maxImages","showBlur","showHDPhotos","show3DTour","showFloorPlans","panoramaUrls","p","prefetchOnHover","displayImages","hiddenImagesCount","hasVideo","has360","hasPlans","openLightbox","Image","Video","Globe","Layout","Lock","AlertTitle","Link","image","Lightbox","src","Zoom","Fullscreen","LocationSection","latitude","longitude","city","address","canViewMap","VerificationGuard","onVerified","dialogOpen","setDialogOpen","verification","setVerification","verifying","setVerifying","formSubmitted","setFormSubmitted","verificationStatus","isVerified","isPending","checkVerificationStatus","fetchError","proceedToNextStep","handleFormSubmit","handleVerificationSuccess","AlertTriangle","Loader2","Form","FormProvider","FormFieldContext","FormField","Controller","useFormField","fieldContext","itemContext","FormItemContext","getFieldState","formState","useFormContext","fieldState","FormItem","React.useId","FormLabel","formItemId","FormControl","formDescriptionId","formMessageId","Slot","FormDescription","FormMessage","body","guestContactSchema","z.object","z.string","GuestContactForm","propertyTitle","isSubmitting","setIsSubmitting","isSuccess","setIsSuccess","cooldownSeconds","setCooldownSeconds","useToast","form","useForm","zodResolver","lastSentKey","lastSent","timeSinceLastSent","cooldownMs","remaining","timer","values","retryDate","waitSeconds","isDisabled","MessageCircle","field","Input","TitleDeedSection","titleDeedUrl","downloading","setDownloading","canAccess","setCanAccess","accessReason","setAccessReason","lease","handleDownload","pathParts","Download","WorkStatusSection","workStatus","workDescription","workImages","workEstimatedCost","workEstimatedDuration","workStartDate","slides","Calendar","DollarSign","PropertyDetail","canAccessAdminDashboard","usePermissions","toggleFavorite","owner","setOwner","selectedImage","setSelectedImage","stats","setStats","newStatus","setNewStatus","statusDialogOpen","setStatusDialogOpen","agencyMandate","setAgencyMandate","fetchPropertyDetails","fetchAgencyMandate","fetchApplications","fetchStats","propertyError","ownerData","ownerError","applicationsWithVerifications","verificationData","favCount","appCount","handleStatusChange","handleContact","allImages","favorite","_d","Heart","getPropertyStatusLabel","Building2","Home","Maximize","Bed","Bath","Separator","ExternalLink","Edit","DialogTrigger","Users"],"mappings":"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"}